<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toddler Genius Academy</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', sans-serif;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            height: 100vh;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        #game-container {
            width: 98%;
            height: 98%;
            max-width: none;
            max-height: none;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            overflow: visible;
            position: relative;
        }        
        
        /* Menu Styles */
        #main-menu {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            padding: -20px;
            transition: all 0.5s ease;
        }
        
        .title {
            font-size: 48px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .menu-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            width: 90%;
            max-width: 1000px;
        }
        
        .menu-button {
            background-color: #fff;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            min-height: 180px;
            position: relative;
        }
        
        .menu-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.15);
        }
        
        .menu-button img {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }
        
        .menu-button h3 {
            font-size: 24px;
            color: #ff8c00;
            margin-bottom: 8px;
        }
        
        .menu-button p {
            font-size: 16px;
            color: #777;
        }
        
        .age-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff6b81;
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        
        /* Game Screen Styles */
        .game-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow: auto;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 3px solid #f0f0f0;
            margin-bottom: 20px;
            z-index: 10;
        }
        
        .back-button {
            background-color: #ff7043;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            background-color: #f4511e;
            transform: scale(1.05);
        }
        
        .difficulty-controls {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .difficulty-button {
            background-color: #e0e0e0;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .difficulty-button.active {
            background-color: #4caf50;
            color: white;
        }
        
        .game-title {
            font-size: 32px;
            color: #ff6b81;
        }
        
        .game-score {
            display: flex;
            align-items: center;
        }
        
        .star {
            width: 40px;
            height: 40px;
            margin-left: 5px;
            background-color: #f1c40f;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .game-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 60px 20px 20px 20px;
        }
        
        /* Character Styles */
        .character {
            position: absolute;
            width: 120px;
            height: 160px;
            z-index: 10;
            left: -20px;
            top: -800px;
            transform: scale(0.8);
        }
        
        .character-body {
            position: absolute;
            width: 100px;
            height: 100px;
            background-color: #ffcd94;
            border-radius: 50%;
            top: 50px;
            left: 25px;
            z-index: 2;
            overflow: auto;
        }
        
        .character-head {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: #ffcd94;
            border-radius: 50%;
            top: 10px;
            left: 35px;
            z-index: 3;
        }
        
        .character-eye {
            position: absolute;
            width: 15px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            top: 30px;
            z-index: 4;
        }
        
        .character-eye.left {
            left: 50px;
        }
        
        .character-eye.right {
            left: 85px;
        }
        
        .character-pupil {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #333;
            border-radius: 50%;
            top: 35px;
            z-index: 5;
        }
        
        .character-pupil.left {
            left: 55px;
        }
        
        .character-pupil.right {
            left: 90px;
        }
        
        .character-mouth {
            position: absolute;
            width: 40px;
            height: 15px;
            background-color: #ff8080;
            border-radius: 0 0 20px 20px;
            top: 55px;
            left: 60px;
            z-index: 4;
        }
        
        .character-arm {
            position: absolute;
            width: 15px;
            height: 60px;
            background-color: #ffcd94;
            border-radius: 10px;
            top: 80px;
            z-index: 1;
        }
        
        .character-arm.left {
            left: 20px;
            transform: rotate(-20deg);
        }
        
        .character-arm.right {
            left: 115px;
            transform: rotate(20deg);
        }
        
        .character-speech {
            position: absolute;
            background-color: white;
            border: 3px solid #333;
            border-radius: 20px;
            padding: 15px;
            max-width: 250px;
            top: -20px;
            left: 130px;
            font-size: 18px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .character-speech:before {
            content: '';
            position: absolute;
            left: -15px;
            top: 30px;
            border-width: 10px;
            border-style: solid;
            border-color: transparent #333 transparent transparent;
        }
        
        /* Pattern Recognition Game */
        #patterns-game {
            background-color: #f8f9fa;
        }
        
        .pattern-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            justify-content: center;
        }
        
        .pattern-row {
            display: flex;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .pattern-item {
            width: 80px;
            height: 80px;
            margin: 0 10px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .pattern-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .pattern-item.selected {
            border: 3px solid #4caf50;
            margin: -3px 7px;
        }
        
        .pattern-item.correct {
            background-color: #a5d6a7;
        }
        
        .pattern-item.incorrect {
            background-color: #ef9a9a;
        }
        
        .answer-row {
            display: flex;
            justify-content: center;
            margin-top: 40px;
        }
        
        .question-mark {
            width: 80px;
            height: 80px;
            background-color: #e0e0e0;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 0 10px;
            box-sizing: border-box;
        }
        
        /* Shapes and Colors Game */
        #shapes-game {
            background-color: #e8f5e9;
        }
        
        .shape-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 80%;
        }
        
        .shape-item {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .shape-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .shape-item.selected {
            border: 4px solid #ffd700;
            margin: -4px;
        }
        
        .shape-prompt {
            font-size: 24px;
            margin-bottom: 30px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 15px;
            max-width: 80%;
        }
        
        /* Counting Game */
        #counting-game {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
        }
        
        .counting-container {
            width: 80%;
            height: 60%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .counting-objects {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            width: 100%;
            height: 60%;
        }
        
        .counting-object {
            font-size: 40px;
            margin: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .counting-object:hover {
            transform: scale(1.2);
        }
        
        .counting-prompt {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .number-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .number-button {
            width: 50px;
            height: 50px;
            margin: 10px;
            border-radius: 50%;
            background-color: #ff9800;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .number-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Cause and Effect Game */
        #cause-effect-game {
            background: linear-gradient(135deg, #fff9c4 0%, #fff176 100%);
        }
        
        .interactive-scene {
            width: 80%;
            height: 70%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: auto;
        }
        
        .interactive-element {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interactive-element:hover {
            transform: scale(1.1);
        }
        
        .sun {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ffeb3b 0%, #ffc107 100%);
            border-radius: 50%;
            top: 50px;
            right: 50px;
        }
        
        .cloud {
            width: 120px;
            height: 60px;
            background-color: #eceff1;
            border-radius: 30px;
        }
        
        .cloud:before, .cloud:after {
            content: '';
            position: absolute;
            background-color: #eceff1;
            border-radius: 50%;
        }
        
        .cloud:before {
            width: 60px;
            height: 60px;
            top: -20px;
            left: 15px;
        }
        
        .cloud:after {
            width: 80px;
            height: 80px;
            top: -30px;
            right: 15px;
        }
        
        .cloud1 {
            top: 80px;
            left: 50px;
        }
        
        .cloud2 {
            top: 150px;
            right: 80px;
        }
        
        .grass {
            width: 100%;
            height: 100px;
            background-color: #81c784;
            position: absolute;
            bottom: 0;
            left: 0;
        }
        
        .tree {
            width: 40px;
            height: 120px;
            background-color: #795548;
            position: absolute;
            bottom: 100px;
            left: 200px;
        }
        
        .tree:before {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            background-color: #66bb6a;
            border-radius: 50%;
            top: -80px;
            left: -40px;
        }
        
        .flower {
            width: 20px;
            height: 60px;
            background-color: #8bc34a;
            position: absolute;
            bottom: 100px;
        }
        
        .flower:before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            top: -20px;
            left: -5px;
        }
        
        .flower1 {
            left: 100px;
        }
        
        .flower1:before {
            background-color: #e91e63;
        }
        
        .flower2 {
            left: 150px;
        }
        
        .flower2:before {
            background-color: #9c27b0;
        }
        
        .flower3 {
            left: 380px;
        }
        
        .flower3:before {
            background-color: #ff9800;
        }
        
        .raindrop {
            position: absolute;
            width: 10px;
            height: 20px;
            background-color: #64b5f6;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.5s ease;
        }
        
        /* Memory Game */
        #memory-game {
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
        }
        
        .memory-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 80%;
            max-width: 500px;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background-color: #7986cb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
            box-sizing: border-box;
        }
        
        .memory-card:hover {
            transform: scale(1.05);
        }
        
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        
        .memory-card-front, .memory-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            box-sizing: border-box;
        }
        
        .memory-card-front {
            background-color: #7986cb;
            transform: rotateY(0deg);
        }
        
        .memory-card-back {
            background-color: white;
            transform: rotateY(180deg);
            font-size: 48px;
        }
        
        /* Alphabet Game */
        #alphabet-game {
            background: linear-gradient(135deg, #ffccbc 0%, #ffab91 100%);
        }
        
        .alphabet-container {
            width: 90%;
            height: 70%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .letter-display {
            font-size: 120px;
            font-weight: bold;
            margin: 20px 0;
            color: #ff6d00;
            text-shadow: 3px 3px 0 #ffcc80;
        }
        
        .alphabet-objects {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
        }
        
        .alphabet-object {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .alphabet-object:hover {
            transform: scale(1.1);
        }
        
        .alphabet-object-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }
        
        .alphabet-object-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .letter-navigation {
            display: flex;
            justify-content: space-between;
            width: 80%;
            margin-top: 30px;
        }
        
        .letter-nav-button {
            background-color: #ff7043;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .letter-nav-button:hover {
            background-color: #f4511e;
            transform: scale(1.05);
        }
        
        /* Puzzle Game */
        #puzzle-game {
            background: linear-gradient(135deg, #b2ebf2 0%, #80deea 100%);
        }
        
        .puzzle-container {
            width: 80%;
            max-width: 600px;
            aspect-ratio: 1;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            padding: 5px;
            position: relative;
        }
        
        .puzzle-piece {
            background-size: 300% 300%;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .puzzle-piece:hover {
            transform: scale(0.95);
        }
        
        .puzzle-preview {
            position: absolute;
            top: -100px;
            right: 20px;
            width: 150px;
            height: 150px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: 3px solid white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Music Game */
        #music-game {
            background: linear-gradient(135deg, #d1c4e9 0%, #b39ddb 100%);
        }
        
        .piano-container {
            width: 90%;
            max-width: 700px;
            height: 200px;
            position: relative;
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .piano-key {
            height: 100%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 0 0 5px 5px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.1s ease;
            flex-grow: 1;
            margin: 0 2px;
        }
        
        .piano-key.black {
            background-color: #333;
            height: 60%;
            width: 60%;
            position: absolute;
            z-index: 2;
            border-radius: 0 0 5px 5px;
        }
        
        .piano-key:hover {
            background-color: #f0f0f0;
        }
        
        .piano-key.black:hover {
            background-color: #555;
        }
        
        .piano-key.pressed {
            background-color: #e3f2fd;
        }
        
        .piano-key.black.pressed {
            background-color: #555;
        }
        
        .note-flying {
            position: absolute;
            font-size: 24px;
            color: #7e57c2;
            opacity: 0;
            animation: fly-note 2s linear;
        }
        
        @keyframes fly-note {
            0% {
                bottom: 0;
                opacity: 1;
            }
            100% {
                bottom: 200px;
                opacity: 0;
            }
        }
        
        .music-sequence {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .sequence-note {
            width: 40px;
            height: 40px;
            margin: 0 5px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            background-color: white;
            border: 2px solid #7e57c2;
            transition: all 0.2s ease;
        }
        
        .sequence-note.highlight {
            background-color: #7e57c2;
            color: white;
            transform: scale(1.1);
        }
        
        /* Drawing Game */
        #drawing-game {
            background: linear-gradient(135deg, #ffcc80 0%, #ffb74d 100%);
        }
        
        .drawing-container {
            width: 80%;
            height: 60%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            overflow: auto;
            position: relative;
        }
        
        .drawing-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        .drawing-toolbar {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .drawing-tool {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .drawing-tool:hover {
            transform: scale(1.1);
        }
        
        .drawing-color {
            border: 2px solid #fff;
        }
        
        .drawing-size {
            background-color: white;
            font-size: 20px;
            font-weight: bold;
        }
        
        .drawing-action {
            background-color: white;
            font-size: 20px;
        }
        
        /* Science Game */
        #science-game {
            background: linear-gradient(135deg, #c5e1a5 0%, #aed581 100%);
        }
        
        .experiment-container {
            width: 80%;
            height: 70%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .experiment-title {
            font-size: 28px;
            font-weight: bold;
            color: #558b2f;
            margin-bottom: 20px;
        }
        
        .experiment-steps {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        
        .experiment-step {
            width: 150px;
            height: 150px;
            background-color: #f1f8e9;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .experiment-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .experiment-step-number {
            font-size: 24px;
            font-weight: bold;
            color: #558b2f;
            margin-bottom: 10px;
        }
        
        .experiment-step-icon {
            font-size: 50px;
        }
        
        .experiment-result {
            width: 90%;
            height: 200px;
            background-color: #f1f8e9;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            position: relative;
        }
        
        /* Math Game */
        #math-game {
            background: linear-gradient(135deg, #90caf9 0%, #64b5f6 100%);
        }
        
        .math-problem-container {
            width: 80%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            position: relative;
        }
        
        .math-problem {
            font-size: 48px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 30px;
        }
        
        .math-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        
        .math-option {
            width: 80px;
            height: 80px;
            background-color: #e3f2fd;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .math-option:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .math-option.correct {
            background-color: #a5d6a7;
        }
        
        .math-option.incorrect {
            background-color: #ef9a9a;
        }
        
        /* Story Game */
        #story-game {
            background: linear-gradient(135deg, #ffecb3 0%, #ffe082 100%);
        }
        
        .story-container {
            width: 90%;
            height: 70%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow: auto;
            position: relative;
        }
        
        .story-scene {
            width: 100%;
            height: 60%;
            background-color: #fbfbfb;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 20px;
            overflow: auto;
        }
        
        .story-character {
            position: absolute;
            transition: all 0.5s ease;
        }
        
        .story-text {
            width: 100%;
            height: 30%;
            font-size: 24px;
            padding: 15px;
            text-align: center;
            overflow-y: auto;
            color: #5d4037;
            background-color: #fff8e1;
            border-radius: 10px;
        }
        
        .story-controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 15px;
        }
        
        .story-button {
            background-color: #ffa000;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .story-button:hover {
            background-color: #ff8f00;
            transform: scale(1.05);
        }
        
        .story-choices {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }
        
        .story-choice {
            background-color: #fff8e1;
            border: 2px solid #ffa000;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .story-choice:hover {
            background-color: #ffa000;
            color: white;
            transform: scale(1.05);
        }
        
        /* Profile Screen */
        #profile-screen {
            background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%);
        }
        
        .profile-container {
            width: 90%;
            height: 90%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: auto;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            background-color: #bbdefb;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 20px;
            font-size: 48px;
        }
        
        .profile-info {
            flex-grow: 1;
        }
        
        .profile-name {
            font-size: 28px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }
        
        .profile-age {
            font-size: 18px;
            color: #546e7a;
        }
        
        .profile-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .profile-stat {
            flex: 1;
            min-width: 150px;
            background-color: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .profile-stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #1565c0;
        }
        
        .profile-stat-label {
            font-size: 16px;
            color: #546e7a;
        }
        
        .profile-achievements {
            flex-grow: 1;
            background-color: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .achievements-title {
            font-size: 24px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .achievement-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .achievement-item {
            width: 120px;
            height: 120px;
            background-color: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .achievement-name {
            font-size: 14px;
            text-align: center;
            color: #546e7a;
        }
        
        /* Reward Screen */
        .reward-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .reward-content {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 80%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .reward-title {
            font-size: 36px;
            color: #ff9800;
            margin-bottom: 20px;
        }
        
        .stars-container {
            display: flex;
            margin: 20px 0;
        }
        
        .reward-star {
            width: 60px;
            height: 60px;
            margin: 0 10px;
            background-color: #f1c40f;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            transition: all 0.3s ease;
        }
        
        .reward-continue {
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 20px;
        }
        
        .reward-continue:hover {
            background-color: #388e3c;
            transform: scale(1.05);
        }
        
        .achievement-unlocked {
            margin-top: 20px;
            font-size: 20px;
            color: #ff6d00;
            display: flex;
            align-items: center;
        }
        
        .achievement-unlocked-icon {
            font-size: 30px;
            margin-right: 10px;
        }
        
        /* Progress Path */
        .progress-path {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 10px 15px;
            z-index: 5;
        }
        
        .path-node {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            margin: 0 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            color: #333;
            position: relative;
        }
        
        .path-node.completed {
            background-color: #4caf50;
            color: white;
        }
        
        .path-node.current {
            background-color: #ff9800;
            color: white;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }
        
        .path-line {
            height: 3px;
            width: 20px;
            background-color: #e0e0e0;
        }
        
        .path-line.completed {
            background-color: #4caf50;
        }
        
        /* Parent Controls */
        #parent-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 101;
        }
        
        .parent-button {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .parent-button:hover {
            background-color: white;
            transform: scale(1.1);
        }
        
        .parent-panel {
            position: absolute;
            top: 50px;
            right: 0;
            width: 300px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: none;
            z-index: 102;
        }
        
        .parent-panel h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .setting-label {
            font-size: 14px;
            color: #555;
        }
        
        .setting-control {
            width: 150px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4caf50;
            cursor: pointer;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4caf50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        .parent-pin-entry {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .pin-input {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .pin-digit {
            width: 40px;
            height: 40px;
            margin: 0 5px;
            border: 2px solid #ccc;
            border-radius: 5px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 180px;
        }
        
        .pin-key {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pin-key:hover {
            background-color: #e0e0e0;
        }
        
        /* Animation keyframes */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-10px) translateX(5px); }
            50% { transform: translateY(0) translateX(10px); }
            75% { transform: translateY(10px) translateX(5px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .title {
                font-size: 36px;
            }
            
            .menu-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .menu-button {
                min-height: 120px;
            }
            
            .menu-button h3 {
                font-size: 20px;
            }
            
            .pattern-item, .question-mark {
                width: 60px;
                height: 60px;
                font-size: 36px;
            }
            
            .number-button {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .character {
                transform: scale(0.7);
                top: 10px;
                left: -10px;
            }
            
            .character-speech {
                max-width: 180px;
                font-size: 16px;
                left: 100px;
            }
            
            .game-content {
                padding-top: 40px;
            }
            
            .shape-container, .memory-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .letter-display {
                font-size: 100px;
            }
            
            .alphabet-object-emoji {
                font-size: 40px;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Main Menu -->
        <div id="main-menu">
            <h1 class="title">Toddler Genius Academy</h1>
            <div class="menu-options">
                <div class="menu-button" onclick="startGame('patterns-game')">
                    <div style="font-size: 40px;">🔄</div>
                    <h3>Patterns</h3>
                    <p>Find the missing pattern</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('shapes-game')">
                    <div style="font-size: 40px;">🔶</div>
                    <h3>Shapes & Colors</h3>
                    <p>Identify shapes and colors</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('counting-game')">
                    <div style="font-size: 40px;">🔢</div>
                    <h3>Counting</h3>
                    <p>Count objects and learn numbers</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('cause-effect-game')">
                    <div style="font-size: 40px;">🌧️</div>
                    <h3>Cause & Effect</h3>
                    <p>Discover how things work</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('memory-game')">
                    <div style="font-size: 40px;">🧠</div>
                    <h3>Memory</h3>
                    <p>Match and remember</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('alphabet-game')">
                    <div style="font-size: 40px;">🔤</div>
                    <h3>Alphabet</h3>
                    <p>Learn letters and words</p>
                    <div class="age-badge">3+</div>
                </div>
                <div class="menu-button" onclick="startGame('puzzle-game')">
                    <div style="font-size: 40px;">🧩</div>
                    <h3>Puzzles</h3>
                    <p>Solve picture puzzles</p>
                    <div class="age-badge">3+</div>
                </div>
                <div class="menu-button" onclick="startGame('music-game')">
                    <div style="font-size: 40px;">🎵</div>
                    <h3>Music</h3>
                    <p>Play and learn melodies</p>
                    <div class="age-badge">3+</div>
                </div>
                <div class="menu-button" onclick="startGame('drawing-game')">
                    <div style="font-size: 40px;">🎨</div>
                    <h3>Drawing</h3>
                    <p>Create colorful art</p>
                    <div class="age-badge">2+</div>
                </div>
                <div class="menu-button" onclick="startGame('science-game')">
                    <div style="font-size: 40px;">🔬</div>
                    <h3>Science</h3>
                    <p>Simple experiments</p>
                    <div class="age-badge">4+</div>
                </div>
                <div class="menu-button" onclick="startGame('math-game')">
                    <div style="font-size: 40px;">➕</div>
                    <h3>Math</h3>
                    <p>Fun with numbers</p>
                    <div class="age-badge">4+</div>
                </div>
                <div class="menu-button" onclick="startGame('story-game')">
                    <div style="font-size: 40px;">📚</div>
                    <h3>Stories</h3>
                    <p>Interactive fairy tales</p>
                    <div class="age-badge">3+</div>
                </div>
            </div>
        </div>
        
        <!-- Pattern Recognition Game -->
        <div id="patterns-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('patterns-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('patterns-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('patterns-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Pattern Magic</h2>
                <div class="game-score" id="patterns-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="patterns-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="patterns-speech">
                        What comes next in the pattern?
                    </div>
                </div>
                <div class="pattern-container">
                    <div class="pattern-row" id="pattern-sequence"></div>
                    <div class="answer-row" id="pattern-answers"></div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>
        
        <!-- Shapes and Colors Game -->
        <div id="shapes-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('shapes-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('shapes-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('shapes-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Shape Explorer</h2>
                <div class="game-score" id="shapes-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="shapes-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="shapes-speech">
                        Can you find the shape?
                    </div>
                </div>
                <div class="shape-prompt" id="shape-prompt">
                    Find the red circle!
                </div>
                <div class="shape-container" id="shape-container"></div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>
        
        <!-- Counting Game -->
        <div id="counting-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('counting-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('counting-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('counting-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Count With Me</h2>
                <div class="game-score" id="counting-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="counting-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="counting-speech">
                        Let's count together!
                    </div>
                </div>
                <div class="counting-container">
                    <div class="counting-prompt" id="counting-prompt">
                        How many apples do you see?
                    </div>
                    <div class="counting-objects" id="counting-objects"></div>
                    <div class="number-buttons" id="number-buttons"></div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>
        
        <!-- Cause and Effect Game -->
        <div id="cause-effect-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('cause-effect-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('cause-effect-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('cause-effect-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Magic Garden</h2>
                <div class="game-score" id="cause-effect-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="cause-effect-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="cause-effect-speech">
                        Try clicking on things in the garden!
                    </div>
                </div>
                <div class="interactive-scene">
                    <div class="sun interactive-element" onclick="triggerSunEffect()"></div>
                    <div class="cloud cloud1 interactive-element" onclick="triggerRainEffect()"></div>
                    <div class="cloud cloud2 interactive-element" onclick="triggerRainEffect()"></div>
                    <div class="grass"></div>
                    <div class="tree interactive-element" onclick="triggerTreeEffect()"></div>
                    <div class="flower flower1 interactive-element" onclick="triggerFlowerEffect(this)"></div>
                    <div class="flower flower2 interactive-element" onclick="triggerFlowerEffect(this)"></div>
                    <div class="flower flower3 interactive-element" onclick="triggerFlowerEffect(this)"></div>
                    <div id="raindrops-container"></div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>
        
        <!-- Memory Game -->
        <div id="memory-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('memory-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('memory-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('memory-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Memory Match</h2>
                <div class="game-score" id="memory-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="memory-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="memory-speech">
                        Find the matching pairs!
                    </div>
                </div>
                <div class="memory-cards" id="memory-cards"></div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Alphabet Game -->
        <div id="alphabet-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('alphabet-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('alphabet-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('alphabet-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Letter Land</h2>
                <div class="game-score" id="alphabet-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="alphabet-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="alphabet-speech">
                        Let's learn the alphabet!
                    </div>
                </div>
                <div class="alphabet-container">
                    <div class="letter-display" id="current-letter">A</div>
                    <div class="alphabet-objects" id="alphabet-objects">
                        <!-- Filled dynamically -->
                    </div>
                    <div class="letter-navigation">
                        <button class="letter-nav-button" id="prev-letter-btn">Previous</button>
                        <button class="letter-nav-button" id="next-letter-btn">Next</button>
                    </div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Puzzle Game -->
        <div id="puzzle-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('puzzle-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('puzzle-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('puzzle-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Picture Puzzles</h2>
                <div class="game-score" id="puzzle-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="puzzle-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="puzzle-speech">
                        Let's solve a puzzle!
                    </div>
                </div>
                <div class="puzzle-container" id="puzzle-container">
                    <!-- Puzzle pieces will be added dynamically -->
                </div>
                <div class="puzzle-preview" id="puzzle-preview"></div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Music Game -->
        <div id="music-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('music-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('music-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('music-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Music Maker</h2>
                <div class="game-score" id="music-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="music-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="music-speech">
                        Let's make music together!
                    </div>
                </div>
                <div class="piano-container" id="piano-container">
                    <!-- Piano keys will be added dynamically -->
                </div>
                <div class="music-sequence" id="music-sequence">
                    <!-- Sequence notes will be added dynamically -->
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Drawing Game -->
        <div id="drawing-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('drawing-game', 1)">Free Draw</button>
                    <button class="difficulty-button" onclick="setDifficulty('drawing-game', 2)">Guided</button>
                    <button class="difficulty-button" onclick="setDifficulty('drawing-game', 3)">Challenge</button>
                </div>
                <h2 class="game-title">Art Studio</h2>
                <div class="game-score" id="drawing-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="drawing-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="drawing-speech">
                        Let's draw something fun!
                    </div>
                </div>
                <div class="drawing-container">
                    <canvas id="drawing-canvas" class="drawing-canvas"></canvas>
                </div>
                <div class="drawing-toolbar" id="drawing-toolbar">
                    <!-- Drawing tools will be added dynamically -->
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Science Game -->
        <div id="science-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('science-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('science-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('science-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Mini Scientists</h2>
                <div class="game-score" id="science-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="science-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="science-speech">
                        Let's do some experiments!
                    </div>
                </div>
                <div class="experiment-container">
                    <div class="experiment-title" id="experiment-title">
                        Colorful Water Magic
                    </div>
                    <div class="experiment-steps" id="experiment-steps">
                        <!-- Experiment steps will be added dynamically -->
                    </div>
                    <div class="experiment-result" id="experiment-result">
                        <!-- Experiment result will be shown here -->
                    </div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Math Game -->
        <div id="math-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('math-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('math-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('math-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Number Adventures</h2>
                <div class="game-score" id="math-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="math-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="math-speech">
                        Let's solve some math problems!
                    </div>
                </div>
                <div class="math-problem-container">
                    <div class="math-problem" id="math-problem">
                        2 + 1 = ?
                    </div>
                    <div class="math-options" id="math-options">
                        <!-- Math options will be added dynamically -->
                    </div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Story Game -->
        <div id="story-game" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <div class="difficulty-controls">
                    <button class="difficulty-button active" onclick="setDifficulty('story-game', 1)">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('story-game', 2)">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('story-game', 3)">Hard</button>
                </div>
                <h2 class="game-title">Story Time</h2>
                <div class="game-score" id="story-game-score"></div>
            </div>
            <div class="game-content">
                <div class="character" id="story-character">
                    <div class="character-head"></div>
                    <div class="character-eye left"></div>
                    <div class="character-eye right"></div>
                    <div class="character-pupil left"></div>
                    <div class="character-pupil right"></div>
                    <div class="character-mouth"></div>
                    <div class="character-body"></div>
                    <div class="character-arm left"></div>
                    <div class="character-arm right"></div>
                    <div class="character-speech" id="story-speech">
                        Let's read a story together!
                    </div>
                </div>
                <div class="story-container">
                    <div class="story-scene" id="story-scene">
                        <!-- Story scene elements will be added dynamically -->
                    </div>
                    <div class="story-text" id="story-text">
                        Once upon a time, there was a little red hen who found a grain of wheat...
                    </div>
                    <div class="story-controls">
                        <button class="story-button" id="prev-page-btn">Previous</button>
                        <button class="story-button" id="next-page-btn">Next</button>
                    </div>
                    <div class="story-choices" id="story-choices">
                        <!-- Story choices will be added dynamically -->
                    </div>
                </div>
            </div>
            <div class="progress-path">
                <div class="path-node completed">1</div>
                <div class="path-line completed"></div>
                <div class="path-node current">2</div>
                <div class="path-line"></div>
                <div class="path-node">3</div>
                <div class="path-line"></div>
                <div class="path-node">4</div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div id="profile-screen" class="game-screen">
            <div class="game-header">
                <button class="back-button" onclick="goToMainMenu()">← Back</button>
                <h2 class="game-title">My Progress</h2>
            </div>
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar">
                        🧒
                    </div>
                    <div class="profile-info">
                        <div class="profile-name">Little Genius</div>
                        <div class="profile-age">Age: <span id="profile-age-display">2</span></div>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="profile-stat-number">12</div>
                        <div class="profile-stat-label">Games Played</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-number">5</div>
                        <div class="profile-stat-label">Stars Earned</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-number">3</div>
                        <div class="profile-stat-label">Badges</div>
                    </div>
                </div>
                <div class="profile-achievements">
                    <div class="achievements-title">My Achievements</div>
                    <div class="achievement-list">
                        <div class="achievement-item">
                            <div class="achievement-icon">🏆</div>
                            <div class="achievement-name">First Steps</div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">🌟</div>
                            <div class="achievement-name">Star Collector</div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">🧩</div>
                            <div class="achievement-name">Puzzle Master</div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">📚</div>
                            <div class="achievement-name">Book Worm</div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">🎨</div>
                            <div class="achievement-name">Artist</div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">🔢</div>
                            <div class="achievement-name">Number Genius</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reward Screen -->
        <div class="reward-screen" id="reward-screen">
            <div class="reward-content">
                <h2 class="reward-title">Great Job!</h2>
                <p id="reward-message">You're a super smart genius!</p>
                <div class="stars-container" id="reward-stars"></div>
                <div class="achievement-unlocked" id="achievement-unlocked">
                    <span class="achievement-unlocked-icon">🏆</span> New Achievement Unlocked!
                </div>
                <button class="reward-continue" onclick="closeReward()">Continue</button>
            </div>
        </div>
        
        <!-- Parent Controls -->
        <div id="parent-controls">
            <button class="parent-button" onclick="toggleParentPanel()">👨‍👩‍👧</button>
            <div class="parent-panel" id="parent-panel">
                <h3>Parent Controls</h3>
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-label">Child's Age</div>
                        <div class="setting-control">
                            <input type="range" min="2" max="6" value="2" class="slider" id="age-slider" oninput="updateAge(this.value)">
                            <span id="age-value">2</span> years
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Volume</div>
                        <div class="setting-control">
                            <input type="range" min="0" max="100" value="50" class="slider" id="volume-slider" oninput="updateVolume(this.value)">
                        </div>
                    </div>
                </div>
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-label">Background Music</div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="music-toggle" checked onchange="toggleMusic()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Sound Effects</div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="sound-toggle" checked onchange="toggleSound()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <button class="back-button" style="margin-top: 20px; width: 100%;" onclick="toggleParentPanel()">Close</button>
            </div>
        </div>
    </div>
    
    <script>
        // Audio Context Setup
        let audioContext;
        let masterGainNode;
        let backgroundMusic;
        let isMusicPlaying = false;
        let soundEnabled = true;
        
        // Game State Variables
        let currentGame = '';
        let gameDifficulties = {};
        let gameScores = {
            'patterns-game': 0,
            'shapes-game': 0,
            'counting-game': 0,
            'cause-effect-game': 0,
            'memory-game': 0,
            'alphabet-game': 0,
            'puzzle-game': 0,
            'music-game': 0,
            'drawing-game': 0,
            'science-game': 0,
            'math-game': 0,
            'story-game': 0
        };
        
        // Achievement tracking
        let achievements = {
            'first-steps': false,
            'star-collector': false,
            'puzzle-master': false,
            'book-worm': false,
            'artist': false,
            'number-genius': false,
            'music-maestro': false,
            'science-explorer': false,
            'memory-champion': false,
            'alphabet-ace': false
        };
        
        // User profile and progression
        let userProfile = {
            age: 2,
            totalGamesPlayed: 0,
            totalStarsEarned: 0,
            unlockedAchievements: 0,
            lastPlayedGame: '',
            progressPaths: {
                'patterns-game': 1,
                'shapes-game': 1,
                'counting-game': 1,
                'cause-effect-game': 1,
                'memory-game': 1,
                'alphabet-game': 1,
                'puzzle-game': 1,
                'music-game': 1,
                'drawing-game': 1,
                'science-game': 1,
                'math-game': 1,
                'story-game': 1
            }
        };
        
        // Patterns Game Variables
        let patternLevel = 1;
        let currentPattern = [];
        let correctAnswer = null;
        
        // Shapes Game Variables
        let shapesLevel = 1;
        let currentShapePrompt = '';
        let correctShape = null;
        
        // Counting Game Variables
        let countingLevel = 1;
        let countingAnswer = 0;
        
        // Memory Game Variables
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        
        // Alphabet Game Variables
        let currentLetter = 'A';
        let alphabetObjects = {};
        
        // Puzzle Game Variables
        let puzzlePieces = [];
        let puzzleImages = ['animal', 'space', 'farm', 'underwater', 'jungle'];
        let currentPuzzleImage = '';
        let puzzleSize = 3; // 3x3 by default
        
        // Music Game Variables
        let pianoKeys = [];
        let currentSequence = [];
        let userSequence = [];
        let isPlayingSequence = false;
        
        // Drawing Game Variables
        let isDrawing = false;
        let drawingContext = null;
        let currentColor = '#000000';
        let currentSize = 5;
        let drawingMode = 'free';
        
        // Science Game Variables
        let currentExperiment = 0;
        let experiments = [
            {
                title: 'Colorful Water Magic',
                steps: [
                    { step: 1, icon: '🚰', text: 'Fill three glasses with water' },
                    { step: 2, icon: '🎨', text: 'Add different food colors' },
                    { step: 3, icon: '🧻', text: 'Place paper towel bridges between glasses' },
                    { step: 4, icon: '⏱️', text: 'Watch the colors travel and mix!' }
                ]
            },
            {
                title: 'Sink or Float',
                steps: [
                    { step: 1, icon: '🛁', text: 'Fill a bowl with water' },
                    { step: 2, icon: '🍎', text: 'Collect different objects' },
                    { step: 3, icon: '❓', text: 'Guess if they will sink or float' },
                    { step: 4, icon: '💧', text: 'Test each object in the water' }
                ]
            },
            {
                title: 'Static Electricity',
                steps: [
                    { step: 1, icon: '🎈', text: 'Blow up a balloon' },
                    { step: 2, icon: '🧠', text: 'Rub the balloon on your hair' },
                    { step: 3, icon: '🔍', text: 'Hold it near small paper pieces' },
                    { step: 4, icon: '✨', text: 'Watch the magic attraction!' }
                ]
            }
        ];
        
        // Math Game Variables
        let currentMathProblem = '';
        let mathAnswer = 0;
        
        // Story Game Variables
        let currentStory = 0;
        let currentPage = 0;
        let stories = [
            {
                title: 'The Little Red Hen',
                pages: [
                    {
                        text: 'Once upon a time, there was a little red hen who found a grain of wheat.',
                        characters: [
                            { type: 'hen', left: '50%', top: '50%', emoji: '🐔' }
                        ]
                    },
                    {
                        text: '"Who will help me plant this wheat?" asked the little red hen. "Not I," said the dog. "Not I," said the cat. "Not I," said the mouse.',
                        characters: [
                            { type: 'hen', left: '30%', top: '50%', emoji: '🐔' },
                            { type: 'dog', left: '50%', top: '50%', emoji: '🐕' },
                            { type: 'cat', left: '70%', top: '50%', emoji: '🐈' },
                            { type: 'mouse', left: '90%', top: '50%', emoji: '🐁' }
                        ]
                    },
                    {
                        text: '"Then I will plant it myself," said the little red hen. And she did.',
                        characters: [
                            { type: 'hen', left: '50%', top: '50%', emoji: '🐔' }
                        ]
                    },
                    {
                        text: 'The wheat grew tall and golden. "Who will help me harvest the wheat?" asked the little red hen.',
                        characters: [
                            { type: 'hen', left: '30%', top: '50%', emoji: '🐔' },
                            { type: 'wheat', left: '70%', top: '40%', emoji: '🌾' }
                        ]
                    },
                    {
                        text: '"Not I," said the dog. "Not I," said the cat. "Not I," said the mouse.',
                        characters: [
                            { type: 'dog', left: '30%', top: '50%', emoji: '🐕' },
                            { type: 'cat', left: '50%', top: '50%', emoji: '🐈' },
                            { type: 'mouse', left: '70%', top: '50%', emoji: '🐁' }
                        ]
                    }
                ],
                choices: [
                    {
                        text: 'The hen decides to share anyway',
                        nextPage: 10
                    },
                    {
                        text: 'The hen keeps the bread for herself',
                        nextPage: 12
                    }
                ]
            },
            {
                title: 'The Three Little Pigs',
                pages: [
                    {
                        text: 'Once upon a time, there were three little pigs who left home to build their own houses.',
                        characters: [
                            { type: 'pig1', left: '30%', top: '50%', emoji: '🐷' },
                            { type: 'pig2', left: '50%', top: '50%', emoji: '🐷' },
                            { type: 'pig3', left: '70%', top: '50%', emoji: '🐷' }
                        ]
                    }
                ]
            }
        ];
        
        // Initialize Web Audio API
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGainNode = audioContext.createGain();
                masterGainNode.gain.value = 0.5;
                masterGainNode.connect(audioContext.destination);
                
                // Create background music
                createBackgroundMusic();
            } catch (e) {
                console.error('Web Audio API not supported:', e);
            }
        }
        
        // Create background music using oscillators
        function createBackgroundMusic() {
            if (!audioContext) return;
            
            backgroundMusic = {
                oscillators: [],
                isPlaying: false
            };
            
            const notes = [
                {freq: 262, duration: 0.5}, // C4
                {freq: 330, duration: 0.5}, // E4
                {freq: 392, duration: 0.5}, // G4
                {freq: 523, duration: 0.5}, // C5
                {freq: 392, duration: 0.5}, // G4
                {freq: 330, duration: 0.5}, // E4
                {freq: 262, duration: 1.0}  // C4
            ];
            
            let startTime = audioContext.currentTime;
            
            function playMelody() {
                backgroundMusic.oscillators.forEach(osc => {
                    if (osc.oscillator) {
                        osc.oscillator.stop();
                        osc.oscillator.disconnect();
                    }
                });
                
                backgroundMusic.oscillators = [];
                startTime = audioContext.currentTime;
                
                notes.forEach((note, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.value = note.freq;
                    
                    gainNode.gain.value = 0;
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    
                    const noteStart = startTime + index * 0.5;
                    const noteEnd = noteStart + note.duration;
                    
                    // Smooth attack and release
                    gainNode.gain.setValueAtTime(0, noteStart);
                    gainNode.gain.linearRampToValueAtTime(0.2, noteStart + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, noteEnd - 0.05);
                    
                    oscillator.start(noteStart);
                    oscillator.stop(noteEnd);
                    
                    backgroundMusic.oscillators.push({
                        oscillator: oscillator,
                        gainNode: gainNode
                    });
                });
                
                // Schedule next loop
                setTimeout(() => {
                    if (backgroundMusic.isPlaying) {
                        playMelody();
                    }
                }, notes.reduce((sum, note) => sum + note.duration * 1000, 0));
            }
            
            backgroundMusic.play = function() {
                if (!backgroundMusic.isPlaying) {
                    backgroundMusic.isPlaying = true;
                    playMelody();
                }
            };
            
            backgroundMusic.stop = function() {
                backgroundMusic.isPlaying = false;
                backgroundMusic.oscillators.forEach(osc => {
                    if (osc.oscillator) {
                        try {
                            osc.oscillator.stop();
                            osc.oscillator.disconnect();
                        } catch (e) {
                            // Oscillator might already be stopped
                        }
                    }
                });
                backgroundMusic.oscillators = [];
            };
        }
        
        // Play piano note
        function playPianoNote(frequency, duration = 0.5) {
            if (!audioContext || !soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;
            
            gainNode.gain.value = 0;
            
            oscillator.connect(gainNode);
            gainNode.connect(masterGainNode);
            
            const now = audioContext.currentTime;
            
            // Smooth attack and release
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
            gainNode.gain.linearRampToValueAtTime(0, now + duration - 0.05);
            
            oscillator.start(now);
            oscillator.stop(now + duration);
        }
        
        // Play success sound
        function playSuccessSound() {
            if (!audioContext || !soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 523.25; // C5
            
            gainNode.gain.value = 0;
            
            oscillator.connect(gainNode);
            gainNode.connect(masterGainNode);
            
            const now = audioContext.currentTime;
            
            // Smooth attack and release
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
            gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
            
            oscillator.start(now);
            oscillator.stop(now + 0.5);
            
            // Play second tone
            setTimeout(() => {
                const oscillator2 = audioContext.createOscillator();
                const gainNode2 = audioContext.createGain();
                
                oscillator2.type = 'sine';
                oscillator2.frequency.value = 784; // G5
                
                gainNode2.gain.value = 0;
                
                oscillator2.connect(gainNode2);
                gainNode2.connect(masterGainNode);
                
                const now2 = audioContext.currentTime;
                
                gainNode2.gain.setValueAtTime(0, now2);
                gainNode2.gain.linearRampToValueAtTime(0.3, now2 + 0.05);
                gainNode2.gain.linearRampToValueAtTime(0, now2 + 0.5);
                
                oscillator2.start(now2);
                oscillator2.stop(now2 + 0.5);
            }, 200);
        }
        
        // Play error sound
        function playErrorSound() {
            if (!audioContext || !soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 277.18; // C#4
            
            gainNode.gain.value = 0;
            
            oscillator.connect(gainNode);
            gainNode.connect(masterGainNode);
            
            const now = audioContext.currentTime;
            
            // Smooth attack and release
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
            gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
            
            oscillator.start(now);
            oscillator.stop(now + 0.4);
        }
        
        // Play click sound
        function playClickSound() {
            if (!audioContext || !soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 440; // A4
            
            gainNode.gain.value = 0;
            
            oscillator.connect(gainNode);
            gainNode.connect(masterGainNode);
            
            const now = audioContext.currentTime;
            
            // Very short click sound
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.2, now + 0.01);
            gainNode.gain.linearRampToValueAtTime(0, now + 0.1);
            
            oscillator.start(now);
            oscillator.stop(now + 0.1);
        }
        
        // Toggle background music
        function toggleMusic() {
            if (!audioContext) {
                initAudio();
            }
            
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const musicToggle = document.getElementById('music-toggle');
            
            if (musicToggle.checked) {
                if (!isMusicPlaying) {
                    backgroundMusic.play();
                    isMusicPlaying = true;
                }
            } else {
                if (isMusicPlaying) {
                    backgroundMusic.stop();
                    isMusicPlaying = false;
                }
            }
        }
        
        // Toggle sound effects
        function toggleSound() {
            const soundToggle = document.getElementById('sound-toggle');
            soundEnabled = soundToggle.checked;
        }
        
        // Update volume
        function updateVolume(value) {
            if (masterGainNode) {
                masterGainNode.gain.value = value / 100;
            }
        }
        
        // Update age
        function updateAge(value) {
            userProfile.age = parseInt(value);
            document.getElementById('age-value').textContent = value;
            document.getElementById('profile-age-display').textContent = value;
            
            // Update game difficulty based on age
            updateGameDifficultiesBasedOnAge();
        }
        
        // Update game difficulties based on age
        function updateGameDifficultiesBasedOnAge() {
            const age = userProfile.age;
            
            // Set appropriate difficulty levels based on age
            Object.keys(gameScores).forEach(game => {
                if (age <= 3) {
                    setDifficulty(game, 1, false);
                } else if (age <= 4) {
                    setDifficulty(game, 2, false);
                } else {
                    setDifficulty(game, 3, false);
                }
            });
            
            // Update UI if in a game
            if (currentGame) {
                const difficultyButtons = document.querySelectorAll(`#${currentGame} .difficulty-button`);
                difficultyButtons.forEach(button => {
                    button.classList.remove('active');
                    const difficulty = gameDifficulties[currentGame] || 1;
                    if (parseInt(button.textContent.match(/\d+/)?.[0] || 1) === difficulty) {
                        button.classList.add('active');
                    }
                });
            }
        }
        
        // Toggle parent panel
        function toggleParentPanel() {
            const panel = document.getElementById('parent-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
        
        // Initialize the game
        function initGame() {
            // Initialize audio on first user interaction
            document.body.addEventListener('click', function() {
                if (!audioContext) {
                    initAudio();
                }
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
            
            // Initialize scores display
            updateScoreDisplay('patterns-game');
            updateScoreDisplay('shapes-game');
            updateScoreDisplay('counting-game');
            updateScoreDisplay('cause-effect-game');
            updateScoreDisplay('memory-game');
            updateScoreDisplay('alphabet-game');
            updateScoreDisplay('puzzle-game');
            updateScoreDisplay('music-game');
            updateScoreDisplay('drawing-game');
            updateScoreDisplay('science-game');
            updateScoreDisplay('math-game');
            updateScoreDisplay('story-game');
            
            // Initialize character animations
            animateCharacters();
            
            // Initialize alphabet objects
            initAlphabetObjects();
            
            // Set default difficulties
            Object.keys(gameScores).forEach(game => {
                gameDifficulties[game] = 1;
            });
            
            // Show first steps achievement if new user
            if (!achievements['first-steps']) {
                setTimeout(() => {
                    unlockAchievement('first-steps', 'First Steps', 'Started your learning journey!');
                }, 2000);
            }
            
            // Check if drawing canvas needs initialization
            const drawingCanvas = document.getElementById('drawing-canvas');
            if (drawingCanvas) {
                initDrawingCanvas();
            }
        }
        
        // Animate characters
        function animateCharacters() {
            const characters = document.querySelectorAll('.character');
            characters.forEach(character => {
                // Position character
                character.style.top = '10px';
                
                // Randomly assign animation
                const animations = ['bounce', 'wiggle', 'float'];
                const randomAnim = animations[Math.floor(Math.random() * animations.length)];
                const duration = 3 + Math.random() * 2; // 3-5 seconds
                const delay = Math.random() * 2; // 0-2 seconds
                
                character.style.animation = `${randomAnim} ${duration}s ease-in-out ${delay}s infinite`;
            });
        }
        
        // Start a specific game
        function startGame(gameId) {
            playClickSound();
            
            // Hide main menu and show selected game
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById(gameId).style.display = 'flex';
            
            currentGame = gameId;
            userProfile.lastPlayedGame = gameId;
            userProfile.totalGamesPlayed++;
            
            // Show character speech bubble
            setTimeout(() => {
                document.getElementById(`${gameId.split('-')[0]}-speech`).style.opacity = 1;
            }, 500);
            
            // Initialize specific game
            switch (gameId) {
                case 'patterns-game':
                    initPatternsGame();
                    break;
                case 'shapes-game':
                    initShapesGame();
                    break;
                case 'counting-game':
                    initCountingGame();
                    break;
                case 'cause-effect-game':
                    initCauseEffectGame();
                    break;
                case 'memory-game':
                    initMemoryGame();
                    break;
                case 'alphabet-game':
                    initAlphabetGame();
                    break;
                case 'puzzle-game':
                    initPuzzleGame();
                    break;
                case 'music-game':
                    initMusicGame();
                    break;
                case 'drawing-game':
                    initDrawingGame();
                    break;
                case 'science-game':
                    initScienceGame();
                    break;
                case 'math-game':
                    initMathGame();
                    break;
                case 'story-game':
                    initStoryGame();
                    break;
            }
            
            // Update progress path display
            updateProgressPath(gameId);
        }
        
        // Go back to main menu
        function goToMainMenu() {
            playClickSound();
            
            // Hide current game and show main menu
            document.getElementById(currentGame).style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
            
            // Hide speech bubble
            document.getElementById(`${currentGame.split('-')[0]}-speech`).style.opacity = 0;
            
            // Clean up game state
            if (currentGame === 'drawing-game') {
                isDrawing = false;
            }
            
            currentGame = '';
        }
        
        // Set difficulty level for a game
        function setDifficulty(gameId, level, updateUI = true) {
            gameDifficulties[gameId] = level;
            
            if (updateUI) {
                // Update difficulty buttons
                const difficultyButtons = document.querySelectorAll(`#${gameId} .difficulty-button`);
                difficultyButtons.forEach(button => {
                    button.classList.remove('active');
                });
                
                difficultyButtons[level - 1].classList.add('active');
                
                // Restart the current game with new difficulty
                if (gameId === currentGame) {
                    switch (gameId) {
                        case 'patterns-game':
                            initPatternsGame();
                            break;
                        case 'shapes-game':
                            initShapesGame();
                            break;
                        case 'counting-game':
                            initCountingGame();
                            break;
                        case 'cause-effect-game':
                            initCauseEffectGame();
                            break;
                        case 'memory-game':
                            initMemoryGame();
                            break;
                        case 'alphabet-game':
                            initAlphabetGame();
                            break;
                        case 'puzzle-game':
                            initPuzzleGame();
                            break;
                        case 'music-game':
                            initMusicGame();
                            break;
                        case 'drawing-game':
                            initDrawingGame();
                            break;
                        case 'science-game':
                            initScienceGame();
                            break;
                        case 'math-game':
                            initMathGame();
                            break;
                        case 'story-game':
                            initStoryGame();
                            break;
                    }
                }
            }
        }
        
        // Update progress path display
        function updateProgressPath(gameId) {
            const progressPath = document.querySelector(`#${gameId} .progress-path`);
            if (progressPath) {
                const currentLevel = userProfile.progressPaths[gameId];
                
                // Update node and line classes
                const nodes = progressPath.querySelectorAll('.path-node');
                const lines = progressPath.querySelectorAll('.path-line');
                
                nodes.forEach((node, index) => {
                    node.classList.remove('completed', 'current');
                    if (index + 1 < currentLevel) {
                        node.classList.add('completed');
                    } else if (index + 1 === currentLevel) {
                        node.classList.add('current');
                    }
                });
                
                lines.forEach((line, index) => {
                    line.classList.remove('completed');
                    if (index + 1 < currentLevel) {
                        line.classList.add('completed');
                    }
                });
            }
        }
        
        // Update score display
        function updateScoreDisplay(gameId) {
            const scoreContainer = document.getElementById(`${gameId}-score`);
            if (scoreContainer) {
                scoreContainer.innerHTML = '';
                
                for (let i = 0; i < gameScores[gameId]; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    scoreContainer.appendChild(star);
                }
            }
        }
        
        // Unlock achievement
        function unlockAchievement(id, name, description) {
            if (!achievements[id]) {
                achievements[id] = true;
                userProfile.unlockedAchievements++;
                
                // Show achievement notification
                const achievementElement = document.getElementById('achievement-unlocked');
                if (achievementElement) {
                    achievementElement.innerHTML = `<span class="achievement-unlocked-icon">🏆</span> Achievement Unlocked: ${name}`;
                    achievementElement.style.display = 'flex';
                    
                    // Add achievement to profile
                    const achievementsList = document.querySelector('.achievement-list');
                    if (achievementsList) {
                        const achievementItem = document.createElement('div');
                        achievementItem.className = 'achievement-item';
                        achievementItem.innerHTML = `
                            <div class="achievement-icon">🏆</div>
                            <div class="achievement-name">${name}</div>
                        `;
                        achievementsList.appendChild(achievementItem);
                    }
                    
                    setTimeout(() => {
                        playSuccessSound();
                    }, 500);
                }
            }
        }
        
        // Check if player qualifies for achievements
        function checkAchievements() {
            // Star Collector
            const totalStars = Object.values(gameScores).reduce((sum, score) => sum + score, 0);
            if (totalStars >= 10 && !achievements['star-collector']) {
                unlockAchievement('star-collector', 'Star Collector', 'Earned 10 stars!');
            }
            
            // Puzzle Master
            if (gameScores['puzzle-game'] >= 5 && !achievements['puzzle-master']) {
                unlockAchievement('puzzle-master', 'Puzzle Master', 'Completed 5 puzzles!');
            }
            
            // Book Worm
            if (gameScores['story-game'] >= 3 && !achievements['book-worm']) {
                unlockAchievement('book-worm', 'Book Worm', 'Read 3 interactive stories!');
            }
            
            // Artist
            if (gameScores['drawing-game'] >= 5 && !achievements['artist']) {
                unlockAchievement('artist', 'Artist', 'Created 5 beautiful drawings!');
            }
            
            // Number Genius
            if (gameScores['math-game'] >= 5 && !achievements['number-genius']) {
                unlockAchievement('number-genius', 'Number Genius', 'Solved 5 math problems!');
            }
            
            // Music Maestro
            if (gameScores['music-game'] >= 5 && !achievements['music-maestro']) {
                unlockAchievement('music-maestro', 'Music Maestro', 'Played 5 music sequences!');
            }
            
            // Science Explorer
            if (gameScores['science-game'] >= 3 && !achievements['science-explorer']) {
                unlockAchievement('science-explorer', 'Science Explorer', 'Completed 3 experiments!');
            }
            
            // Memory Champion
            if (gameScores['memory-game'] >= 5 && !achievements['memory-champion']) {
                unlockAchievement('memory-champion', 'Memory Champion', 'Mastered 5 memory games!');
            }
            
            // Alphabet Ace
            if (gameScores['alphabet-game'] >= 5 && !achievements['alphabet-ace']) {
                unlockAchievement('alphabet-ace', 'Alphabet Ace', 'Learned all about letters!');
            }
        }
        
        // Update user progress
        function updateUserProgress(gameId) {
            if (gameScores[gameId] > 0 && gameScores[gameId] % 3 === 0) {
                const nextLevel = Math.min(userProfile.progressPaths[gameId] + 1, 4);
                userProfile.progressPaths[gameId] = nextLevel;
                
                // Update progress path display
                updateProgressPath(gameId);
            }
        }
        
        // Show reward screen
        function showReward(message, stars) {
            const rewardScreen = document.getElementById('reward-screen');
            const rewardMessage = document.getElementById('reward-message');
            const rewardStars = document.getElementById('reward-stars');
            const achievementElement = document.getElementById('achievement-unlocked');
            
            rewardMessage.textContent = message;
            rewardStars.innerHTML = '';
            
            for (let i = 0; i < stars; i++) {
                const star = document.createElement('div');
                star.className = 'reward-star';
                star.style.animation = `spin 1s ease-in-out ${i * 0.2}s`;
                rewardStars.appendChild(star);
            }
            
            // Hide achievement notification initially
            if (achievementElement) {
                achievementElement.style.display = 'none';
            }
            
            rewardScreen.style.display = 'flex';
            playSuccessSound();
            
            // Update user stats
            userProfile.totalStarsEarned += stars;
            
            // Check for achievements after showing reward
            setTimeout(() => {
                checkAchievements();
            }, 1000);
        }
        
        // Close reward screen
        function closeReward() {
            document.getElementById('reward-screen').style.display = 'none';
            playClickSound();
        }
        
        // Pattern Recognition Game Logic
        function initPatternsGame() {
            const patternSequence = document.getElementById('pattern-sequence');
            const patternAnswers = document.getElementById('pattern-answers');
            
            patternSequence.innerHTML = '';
            patternAnswers.innerHTML = '';
            
            // Set difficulty level
            patternLevel = gameDifficulties['patterns-game'] || 1;
            
            // Generate pattern based on level
            generatePattern();
            
            // Display pattern sequence
            currentPattern.forEach((item, index) => {
                if (index === currentPattern.length - 1) {
                    // Last item is hidden (question mark)
                    const questionMark = document.createElement('div');
                    questionMark.className = 'question-mark';
                    questionMark.textContent = '?';
                    patternSequence.appendChild(questionMark);
                } else {
                    const patternItem = document.createElement('div');
                    patternItem.className = 'pattern-item';
                    patternItem.textContent = item;
                    patternItem.style.backgroundColor = getRandomPastelColor();
                    patternSequence.appendChild(patternItem);
                }
            });
            
            // Generate answer options
            const answerOptions = generateAnswerOptions();
            
            answerOptions.forEach(option => {
                const answerItem = document.createElement('div');
                answerItem.className = 'pattern-item';
                answerItem.textContent = option;
                answerItem.style.backgroundColor = getRandomPastelColor();
                answerItem.addEventListener('click', () => checkPatternAnswer(answerItem, option));
                patternAnswers.appendChild(answerItem);
            });
            
            // Update character speech
            document.getElementById('patterns-speech').textContent = `What comes next in the pattern? Level ${patternLevel}`;
        }
        
        // Generate pattern based on level
        function generatePattern() {
            if (patternLevel === 1) {
                // Simple alternating pattern (A, B, A, B, ?)
                const options = ['🍎', '🍌', '🍊', '🍇', '🍓', '🍋', '🥝', '🍒'];
                const a = options[Math.floor(Math.random() * options.length)];
                let b;
                do {
                    b = options[Math.floor(Math.random() * options.length)];
                } while (a === b);
                
                currentPattern = [a, b, a, b, a];
                correctAnswer = a;
            } else if (patternLevel === 2) {
                // Incremental pattern with shapes or numbers
                if (Math.random() < 0.5) {
                    // Number sequence (1, 2, 3, ?)
                    const startNumber = Math.floor(Math.random() * 5) + 1;
                    currentPattern = [startNumber, startNumber + 1, startNumber + 2, startNumber + 3];
                    correctAnswer = startNumber + 3;
                } else {
                    // Shape sequence with three repeating items
                    const shapes = ['🔺', '⭐', '🔶', '⚪', '🔷', '🔴', '🟦', '🟩'];
                    const a = shapes[Math.floor(Math.random() * shapes.length)];
                    let b, c;
                    do {
                        b = shapes[Math.floor(Math.random() * shapes.length)];
                    } while (a === b);
                    do {
                        c = shapes[Math.floor(Math.random() * shapes.length)];
                    } while (a === c || b === c);
                    
                    currentPattern = [a, b, c, a, b];
                    correctAnswer = c;
                }
            } else {
                // Advanced patterns
                const patternTypes = ['growing', 'position', 'complex'];
                const patternType = patternTypes[Math.floor(Math.random() * patternTypes.length)];
                
                if (patternType === 'growing') {
                    // Growing pattern (e.g., 1, 2, 4, 8, ?)
                    const base = Math.floor(Math.random() * 3) + 2; // 2, 3, or 4
                    const sequence = [1];
                    for (let i = 1; i < 5; i++) {
                        sequence.push(sequence[i-1] * base);
                    }
                    currentPattern = sequence.slice(0, -1);
                    correctAnswer = sequence[sequence.length - 1];
                } else if (patternType === 'position') {
                    // Position-based pattern with emojis
                    const emojis = ['😀', '🚗', '🐱', '🌈', '🎈', '🎁', '🔑', '⚽'];
                    const selectedEmojis = [];
                    while (selectedEmojis.length < 3) {
                        const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                        if (!selectedEmojis.includes(emoji)) {
                            selectedEmojis.push(emoji);
                        }
                    }
                    
                    // Create pattern like: A, B, C, A, B, ?
                    const [a, b, c] = selectedEmojis;
                    currentPattern = [a, b, c, a, b];
                    correctAnswer = c;
                } else {
                    // Complex pattern: a mix of letters, numbers, shapes
                    const options = [
                        '1️⃣', '2️⃣', '3️⃣', '4️⃣', '5️⃣',
                        '🔴', '🟠', '🟡', '🟢', '🔵',
                        'A', 'B', 'C', 'D', 'E'
                    ];
                    
                    // Create a pattern with a rule
                    const selectedOptions = [];
                    for (let i = 0; i < 3; i++) {
                        let option;
                        do {
                            option = options[Math.floor(Math.random() * options.length)];
                        } while (selectedOptions.includes(option));
                        selectedOptions.push(option);
                    }
                    
                    const [a, b, c] = selectedOptions;
                    currentPattern = [a, b, c, a, b];
                    correctAnswer = c;
                }
            }
        }
        
        // Generate answer options for pattern game
        function generateAnswerOptions() {
            const options = [correctAnswer];
            const allOptions = ['🍎', '🍌', '🍊', '🍇', '🍓', '🔺', '⭐', '🔶', '⚪', '🔷', '🐶', '🐱', '🐭', '🐰', '🦊'];
            
            if (typeof correctAnswer === 'number') {
                // If correctAnswer is a number, add other numbers as options
                while (options.length < 4) {
                    const randomOffset = Math.floor(Math.random() * 10) - 5; // -5 to +4
                    const randomOption = correctAnswer + randomOffset;
                    if (!options.includes(randomOption) && randomOption > 0) {
                        options.push(randomOption);
                    }
                }
            } else {
                // Add wrong options from the allOptions array
                while (options.length < 4) {
                    const randomOption = allOptions[Math.floor(Math.random() * allOptions.length)];
                    if (!options.includes(randomOption) && randomOption !== correctAnswer) {
                        options.push(randomOption);
                    }
                }
            }
            
            // Shuffle options
            return shuffleArray(options);
        }
        
        // Check pattern answer
        function checkPatternAnswer(element, answer) {
            const allItems = document.querySelectorAll('.pattern-item');
            allItems.forEach(item => {
                item.style.pointerEvents = 'none';
            });
            
            const isCorrect = answer === correctAnswer 
                || (typeof answer === 'number' && typeof correctAnswer === 'number' && answer === correctAnswer);
                
            if (isCorrect) {
                element.classList.add('correct');
                playSuccessSound();
                
                // Update score
                gameScores['patterns-game']++;
                updateScoreDisplay('patterns-game');
                
                // Update progress
                updateUserProgress('patterns-game');
                
                // Show reward every 3 correct answers
                if (gameScores['patterns-game'] % 3 === 0) {
                    setTimeout(() => {
                        showReward('You are a pattern expert!', Math.min(gameScores['patterns-game'] / 3, 5));
                    }, 1000);
                }
                
                // Level up (but respect the current difficulty setting)
                patternLevel = Math.min(patternLevel + 1, 4);
                
                // Get next pattern after delay
                setTimeout(() => {
                    initPatternsGame();
                }, 1500);
            } else {
                element.classList.add('incorrect');
                playErrorSound();
                
                // Show correct answer
                allItems.forEach(item => {
                    if ((typeof correctAnswer === 'number' && item.textContent == correctAnswer) || 
                        item.textContent === correctAnswer) {
                        item.classList.add('correct');
                    }
                });
                
                // Try again after delay
                setTimeout(() => {
                    initPatternsGame();
                }, 2000);
            }
        }
        
        // Shapes and Colors Game Logic
        function initShapesGame() {
            const shapeContainer = document.getElementById('shape-container');
            const shapePrompt = document.getElementById('shape-prompt');
            
            shapeContainer.innerHTML = '';
            
            // Set difficulty based on settings
            shapesLevel = gameDifficulties['shapes-game'] || 1;
            
            // Generate shapes based on level
            const shapes = generateShapes();
            
            // Update shape container
            shapes.forEach(shapeData => {
                const shapeItem = document.createElement('div');
                shapeItem.className = 'shape-item';
                shapeItem.style.background = shapeData.color;
                
                if (shapeData.shape === 'circle') {
                    shapeItem.style.borderRadius = '50%';
                } else if (shapeData.shape === 'triangle') {
                    shapeItem.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                } else if (shapeData.shape === 'square') {
                    // Default shape is square
                } else if (shapeData.shape === 'star') {
                    shapeItem.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
                } else if (shapeData.shape === 'diamond') {
                    shapeItem.style.clipPath = 'polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)';
                } else if (shapeData.shape === 'heart') {
                    shapeItem.style.clipPath = 'path("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z")';
                } else if (shapeData.shape === 'pentagon') {
                    shapeItem.style.clipPath = 'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)';
                } else if (shapeData.shape === 'hexagon') {
                    shapeItem.style.clipPath = 'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)';
                }
                
                shapeItem.dataset.shape = shapeData.shape;
                shapeItem.dataset.color = shapeData.colorName;
                
                shapeItem.addEventListener('click', () => checkShapeAnswer(shapeItem));
                shapeContainer.appendChild(shapeItem);
            });
            
            // Set prompt based on difficulty
            if (shapesLevel === 1) {
                // Level 1: Either shape or color
                if (Math.random() < 0.5) {
                    currentShapePrompt = `shape:${correctShape.shape}`;
                    shapePrompt.textContent = `Find the ${correctShape.shape}!`;
                } else {
                    currentShapePrompt = `color:${correctShape.colorName}`;
                    shapePrompt.textContent = `Find the ${correctShape.colorName} shape!`;
                }
            } else if (shapesLevel === 2) {
                // Level 2: Both shape and color
                currentShapePrompt = `both:${correctShape.colorName}:${correctShape.shape}`;
                shapePrompt.textContent = `Find the ${correctShape.colorName} ${correctShape.shape}!`;
            } else {
                // Level 3+: Multiple attributes or negation
                const promptTypes = ['multiple', 'negation', 'position'];
                const promptType = promptTypes[Math.floor(Math.random() * promptTypes.length)];
                
                if (promptType === 'multiple') {
                    // Find shape with multiple conditions (e.g., "Find a red shape that is NOT a circle")
                    const otherShapes = shapes.filter(shape => 
                        shape.colorName === correctShape.colorName && 
                        shape.shape !== correctShape.shape
                    );
                    
                    if (otherShapes.length > 0) {
                        const excludedShape = otherShapes[0].shape;
                        currentShapePrompt = `multiple:${correctShape.colorName}:not:${excludedShape}`;
                        shapePrompt.textContent = `Find a ${correctShape.colorName} shape that is NOT a ${excludedShape}!`;
                    } else {
                        // Fallback to basic prompt
                        currentShapePrompt = `both:${correctShape.colorName}:${correctShape.shape}`;
                        shapePrompt.textContent = `Find the ${correctShape.colorName} ${correctShape.shape}!`;
                    }
                } else if (promptType === 'negation') {
                    // Use negation in prompt
                    currentShapePrompt = `negation:not:${correctShape.colorName}:${correctShape.shape}`;
                    shapePrompt.textContent = `Find a shape that is NOT ${correctShape.colorName}!`;
                } else {
                    // Position-based prompts
                    const positions = ['top', 'bottom', 'left', 'right'];
                    const position = positions[Math.floor(Math.random() * positions.length)];
                    
                    currentShapePrompt = `position:${position}`;
                    shapePrompt.textContent = `Find a shape on the ${position} side!`;
                }
            }
            
            // Update character speech
            document.getElementById('shapes-speech').textContent = `Can you find the shape? Level ${shapesLevel}`;
        }
        
        // Generate shapes for shape game
        function generateShapes() {
            const colors = [
                { name: 'red', value: '#ff6b6b' },
                { name: 'blue', value: '#4dabf7' },
                { name: 'green', value: '#51cf66' },
                { name: 'yellow', value: '#ffd43b' },
                { name: 'purple', value: '#cc5de8' },
                { name: 'orange', value: '#ff922b' },
                { name: 'pink', value: '#f06595' },
                { name: 'brown', value: '#9c7f50' }
            ];
            
            const shapes = ['circle', 'square', 'triangle'];
            
            if (shapesLevel >= 2) {
                // Add more shapes for higher levels
                shapes.push('star', 'diamond');
            }
            
            if (shapesLevel >= 3) {
                // Even more shapes for highest level
                shapes.push('heart', 'pentagon', 'hexagon');
            }
            
            const result = [];
            const usedCombinations = new Set();
            
            // Number of shapes depends on difficulty
            const numShapes = shapesLevel === 1 ? 6 : (shapesLevel === 2 ? 9 : 12);
            
            // Generate unique shapes
            for (let i = 0; i < numShapes; i++) {
                let shape, colorObj, combination;
                
                do {
                    shape = shapes[Math.floor(Math.random() * shapes.length)];
                    colorObj = colors[Math.floor(Math.random() * colors.length)];
                    combination = `${shape}-${colorObj.name}`;
                } while (usedCombinations.has(combination) && usedCombinations.size < shapes.length * colors.length);
                
                usedCombinations.add(combination);
                
                result.push({
                    shape: shape,
                    color: colorObj.value,
                    colorName: colorObj.name
                });
            }
            
            // Pick one shape as the correct one
            correctShape = result[Math.floor(Math.random() * result.length)];
            
            return shuffleArray(result);
        }
        
        // Check shape answer
        function checkShapeAnswer(element) {
            const allItems = document.querySelectorAll('.shape-item');
            allItems.forEach(item => {
                item.style.pointerEvents = 'none';
            });
            
            const [type, ...params] = currentShapePrompt.split(':');
            let isCorrect = false;
            
            if (type === 'shape') {
                isCorrect = element.dataset.shape === params[0];
            } else if (type === 'color') {
                isCorrect = element.dataset.color === params[0];
            } else if (type === 'both') {
                isCorrect = element.dataset.color === params[0] && element.dataset.shape === params[1];
            } else if (type === 'multiple') {
                // Multiple conditions: color and NOT a specific shape
                isCorrect = element.dataset.color === params[0] && params[1] === 'not' && element.dataset.shape !== params[2];
            } else if (type === 'negation') {
                // Negation: NOT a specific color
                isCorrect = params[0] === 'not' && element.dataset.color !== params[1];
            } else if (type === 'position') {
                // Position-based
                const position = params[0];
                const index = Array.from(allItems).indexOf(element);
                const gridSize = Math.sqrt(allItems.length);
                
                if (position === 'top') {
                    isCorrect = index < gridSize;
                } else if (position === 'bottom') {
                    isCorrect = index >= allItems.length - gridSize;
                } else if (position === 'left') {
                    isCorrect = index % gridSize === 0;
                } else if (position === 'right') {
                    isCorrect = index % gridSize === gridSize - 1;
                }
            }
            
            if (isCorrect) {
                element.classList.add('selected');
                playSuccessSound();
                
                // Update score
                gameScores['shapes-game']++;
                updateScoreDisplay('shapes-game');
                
                // Update progress
                updateUserProgress('shapes-game');
                
                // Show reward every 3 correct answers
                if (gameScores['shapes-game'] % 3 === 0) {
                    setTimeout(() => {
                        showReward('You know your shapes and colors!', Math.min(gameScores['shapes-game'] / 3, 5));
                    }, 1000);
                }
                
                // Level up (but respect current difficulty setting)
                shapesLevel = Math.min(shapesLevel + 1, gameDifficulties['shapes-game'] * 2);
                
                // Get next shapes after delay
                setTimeout(() => {
                    initShapesGame();
                }, 1500);
            } else {
                playErrorSound();
                element.style.border = '3px solid #ff0000';
                
                // Show correct answer(s)
                allItems.forEach(item => {
                    if (type === 'shape' && item.dataset.shape === params[0]) {
                        item.classList.add('selected');
                    } else if (type === 'color' && item.dataset.color === params[0]) {
                        item.classList.add('selected');
                    } else if (type === 'both' && item.dataset.color === params[0] && item.dataset.shape === params[1]) {
                        item.classList.add('selected');
                    } else if (type === 'multiple' && item.dataset.color === params[0] && params[1] === 'not' && item.dataset.shape !== params[2]) {
                        item.classList.add('selected');
                    } else if (type === 'negation' && params[0] === 'not' && item.dataset.color !== params[1]) {
                        item.classList.add('selected');
                    } else if (type === 'position') {
                        const position = params[0];
                        const index = Array.from(allItems).indexOf(item);
                        const gridSize = Math.sqrt(allItems.length);
                        
                        if (position === 'top' && index < gridSize) {
                            item.classList.add('selected');
                        } else if (position === 'bottom' && index >= allItems.length - gridSize) {
                            item.classList.add('selected');
                        } else if (position === 'left' && index % gridSize === 0) {
                            item.classList.add('selected');
                        } else if (position === 'right' && index % gridSize === gridSize - 1) {
                            item.classList.add('selected');
                        }
                    }
                });
                
                // Try again after delay
                setTimeout(() => {
                    initShapesGame();
                }, 2000);
            }
        }
        
        // Counting Game Logic
        function initCountingGame() {
            const countingObjects = document.getElementById('counting-objects');
            const numberButtons = document.getElementById('number-buttons');
            const countingPrompt = document.getElementById('counting-prompt');
            
            countingObjects.innerHTML = '';
            numberButtons.innerHTML = '';
            
            // Set difficulty
            countingLevel = gameDifficulties['counting-game'] || 1;
            
            // Generate counting challenge based on level
            const count = generateCountingChallenge();
            countingAnswer = count;
            
            // Set prompt
            const emojis = ['🍎', '🍌', '🍊', '🍇', '🍓', '🍒', '🍑', '🍍', '🥝', '🍉', '🐶', '🐱', '🐭', '🐰', '🦊', '🐻', '🦁', '🐮'];
            const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            if (countingLevel === 1) {
                countingPrompt.textContent = `How many ${selectedEmoji} do you see?`;
            } else if (countingLevel === 2) {
                // Level 2: Mix of two types of objects
                const secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                countingPrompt.textContent = `How many ${selectedEmoji} do you see?`;
            } else {
                // Level 3: Addition, subtraction, or grouping
                const operations = ['add', 'subtract', 'grouping'];
                const operation = operations[Math.floor(Math.random() * operations.length)];
                
                if (operation === 'add') {
                    const secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    countingPrompt.textContent = `How many things do you see altogether?`;
                } else if (operation === 'subtract') {
                    const secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    countingPrompt.textContent = `How many more ${selectedEmoji} than ${secondEmoji}?`;
                } else {
                    countingPrompt.textContent = `How many groups of 2 ${selectedEmoji} can you make?`;
                }
            }
            
            // Update character speech
            document.getElementById('counting-speech').textContent = `Let's count together! Level ${countingLevel}`;
            
            // Create number options
            const maxNumber = countingLevel === 1 ? 10 : (countingLevel === 2 ? 15 : 20);
            const numButtons = Math.min(countingAnswer + 5, maxNumber);
            
            // Generate a set of numbers including the correct answer
            const numberOptions = [countingAnswer];
            while (numberOptions.length < Math.min(6, numButtons)) {
                const num = Math.max(1, Math.floor(Math.random() * numButtons));
                if (!numberOptions.includes(num)) {
                    numberOptions.push(num);
                }
            }
            
            // Shuffle and display number buttons
            shuffleArray(numberOptions).forEach(num => {
                const numberButton = document.createElement('div');
                numberButton.className = 'number-button';
                numberButton.textContent = num;
                numberButton.addEventListener('click', () => checkCountingAnswer(numberButton, num));
                numberButtons.appendChild(numberButton);
            });
        }
        
        // Generate counting challenge based on level
        function generateCountingChallenge() {
            const countingObjects = document.getElementById('counting-objects');
            countingObjects.innerHTML = '';
            
            if (countingLevel === 1) {
                // Level 1: Simple counting up to 5
                const count = Math.floor(Math.random() * 5) + 1;
                const emojis = ['🍎', '🍌', '🍊', '🍇', '🍓', '🍒', '🍑', '🍍', '🥝', '🍉'];
                const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                for (let i = 0; i < count; i++) {
                    const countingObject = document.createElement('div');
                    countingObject.className = 'counting-object';
                    countingObject.textContent = selectedEmoji;
                    countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                    countingObjects.appendChild(countingObject);
                }
                
                return count;
            } else if (countingLevel === 2) {
                // Level 2: Counting up to 10, possibly with two types of objects
                const count = Math.floor(Math.random() * 6) + 5; // 5-10
                const emojis = ['🍎', '🍌', '🍊', '🍇', '🍓', '🍒', '🍑', '🍍', '🥝', '🍉'];
                const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                // Possibly add a second type
                const useSecondType = Math.random() < 0.5;
                let secondEmoji;
                let secondTypeCount = 0;
                
                if (useSecondType) {
                    do {
                        secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    } while (secondEmoji === selectedEmoji);
                    
                    secondTypeCount = Math.floor(Math.random() * 4) + 1; // 1-4
                }
                
                // Add main objects
                for (let i = 0; i < (useSecondType ? count - secondTypeCount : count); i++) {
                    const countingObject = document.createElement('div');
                    countingObject.className = 'counting-object';
                    countingObject.textContent = selectedEmoji;
                    countingObject.dataset.type = 'main';
                    countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                    countingObjects.appendChild(countingObject);
                }
                
                // Add second type if using
                if (useSecondType) {
                    for (let i = 0; i < secondTypeCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = secondEmoji;
                        countingObject.dataset.type = 'second';
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                }
                
                return useSecondType ? count - secondTypeCount : count;
            } else {
                // Level 3: More advanced counting concepts
                const operationType = Math.floor(Math.random() * 3); // 0: addition, 1: subtraction, 2: grouping
                const emojis = ['🐶', '🐱', '🐭', '🐰', '🦊', '🐻', '🦁', '🐮', '🐷', '🐸'];
                const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                if (operationType === 0) {
                    // Addition: count total of two types
                    const firstCount = Math.floor(Math.random() * 5) + 3; // 3-7
                    const secondCount = Math.floor(Math.random() * 5) + 2; // 2-6
                    
                    let secondEmoji;
                    do {
                        secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    } while (secondEmoji === selectedEmoji);
                    
                    // Add first type
                    for (let i = 0; i < firstCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = selectedEmoji;
                        countingObject.dataset.type = 'first';
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                    
                    // Add second type
                    for (let i = 0; i < secondCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = secondEmoji;
                        countingObject.dataset.type = 'second';
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                    
                    return firstCount + secondCount;
                } else if (operationType === 1) {
                    // Subtraction: how many more of one type than another
                    const firstCount = Math.floor(Math.random() * 5) + 5; // 5-9
                    const secondCount = Math.floor(Math.random() * 4) + 1; // 1-4
                    
                    let secondEmoji;
                    do {
                        secondEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    } while (secondEmoji === selectedEmoji);
                    
                    // Add first type
                    for (let i = 0; i < firstCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = selectedEmoji;
                        countingObject.dataset.type = 'first';
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                    
                    // Add second type
                    for (let i = 0; i < secondCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = secondEmoji;
                        countingObject.dataset.type = 'second';
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                    
                    return firstCount - secondCount;
                } else {
                    // Grouping: how many groups of 2, 3, etc.
                    const groupSize = 2;
                    const numberOfGroups = Math.floor(Math.random() * 3) + 2; // 2-4
                    const totalCount = groupSize * numberOfGroups;
                    
                    for (let i = 0; i < totalCount; i++) {
                        const countingObject = document.createElement('div');
                        countingObject.className = 'counting-object';
                        countingObject.textContent = selectedEmoji;
                        
                        // Position objects in groups
                        const groupIndex = Math.floor(i / groupSize);
                        const withinGroupIndex = i % groupSize;
                        
                        countingObject.style.position = 'relative';
                        countingObject.style.left = `${(groupIndex * 40) - (withinGroupIndex * 5)}px`;
                        countingObject.style.top = `${withinGroupIndex * 10}px`;
                        
                        countingObject.style.animation = `bounce ${1 + Math.random()}s ease-in-out ${Math.random()}s infinite`;
                        countingObjects.appendChild(countingObject);
                    }
                    
                    return numberOfGroups;
                }
            }
        }
        
        // Check counting answer
        function checkCountingAnswer(element, answer) {
            const allButtons = document.querySelectorAll('.number-button');
            allButtons.forEach(button => {
                button.style.pointerEvents = 'none';
            });
            
            if (answer === countingAnswer) {
                element.style.backgroundColor = '#4caf50';
                playSuccessSound();
                
                // Update score
                gameScores['counting-game']++;
                updateScoreDisplay('counting-game');
                
                // Update progress
                updateUserProgress('counting-game');
                
                // Show reward every 3 correct answers
                if (gameScores['counting-game'] % 3 === 0) {
                    setTimeout(() => {
                        showReward('You are a counting champion!', Math.min(gameScores['counting-game'] / 3, 5));
                    }, 1000);
                }
                
                // Level up (but respect current difficulty setting)
                countingLevel = Math.min(countingLevel + 1, gameDifficulties['counting-game'] * 2);
                
                // Get next counting challenge after delay
                setTimeout(() => {
                    initCountingGame();
                }, 1500);
            } else {
                element.style.backgroundColor = '#f44336';
                playErrorSound();
                
                // Show correct answer
                allButtons.forEach(button => {
                    if (parseInt(button.textContent) === countingAnswer) {
                        button.style.backgroundColor = '#4caf50';
                    }
                });
                
                // Try again after delay
                setTimeout(() => {
                    initCountingGame();
                }, 2000);
            }
        }
        
        // Cause and Effect Game Logic
        function initCauseEffectGame() {
            // Reset interactive elements
            const sun = document.querySelector('.sun');
            sun.style.animation = 'none';
            
            const clouds = document.querySelectorAll('.cloud');
            clouds.forEach(cloud => {
                cloud.style.animation = 'float 10s ease-in-out infinite';
            });
            
            const flowers = document.querySelectorAll('.flower');
            flowers.forEach(flower => {
                flower.style.transform = 'scale(1)';
            });
            
            // Clear existing raindrops
            document.getElementById('raindrops-container').innerHTML = '';
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'Try clicking on things in the garden!';
            
            // More advanced effects based on difficulty
            const difficulty = gameDifficulties['cause-effect-game'] || 1;
            
            if (difficulty >= 2) {
                // Add more interactive elements for higher difficulties
                const scene = document.querySelector('.interactive-scene');
                
                // Check if we already added additional elements
                if (!document.querySelector('.butterfly')) {
                    // Add a butterfly
                    const butterfly = document.createElement('div');
                    butterfly.className = 'interactive-element butterfly';
                    butterfly.style.position = 'absolute';
                    butterfly.style.fontSize = '40px';
                    butterfly.textContent = '🦋';
                    butterfly.style.top = '100px';
                    butterfly.style.left = '300px';
                    butterfly.style.animation = 'float 8s ease-in-out infinite';
                    butterfly.onclick = triggerButterflyEffect;
                    scene.appendChild(butterfly);
                    
                    // Add a bird
                    const bird = document.createElement('div');
                    bird.className = 'interactive-element bird';
                    bird.style.position = 'absolute';
                    bird.style.fontSize = '40px';
                    bird.textContent = '🐦';
                    bird.style.top = '50px';
                    bird.style.left = '150px';
                    bird.onclick = triggerBirdEffect;
                    scene.appendChild(bird);
                }
            }
            
            if (difficulty >= 3) {
                // Add more complex interactive elements and scenes
                const scene = document.querySelector('.interactive-scene');
                
                // Check if we already added these elements
                if (!document.querySelector('.pond')) {
                    // Add a pond
                    const pond = document.createElement('div');
                    pond.className = 'interactive-element pond';
                    pond.style.position = 'absolute';
                    pond.style.width = '150px';
                    pond.style.height = '70px';
                    pond.style.backgroundColor = '#3498db';
                    pond.style.borderRadius = '50%';
                    pond.style.bottom = '110px';
                    pond.style.right = '50px';
                    pond.onclick = triggerPondEffect;
                    scene.appendChild(pond);
                    
                    // Add a fish in the pond
                    const fish = document.createElement('div');
                    fish.className = 'interactive-element fish';
                    fish.style.position = 'absolute';
                    fish.style.fontSize = '25px';
                    fish.textContent = '🐟';
                    fish.style.bottom = '130px';
                    fish.style.right = '100px';
                    fish.onclick = triggerFishEffect;
                    scene.appendChild(fish);
                }
            }
        }
        
        // Sun effect
        function triggerSunEffect() {
            playClickSound();
            
            const sun = document.querySelector('.sun');
            sun.style.animation = 'spin 2s linear infinite';
            
            // Make flowers grow
            const flowers = document.querySelectorAll('.flower');
            flowers.forEach(flower => {
                flower.style.transition = 'transform 1s ease';
                flower.style.transform = 'scale(1.3)';
            });
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'The sun makes flowers grow!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Rain effect
        function triggerRainEffect() {
            playClickSound();
            
            const raindropsContainer = document.getElementById('raindrops-container');
            raindropsContainer.innerHTML = '';
            
            // Create raindrops
            for (let i = 0; i < 20; i++) {
                const raindrop = document.createElement('div');
                raindrop.className = 'raindrop';
                raindrop.style.left = `${Math.random() * 100}%`;
                raindrop.style.top = '20%';
                raindrop.style.animationDelay = `${Math.random() * 2}s`;
                raindropsContainer.appendChild(raindrop);
                
                // Animate raindrop
                setTimeout(() => {
                    raindrop.style.opacity = 1;
                    raindrop.style.transform = 'translateY(200px)';
                    
                    // Remove raindrop after animation
                    setTimeout(() => {
                        raindrop.style.opacity = 0;
                    }, 1000);
                }, i * 100);
            }
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'Clouds make rain!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Tree effect
        function triggerTreeEffect() {
            playClickSound();
            
            const tree = document.querySelector('.tree');
            tree.style.animation = 'wiggle 0.5s ease infinite';
            
            // If there's a bird, make it fly away
            const bird = document.querySelector('.bird');
            if (bird) {
                bird.style.transition = 'transform 2s ease, top 2s ease, left 2s ease';
                bird.style.transform = 'translateY(-100px)';
                bird.style.top = '0';
                bird.style.left = '400px';
                
                // Return the bird after some time
                setTimeout(() => {
                    bird.style.transition = 'transform 2s ease, top 2s ease, left 2s ease';
                    bird.style.transform = 'translateY(0)';
                    bird.style.top = '50px';
                    bird.style.left = '150px';
                }, 3000);
            }
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'The tree is dancing in the wind!';
            
            // Stop animation after some time
            setTimeout(() => {
                tree.style.animation = 'none';
            }, 2000);
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Flower effect
        function triggerFlowerEffect(flower) {
            playClickSound();
            
            flower.style.animation = 'bounce 0.5s ease infinite';
            
            // If there's a butterfly, make it come to the flower
            const butterfly = document.querySelector('.butterfly');
            if (butterfly) {
                const flowerRect = flower.getBoundingClientRect();
                const butterflyRect = butterfly.getBoundingClientRect();
                
                butterfly.style.transition = 'top 1s ease, left 1s ease';
                butterfly.style.top = `${flowerRect.top - butterflyRect.height/2}px`;
                butterfly.style.left = `${flowerRect.left}px`;
                
                // Return the butterfly after some time
                setTimeout(() => {
                    butterfly.style.transition = 'top 1s ease, left 1s ease';
                    butterfly.style.top = '100px';
                    butterfly.style.left = '300px';
                    butterfly.style.animation = 'float 8s ease-in-out infinite';
                }, 3000);
            }
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'You made the flower bounce!';
            
            // Stop animation after some time
            setTimeout(() => {
                flower.style.animation = 'none';
            }, 2000);
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Butterfly effect
        function triggerButterflyEffect() {
            playClickSound();
            
            const butterfly = document.querySelector('.butterfly');
            butterfly.style.animation = 'none';
            
            // Make butterfly flutter around
            butterfly.style.transition = 'transform 0.2s ease';
            
            let flutterCount = 0;
            const flutterInterval = setInterval(() => {
                butterfly.style.transform = flutterCount % 2 === 0 ? 'rotate(10deg)' : 'rotate(-10deg)';
                flutterCount++;
                
                if (flutterCount > 10) {
                    clearInterval(flutterInterval);
                    butterfly.style.transform = 'none';
                    butterfly.style.animation = 'float 8s ease-in-out infinite';
                }
            }, 200);
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'The butterfly is fluttering its wings!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Bird effect
        function triggerBirdEffect() {
            playClickSound();
            
            const bird = document.querySelector('.bird');
            
            // Make bird sing
            bird.textContent = '🐦';
            const noteElement = document.createElement('div');
            noteElement.textContent = '🎵';
            noteElement.style.position = 'absolute';
            noteElement.style.top = '-20px';
            noteElement.style.left = '20px';
            noteElement.style.fontSize = '20px';
            noteElement.style.animation = 'float 2s ease-out';
            bird.appendChild(noteElement);
            
            // Play bird sound
            if (audioContext && soundEnabled) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 880; // A5
                
                gainNode.gain.value = 0;
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGainNode);
                
                const now = audioContext.currentTime;
                
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.2, now + 0.05);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
                
                oscillator.start(now);
                oscillator.stop(now + 0.3);
                
                // Second chirp
                setTimeout(() => {
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode2 = audioContext.createGain();
                    
                    oscillator2.type = 'sine';
                    oscillator2.frequency.value = 988; // B5
                    
                    gainNode2.gain.value = 0;
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(masterGainNode);
                    
                    const now2 = audioContext.currentTime;
                    
                    gainNode2.gain.setValueAtTime(0, now2);
                    gainNode2.gain.linearRampToValueAtTime(0.2, now2 + 0.05);
                    gainNode2.gain.linearRampToValueAtTime(0, now2 + 0.3);
                    
                    oscillator2.start(now2);
                    oscillator2.stop(now2 + 0.3);
                }, 400);
            }
            
            // Remove note after animation
            setTimeout(() => {
                if (noteElement.parentNode === bird) {
                    bird.removeChild(noteElement);
                }
            }, 2000);
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'The bird is singing!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Pond effect
        function triggerPondEffect() {
            playClickSound();
            
            const pond = document.querySelector('.pond');
            
            // Create ripple effect
            for (let i = 0; i < 3; i++) {
                const ripple = document.createElement('div');
                ripple.style.position = 'absolute';
                ripple.style.width = '100%';
                ripple.style.height = '100%';
                ripple.style.borderRadius = '50%';
                ripple.style.border = '2px solid rgba(255, 255, 255, 0.5)';
                ripple.style.top = '0';
                ripple.style.left = '0';
                ripple.style.transform = 'scale(1)';
                ripple.style.opacity = '1';
                ripple.style.transition = `transform ${1 + i * 0.5}s ease-out, opacity ${1 + i * 0.5}s ease-out`;
                pond.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.style.transform = 'scale(2)';
                    ripple.style.opacity = '0';
                }, 100);
                
                // Remove ripple after animation
                setTimeout(() => {
                    if (ripple.parentNode === pond) {
                        pond.removeChild(ripple);
                    }
                }, (1 + i * 0.5) * 1000);
            }
            
            // Make fish move
            const fish = document.querySelector('.fish');
            if (fish) {
                fish.style.transition = 'transform 1s ease, left 1s ease';
                fish.style.transform = 'translateX(30px)';
                
                setTimeout(() => {
                    fish.style.transform = 'translateX(0)';
                }, 1000);
            }
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'You made ripples in the pond!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Fish effect
        function triggerFishEffect() {
            playClickSound();
            
            const fish = document.querySelector('.fish');
            
            // Make fish jump
            fish.style.transition = 'transform 0.5s ease-out, bottom 0.5s ease-out';
            fish.style.transform = 'translateY(-30px)';
            fish.style.bottom = '160px';
            
            // Create splash
            const splash = document.createElement('div');
            splash.textContent = '💦';
            splash.style.position = 'absolute';
            splash.style.fontSize = '20px';
            splash.style.bottom = '140px';
            splash.style.right = '110px';
            splash.style.opacity = '1';
            splash.style.transition = 'opacity 1s ease';
            document.querySelector('.interactive-scene').appendChild(splash);
            
            // Reset fish after jump
            setTimeout(() => {
                fish.style.transform = 'translateY(0)';
                fish.style.bottom = '130px';
                
                // Fade out splash
                splash.style.opacity = '0';
                
                // Remove splash after animation
                setTimeout(() => {
                    if (splash.parentNode) {
                        splash.parentNode.removeChild(splash);
                    }
                }, 1000);
            }, 500);
            
            // Update character speech
            document.getElementById('cause-effect-speech').textContent = 'The fish jumped out of the water!';
            
            // Add score if not already at max
            if (gameScores['cause-effect-game'] < 10) {
                gameScores['cause-effect-game']++;
                updateScoreDisplay('cause-effect-game');
                
                // Update progress
                updateUserProgress('cause-effect-game');
                
                if (gameScores['cause-effect-game'] % 2 === 0) {
                    setTimeout(() => {
                        showReward('You understand how nature works!', Math.min(gameScores['cause-effect-game'] / 2, 5));
                    }, 1000);
                }
            }
        }
        
        // Memory Game Logic
        function initMemoryGame() {
            const memoryCardsContainer = document.getElementById('memory-cards');
            memoryCardsContainer.innerHTML = '';
            
            // Reset game state
            flippedCards = [];
            matchedPairs = 0;
            
            // Set difficulty
            const difficulty = gameDifficulties['memory-game'] || 1;
            
            // Emoji pairs for memory game (adjust difficulty based on level)
            const numPairs = difficulty === 1 ? 3 : (difficulty === 2 ? 4 : 6);
            
            // More advanced themes for higher difficulties
            let emojis;
            
            if (difficulty === 1) {
                // Simple animals for easier level
                emojis = ['🐶', '🐱', '🐭', '🐰', '🦊', '🐻', '🐼', '🐨', '🦁', '🐯', '🐸', '🐵'];
            } else if (difficulty === 2) {
                // Mix of categories for medium level
                emojis = ['🍎', '🍌', '🚗', '🚂', '🏠', '⚽', '🎸', '🎨', '🔑', '📱', '⏰', '📚'];
            } else {
                // Challenging and less distinct categories
                emojis = ['🔴', '🟠', '🟡', '🟢', '🔵', '🟣', '⚪', '⚫', '🟤', '🔺', '🔶', '🔷'];
            }
            
            const selectedEmojis = emojis.slice(0, numPairs);
            
            // Create pairs
            memoryCards = [];
            selectedEmojis.forEach(emoji => {
                memoryCards.push({ emoji, matched: false });
                memoryCards.push({ emoji, matched: false });
            });
            
            // Shuffle cards
            memoryCards = shuffleArray(memoryCards);
            
            // Adjust grid layout based on number of cards
            if (numPairs <= 3) {
                memoryCardsContainer.style.gridTemplateColumns = 'repeat(3, 1fr)';
            } else if (numPairs === 4) {
                memoryCardsContainer.style.gridTemplateColumns = 'repeat(4, 1fr)';
            } else {
                memoryCardsContainer.style.gridTemplateColumns = 'repeat(4, 1fr)';
            }
            
            // Create card elements
            memoryCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                cardElement.dataset.index = index;
                
                const cardFront = document.createElement('div');
                cardFront.className = 'memory-card-front';
                cardElement.appendChild(cardFront);
                
                const cardBack = document.createElement('div');
                cardBack.className = 'memory-card-back';
                cardBack.textContent = card.emoji;
                cardElement.appendChild(cardBack);
                
                cardElement.addEventListener('click', () => flipCard(cardElement, index));
                memoryCardsContainer.appendChild(cardElement);
            });
            
            // Update character speech
            document.getElementById('memory-speech').textContent = 'Find the matching pairs!';
        }
        
        // Flip card in memory game
        function flipCard(cardElement, index) {
            // Prevent flipping more than two cards at once or already matched cards
            if (flippedCards.length >= 2 || memoryCards[index].matched || flippedCards.includes(index)) {
                return;
            }
            
            playClickSound();
            
            // Flip the card
            cardElement.classList.add('flipped');
            flippedCards.push(index);
            
            // Check for match if two cards are flipped
            if (flippedCards.length === 2) {
                const [index1, index2] = flippedCards;
                
                if (memoryCards[index1].emoji === memoryCards[index2].emoji) {
                    // Match found
                    memoryCards[index1].matched = true;
                    memoryCards[index2].matched = true;
                    matchedPairs++;
                    
                    playSuccessSound();
                    
                    // Clear flipped cards
                    flippedCards = [];
                    
                    // Check if all pairs are matched
                    if (matchedPairs === memoryCards.length / 2) {
                        // Game completed
                        gameScores['memory-game']++;
                        updateScoreDisplay('memory-game');
                        
                        // Update progress
                        updateUserProgress('memory-game');
                        
                        setTimeout(() => {
                            showReward('You have an amazing memory!', Math.min(gameScores['memory-game'], 5));
                            
                            // Check for memory champion achievement
                            if (gameScores['memory-game'] >= 5 && !achievements['memory-champion']) {
                                unlockAchievement('memory-champion', 'Memory Champion', 'Mastered 5 memory games!');
                            }
                        }, 1000);
                        
                        // Reset game after reward
                        setTimeout(() => {
                            initMemoryGame();
                        }, 3000);
                    }
                } else {
                    // No match
                    setTimeout(() => {
                        document.querySelectorAll(`.memory-card[data-index="${index1}"], .memory-card[data-index="${index2}"]`).forEach(card => {
                            card.classList.remove('flipped');
                        });
                        flippedCards = [];
                        playErrorSound();
                    }, 1000);
                }
            }
        }
        
        // Alphabet Game Logic
        function initAlphabetObjects() {
            // Create alphabet objects
            alphabetObjects = {
                'A': [
                    { emoji: '🍎', name: 'Apple' },
                    { emoji: '👽', name: 'Alien' },
                    { emoji: '✈️', name: 'Airplane' }
                ],
                'B': [
                    { emoji: '🍌', name: 'Banana' },
                    { emoji: '🦋', name: 'Butterfly' },
                    { emoji: '🏀', name: 'Basketball' }
                ],
                'C': [
                    { emoji: '🐱', name: 'Cat' },
                    { emoji: '🍪', name: 'Cookie' },
                    { emoji: '🤡', name: 'Clown' }
                ],
                'D': [
                    { emoji: '🐕', name: 'Dog' },
                    { emoji: '🦆', name: 'Duck' },
                    { emoji: '🧸', name: 'Doll' }
                ],
                'E': [
                    { emoji: '🥚', name: 'Egg' },
                    { emoji: '🐘', name: 'Elephant' },
                    { emoji: '👁️', name: 'Eye' }
                ],
                'F': [
                    { emoji: '🐸', name: 'Frog' },
                    { emoji: '🦊', name: 'Fox' },
                    { emoji: '🍟', name: 'Fries' }
                ],
                'G': [
                    { emoji: '🦒', name: 'Giraffe' },
                    { emoji: '🍇', name: 'Grapes' },
                    { emoji: '🎮', name: 'Game' }
                ],
                'H': [
                    { emoji: '🏠', name: 'House' },
                    { emoji: '🐴', name: 'Horse' },
                    { emoji: '🙋‍♂️', name: 'Hand' }
                ],
                'I': [
                    { emoji: '🍦', name: 'Ice cream' },
                    { emoji: '🦔', name: 'Igel' },
                    { emoji: '👶', name: 'Infant' }
                ],
                'J': [
                    { emoji: '🤹‍♂️', name: 'Juggler' },
                    { emoji: '👖', name: 'Jeans' },
                    { emoji: '🕹️', name: 'Joystick' }
                ],
                'K': [
                    { emoji: '🪁', name: 'Kite' },
                    { emoji: '🔑', name: 'Key' },
                    { emoji: '🦘', name: 'Kangaroo' }
                ],
                'L': [
                    { emoji: '🦁', name: 'Lion' },
                    { emoji: '🍋', name: 'Lemon' },
                    { emoji: '💡', name: 'Light bulb' }
                ],
                'M': [
                    { emoji: '🐵', name: 'Monkey' },
                    { emoji: '🌙', name: 'Moon' },
                    { emoji: '🍄', name: 'Mushroom' }
                ],
                'N': [
                    { emoji: '📓', name: 'Notebook' },
                    { emoji: '👃', name: 'Nose' },
                    { emoji: '🌃', name: 'Night' }
                ],
                'O': [
                    { emoji: '🐙', name: 'Octopus' },
                    { emoji: '🦉', name: 'Owl' },
                    { emoji: '🍊', name: 'Orange' }
                ],
                'P': [
                    { emoji: '🐼', name: 'Panda' },
                    { emoji: '🍐', name: 'Pear' },
                    { emoji: '✏️', name: 'Pencil' }
                ],
                'Q': [
                    { emoji: '👸', name: 'Queen' },
                    { emoji: '❓', name: 'Question' },
                    { emoji: '🧠', name: 'Quiz' }
                ],
                'R': [
                    { emoji: '🐇', name: 'Rabbit' },
                    { emoji: '🤖', name: 'Robot' },
                    { emoji: '🌈', name: 'Rainbow' }
                ],
                'S': [
                    { emoji: '🐍', name: 'Snake' },
                    { emoji: '⭐', name: 'Star' },
                    { emoji: '🍓', name: 'Strawberry' }
                ],
                'T': [
                    { emoji: '🐅', name: 'Tiger' },
                    { emoji: '🌮', name: 'Taco' },
                    { emoji: '🦃', name: 'Turkey' }
                ],
                'U': [
                    { emoji: '☂️', name: 'Umbrella' },
                    { emoji: '🦄', name: 'Unicorn' },
                    { emoji: '👆', name: 'Up' }
                ],
                'V': [
                    { emoji: '🚐', name: 'Van' },
                    { emoji: '🎻', name: 'Violin' },
                    { emoji: '🌋', name: 'Volcano' }
                ],
                'W': [
                    { emoji: '🐺', name: 'Wolf' },
                    { emoji: '🍉', name: 'Watermelon' },
                    { emoji: '👩‍🦱', name: 'Woman' }
                ],
                'X': [
                    { emoji: '❌', name: 'X' },
                    { emoji: '🎸', name: 'Xylophone' },
                    { emoji: '📦', name: 'Box' }
                ],
                'Y': [
                    { emoji: '🧶', name: 'Yarn' },
                    { emoji: '🟡', name: 'Yellow' },
                    { emoji: '🪀', name: 'Yo-yo' }
                ],
                'Z': [
                    { emoji: '🦓', name: 'Zebra' },
                    { emoji: '🤐', name: 'Zipper' },
                    { emoji: '💤', name: 'Zzz' }
                ]
            };
        }
        
        function initAlphabetGame() {
            currentLetter = 'A';
            displayAlphabetLetter();
            
            // Set up navigation buttons
            document.getElementById('prev-letter-btn').addEventListener('click', () => {
                navigateAlphabet(-1);
            });
            
            document.getElementById('next-letter-btn').addEventListener('click', () => {
                navigateAlphabet(1);
            });
            
            // Update character speech
            document.getElementById('alphabet-speech').textContent = `Let's learn the letter ${currentLetter}!`;
        }
        
        function displayAlphabetLetter() {
            // Display current letter
            document.getElementById('current-letter').textContent = currentLetter;
            
            // Display objects for this letter
            const alphabetObjectsContainer = document.getElementById('alphabet-objects');
            alphabetObjectsContainer.innerHTML = '';
            
            const objects = alphabetObjects[currentLetter];
            
            objects.forEach(obj => {
                const objectElement = document.createElement('div');
                objectElement.className = 'alphabet-object';
                objectElement.innerHTML = `
                    <div class="alphabet-object-emoji">${obj.emoji}</div>
                    <div class="alphabet-object-name">${obj.name}</div>
                `;
                
                objectElement.addEventListener('click', () => {
                    // Pronounce the word
                    speakWord(obj.name);
                    
                    // Animate the object
                    objectElement.style.animation = 'pulse 0.5s ease';
                    setTimeout(() => {
                        objectElement.style.animation = '';
                    }, 500);
                });
                
                alphabetObjectsContainer.appendChild(objectElement);
            });
            
            // Update character speech
            const speech = document.getElementById('alphabet-speech');
            
            // Different phrases based on difficulty
            const difficulty = gameDifficulties['alphabet-game'] || 1;
            const phrases = [
                `This is the letter ${currentLetter}!`,
                `${currentLetter} is for ${objects[0].name}!`,
                `Can you think of more words that start with ${currentLetter}?`
            ];
            
            speech.textContent = phrases[difficulty - 1];
            
            // Increment score occasionally to show progress
            if (Math.random() < 0.2) {
                gameScores['alphabet-game']++;
                updateScoreDisplay('alphabet-game');
                
                // Update progress
                updateUserProgress('alphabet-game');
                
                // Check for alphabet ace achievement
                if (gameScores['alphabet-game'] >= 5 && !achievements['alphabet-ace']) {
                    unlockAchievement('alphabet-ace', 'Alphabet Ace', 'Learned all about letters!');
                }
            }
        }
        
        function navigateAlphabet(direction) {
            playClickSound();
            
            // Get all letters
            const letters = Object.keys(alphabetObjects);
            const currentIndex = letters.indexOf(currentLetter);
            
            // Calculate new index
            let newIndex = currentIndex + direction;
            
            // Handle wrapping
            if (newIndex < 0) newIndex = letters.length - 1;
            if (newIndex >= letters.length) newIndex = 0;
            
            currentLetter = letters[newIndex];
            
            // Update display
            displayAlphabetLetter();
        }
        
        function speakWord(word) {
            if (!audioContext || !soundEnabled) return;
            
            // Simple "speaking" effect - a series of tones
            const baseFreq = 300 + Math.random() * 100;
            const wordLength = word.length;
            
            for (let i = 0; i < wordLength; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'triangle';
                    oscillator.frequency.value = baseFreq + (i * 30);
                    
                    gainNode.gain.value = 0;
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    
                    const now = audioContext.currentTime;
                    
                    gainNode.gain.setValueAtTime(0, now);
                    gainNode.gain.linearRampToValueAtTime(0.2, now + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                    
                    oscillator.start(now);
                    oscillator.stop(now + 0.2);
                }, i * 250);
            }
        }
        
        // Puzzle Game Logic
        function initPuzzleGame() {
            // Choose random puzzle image
            const puzzleIndex = Math.floor(Math.random() * puzzleImages.length);
            currentPuzzleImage = puzzleImages[puzzleIndex];
            
            // Set difficulty
            const difficulty = gameDifficulties['puzzle-game'] || 1;
            
            if (difficulty === 1) {
                puzzleSize = 2; // 2x2 puzzle
            } else if (difficulty === 2) {
                puzzleSize = 3; // 3x3 puzzle
            } else {
                puzzleSize = 4; // 4x4 puzzle
            }
            
            // Create puzzle container with correct grid size
            const puzzleContainer = document.getElementById('puzzle-container');
            puzzleContainer.style.gridTemplateColumns = `repeat(${puzzleSize}, 1fr)`;
            puzzleContainer.style.gridTemplateRows = `repeat(${puzzleSize}, 1fr)`;
            
            // Show puzzle preview
            const puzzlePreview = document.getElementById('puzzle-preview');
            puzzlePreview.style.backgroundImage = `url('https://picsum.photos/300/300?${currentPuzzleImage}')`;
            
            // Create puzzle pieces
            createPuzzlePieces();
            
            // Update character speech
            document.getElementById('puzzle-speech').textContent = 'Can you put the puzzle together?';
        }
        
        function createPuzzlePieces() {
            puzzlePieces = [];
            const puzzleContainer = document.getElementById('puzzle-container');
            puzzleContainer.innerHTML = '';
            
            // Create pieces
            for (let row = 0; row < puzzleSize; row++) {
                for (let col = 0; col < puzzleSize; col++) {
                    const piece = {
                        row: row,
                        col: col,
                        currentRow: row,
                        currentCol: col
                    };
                    
                    puzzlePieces.push(piece);
                }
            }
            
            // Shuffle pieces
            if (gameDifficulties['puzzle-game'] > 1) {
                puzzlePieces = shuffleArray(puzzlePieces);
                
                // Reassign current positions after shuffle
                puzzlePieces.forEach((piece, index) => {
                    piece.currentRow = Math.floor(index / puzzleSize);
                    piece.currentCol = index % puzzleSize;
                });
            }
            
            // Create DOM elements
            puzzlePieces.forEach((piece, index) => {
                const pieceElement = document.createElement('div');
                pieceElement.className = 'puzzle-piece';
                pieceElement.dataset.index = index;
                
                // Position the background image to show the right part
                pieceElement.style.backgroundImage = `url('https://picsum.photos/300/300?${currentPuzzleImage}')`;
                pieceElement.style.backgroundSize = `${puzzleSize * 100}%`;
                pieceElement.style.backgroundPosition = `${piece.col * 100/(puzzleSize-1)}% ${piece.row * 100/(puzzleSize-1)}%`;
                
                // Set grid position
                pieceElement.style.gridRow = piece.currentRow + 1;
                pieceElement.style.gridColumn = piece.currentCol + 1;
                
                pieceElement.addEventListener('click', () => movePuzzlePiece(index));
                puzzleContainer.appendChild(pieceElement);
            });
        }
        
        function movePuzzlePiece(index) {
            playClickSound();
            
            const piece = puzzlePieces[index];
            const pieceElement = document.querySelector(`.puzzle-piece[data-index="${index}"]`);
            
            // Check if piece can be moved
            const emptySpaces = findAdjacentEmptySpaces(piece.currentRow, piece.currentCol);
            
            if (emptySpaces.length > 0) {
                // Move to first available empty space
                const [newRow, newCol] = emptySpaces[0];
                
                // Update piece position
                piece.currentRow = newRow;
                piece.currentCol = newCol;
                
                // Update DOM element
                pieceElement.style.gridRow = newRow + 1;
                pieceElement.style.gridColumn = newCol + 1;
                
                // Check if puzzle is solved
                if (isPuzzleSolved()) {
                    // Solved!
                    setTimeout(() => {
                        playSuccessSound();
                        
                        // Update score
                        gameScores['puzzle-game']++;
                        updateScoreDisplay('puzzle-game');
                        
                        // Update progress
                        updateUserProgress('puzzle-game');
                        
                        // Show reward
                        showReward('You solved the puzzle!', Math.min(gameScores['puzzle-game'], 5));
                        
                        // Check for puzzle master achievement
                        if (gameScores['puzzle-game'] >= 5 && !achievements['puzzle-master']) {
                            unlockAchievement('puzzle-master', 'Puzzle Master', 'Completed 5 puzzles!');
                        }
                        
                        // Load new puzzle after a delay
                        setTimeout(() => {
                            initPuzzleGame();
                        }, 2000);
                    }, 500);
                }
            }
        }
        
        function findAdjacentEmptySpaces(row, col) {
            // For simplicity, in this version we'll allow any piece to move anywhere
            // In a real puzzle, you'd check adjacent spaces
            
            // Find all empty spaces
            const occupiedPositions = [];
            puzzlePieces.forEach(piece => {
                if (piece.currentRow !== row || piece.currentCol !== col) { // Skip the current piece
                    occupiedPositions.push(`${piece.currentRow},${piece.currentCol}`);
                }
            });
            
            // Check adjacent positions (up, right, down, left)
            const adjacentPositions = [
                [row - 1, col], // up
                [row, col + 1], // right
                [row + 1, col], // down
                [row, col - 1]  // left
            ];
            
            // Filter valid empty positions
            return adjacentPositions.filter(([r, c]) => {
                return r >= 0 && r < puzzleSize && 
                       c >= 0 && c < puzzleSize &&
                       !occupiedPositions.includes(`${r},${c}`);
            });
        }
        
        function isPuzzleSolved() {
            // Check if all pieces are in correct positions
            return puzzlePieces.every(piece => 
                piece.row === piece.currentRow && piece.col === piece.currentCol
            );
        }
        
        // Music Game Logic
        function initMusicGame() {
            const pianoContainer = document.getElementById('piano-container');
            const sequenceContainer = document.getElementById('music-sequence');
            
            pianoContainer.innerHTML = '';
            sequenceContainer.innerHTML = '';
            
            // Set difficulty
            const difficulty = gameDifficulties['music-game'] || 1;
            
            // Create piano keys
            createPianoKeys();
            
            // Generate sequence based on difficulty
            generateMusicSequence(difficulty);
            
            // Display sequence
            displayMusicSequence();
            
            // Reset user sequence
            userSequence = [];
            isPlayingSequence = false;
            
            // Update character speech
            document.getElementById('music-speech').textContent = 'Listen and repeat the melody!';
            
            // Play sequence after a short delay
            setTimeout(playMusicSequence, 1000);
        }
        
        function createPianoKeys() {
            const pianoContainer = document.getElementById('piano-container');
            pianoContainer.innerHTML = '';
            
            // Define notes and frequencies
            const notes = [
                { note: 'C', freq: 261.63, color: 'white' },
                { note: 'C#', freq: 277.18, color: 'black' },
                { note: 'D', freq: 293.66, color: 'white' },
                { note: 'D#', freq: 311.13, color: 'black' },
                { note: 'E', freq: 329.63, color: 'white' },
                { note: 'F', freq: 349.23, color: 'white' },
                { note: 'F#', freq: 369.99, color: 'black' },
                { note: 'G', freq: 392.00, color: 'white' },
                { note: 'G#', freq: 415.30, color: 'black' },
                { note: 'A', freq: 440.00, color: 'white' },
                { note: 'A#', freq: 466.16, color: 'black' },
                { note: 'B', freq: 493.88, color: 'white' }
            ];
            
            pianoKeys = notes;
            
            // Create piano keys
            notes.forEach((note, index) => {
                const keyElement = document.createElement('div');
                keyElement.className = `piano-key ${note.color}`;
                keyElement.dataset.note = note.note;
                keyElement.dataset.index = index;
                
                if (note.color === 'black') {
                    keyElement.style.left = `${(index - 0.5) * 40}px`;
                }
                
                keyElement.addEventListener('click', () => playNote(index));
                pianoContainer.appendChild(keyElement);
            });
        }
        
        function generateMusicSequence(difficulty) {
            currentSequence = [];
            
            // Generate sequence based on difficulty
            const sequenceLength = difficulty === 1 ? 3 : (difficulty === 2 ? 5 : 7);
            
            // Simple notes for beginners (only white keys)
            const allowedNotes = difficulty === 1 ? 
                [0, 2, 4, 5, 7, 9, 11] : // White keys only for level 1
                Array.from({ length: pianoKeys.length }, (_, i) => i); // All keys for higher levels
            
            for (let i = 0; i < sequenceLength; i++) {
                const randomIndex = Math.floor(Math.random() * allowedNotes.length);
                currentSequence.push(allowedNotes[randomIndex]);
            }
        }
        
        function displayMusicSequence() {
            const sequenceContainer = document.getElementById('music-sequence');
            sequenceContainer.innerHTML = '';
            
            currentSequence.forEach((noteIndex, i) => {
                const noteElement = document.createElement('div');
                noteElement.className = 'sequence-note';
                noteElement.textContent = pianoKeys[noteIndex].note;
                noteElement.dataset.index = i;
                sequenceContainer.appendChild(noteElement);
            });
        }
        
        function playMusicSequence() {
            isPlayingSequence = true;
            
            // Disable piano keys during playback
            const keys = document.querySelectorAll('.piano-key');
            keys.forEach(key => {
                key.style.pointerEvents = 'none';
            });
            
            // Play each note in sequence
            currentSequence.forEach((noteIndex, i) => {
                setTimeout(() => {
                    playNote(noteIndex, true);
                    
                    // Highlight current note in sequence
                    const notes = document.querySelectorAll('.sequence-note');
                    notes.forEach(note => note.classList.remove('highlight'));
                    
                    if (notes[i]) {
                        notes[i].classList.add('highlight');
                    }
                    
                    // If last note, re-enable piano keys
                    if (i === currentSequence.length - 1) {
                        setTimeout(() => {
                            keys.forEach(key => {
                                key.style.pointerEvents = 'auto';
                            });
                            
                            // Remove highlight
                            notes.forEach(note => note.classList.remove('highlight'));
                            
                            isPlayingSequence = false;
                            userSequence = []; // Reset user sequence
                        }, 500);
                    }
                }, i * 1000);
            });
        }
        
        function playNote(index, isSequence = false) {
            if (!isPlayingSequence || isSequence) {
                const note = pianoKeys[index];
                
                // Play the note
                playPianoNote(note.freq);
                
                // Visual feedback
                const keyElement = document.querySelector(`.piano-key[data-index="${index}"]`);
                keyElement.classList.add('pressed');
                
                // Create flying note
                const noteEmoji = document.createElement('div');
                noteEmoji.className = 'note-flying';
                noteEmoji.textContent = '🎵';
                noteEmoji.style.left = `${parseInt(keyElement.offsetLeft) + keyElement.offsetWidth / 2}px`;
                noteEmoji.style.bottom = '0';
                
                document.getElementById('piano-container').appendChild(noteEmoji);
                
                // Remove note after animation
                setTimeout(() => {
                    keyElement.classList.remove('pressed');
                    if (noteEmoji.parentNode) {
                        noteEmoji.parentNode.removeChild(noteEmoji);
                    }
                }, 500);
                
                // If user is playing, add to sequence and check
                if (!isSequence) {
                    userSequence.push(index);
                    
                    // Check if user sequence matches so far
                    const currentLength = userSequence.length;
                    const isCorrectSoFar = userSequence.every((note, i) => note === currentSequence[i]);
                    
                    if (!isCorrectSoFar) {
                        // Wrong note!
                        playErrorSound();
                        
                        // Reset user sequence and replay after a delay
                        setTimeout(() => {
                            userSequence = [];
                            playMusicSequence();
                        }, 1000);
                    } else if (currentLength === currentSequence.length) {
                        // Completed sequence correctly!
                        setTimeout(() => {
                            playSuccessSound();
                            
                            // Update score
                            gameScores['music-game']++;
                            updateScoreDisplay('music-game');
                            
                            // Update progress
                            updateUserProgress('music-game');
                            
                            // Show reward occasionally
                            if (gameScores['music-game'] % 3 === 0) {
                                showReward('You have a great musical ear!', Math.min(gameScores['music-game'] / 3, 5));
                                
                                // Check for music maestro achievement
                                if (gameScores['music-game'] >= 5 && !achievements['music-maestro']) {
                                    unlockAchievement('music-maestro', 'Music Maestro', 'Played 5 music sequences!');
                                }
                            }
                            
                            // Generate new sequence after delay
                            setTimeout(() => {
                                initMusicGame();
                            }, 1500);
                        }, 500);
                    }
                }
            }
        }
        
        // Drawing Game Logic
        function initDrawingGame() {
            // Set drawing mode based on difficulty
            const difficulty = gameDifficulties['drawing-game'] || 1;
            drawingMode = difficulty === 1 ? 'free' : (difficulty === 2 ? 'guided' : 'challenge');
            
            // Initialize drawing canvas
            initDrawingCanvas();
            
            // Create drawing tools
            createDrawingTools();
            
            // Update character speech
            const speeches = {
                'free': 'Draw anything you like!',
                'guided': 'Can you draw the shape?',
                'challenge': 'Draw what you see!'
            };
            
            document.getElementById('drawing-speech').textContent = speeches[drawingMode];
            
            // For guided mode, show a shape to trace
            if (drawingMode === 'guided') {
                showGuidedDrawing();
            } else if (drawingMode === 'challenge') {
                showDrawingChallenge();
            }
        }
        
        function initDrawingCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const container = canvas.parentElement;
            
            // Set canvas size to match container
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            // Get drawing context
            drawingContext = canvas.getContext('2d');
            drawingContext.lineCap = 'round';
            drawingContext.lineJoin = 'round';
            drawingContext.strokeStyle = currentColor;
            drawingContext.lineWidth = currentSize;
            
            // Reset canvas
            drawingContext.fillStyle = 'white';
            drawingContext.fillRect(0, 0, canvas.width, canvas.height);
            
            // Set up drawing events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function createDrawingTools() {
            const toolbar = document.getElementById('drawing-toolbar');
            toolbar.innerHTML = '';
            
            // Color tools
            const colors = ['#000000', '#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            colors.forEach(color => {
                const colorTool = document.createElement('div');
                colorTool.className = 'drawing-tool drawing-color';
                colorTool.style.backgroundColor = color;
                colorTool.addEventListener('click', () => {
                    currentColor = color;
                    drawingContext.strokeStyle = color;
                    playClickSound();
                });
                toolbar.appendChild(colorTool);
            });
            
            // Size tools
            const sizes = [2, 5, 10];
            
            sizes.forEach(size => {
                const sizeTool = document.createElement('div');
                sizeTool.className = 'drawing-tool drawing-size';
                sizeTool.textContent = size === 2 ? 'S' : (size === 5 ? 'M' : 'L');
                sizeTool.addEventListener('click', () => {
                    currentSize = size;
                    drawingContext.lineWidth = size;
                    playClickSound();
                });
                toolbar.appendChild(sizeTool);
            });
            
            // Clear action
            const clearTool = document.createElement('div');
            clearTool.className = 'drawing-tool drawing-action';
            clearTool.textContent = '🧹';
            clearTool.addEventListener('click', () => {
                clearDrawing();
                playClickSound();
            });
            toolbar.appendChild(clearTool);
            
            // Save action
            const saveTool = document.createElement('div');
            saveTool.className = 'drawing-tool drawing-action';
            saveTool.textContent = '💾';
            saveTool.addEventListener('click', () => {
                saveDrawing();
                playClickSound();
            });
            toolbar.appendChild(saveTool);
        }
        
        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            const canvas = document.getElementById('drawing-canvas');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            drawingContext.lineTo(x, y);
            drawingContext.stroke();
            drawingContext.beginPath();
            drawingContext.moveTo(x, y);
        }
        
        function handleTouch(e) {
            e.preventDefault();
            
            const canvas = document.getElementById('drawing-canvas');
            const rect = canvas.getBoundingClientRect();
            
            if (e.type === 'touchstart') {
                isDrawing = true;
            }
            
            if (isDrawing && e.touches.length > 0) {
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                drawingContext.lineTo(x, y);
                drawingContext.stroke();
                drawingContext.beginPath();
                drawingContext.moveTo(x, y);
            }
        }
        
        function stopDrawing() {
            if (isDrawing) {
                drawingContext.beginPath();
                isDrawing = false;
                
                // Check if drawing is complete
                if (drawingMode === 'guided' || drawingMode === 'challenge') {
                    checkDrawingCompletion();
                }
            }
        }
        
        function clearDrawing() {
            const canvas = document.getElementById('drawing-canvas');
            drawingContext.fillStyle = 'white';
            drawingContext.fillRect(0, 0, canvas.width, canvas.height);
            
            // Redraw guide shape if in guided mode
            if (drawingMode === 'guided') {
                showGuidedDrawing();
            } else if (drawingMode === 'challenge') {
                showDrawingChallenge();
            }
        }
        
        function saveDrawing() {
            // Increment score
            gameScores['drawing-game']++;
            updateScoreDisplay('drawing-game');
            
            // Update progress
            updateUserProgress('drawing-game');
            
            // Show reward occasionally
            if (gameScores['drawing-game'] % 3 === 0) {
                showReward('You created beautiful art!', Math.min(gameScores['drawing-game'] / 3, 5));
                
                // Check for artist achievement
                if (gameScores['drawing-game'] >= 5 && !achievements['artist']) {
                    unlockAchievement('artist', 'Artist', 'Created 5 beautiful drawings!');
                }
            }
            
            // Clear canvas for a new drawing
            clearDrawing();
        }
        
        function showGuidedDrawing() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = drawingContext;
            
            // Draw guide shape in light gray
            ctx.save();
            ctx.strokeStyle = '#cccccc';
            ctx.lineWidth = 2;
            
            const shapes = [
                drawCircle,
                drawSquare,
                drawTriangle,
                drawStar,
                drawFlower,
                drawHouse
            ];
            
            // Choose random shape
            const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
            randomShape(ctx, canvas.width / 2, canvas.height / 2, Math.min(canvas.width, canvas.height) * 0.3);
            
            ctx.restore();
        }
        
        function drawCircle(ctx, x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        function drawSquare(ctx, x, y, size) {
            ctx.beginPath();
            ctx.rect(x - size / 2, y - size / 2, size, size);
            ctx.stroke();
        }
        
        function drawTriangle(ctx, x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x, y - size / 2);
            ctx.lineTo(x + size / 2, y + size / 2);
            ctx.lineTo(x - size / 2, y + size / 2);
            ctx.closePath();
            ctx.stroke();
        }
        
        function drawStar(ctx, x, y, size) {
            const spikes = 5;
            const outerRadius = size;
            const innerRadius = size / 2;
            
            ctx.beginPath();
            
            for (let i = 0; i < spikes * 2; i++) {
                const radius = i % 2 === 0 ? outerRadius : innerRadius;
                const angle = (Math.PI * i) / spikes - Math.PI / 2;
                
                const pointX = x + radius * Math.cos(angle);
                const pointY = y + radius * Math.sin(angle);
                
                if (i === 0) {
                    ctx.moveTo(pointX, pointY);
                } else {
                    ctx.lineTo(pointX, pointY);
                }
            }
            
            ctx.closePath();
            ctx.stroke();
        }
        
        function drawFlower(ctx, x, y, size) {
            // Draw petals
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI * 2 * i) / 6;
                const petalX = x + Math.cos(angle) * size * 0.7;
                const petalY = y + Math.sin(angle) * size * 0.7;
                
                ctx.beginPath();
                ctx.arc(petalX, petalY, size / 3, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Draw center
            ctx.beginPath();
            ctx.arc(x, y, size / 4, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        function drawHouse(ctx, x, y, size) {
            // Draw main house
            ctx.beginPath();
            ctx.rect(x - size / 2, y, size, size * 0.8);
            ctx.stroke();
            
            // Draw roof
            ctx.beginPath();
            ctx.moveTo(x - size * 0.6, y);
            ctx.lineTo(x, y - size * 0.6);
            ctx.lineTo(x + size * 0.6, y);
            ctx.stroke();
            
            // Draw door
            ctx.beginPath();
            ctx.rect(x - size * 0.15, y + size * 0.4, size * 0.3, size * 0.4);
            ctx.stroke();
            
            // Draw window
            ctx.beginPath();
            ctx.rect(x + size * 0.2, y + size * 0.2, size * 0.2, size * 0.2);
            ctx.stroke();
        }
        
        function showDrawingChallenge() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = drawingContext;
            
            // Draw a light background for the challenge
            ctx.save();
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Choose a challenge
            const challenges = [
                { text: 'Draw a cat', prompt: '🐱' },
                { text: 'Draw a house', prompt: '🏠' },
                { text: 'Draw a tree', prompt: '🌳' },
                { text: 'Draw a car', prompt: '🚗' },
                { text: 'Draw a flower', prompt: '🌸' },
                { text: 'Draw the sun', prompt: '☀️' },
                { text: 'Draw a boat', prompt: '⛵' },
                { text: 'Draw a butterfly', prompt: '🦋' }
            ];
            
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            // Show challenge text
            ctx.fillStyle = '#888888';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(challenge.text, canvas.width / 2, 40);
            
            // Show challenge emoji
            ctx.font = '80px sans-serif';
            ctx.fillText(challenge.prompt, canvas.width / 2, canvas.height / 2);
            
            // Update character speech
            document.getElementById('drawing-speech').textContent = challenge.text;
            
            ctx.restore();
        }
        
        function checkDrawingCompletion() {
            // In a real app, you'd implement drawing recognition
            // For this demo, we'll just count pixels drawn
            
            const canvas = document.getElementById('drawing-canvas');
            const ctx = drawingContext;
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            let coloredPixels = 0;
            for (let i = 0; i < data.length; i += 4) {
                // Skip white pixels (background)
                if (data[i] !== 255 || data[i+1] !== 255 || data[i+2] !== 255) {
                    coloredPixels++;
                }
            }
            
            // If enough pixels are drawn, consider it complete
            const minPixels = canvas.width * canvas.height * 0.05; // 5% of canvas
            
            if (coloredPixels > minPixels) {
                // Complete!
                document.getElementById('drawing-speech').textContent = 'Great job! Your drawing looks amazing!';
                
                setTimeout(() => {
                    saveDrawing();
                }, 1500);
            }
        }
        
        // Science Game Logic
        function initScienceGame() {
            // Set difficulty
            const difficulty = gameDifficulties['science-game'] || 1;
            
            // Choose experiment based on difficulty
            currentExperiment = Math.min(difficulty - 1, experiments.length - 1);
            
            // Display experiment
            displayExperiment();
            
            // Update character speech
            document.getElementById('science-speech').textContent = 'Let\'s do a fun experiment!';
        }
        
        function displayExperiment() {
            const experiment = experiments[currentExperiment];
            
            // Set experiment title
            document.getElementById('experiment-title').textContent = experiment.title;
            
            // Clear steps and result
            const stepsContainer = document.getElementById('experiment-steps');
            const resultContainer = document.getElementById('experiment-result');
            
            stepsContainer.innerHTML = '';
            resultContainer.innerHTML = '';
            
            // Create experiment steps
            experiment.steps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.className = 'experiment-step';
                stepElement.dataset.step = step.step;
                stepElement.innerHTML = `
                    <div class="experiment-step-number">${step.step}</div>
                    <div class="experiment-step-icon">${step.icon}</div>
                    <div class="experiment-step-text">${step.text}</div>
                `;
                
                stepElement.addEventListener('click', () => performExperimentStep(step.step));
                stepsContainer.appendChild(stepElement);
            });
        }
        
        function performExperimentStep(stepNum) {
            playClickSound();
            
            const experiment = experiments[currentExperiment];
            const resultContainer = document.getElementById('experiment-result');
            
            // Highlight active step
            document.querySelectorAll('.experiment-step').forEach(step => {
                if (parseInt(step.dataset.step) === stepNum) {
                    step.style.backgroundColor = '#c8e6c9';
                }
            });
            
            // Show animation based on step
            let animation = '';
            
            switch (experiment.title) {
                case 'Colorful Water Magic':
                    if (stepNum === 1) {
                        animation = createWaterGlassesAnimation();
                    } else if (stepNum === 2) {
                        animation = addColorsAnimation();
                    } else if (stepNum === 3) {
                        animation = addPaperTowelsAnimation();
                    } else if (stepNum === 4) {
                        animation = colorMixingAnimation();
                    }
                    break;
                
                case 'Sink or Float':
                    if (stepNum === 1) {
                        animation = createWaterBowlAnimation();
                    } else if (stepNum === 2) {
                        animation = showObjectsAnimation();
                    } else if (stepNum === 3) {
                        animation = predictSinkFloatAnimation();
                    } else if (stepNum === 4) {
                        animation = testSinkFloatAnimation();
                    }
                    break;
                
                case 'Static Electricity':
                    if (stepNum === 1) {
                        animation = inflateBalloonAnimation();
                    } else if (stepNum === 2) {
                        animation = rubBalloonAnimation();
                    } else if (stepNum === 3) {
                        animation = holdNearPaperAnimation();
                    } else if (stepNum === 4) {
                        animation = staticAttractionAnimation();
                    }
                    break;
            }
            
            resultContainer.innerHTML = animation;
            
            // Update science score if completed all steps
            if (stepNum === experiment.steps.length) {
                gameScores['science-game']++;
                updateScoreDisplay('science-game');
                
                // Update progress
                updateUserProgress('science-game');
                
                // Show reward
                setTimeout(() => {
                    showReward('You are a great scientist!', Math.min(gameScores['science-game'], 5));
                    
                    // Check for science explorer achievement
                    if (gameScores['science-game'] >= 3 && !achievements['science-explorer']) {
                        unlockAchievement('science-explorer', 'Science Explorer', 'Completed 3 experiments!');
                    }
                    
                    // Move to next experiment
                    setTimeout(() => {
                        currentExperiment = (currentExperiment + 1) % experiments.length;
                        displayExperiment();
                    }, 2000);
                }, 1500);
            }
            
            // Update character speech
            document.getElementById('science-speech').textContent = experiment.steps[stepNum - 1].text;
        }
        
        // Science experiment animations
        function createWaterGlassesAnimation() {
            return `
                <div style="display: flex; justify-content: space-around; height: 100%;">
                    <div style="width: 50px; height: 100px; background-color: #e3f2fd; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">💧</div>
                    </div>
                    <div style="width: 50px; height: 100px; background-color: #e3f2fd; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">💧</div>
                    </div>
                    <div style="width: 50px; height: 100px; background-color: #e3f2fd; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">💧</div>
                    </div>
                </div>
            `;
        }
        
        function addColorsAnimation() {
            return `
                <div style="display: flex; justify-content: space-around; height: 100%;">
                    <div style="width: 50px; height: 100px; background-color: #ff5252; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">🔴</div>
                    </div>
                    <div style="width: 50px; height: 100px; background-color: #448aff; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">🔵</div>
                    </div>
                    <div style="width: 50px; height: 100px; background-color: #ffeb3b; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;">
                        <div style="position: absolute; top: 15px; width: 100%; text-align: center;">🟡</div>
                    </div>
                </div>
            `;
        }
        
        function addPaperTowelsAnimation() {
            return `
                <div style="display: flex; justify-content: space-around; height: 100%;">
                    <div style="width: 50px; height: 100px; background-color: #ff5252; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                    
                    <div style="width: 20px; height: 15px; background-color: #f5f5f5; position: relative; top: 50px; transform: rotate(10deg);"></div>
                    
                    <div style="width: 50px; height: 100px; background-color: #448aff; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                    
                    <div style="width: 20px; height: 15px; background-color: #f5f5f5; position: relative; top: 50px; transform: rotate(10deg);"></div>
                    
                    <div style="width: 50px; height: 100px; background-color: #ffeb3b; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                </div>
            `;
        }
        
        function colorMixingAnimation() {
            return `
                <div style="display: flex; justify-content: space-around; height: 100%;">
                    <div style="width: 50px; height: 100px; background-color: #ff5252; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                    
                    <div style="width: 20px; height: 15px; background-color: #e040fb; position: relative; top: 50px; transform: rotate(10deg);"></div>
                    
                    <div style="width: 50px; height: 100px; background-color: #448aff; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                    
                    <div style="width: 20px; height: 15px; background-color: #4caf50; position: relative; top: 50px; transform: rotate(10deg);"></div>
                    
                    <div style="width: 50px; height: 100px; background-color: #ffeb3b; border-radius: 0 0 10px 10px; border: 2px solid #90caf9; margin-top: 50px; position: relative;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">✨ The colors are traveling and mixing! ✨</div>
            `;
        }
        
        function createWaterBowlAnimation() {
            return `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                    <div style="width: 150px; height: 80px; background-color: #e3f2fd; border-radius: 0 0 75px 75px; border: 2px solid #90caf9; position: relative;">
                        <div style="position: absolute; top: 20px; width: 100%; text-align: center;">💧</div>
                    </div>
                </div>
            `;
        }
        
        function showObjectsAnimation() {
            return `
                <div style="display: flex; justify-content: space-around; align-items: center; height: 100%;">
                    <div style="font-size: 30px;">🪨</div>
                    <div style="font-size: 30px;">🍎</div>
                    <div style="font-size: 30px;">🪶</div>
                    <div style="font-size: 30px;">🔑</div>
                    <div style="font-size: 30px;">🧩</div>
                </div>
            `;
        }
        
        function predictSinkFloatAnimation() {
            return `
                <div style="display: flex; flex-direction: column; align-items: center; height: 100%;">
                    <div style="display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">SINK</div>
                            <div style="font-size: 30px;">🪨 🔑</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">FLOAT</div>
                            <div style="font-size: 30px;">🍎 🪶 🧩</div>
                        </div>
                    </div>
                    <div style="font-size: 16px; text-align: center;">What do you think will happen?</div>
                </div>
            `;
        }
        
        function testSinkFloatAnimation() {
            return `
                <div style="width: 150px; height: 80px; background-color: #e3f2fd; border-radius: 0 0 75px 75px; border: 2px solid #90caf9; position: relative; margin: 0 auto;">
                    <div style="position: absolute; top: 60px; left: 30px; font-size: 20px;">🪨</div>
                    <div style="position: absolute; top: 60px; left: 70px; font-size: 20px;">🔑</div>
                    <div style="position: absolute; top: 10px; left: 40px; font-size: 20px;">🍎</div>
                    <div style="position: absolute; top: 5px; left: 80px; font-size: 20px;">🪶</div>
                    <div style="position: absolute; top: 15px; left: 110px; font-size: 20px;">🧩</div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">Results:</div>
                    <div>Sink: Rock, Key</div>
                    <div>Float: Apple, Feather, Puzzle piece</div>
                </div>
            `;
        }
        
        function inflateBalloonAnimation() {
            return `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                    <div style="font-size: 80px; animation: pulse 1s infinite;">🎈</div>
                </div>
            `;
        }
        
        function rubBalloonAnimation() {
            return `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                    <div style="position: relative;">
                        <div style="font-size: 60px;">🎈</div>
                        <div style="position: absolute; top: 0; right: -30px; font-size: 40px;">💇‍♂️</div>
                        <div style="position: absolute; top: 10px; left: 30px; font-size: 20px;">✨</div>
                        <div style="position: absolute; top: 30px; left: 10px; font-size: 20px;">✨</div>
                    </div>
                </div>
            `;
        }
        
        function holdNearPaperAnimation() {
            return `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                    <div style="position: relative;">
                        <div style="font-size: 60px;">🎈</div>
                        <div style="position: absolute; top: 20px; right: -60px; font-size: 30px; transform: rotate(15deg);">📄</div>
                        <div style="position: absolute; top: 10px; left: 20px; font-size: 15px;">⚡</div>
                    </div>
                </div>
            `;
        }
        
        function staticAttractionAnimation() {
            return `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                    <div style="position: relative;">
                        <div style="font-size: 60px;">🎈</div>
                        <div style="position: absolute; top: 20px; right: -30px; font-size: 20px; transform: rotate(15deg);">📄</div>
                        <div style="position: absolute; top: 10px; left: 20px; font-size: 15px;">⚡</div>
                        <div style="position: absolute; top: 30px; left: 30px; font-size: 15px;">⚡</div>
                        <div style="position: absolute; top: 20px; right: -50px; font-size: 20px; transform: rotate(5deg);">📄</div>
                        <div style="position: absolute; top: 40px; right: -40px; font-size: 20px; transform: rotate(-10deg);">📄</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; font-weight: bold;">
                    Magic attraction! The papers stick to the balloon because of static electricity!
                </div>
            `;
        }
        
        // Math Game Logic
        function initMathGame() {
            // Set difficulty
            const difficulty = gameDifficulties['math-game'] || 1;
            
            // Generate math problem based on difficulty
            generateMathProblem(difficulty);
            
            // Display math problem
            document.getElementById('math-problem').textContent = currentMathProblem;
            
            // Create answer options
            createMathOptions();
            
            // Update character speech
            document.getElementById('math-speech').textContent = `Let's solve this math problem!`;
        }
        
        function generateMathProblem(difficulty) {
            if (difficulty === 1) {
                // Simple addition up to 10
                const a = Math.floor(Math.random() * 5) + 1;
                const b = Math.floor(Math.random() * 5) + 1;
                
                currentMathProblem = `${a} + ${b} = ?`;
                mathAnswer = a + b;
            } else if (difficulty === 2) {
                // Addition, subtraction up to 20
                const operation = Math.random() < 0.5 ? '+' : '-';
                
                if (operation === '+') {
                    const a = Math.floor(Math.random() * 10) + 1;
                    const b = Math.floor(Math.random() * 10) + 1;
                    
                    currentMathProblem = `${a} + ${b} = ?`;
                    mathAnswer = a + b;
                } else {
                    // Ensure a > b for subtraction
                    const a = Math.floor(Math.random() * 10) + 10; // 10-19
                    const b = Math.floor(Math.random() * 10) + 1;  // 1-10
                    
                    currentMathProblem = `${a} - ${b} = ?`;
                    mathAnswer = a - b;
                }
            } else {
                // Addition, subtraction, simple multiplication
                const operation = Math.random() < 0.33 ? '+' : (Math.random() < 0.66 ? '-' : '×');
                
                if (operation === '+') {
                    const a = Math.floor(Math.random() * 20) + 1;
                    const b = Math.floor(Math.random() * 20) + 1;
                    
                    currentMathProblem = `${a} + ${b} = ?`;
                    mathAnswer = a + b;
                } else if (operation === '-') {
                    // Ensure a > b for subtraction
                    const a = Math.floor(Math.random() * 20) + 20; // 20-39
                    const b = Math.floor(Math.random() * 20) + 1;  // 1-20
                    
                    currentMathProblem = `${a} - ${b} = ?`;
                    mathAnswer = a - b;
                } else {
                    // Simple multiplication
                    const a = Math.floor(Math.random() * 5) + 1; // 1-5
                    const b = Math.floor(Math.random() * 5) + 1; // 1-5
                    
                    currentMathProblem = `${a} × ${b} = ?`;
                    mathAnswer = a * b;
                }
            }
        }
        
        function createMathOptions() {
            const optionsContainer = document.getElementById('math-options');
            optionsContainer.innerHTML = '';
            
            // Create array with the correct answer
            const options = [mathAnswer];
            
            // Add incorrect options
            while (options.length < 4) {
                let wrongAnswer;
                
                if (currentMathProblem.includes('×')) {
                    // For multiplication, create plausible wrong answers
                    wrongAnswer = mathAnswer + (Math.floor(Math.random() * 5) - 2);
                } else {
                    // For addition/subtraction, create plausible wrong answers
                    wrongAnswer = mathAnswer + (Math.floor(Math.random() * 5) - 2);
                }
                
                // Ensure wrong answer is positive and not already in options
                if (wrongAnswer > 0 && !options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // Shuffle options
            const shuffledOptions = shuffleArray(options);
            
            // Create option elements
            shuffledOptions.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'math-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => checkMathAnswer(optionElement, option));
                optionsContainer.appendChild(optionElement);
            });
        }
        
        function checkMathAnswer(element, answer) {
            // Disable all options
            document.querySelectorAll('.math-option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            if (answer === mathAnswer) {
                // Correct!
                element.classList.add('correct');
                playSuccessSound();
                
                // Update score
                gameScores['math-game']++;
                updateScoreDisplay('math-game');
                
                // Update progress
                updateUserProgress('math-game');
                
                // Show reward occasionally
                if (gameScores['math-game'] % 3 === 0) {
                    setTimeout(() => {
                        showReward('You are a math genius!', Math.min(gameScores['math-game'] / 3, 5));
                        
                        // Check for number genius achievement
                        if (gameScores['math-game'] >= 5 && !achievements['number-genius']) {
                            unlockAchievement('number-genius', 'Number Genius', 'Solved 5 math problems!');
                        }
                    }, 1000);
                }
                
                // Load new math problem after delay
                setTimeout(() => {
                    initMathGame();
                }, 1500);
            } else {
                // Incorrect
                element.classList.add('incorrect');
                playErrorSound();
                
                // Show correct answer
                document.querySelectorAll('.math-option').forEach(option => {
                    if (parseInt(option.textContent) === mathAnswer) {
                        option.classList.add('correct');
                    }
                });
                
                // Try again after delay
                setTimeout(() => {
                    initMathGame();
                }, 2000);
            }
        }
        
        // Story Game Logic
        function initStoryGame() {
            // Set current story and page
            currentStory = 0;
            currentPage = 0;
            
            // Set up story navigation buttons
            document.getElementById('prev-page-btn').addEventListener('click', () => navigateStory(-1));
            document.getElementById('next-page-btn').addEventListener('click', () => navigateStory(1));
            
            // Display the first page
            displayStoryPage();
            
            // Update character speech
            document.getElementById('story-speech').textContent = 'Let\'s read a story together!';
        }
        
        function displayStoryPage() {
            const story = stories[currentStory];
            const page = story.pages[currentPage];
            
            // Display text
            document.getElementById('story-text').textContent = page.text;
            
            // Display characters in the scene
            const sceneElement = document.getElementById('story-scene');
            sceneElement.innerHTML = '';
            
            if (page.characters) {
                page.characters.forEach(char => {
                    const charElement = document.createElement('div');
                    charElement.className = 'story-character';
                    charElement.textContent = char.emoji;
                    charElement.style.left = char.left;
                    charElement.style.top = char.top;
                    
                    // Add animation and click handler
                    charElement.style.animation = 'float 3s ease-in-out infinite';
                    
                    charElement.addEventListener('click', () => {
                        // Play sound and animate when clicked
                        playClickSound();
                        charElement.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            charElement.style.transform = 'scale(1)';
                        }, 300);
                    });
                    
                    sceneElement.appendChild(charElement);
                });
            }
            
            // Show choices if this is the last page before choices
            const choicesContainer = document.getElementById('story-choices');
            choicesContainer.innerHTML = '';
            
            // Check if we should display choices
            if (story.choices && currentPage === story.pages.length - 1) {
                // Show choices
                story.choices.forEach(choice => {
                    const choiceElement = document.createElement('div');
                    choiceElement.className = 'story-choice';
                    choiceElement.textContent = choice.text;
                    choiceElement.addEventListener('click', () => selectStoryChoice(choice));
                    choicesContainer.appendChild(choiceElement);
                });
                
                // Hide next button
                document.getElementById('next-page-btn').style.display = 'none';
            } else {
                // Show next button
                document.getElementById('next-page-btn').style.display = 'block';
            }
            
            // Enable/disable prev button
            document.getElementById('prev-page-btn').disabled = currentPage === 0;
            
            // Update character speech to encourage interaction
            const speechElement = document.getElementById('story-speech');
            if (page.characters && page.characters.length > 0) {
                speechElement.textContent = 'Click on the characters to see what happens!';
            } else {
                speechElement.textContent = 'What happens next in the story?';
            }
        }
        
        function navigateStory(direction) {
            playClickSound();
            
            const story = stories[currentStory];
            const newPage = currentPage + direction;
            
            if (newPage >= 0 && newPage < story.pages.length) {
                currentPage = newPage;
                displayStoryPage();
                
                // If reached the end of the story, update score
                if (newPage === story.pages.length - 1) {
                    gameScores['story-game']++;
                    updateScoreDisplay('story-game');
                    
                    // Update progress
                    updateUserProgress('story-game');
                    
                    // Show reward occasionally
                    if (gameScores['story-game'] % 2 === 0) {
                        setTimeout(() => {
                            showReward('You are a great reader!', Math.min(gameScores['story-game'] / 2, 5));
                            
                            // Check for book worm achievement
                            if (gameScores['story-game'] >= 3 && !achievements['book-worm']) {
                                unlockAchievement('book-worm', 'Book Worm', 'Read 3 interactive stories!');
                            }
                        }, 1000);
                    }
                }
            }
        }
        
        function selectStoryChoice(choice) {
            playClickSound();
            
            // Implement choice logic here
            // For now, just advance to the next story
            currentStory = (currentStory + 1) % stories.length;
            currentPage = 0;
            displayStoryPage();
        }
        
        // Helper Functions
        
        // Shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Get random pastel color
        function getRandomPastelColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsl(${hue}, 100%, 80%)`;
        }
        
        // Initialize game when page loads
        window.addEventListener('load', initGame);
        
        // Handle window resize for drawing canvas
        window.addEventListener('resize', () => {
            if (currentGame === 'drawing-game') {
                // Resize canvas while preserving drawing
                const canvas = document.getElementById('drawing-canvas');
                const container = canvas.parentElement;
                const tempCanvas = document.createElement('canvas');
                const tempContext = tempCanvas.getContext('2d');
                
                // Copy current drawing to temp canvas
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempContext.drawImage(canvas, 0, 0);
                
                // Resize canvas
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
                
                // Restore drawing
                drawingContext.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
            }
        });

    </script>
</body>
</html>
