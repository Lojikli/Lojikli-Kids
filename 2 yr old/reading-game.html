<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Explorer: Reading Adventure</title>
    <style>
        :root {
            --primary-color: #4a6ed0;
            --secondary-color: #ff8a5c;
            --tertiary-color: #8bd3e6;
            --success-color: #76e383;
            --background-color: #f9f7f3;
            --text-color: #333;
            --card-color: white;
            --card-shadow: 0 8px 16px rgba(0,0,0,0.1);
            --font-main: 'Comic Sans MS', cursive, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: var(--text-color);
            transition: background-color 0.5s;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
            letter-spacing: 1px;
        }

        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-top: 20px;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .character-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }

        .character {
            font-size: 3rem;
            animation: bounce 2s infinite;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }

        .character:hover {
            transform: scale(1.2);
        }

        .character-speech {
            position: absolute;
            background-color: white;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            padding: 10px;
            width: 150px;
            font-size: 0.8rem;
            top: -90px;
            left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .character-speech:after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: var(--primary-color) transparent;
            margin-left: -15px;
        }

        .character:hover .character-speech {
            opacity: 1;
        }

        .flash-card {
            background-color: var(--card-color);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            text-align: center;
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }

        .flash-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .word-display {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .word-image {
            font-size: 4rem;
            margin: 15px 0;
        }

        .phonetic {
            font-size: 1.2rem;
            color: #777;
            margin: 10px 0;
            font-style: italic;
        }

        .example-sentence {
            font-size: 1.3rem;
            margin: 15px 0;
            color: #555;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-size: 1rem;
            font-family: var(--font-main);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #3756b5;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .correct {
            background-color: var(--success-color);
        }

        .incorrect {
            background-color: #ff6961;
        }

        .speak-btn {
            background-color: var(--tertiary-color);
            font-size: 1.2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .option {
            background-color: var(--card-color);
            border: 2px solid var(--tertiary-color);
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .option:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 20px;
            margin: 20px 0;
            height: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.5s;
            border-radius: 20px;
        }

        .progress-text {
            text-align: center;
            font-size: 1rem;
            margin-top: 5px;
        }

        .settings-panel {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin: 20px 0;
        }

        .settings-heading {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .settings-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .settings-content.open {
            max-height: 1000px;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
        }

        .setting-label {
            font-size: 1.1rem;
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s;
            background-color: rgba(255,255,255,0.8);
        }

        .celebration.show {
            opacity: 1;
        }

        .celebration-content {
            text-align: center;
            animation: celebrate 1s ease-in-out;
        }

        .emoji-rain {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .emoji {
            position: absolute;
            font-size: 2rem;
            animation: fall 3s linear;
            top: -50px;
        }

        .help-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--tertiary-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .help-btn:hover {
            transform: scale(1.1);
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .help-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .help-content {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--text-color);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--tertiary-color);
            color: white;
            border-radius: 50px;
            padding: 8px 15px;
            font-size: 0.9rem;
            margin: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.5rem;
            margin: 15px 0;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            top: -10px;
            animation: confetti-fall 4s linear forwards;
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid #ddd;
            font-size: 0.9rem;
            color: #777;
        }

        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes celebrate {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes fall {
            0% { transform: translateY(0) rotate(0); opacity: 1; }
            100% { transform: translateY(800px) rotate(360deg); opacity: 0; }
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0) scale(1); }
            100% { transform: translateY(1000px) rotate(720deg) scale(0); }
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            .flash-card {
                padding: 20px;
            }

            .word-display {
                font-size: 3rem;
            }

            .controls {
                flex-wrap: wrap;
            }
        }

        /* Dark mode */
        .dark-mode {
            --background-color: #222;
            --text-color: #eee;
            --card-color: #333;
            --card-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <header>
        <h1>Word Explorer üìö</h1>
        <div class="help-btn">‚ùì</div>
    </header>

    <div class="container">
        <div class="character-container">
            <div class="character">
                ü¶ä
                <div class="character-speech">Hi! I'm Foxy! I'll help you learn new words!</div>
            </div>
            <div class="character">
                ü¶â
                <div class="character-speech">Hello! I'm Professor Hoot! Let's build your vocabulary!</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>
        <div class="progress-text">Level: <span id="level-display">Beginner</span> - Words Mastered: <span id="words-mastered">0</span></div>

        <div class="settings-panel">
            <div class="settings-heading">
                <h3>Game Settings</h3>
                <span>‚öôÔ∏è</span>
            </div>
            <div class="settings-content">
                <div class="setting-row">
                    <div class="setting-label">Word Difficulty</div>
                    <div>
                        <select id="difficulty-setting">
                            <option value="beginner">Beginner</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="advanced">Advanced</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                </div>
                <div class="setting-row">
                    <div class="setting-label">Speech Speed</div>
                    <div>
                        <input type="range" id="speech-rate" min="0.5" max="1.5" step="0.1" value="1">
                    </div>
                </div>
                <div class="setting-row">
                    <div class="setting-label">Show Phonetics</div>
                    <div>
                        <input type="checkbox" id="show-phonetics" checked>
                    </div>
                </div>
                <div class="setting-row">
                    <div class="setting-label">Show Example Sentences</div>
                    <div>
                        <input type="checkbox" id="show-sentences" checked>
                    </div>
                </div>
                <div class="setting-row">
                    <div class="setting-label">Dark Mode</div>
                    <div>
                        <input type="checkbox" id="dark-mode">
                    </div>
                </div>
                <div class="setting-row">
                    <button id="reset-progress">Reset Progress</button>
                </div>
            </div>
        </div>

        <div class="game-area">
            <div class="flash-card">
                <div class="word-image">üçé</div>
                <div class="word-display">apple</div>
                <div class="phonetic">/Àà√¶p.…ôl/</div>
                <div class="example-sentence">I like to eat an apple for lunch.</div>
                <div class="controls">
                    <button class="speak-btn">üîä</button>
                    <button id="know-btn">I Know This Word üëç</button>
                    <button id="learning-btn">Still Learning ü§î</button>
                    <button id="next-btn">Next Word ‚û°Ô∏è</button>
                </div>
            </div>

            <div id="quiz-container" style="display: none;">
                <h2>Quick Quiz!</h2>
                <div class="flash-card">
                    <div class="quiz-question">What word does this image show?</div>
                    <div class="word-image">üçé</div>
                    <div class="options">
                        <div class="option">apple</div>
                        <div class="option">banana</div>
                        <div class="option">orange</div>
                        <div class="option">carrot</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="help-modal">
        <div class="help-content">
            <button class="close-btn">√ó</button>
            <h2>How to Play</h2>
            <p>Welcome to Word Explorer! This game will help you learn to read bigger and bigger words.</p>
            <h3>Game Controls</h3>
            <ul>
                <li><strong>üîä Button</strong> - Click to hear the word pronounced</li>
                <li><strong>I Know This Word</strong> - Click if you can read the word easily</li>
                <li><strong>Still Learning</strong> - Click if you need more practice with this word</li>
                <li><strong>Next Word</strong> - Move to the next word</li>
            </ul>
            <h3>Game Features</h3>
            <p>As you learn more words, you'll unlock harder words and earn badges!</p>
            <p>You can adjust the game settings to make it easier or more challenging.</p>
            <h3>Tips for Parents</h3>
            <p>Encourage your child to sound out the words phonetically.</p>
            <p>Celebrate their progress, no matter how small!</p>
            <p>Practice regularly for the best results.</p>
            <div style="display: flex; flex-wrap: wrap; margin-top: 20px;">
                <div class="badge">Word Master üèÜ</div>
                <div class="badge">Reading Star ‚≠ê</div>
                <div class="badge">Vocabulary Hero ü¶∏</div>
            </div>
        </div>
    </div>

    <div class="celebration">
        <div class="celebration-content">
            <h2>Great Job! üéâ</h2>
            <p>You're learning so fast!</p>
            <div class="badge">New Badge Earned: Word Explorer üîç</div>
        </div>
        <div class="emoji-rain"></div>
    </div>

    <footer>
        Word Explorer: Reading Adventure | Created for Young Learners
    </footer>

    <script>
        // Word database organized by difficulty levels
        const wordDatabase = {
            beginner: [
                { word: "cat", image: "üê±", phonetic: "/k√¶t/", sentence: "The cat sleeps on the bed." },
                { word: "dog", image: "üê∂", phonetic: "/d…í…°/", sentence: "The dog plays in the yard." },
                { word: "sun", image: "‚òÄÔ∏è", phonetic: "/s ån/", sentence: "The sun is bright today." },
                { word: "hat", image: "üß¢", phonetic: "/h√¶t/", sentence: "I wear a hat when it's sunny." },
                { word: "bed", image: "üõèÔ∏è", phonetic: "/bed/", sentence: "I sleep in my bed." },
                { word: "cup", image: "ü•§", phonetic: "/k åp/", sentence: "I drink from my cup." },
                { word: "ball", image: "‚öΩ", phonetic: "/b…îÀêl/", sentence: "I kick the ball in the park." },
                { word: "fish", image: "üê†", phonetic: "/f…™ É/", sentence: "The fish swims in water." },
                { word: "star", image: "‚≠ê", phonetic: "/st…ëÀêr/", sentence: "I see stars at night." },
                { word: "book", image: "üìï", phonetic: "/b äk/", sentence: "I read a book before bed." }
            ],
            easy: [
                { word: "apple", image: "üçé", phonetic: "/Àà√¶p.…ôl/", sentence: "I like to eat an apple for lunch." },
                { word: "happy", image: "üòÉ", phonetic: "/Ààh√¶p.i/", sentence: "I feel happy when I play." },
                { word: "water", image: "üíß", phonetic: "/Ààw…îÀê.t…ôr/", sentence: "I drink water every day." },
                { word: "friend", image: "üë≠", phonetic: "/frend/", sentence: "My friend plays with me." },
                { word: "house", image: "üè†", phonetic: "/ha äs/", sentence: "I live in a house." },
                { word: "rabbit", image: "üê∞", phonetic: "/Ààr√¶b.…™t/", sentence: "The rabbit hops in the garden." },
                { word: "flower", image: "üå∏", phonetic: "/Ààfla ä.…ôr/", sentence: "The flower grows in spring." },
                { word: "pencil", image: "‚úèÔ∏è", phonetic: "/Ààpen.s…ôl/", sentence: "I write with a pencil." },
                { word: "cloud", image: "‚òÅÔ∏è", phonetic: "/kla äd/", sentence: "The cloud is in the sky." },
                { word: "window", image: "ü™ü", phonetic: "/Ààw…™n.do ä/", sentence: "I look through the window." }
            ],
            medium: [
                { word: "birthday", image: "üéÇ", phonetic: "/Ààb…úÀêŒ∏.de…™/", sentence: "Today is my birthday!" },
                { word: "elephant", image: "üêò", phonetic: "/Ààel.…™.f…ônt/", sentence: "The elephant has a long trunk." },
                { word: "rainbow", image: "üåà", phonetic: "/Ààre…™n.bo ä/", sentence: "I saw a rainbow after the rain." },
                { word: "sandwich", image: "ü•™", phonetic: "/Ààs√¶nd.w…™t É/", sentence: "I eat a sandwich for lunch." },
                { word: "butterfly", image: "ü¶ã", phonetic: "/Ààb åt.…ô.fla…™/", sentence: "The butterfly has colorful wings." },
                { word: "playground", image: "üõù", phonetic: "/Ààple…™.…°ra änd/", sentence: "I play at the playground." },
                { word: "dinosaur", image: "ü¶ñ", phonetic: "/Ààda…™.n…ô.s…îÀêr/", sentence: "The dinosaur lived long ago." },
                { word: "umbrella", image: "‚òÇÔ∏è", phonetic: "/ åmÀàbrel.…ô/", sentence: "I use an umbrella when it rains." },
                { word: "chocolate", image: "üç´", phonetic: "/Ààt É…ík.l…ôt/", sentence: "I like to eat chocolate." },
                { word: "sunflower", image: "üåª", phonetic: "/Ààs ån.fla ä.…ôr/", sentence: "The sunflower is tall and yellow." }
            ],
            advanced: [
                { word: "beautiful", image: "ü¶ö", phonetic: "/ÀàbjuÀê.t…™.f…ôl/", sentence: "The garden is beautiful in spring." },
                { word: "adventure", image: "üèïÔ∏è", phonetic: "/…ôdÀàven.t É…ôr/", sentence: "We had an adventure in the forest." },
                { word: "astronaut", image: "üë®‚ÄçüöÄ", phonetic: "/Àà√¶s.tr…ô.n…îÀêt/", sentence: "The astronaut travels to space." },
                { word: "vacation", image: "üèñÔ∏è", phonetic: "/ve…™Ààke…™. É…ôn/", sentence: "We go on vacation in summer." },
                { word: "refrigerator", image: "üßä", phonetic: "/r…™Ààfr…™d í.…ô.re…™.t…ôr/", sentence: "I keep food in the refrigerator." },
                { word: "vegetables", image: "ü•¶", phonetic: "/Ààved í.t…ô.b…ôlz/", sentence: "I eat vegetables with dinner." },
                { word: "helicopter", image: "üöÅ", phonetic: "/Ààhel.…™.k…íp.t…ôr/", sentence: "The helicopter flies in the sky." },
                { word: "playground", image: "üõù", phonetic: "/Ààple…™.…°ra änd/", sentence: "We have fun at the playground." },
                { word: "microscope", image: "üî¨", phonetic: "/Ààma…™.kr…ô.sk…ô äp/", sentence: "I look at small things with a microscope." },
                { word: "watermelon", image: "üçâ", phonetic: "/Ààw…îÀê.t…ôr.mel.…ôn/", sentence: "Watermelon is juicy and sweet." }
            ],
            expert: [
                { word: "extraordinary", image: "‚ú®", phonetic: "/…™kÀàstr…îÀêr.d…™n.er.i/", sentence: "The magic show was extraordinary!" },
                { word: "imagination", image: "üß†", phonetic: "/…™Àåm√¶d í.…™Ààne…™. É…ôn/", sentence: "I use my imagination to create stories." },
                { word: "celebration", image: "üéâ", phonetic: "/Àåsel.…ôÀàbre…™. É…ôn/", sentence: "We had a celebration for my birthday." },
                { word: "telescope", image: "üî≠", phonetic: "/Ààtel.…™.sk…ô äp/", sentence: "I see stars with my telescope." },
                { word: "encyclopedia", image: "üìö", phonetic: "/…™nÀåsa…™.kl…ôÀàpiÀê.di.…ô/", sentence: "I read the encyclopedia to learn new things." },
                { word: "transportation", image: "üöÇ", phonetic: "/Àåtr√¶n.sp…îÀêrÀàte…™. É…ôn/", sentence: "Trains are a type of transportation." },
                { word: "communication", image: "üì±", phonetic: "/k…ôÀåmjuÀê.n…™Ààke…™. É…ôn/", sentence: "Talking is a form of communication." },
                { word: "experiment", image: "üß™", phonetic: "/…™kÀàsper.…™.m…ônt/", sentence: "We did a science experiment in class." },
                { word: "temperature", image: "üå°Ô∏è", phonetic: "/Ààtem.pr…ô.t É…ôr/", sentence: "The temperature is hot in summer." },
                { word: "mathematics", image: "üî¢", phonetic: "/Àåm√¶Œ∏.…ôÀàm√¶t.…™ks/", sentence: "I study mathematics at school." }
            ]
        };

        // Game state
        let gameState = {
            currentDifficulty: "beginner",
            currentWordIndex: 0,
            wordsMastered: 0,
            correctAnswers: 0,
            showingQuiz: false,
            masteredWords: {},
            badges: [],
            level: "Beginner",
            speechRate: 1
        };

        // DOM Elements
        const wordDisplay = document.querySelector('.word-display');
        const wordImage = document.querySelector('.word-image');
        const phoneticDisplay = document.querySelector('.phonetic');
        const sentenceDisplay = document.querySelector('.example-sentence');
        const speakBtn = document.querySelector('.speak-btn');
        const knowBtn = document.getElementById('know-btn');
        const learningBtn = document.getElementById('learning-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.querySelector('.progress-bar');
        const wordsMasteredDisplay = document.getElementById('words-mastered');
        const levelDisplay = document.getElementById('level-display');
        const quizContainer = document.getElementById('quiz-container');
        const settingsHeading = document.querySelector('.settings-heading');
        const settingsContent = document.querySelector('.settings-content');
        const difficultySetting = document.getElementById('difficulty-setting');
        const speechRateSetting = document.getElementById('speech-rate');
        const showPhoneticsSetting = document.getElementById('show-phonetics');
        const showSentencesSetting = document.getElementById('show-sentences');
        const darkModeSetting = document.getElementById('dark-mode');
        const resetProgressBtn = document.getElementById('reset-progress');
        const helpBtn = document.querySelector('.help-btn');
        const helpModal = document.querySelector('.help-modal');
        const closeHelpBtn = document.querySelector('.close-btn');
        const celebration = document.querySelector('.celebration');

        // Initialize game
        function initGame() {
            // Load saved state from localStorage if available
            loadGameState();

            // Update UI based on current state
            updateUI();

            // Event listeners
            speakBtn.addEventListener('click', speakCurrentWord);
            knowBtn.addEventListener('click', handleKnowWord);
            learningBtn.addEventListener('click', handleLearningWord);
            nextBtn.addEventListener('click', showNextWord);
            settingsHeading.addEventListener('click', toggleSettings);
            difficultySetting.addEventListener('change', changeDifficulty);
            speechRateSetting.addEventListener('change', changeSpeechRate);
            showPhoneticsSetting.addEventListener('change', togglePhonetics);
            showSentencesSetting.addEventListener('change', toggleSentences);
            darkModeSetting.addEventListener('change', toggleDarkMode);
            resetProgressBtn.addEventListener('click', resetProgress);
            helpBtn.addEventListener('click', openHelp);
            closeHelpBtn.addEventListener('click', closeHelp);

            // Character tooltips
            const characters = document.querySelectorAll('.character');
            characters.forEach(character => {
                character.addEventListener('click', () => {
                    speakCurrentWord();
                    character.classList.add('bounce');
                    setTimeout(() => {
                        character.classList.remove('bounce');
                    }, 1000);
                });
            });

            // Set up quiz options click handlers
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', handleQuizOption);
            });
        }

        // Load game state from localStorage
        function loadGameState() {
            const savedState = localStorage.getItem('wordExplorerState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = { ...gameState, ...parsedState };
                
                // Set UI controls to match saved state
                difficultySetting.value = gameState.currentDifficulty;
                speechRateSetting.value = gameState.speechRate;
                showPhoneticsSetting.checked = gameState.showPhonetics !== false;
                showSentencesSetting.checked = gameState.showSentences !== false;
                darkModeSetting.checked = gameState.darkMode === true;
                
                if (gameState.darkMode) {
                    document.body.classList.add('dark-mode');
                }
            }
        }

        // Save game state to localStorage
        function saveGameState() {
            localStorage.setItem('wordExplorerState', JSON.stringify(gameState));
        }

        // Update UI based on current game state
        function updateUI() {
            const currentWord = getCurrentWord();
            
            // Update word card
            wordDisplay.textContent = currentWord.word;
            wordImage.textContent = currentWord.image;
            phoneticDisplay.textContent = currentWord.phonetic;
            sentenceDisplay.textContent = currentWord.sentence;
            
            // Update progress indicators
            wordsMasteredDisplay.textContent = gameState.wordsMastered;
            levelDisplay.textContent = gameState.level;
            
            // Calculate progress percentage based on words mastered in current difficulty
            const totalWordsInLevel = wordDatabase[gameState.currentDifficulty].length;
            const masteredInCurrentLevel = Object.keys(gameState.masteredWords)
                .filter(word => gameState.masteredWords[word] === gameState.currentDifficulty)
                .length;
            const progressPercentage = (masteredInCurrentLevel / totalWordsInLevel) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            
            // Show/hide elements based on settings
            phoneticDisplay.style.display = gameState.showPhonetics !== false ? 'block' : 'none';
            sentenceDisplay.style.display = gameState.showSentences !== false ? 'block' : 'none';
            
            // Show appropriate buttons
            if (gameState.showingQuiz) {
                document.querySelector('.flash-card .controls').style.display = 'none';
                quizContainer.style.display = 'block';
            } else {
                document.querySelector('.flash-card .controls').style.display = 'flex';
                quizContainer.style.display = 'none';
            }
        }

        // Get current word from database
        function getCurrentWord() {
            const words = wordDatabase[gameState.currentDifficulty];
            return words[gameState.currentWordIndex % words.length];
        }

        // Speak the current word using the Web Speech API
        function speakCurrentWord() {
            const word = getCurrentWord().word;
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = gameState.speechRate;
            speechSynthesis.speak(utterance);
            
            // Optional: Also speak the sentence if enabled
            if (gameState.showSentences !== false) {
                const sentenceUtterance = new SpeechSynthesisUtterance(getCurrentWord().sentence);
                sentenceUtterance.rate = gameState.speechRate;
                setTimeout(() => {
                    speechSynthesis.speak(sentenceUtterance);
                }, 1000);
            }
        }

        // Handle "I Know This Word" button
        function handleKnowWord() {
            const currentWord = getCurrentWord().word;
            
            // Add to mastered words if not already mastered
            if (!gameState.masteredWords[currentWord]) {
                gameState.masteredWords[currentWord] = gameState.currentDifficulty;
                gameState.wordsMastered++;
                
                // Check for level up
                checkForLevelUp();
                
                // Occasionally show a quiz to reinforce learning
                if (Math.random() < 0.3) {
                    showQuiz();
                    return;
                }
            }
            
            // Show next word
            showNextWord();
        }

        // Handle "Still Learning" button
        function handleLearningWord() {
            // Keep in the rotation, but move to next word
            showNextWord();
        }

        // Show next word
        function showNextWord() {
            gameState.currentWordIndex++;
            gameState.showingQuiz = false;
            updateUI();
            saveGameState();
        }

        // Show a quiz to reinforce learning
        function showQuiz() {
            gameState.showingQuiz = true;
            
            // Get the current word and 3 other random words as options
            const correctWord = getCurrentWord();
            const allWords = wordDatabase[gameState.currentDifficulty];
            let options = [correctWord.word];
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * allWords.length);
                const randomWord = allWords[randomIndex].word;
                if (!options.includes(randomWord)) {
                    options.push(randomWord);
                }
            }
            
            // Shuffle options
            options = shuffleArray(options);
            
            // Update quiz UI
            document.querySelector('.quiz-question').textContent = "What word does this image show?";
            document.querySelector('#quiz-container .word-image').textContent = correctWord.image;
            
            const optionElements = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                optionElements[index].textContent = option;
                optionElements[index].className = 'option'; // Reset classes
            });
            
            updateUI();
        }

        // Handle quiz option selection
        function handleQuizOption(event) {
            const selectedOption = event.target.textContent;
            const correctWord = getCurrentWord().word;
            
            if (selectedOption === correctWord) {
                // Correct answer
                event.target.classList.add('correct');
                gameState.correctAnswers++;
                
                // Show celebration if they've gotten multiple correct answers
                if (gameState.correctAnswers % 5 === 0) {
                    showCelebration();
                }
                
                // Move to next word after a short delay
                setTimeout(() => {
                    showNextWord();
                }, 1000);
            } else {
                // Incorrect answer
                event.target.classList.add('incorrect');
                
                // Highlight the correct answer
                document.querySelectorAll('.option').forEach(option => {
                    if (option.textContent === correctWord) {
                        option.classList.add('correct');
                    }
                });
                
                // Move to next word after a delay
                setTimeout(() => {
                    showNextWord();
                }, 2000);
            }
        }

        // Check if player has mastered enough words to level up
        function checkForLevelUp() {
            const totalWordsInLevel = wordDatabase[gameState.currentDifficulty].length;
            const masteredInCurrentLevel = Object.keys(gameState.masteredWords)
                .filter(word => gameState.masteredWords[word] === gameState.currentDifficulty)
                .length;
            
            // Level up if they've mastered at least 80% of words
            if (masteredInCurrentLevel >= totalWordsInLevel * 0.8) {
                const difficultyLevels = ["beginner", "easy", "medium", "advanced", "expert"];
                const currentIndex = difficultyLevels.indexOf(gameState.currentDifficulty);
                
                if (currentIndex < difficultyLevels.length - 1) {
                    const newDifficulty = difficultyLevels[currentIndex + 1];
                    gameState.currentDifficulty = newDifficulty;
                    gameState.currentWordIndex = 0;
                    
                    // Update level display
                    gameState.level = newDifficulty.charAt(0).toUpperCase() + newDifficulty.slice(1);
                    
                    // Add new badge
                    const badges = [
                        "Word Explorer üîç",
                        "Reading Ranger üìö",
                        "Vocabulary Voyager üöÄ",
                        "Word Wizard üßô‚Äç‚ôÇÔ∏è",
                        "Reading Champion üèÜ"
                    ];
                    
                    if (currentIndex < badges.length) {
                        gameState.badges.push(badges[currentIndex]);
                        showCelebration(badges[currentIndex]);
                    }
                    
                    // Update difficulty setting
                    difficultySetting.value = newDifficulty;
                }
            }
        }

        // Show celebration animation
        function showCelebration(badge) {
            const celebrationEl = document.querySelector('.celebration');
            const badgeEl = document.querySelector('.celebration .badge');
            
            if (badge) {
                badgeEl.textContent = `New Badge Earned: ${badge}`;
            } else {
                badgeEl.textContent = `New Badge Earned: Word Master üèÜ`;
            }
            
            // Show emojis
            const emojiRain = document.querySelector('.emoji-rain');
            emojiRain.innerHTML = '';
            
            const emojis = ['üéâ', '‚≠ê', 'üèÜ', 'üåü', '‚ú®', 'üí´', 'üëè', 'üôå', 'üéä', 'ü•≥'];
            for (let i = 0; i < 50; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.left = `${Math.random() * 100}%`;
                emoji.style.animationDelay = `${Math.random() * 2}s`;
                emojiRain.appendChild(emoji);
            }
            
            // Show celebration
            celebrationEl.classList.add('show');
            
            // Hide after a few seconds
            setTimeout(() => {
                celebrationEl.classList.remove('show');
            }, 3000);
        }

        // Toggle settings panel
        function toggleSettings() {
            settingsContent.classList.toggle('open');
        }

        // Change difficulty level
        function changeDifficulty() {
            gameState.currentDifficulty = difficultySetting.value;
            gameState.currentWordIndex = 0;
            gameState.level = difficultySetting.value.charAt(0).toUpperCase() + difficultySetting.value.slice(1);
            updateUI();
            saveGameState();
        }

        // Change speech rate
        function changeSpeechRate() {
            gameState.speechRate = parseFloat(speechRateSetting.value);
            saveGameState();
        }

        // Toggle phonetics display
        function togglePhonetics() {
            gameState.showPhonetics = showPhoneticsSetting.checked;
            updateUI();
            saveGameState();
        }

        // Toggle sentences display
        function toggleSentences() {
            gameState.showSentences = showSentencesSetting.checked;
            updateUI();
            saveGameState();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            gameState.darkMode = darkModeSetting.checked;
            document.body.classList.toggle('dark-mode', gameState.darkMode);
            saveGameState();
        }

        // Reset progress
        function resetProgress() {
            if (confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                gameState = {
                    currentDifficulty: "beginner",
                    currentWordIndex: 0,
                    wordsMastered: 0,
                    correctAnswers: 0,
                    showingQuiz: false,
                    masteredWords: {},
                    badges: [],
                    level: "Beginner",
                    speechRate: gameState.speechRate,
                    showPhonetics: gameState.showPhonetics,
                    showSentences: gameState.showSentences,
                    darkMode: gameState.darkMode
                };
                updateUI();
                saveGameState();
            }
        }

        // Open help modal
        function openHelp() {
            helpModal.classList.add('show');
        }

        // Close help modal
        function closeHelp() {
            helpModal.classList.remove('show');
        }

        // Utility: Shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>