<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Division Game!</title>
    <style>
        body {
            background-color: #E6F3FF;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        .score-label {
            font-size: 24px;
            margin: 20px 0;
        }

        .problem-frame {
            position: relative;
            margin: 20px auto;
            width: 600px;
        }

        canvas {
            background-color: #E6F3FF;
        }

        .answer-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: -300px;
            position: relative;
            z-index: 1;
        }

        .digit-input {
            width: 30px;
            height: 40px;
            font-size: 24px;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 5px;
            background-color: white;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        .digit-input.correct {
            border-color: #4CAF50;
            background-color: #E8F5E9;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .wrong {
            animation: wrongShake 0.2s ease-in-out;
            background-color: #ffebee;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score-label">Stars: ‚≠ê x <span id="score">0</span></div>
        <div class="problem-frame">
            <canvas id="gameCanvas" width="600" height="300"></canvas>
            <div id="answerContainer" class="answer-container"></div>
        </div>
    </div>

    <script>
        class DivisionGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.score = 0;
                this.answerContainer = document.getElementById('answerContainer');
                this.scoreElement = document.getElementById('score');
                this.currentProblem = null;
                this.answerInputs = [];
                
                this.newProblem();
            }

            generateProblem() {
                const divisor = Math.floor(Math.random() * 11) + 2; // 2 to 12
                const quotientLength = Math.floor(Math.random() * 3) + 3; // 3 to 5
                
                let quotientDigits = [];
                let dividendParts = [];
                
                for (let i = 0; i < quotientLength; i++) {
                    let qDigit, dividendPart;
                    do {
                        qDigit = Math.floor(Math.random() * 9) + 1;
                        dividendPart = qDigit * divisor;
                    } while (dividendPart > 144);
                    
                    quotientDigits.push(qDigit);
                    dividendParts.push(dividendPart);
                }
                
                const dividend = parseInt(dividendParts.join(''));
                const quotient = parseInt(quotientDigits.join(''));
                
                return { dividend, divisor, quotient };
            }

            drawProblem() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.font = '24px "Comic Sans MS"';
                this.ctx.textAlign = 'center';
                
                const xStart = 220;
                const yStart = 150;
                
                // Draw divisor
                this.ctx.textAlign = 'right';
                this.ctx.fillText(this.currentProblem.divisor, xStart - 20, yStart);
                
                // Draw division symbol
                this.ctx.beginPath();
                this.ctx.moveTo(xStart - 10, yStart - 10);
                this.ctx.lineTo(xStart + String(this.currentProblem.dividend).length * 30, yStart - 10);
                this.ctx.moveTo(xStart - 10, yStart - 10);
                this.ctx.lineTo(xStart - 10, yStart - 30);
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Draw dividend
                this.ctx.textAlign = 'center';
                String(this.currentProblem.dividend).split('').forEach((digit, i) => {
                    this.ctx.fillText(digit, xStart + i * 30, yStart);
                });
            }

            createAnswerInputs() {
                this.answerContainer.innerHTML = '';
                this.answerInputs = [];
                
                const answer = String(this.currentProblem.quotient);
                
                for (let i = 0; i < answer.length; i++) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.maxLength = 1;
                    input.className = 'digit-input';
                    input.dataset.position = i;
                    
                    input.addEventListener('input', (e) => this.checkDigit(e, i));
                    input.addEventListener('keydown', (e) => this.handleKeydown(e, i));
                    
                    this.answerContainer.appendChild(input);
                    this.answerInputs.push(input);
                }
                
                if (this.answerInputs.length > 0) {
                    this.answerInputs[0].focus();
                }
            }

            checkDigit(event, position) {
                const input = event.target;
                const value = input.value;
                
                if (value === '') return;
                
                if (!/^\d$/.test(value)) {
                    input.value = '';
                    return;
                }
                
                const correctAnswer = String(this.currentProblem.quotient);
                
                if (value === correctAnswer[position]) {
                    input.classList.add('correct');
                    if (position < this.answerInputs.length - 1) {
                        this.answerInputs[position + 1].focus();
                    }
                    
                    if (this.checkAllCorrect()) {
                        setTimeout(() => this.celebrate(), 200);
                    }
                } else {
                    input.value = '';
                    input.classList.add('wrong');
                    setTimeout(() => input.classList.remove('wrong'), 500);
                }
            }

            handleKeydown(event, position) {
                if (event.key === 'ArrowLeft' && position > 0) {
                    this.answerInputs[position - 1].focus();
                } else if (event.key === 'ArrowRight' && position < this.answerInputs.length - 1) {
                    this.answerInputs[position + 1].focus();
                }
            }

            checkAllCorrect() {
                const correctAnswer = String(this.currentProblem.quotient);
                return this.answerInputs.every((input, i) => input.value === correctAnswer[i]);
            }

            celebrate() {
                this.score++;
                this.scoreElement.textContent = this.score;
                
                let step = 0;
                const colors = ['red', 'orange', 'yellow', 'green', 'blue', 'purple'];
                
                const animate = () => {
                    if (step < 30) {
                        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                        
                        for (let i = 0; i < 10; i++) {
                            const color = colors[step % colors.length];
                            const x = Math.random() * 400 + 100;
                            const y = Math.random() * 200 + 50;
                            const size = Math.random() * 20 + 20;
                            
                            this.drawStar(x, y, size, color);
                        }
                        
                        step++;
                        requestAnimationFrame(animate);
                    } else {
                        this.newProblem();
                    }
                };
                
                this.answerContainer.innerHTML = '';
                animate();
            }

            drawStar(x, y, size, color) {
                this.ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = i * 2 * Math.PI / 5 - Math.PI / 2;
                    const px = x + size * Math.cos(angle);
                    const py = y + size * Math.sin(angle);
                    
                    if (i === 0) {
                        this.ctx.moveTo(px, py);
                    } else {
                        this.ctx.lineTo(px, py);
                    }
                }
                this.ctx.closePath();
                this.ctx.fillStyle = color;
                this.ctx.fill();
            }

            newProblem() {
                this.currentProblem = this.generateProblem();
                this.drawProblem();
                this.createAnswerInputs();
            }
        }

        // Start the game when the page loads
        window.addEventListener('load', () => {
            new DivisionGame();
        });
    </script>
</body>
</html>