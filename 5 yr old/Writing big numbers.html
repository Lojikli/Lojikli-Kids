<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Wizard's Scientific Notation Adventure</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Nunito:wght@600;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
        }
        
        #game-container {
            position: relative;
            width: 900px;
            height: 650px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            overflow: hidden;
        }
        
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: all 0.5s;
        }
        
        .active-screen {
            display: flex;
        }
        
        .title {
            font-size: 36px;
            font-weight: 800;
            color: #4A6AE8;
            margin-bottom: 24px;
            text-align: center;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
        }
        
        .subtitle {
            font-size: 24px;
            margin-bottom: 16px;
            text-align: center;
            color: #555;
        }
        
        .btn {
            background: #4A6AE8;
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 20px;
            font-weight: 600;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            margin: 10px;
            cursor: pointer;
            box-shadow: 0 4px 0 #2a4ac8;
            transition: all 0.1s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #2a4ac8;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2a4ac8;
        }
        
        .btn-green {
            background: #4AE86A;
            box-shadow: 0 4px 0 #2ac84a;
        }
        
        .btn-green:hover {
            box-shadow: 0 6px 0 #2ac84a;
        }
        
        .btn-green:active {
            box-shadow: 0 2px 0 #2ac84a;
        }
        
        .btn-yellow {
            background: #E8E84A;
            box-shadow: 0 4px 0 #c8c82a;
            color: #333;
        }
        
        .btn-yellow:hover {
            box-shadow: 0 6px 0 #c8c82a;
        }
        
        .btn-yellow:active {
            box-shadow: 0 2px 0 #c8c82a;
        }
        
        .btn-red {
            background: #E84A4A;
            box-shadow: 0 4px 0 #c82a2a;
        }
        
        .btn-red:hover {
            box-shadow: 0 6px 0 #c82a2a;
        }
        
        .btn-red:active {
            box-shadow: 0 2px 0 #c82a2a;
        }
        
        .character {
            position: absolute;
            width: 200px;
            height: 200px;
            bottom: 0;
            left: 50px;
            transition: all 0.3s;
        }
        
        .speech-bubble {
            position: absolute;
            padding: 15px;
            background: white;
            border-radius: 20px;
            max-width: 350px;
            font-size: 16px;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 10;
            transition: all 0.3s;
        }
        
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 30px;
            border: 10px solid transparent;
            border-top-color: white;
        }
        
        .wizard-speech {
            bottom: 200px;
            left: 120px;
        }
        
        .monster-speech {
            bottom: 200px;
            right: 120px;
        }
        
        .game-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        
        .problem-container {
            font-size: 24px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f1f5ff;
            border-radius: 12px;
            text-align: center;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80%;
        }
        
        .input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            width: 80%;
        }
        
        .input-display {
            width: 100%;
            min-height: 60px;
            font-size: 20px;
            padding: 10px;
            background: #f8f8f8;
            border: 2px solid #ccc;
            border-radius: 10px;
            margin-bottom: 10px;
            word-wrap: break-word;
            position: relative;
            font-family: 'Nunito', sans-serif;
            overflow-y: auto;
            max-height: 150px;
        }
        
        .input-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 400px;
        }
        
        .input-btn {
            font-size: 16px;
            padding: 8px 12px;
            min-width: 40px;
            background: #4A6AE8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            box-shadow: 0 2px 0 #2a4ac8;
        }
        
        .input-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 0 #2a4ac8;
        }
        
        .input-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #2a4ac8;
        }
        
        .submit-btn {
            background: #4AE86A;
            box-shadow: 0 2px 0 #2ac84a;
            padding: 8px 24px;
        }
        
        .submit-btn:hover {
            box-shadow: 0 4px 0 #2ac84a;
        }
        
        .submit-btn:active {
            box-shadow: 0 1px 0 #2ac84a;
        }
        
        .clear-btn {
            background: #E84A4A;
            box-shadow: 0 2px 0 #c82a2a;
        }
        
        .clear-btn:hover {
            box-shadow: 0 4px 0 #c82a2a;
        }
        
        .clear-btn:active {
            box-shadow: 0 1px 0 #c82a2a;
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.8);
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .level-display {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.8);
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .feedback {
            position: absolute;
            font-size: 72px;
            font-weight: 800;
            opacity: 0;
            transition: all 0.5s;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
            transform: scale(0.5);
            z-index: 100;
        }
        
        .feedback.active {
            opacity: 1;
            transform: scale(1);
        }
        
        .correct {
            color: #4AE86A;
        }
        
        .incorrect {
            color: #E84A4A;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            z-index: 100;
            pointer-events: none;
            transition: all 0.5s;
            transform: rotate(45deg);
        }
        
        .help-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #4A6AE8;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 20;
        }
        
        .help-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 80%;
            max-height: 80%;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 30;
            overflow-y: auto;
            transition: all 0.3s;
            opacity: 0;
            pointer-events: none;
        }
        
        .help-content.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }
        
        .close-help {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: #E84A4A;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .settings-panel {
            width: 80%;
            display: flex;
            flex-direction: column;
            background: #f1f5ff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .settings-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #4A6AE8;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .settings-label {
            font-size: 16px;
        }
        
        .settings-input {
            width: 150px;
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #ccc;
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
        }
        
        .settings-checkbox {
            width: 20px;
            height: 20px;
        }
        
        .slider-container {
            width: 150px;
        }
        
        .slider {
            width: 100%;
        }
        
        .monster-container {
            position: absolute;
            right: 50px;
            bottom: 0;
            transition: all 0.3s;
            transform: translateY(100%);
        }
        
        .monster-container.active {
            transform: translateY(0);
        }
        
        .zero-count {
            position: absolute;
            top: -40px;
            right: 0;
            font-size: 24px;
            font-weight: bold;
            color: #E84A4A;
        }
        
        .progress-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 20px;
            background: #f1f1f1;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #4AE86A;
            width: 0%;
            transition: width 0.5s;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active-screen">
            <h1 class="title">Number Wizard's<br>Scientific Notation Adventure</h1>
            <p class="subtitle">Learn about HUGE numbers in a fun way!</p>
            <button id="start-btn" class="btn btn-green">Start Game</button>
            <button id="settings-btn" class="btn">Settings</button>
        </div>
        
        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <h1 class="title">Game Settings</h1>
            <div class="settings-panel">
                <h2 class="settings-title">Learning Parameters</h2>
                <div class="settings-row">
                    <span class="settings-label">Max Power of 10:</span>
                    <input type="number" id="max-power" class="settings-input" min="3" max="39" value="39">
                </div>
                <div class="settings-row">
                    <span class="settings-label">Questions Per Level:</span>
                    <input type="number" id="questions-per-level" class="settings-input" min="3" max="20" value="5">
                </div>
                <div class="settings-row">
                    <span class="settings-label">Sound Effects:</span>
                    <input type="checkbox" id="sound-enabled" class="settings-checkbox" checked>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Sound Volume:</span>
                    <div class="slider-container">
                        <input type="range" id="volume-slider" class="slider" min="0" max="100" value="70">
                    </div>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Show Animations:</span>
                    <input type="checkbox" id="animations-enabled" class="settings-checkbox" checked>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Use Words Only:</span>
                    <input type="checkbox" id="words-only" class="settings-checkbox">
                </div>
            </div>
            <button id="save-settings-btn" class="btn btn-green">Save Settings</button>
            <button id="back-to-welcome-btn" class="btn">Back</button>
        </div>
        
        <!-- Level Select Screen -->
        <div id="level-select-screen" class="screen">
            <h1 class="title">Choose Your Level</h1>
            <button id="level-1-btn" class="btn">Level 1: Simple Powers</button>
            <button id="level-2-btn" class="btn">Level 2: Decimal Numbers</button>
            <p class="subtitle" style="margin-top: 20px;">What do you want to practice?</p>
            <div style="display: flex; margin-top: 10px;">
                <button id="practice-scientific-btn" class="btn btn-yellow">Scientific Notation</button>
                <button id="practice-expanded-btn" class="btn btn-red">Expanded Form</button>
                <button id="practice-both-btn" class="btn btn-green">Both</button>
            </div>
            <button id="back-from-level-btn" class="btn" style="margin-top: 20px;">Back</button>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="level-display">Level: <span id="current-level">1</span></div>
            <div class="score-display">Score: <span id="score">0</span></div>
            
            <div class="game-area">
                <div class="problem-container" id="problem-text">
                    Convert this number to scientific notation:
                </div>
                
                <div class="input-container">
                    <div class="input-display" id="input-display"></div>
                    <div class="input-buttons">
                        <!-- Number buttons will be added dynamically -->
                    </div>
                </div>
                
                <div>
                    <button id="submit-answer" class="btn submit-btn">Submit</button>
                    <button id="clear-input" class="btn clear-btn">Clear</button>
                </div>
            </div>
            
            <div class="feedback" id="feedback"></div>
            
            <div class="character" id="wizard">
                <svg width="200" height="200" viewBox="0 0 200 200">
                    <!-- Wizard body -->
                    <circle cx="100" cy="100" r="60" fill="#4A6AE8" />
                    
                    <!-- Wizard hat -->
                    <path d="M100,40 L70,100 L130,100 Z" fill="#6A4AE8" />
                    <circle cx="100" cy="40" r="10" fill="#FFCC00" />
                    
                    <!-- Wizard face -->
                    <circle cx="85" cy="90" r="8" fill="white" />
                    <circle cx="115" cy="90" r="8" fill="white" />
                    <circle cx="85" cy="90" r="4" fill="#333" />
                    <circle cx="115" cy="90" r="4" fill="#333" />
                    
                    <!-- Wizard beard -->
                    <path d="M100,100 Q80,120 70,150 Q100,140 100,150 Q100,140 130,150 Q120,120 100,100" fill="white" />
                    
                    <!-- Wizard smile -->
                    <path d="M85,110 Q100,120 115,110" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round" />
                </svg>
            </div>
            
            <div class="speech-bubble wizard-speech" id="wizard-speech">
                Welcome to the Land of Big Numbers! I'm the Number Wizard, and I'll help you learn about HUGE numbers!
            </div>
            
            <div class="monster-container" id="monster-container">
                <div class="zero-count" id="zero-count">0 zeros!</div>
                <svg width="200" height="200" viewBox="0 0 200 200">
                    <!-- Zero Monster body -->
                    <circle cx="100" cy="100" r="60" fill="#E84A4A" />
                    
                    <!-- Zero Monster eyes -->
                    <circle cx="80" cy="80" r="15" fill="white" />
                    <circle cx="120" cy="80" r="15" fill="white" />
                    <circle cx="80" cy="80" r="8" fill="#333" />
                    <circle cx="120" cy="80" r="8" fill="#333" />
                    
                    <!-- Zero Monster mouth -->
                    <circle cx="100" cy="120" r="25" fill="white" />
                    <circle cx="100" cy="120" r="15" fill="#E84A4A" />
                    
                    <!-- Zero Monster horns -->
                    <path d="M70,60 L60,30 L80,55 Z" fill="#E84A4A" />
                    <path d="M130,60 L140,30 L120,55 Z" fill="#E84A4A" />
                </svg>
            </div>
            
            <div class="speech-bubble monster-speech" id="monster-speech">
                RAWRR! I'm the Zero Monster! I LOVE zeros! Keep writing zeros!
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            
            <div class="help-btn" id="help-btn">?</div>
        </div>
        
        <!-- Level Complete Screen -->
        <div id="level-complete-screen" class="screen">
            <h1 class="title">Level Complete!</h1>
            <p class="subtitle">Great job! You're becoming a number master!</p>
            <p class="subtitle">Your score: <span id="final-score">0</span></p>
            <button id="next-level-btn" class="btn btn-green">Next Level</button>
            <button id="replay-level-btn" class="btn">Play Again</button>
            <button id="back-to-menu-btn" class="btn btn-yellow">Back to Menu</button>
        </div>
        
        <!-- Help Screen -->
        <div id="help-content" class="help-content">
            <div class="close-help" id="close-help">X</div>
            <h2 class="title" style="margin-top: 0;">How to Play</h2>
            <div style="font-size: 16px; line-height: 1.5;">
                <h3 style="color: #4A6AE8; margin: 10px 0;">About Big Numbers</h3>
                <p>Big numbers can be written in two ways:</p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li><strong>Expanded Form</strong>: Writing out the whole number (like 1,000,000,000)</li>
                    <li><strong>Scientific Notation</strong>: Writing as a number times a power of 10 (like 1 × 10^9)</li>
                </ul>
                
                <h3 style="color: #4A6AE8; margin: 10px 0;">Place Values</h3>
                <p>Here are the names of some big numbers:</p>
                <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                    <tr>
                        <th style="text-align: left; border: 1px solid #ccc; padding: 5px;">Name</th>
                        <th style="text-align: left; border: 1px solid #ccc; padding: 5px;">Power of 10</th>
                        <th style="text-align: left; border: 1px solid #ccc; padding: 5px;">Zeros</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Thousand</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^3</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000 (3 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Million</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^6</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000,000 (6 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Billion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^9</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000,000,000 (9 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Trillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^12</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000,000,000,000 (12 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Quadrillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^15</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000,000,000,000,000 (15 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Quintillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^18</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1,000,000,000,000,000,000 (18 zeros)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Sextillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^21</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 21 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Septillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^24</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 24 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Octillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^27</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 27 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Nonillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^30</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 30 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Decillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^33</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 33 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Undecillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^36</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 36 zeros</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 5px;">Duodecillion</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">10^39</td>
                        <td style="border: 1px solid #ccc; padding: 5px;">1 with 39 zeros</td>
                    </tr>
                </table>
                
                <h3 style="color: #4A6AE8; margin: 10px 0;">How to Write Scientific Notation</h3>
                <p>To write in scientific notation:</p>
                <ol style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Write a number between 1 and 10 (or a number less than 10 for Level 1)</li>
                    <li>Multiply it by 10 raised to a power</li>
                    <li>The power tells you how many places to move the decimal point</li>
                </ol>
                <p>Example: 5,000,000 = 5 × 10^6 (5 times 10 to the power of 6)</p>
                
                <h3 style="color: #4A6AE8; margin: 10px 0;">Game Controls</h3>
                <p>Use the on-screen buttons to input your answer. Click Submit when you're done!</p>
                <p>Watch out for the Zero Monster when writing expanded form! He gets excited with lots of zeros!</p>
            </div>
        </div>
    </div>

    <script>
        // Game state variables
        let gameState = {
            score: 0,
            currentLevel: 1,
            currentQuestion: 0,
            currentMode: 'scientific', // 'scientific' or 'expanded'
            totalQuestions: 5,
            maxPower: 39,
            soundEnabled: true,
            volume: 0.7,
            animationsEnabled: true,
            wordsOnly: false, // Whether to show only words instead of numerals
            currentProblem: null,
            currentAnswer: ''
        };
        
        // Audio context for sound effects
        let audioContext;
        let masterGainNode;
        
        // Place value names
        const placeValueNames = [
            '', 'thousand', 'million', 'billion', 'trillion', 'quadrillion',
            'quintillion', 'sextillion', 'septillion', 'octillion', 'nonillion',
            'decillion', 'undecillion', 'duodecillion'
        ];
        
        // Number names for 1-9
        const digitNames = [
            'zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'
        ];
        
        // Convert a number to words
        function numberToWords(num) {
            if (num <= 9) {
                return digitNames[num];
            }
            return num.toString();
        }
        
        // DOM Elements
        const welcomeScreen = document.getElementById('welcome-screen');
        const settingsScreen = document.getElementById('settings-screen');
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelCompleteScreen = document.getElementById('level-complete-screen');
        const helpContent = document.getElementById('help-content');
        
        const startBtn = document.getElementById('start-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const backToWelcomeBtn = document.getElementById('back-to-welcome-btn');
        const level1Btn = document.getElementById('level-1-btn');
        const level2Btn = document.getElementById('level-2-btn');
        const practiceScientificBtn = document.getElementById('practice-scientific-btn');
        const practiceExpandedBtn = document.getElementById('practice-expanded-btn');
        const practiceBothBtn = document.getElementById('practice-both-btn');
        const backFromLevelBtn = document.getElementById('back-from-level-btn');
        const submitAnswerBtn = document.getElementById('submit-answer');
        const clearInputBtn = document.getElementById('clear-input');
        const nextLevelBtn = document.getElementById('next-level-btn');
        const replayLevelBtn = document.getElementById('replay-level-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const helpBtn = document.getElementById('help-btn');
        const closeHelpBtn = document.getElementById('close-help');
        
        const problemText = document.getElementById('problem-text');
        const inputDisplay = document.getElementById('input-display');
        const inputButtons = document.querySelector('.input-buttons');
        const feedbackElement = document.getElementById('feedback');
        const wizardSpeech = document.getElementById('wizard-speech');
        const monsterSpeech = document.getElementById('monster-speech');
        const monsterContainer = document.getElementById('monster-container');
        const zeroCount = document.getElementById('zero-count');
        const progressBar = document.getElementById('progress-bar');
        const currentLevelDisplay = document.getElementById('current-level');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('final-score');
        
        const maxPowerInput = document.getElementById('max-power');
        const questionsPerLevelInput = document.getElementById('questions-per-level');
        const soundEnabledCheckbox = document.getElementById('sound-enabled');
        const volumeSlider = document.getElementById('volume-slider');
        const animationsEnabledCheckbox = document.getElementById('animations-enabled');
        const wordsOnlyCheckbox = document.getElementById('words-only');
        
        // Initialize Audio Context
        function initAudio() {
            // Create audio context only when user interacts with the page
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGainNode = audioContext.createGain();
                masterGainNode.gain.value = gameState.volume;
                masterGainNode.connect(audioContext.destination);
            }
        }
        
        // Play sound effect
        function playSound(type) {
            if (!gameState.soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            switch (type) {
                case 'correct':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1);
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 1);
                    
                    setTimeout(() => {
                        const osc2 = audioContext.createOscillator();
                        osc2.type = 'sine';
                        osc2.frequency.setValueAtTime(659.25, audioContext.currentTime); // E5
                        const gain2 = audioContext.createGain();
                        gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gain2.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.8);
                        osc2.connect(gain2);
                        gain2.connect(masterGainNode);
                        osc2.start();
                        osc2.stop(audioContext.currentTime + 0.8);
                    }, 200);
                    
                    setTimeout(() => {
                        const osc3 = audioContext.createOscillator();
                        osc3.type = 'sine';
                        osc3.frequency.setValueAtTime(783.99, audioContext.currentTime); // G5
                        const gain3 = audioContext.createGain();
                        gain3.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gain3.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1.2);
                        osc3.connect(gain3);
                        gain3.connect(masterGainNode);
                        osc3.start();
                        osc3.stop(audioContext.currentTime + 1.2);
                    }, 400);
                    break;
                    
                case 'incorrect':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.8);
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.8);
                    
                    setTimeout(() => {
                        const osc2 = audioContext.createOscillator();
                        osc2.type = 'sawtooth';
                        osc2.frequency.setValueAtTime(196, audioContext.currentTime); // G3
                        const gain2 = audioContext.createGain();
                        gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gain2.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1);
                        osc2.connect(gain2);
                        gain2.connect(masterGainNode);
                        osc2.start();
                        osc2.stop(audioContext.currentTime + 1);
                    }, 200);
                    break;
                    
                case 'click':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.1);
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                    
                case 'monster':
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.5);
                    
                    const lfo = audioContext.createOscillator();
                    lfo.type = 'sawtooth';
                    lfo.frequency.value = 10;
                    
                    const lfoGain = audioContext.createGain();
                    lfoGain.gain.value = 50;
                    
                    lfo.connect(lfoGain);
                    lfoGain.connect(oscillator.frequency);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    
                    lfo.start();
                    oscillator.start();
                    
                    oscillator.stop(audioContext.currentTime + 0.5);
                    lfo.stop(audioContext.currentTime + 0.5);
                    break;
                    
                case 'zero':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(300 + Math.random() * 200, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.1);
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGainNode);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
            }
        }
        
        // Create confetti effect
        function createConfetti() {
            if (!gameState.animationsEnabled) return;
            
            const colors = ['#4A6AE8', '#4AE86A', '#E8E84A', '#E84A4A', '#E84AE8'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.opacity = '1';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.getElementById('game-container').appendChild(confetti);
                
                // Animate confetti falling
                setTimeout(() => {
                    confetti.style.top = `${100 + Math.random() * 20}%`;
                    confetti.style.left = `${parseInt(confetti.style.left) + (Math.random() * 20 - 10)}%`;
                    confetti.style.opacity = '0';
                }, 10);
                
                // Remove from DOM after animation
                setTimeout(() => {
                    confetti.remove();
                }, 2000);
            }
        }
        
        // Create button layout for input
        function createInputButtons() {
            inputButtons.innerHTML = '';
            
            // Add number buttons
            for (let i = 0; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'input-btn';
                btn.textContent = i;
                btn.onclick = () => {
                    playSound('click');
                    appendToInput(i.toString());
                };
                inputButtons.appendChild(btn);
            }
            
            // Add decimal point button
            const decimalBtn = document.createElement('button');
            decimalBtn.className = 'input-btn';
            decimalBtn.textContent = '.';
            decimalBtn.onclick = () => {
                playSound('click');
                appendToInput('.');
            };
            inputButtons.appendChild(decimalBtn);
            
            // Add multiplication and power buttons for scientific notation
            if (gameState.currentMode === 'scientific' || gameState.currentMode === 'both') {
                const timesBtn = document.createElement('button');
                timesBtn.className = 'input-btn';
                timesBtn.textContent = '×';
                timesBtn.onclick = () => {
                    playSound('click');
                    appendToInput(' × ');
                };
                inputButtons.appendChild(timesBtn);
                
                const tenBtn = document.createElement('button');
                tenBtn.className = 'input-btn';
                tenBtn.textContent = '10';
                tenBtn.onclick = () => {
                    playSound('click');
                    appendToInput('10');
                };
                inputButtons.appendChild(tenBtn);
                
                const powerBtn = document.createElement('button');
                powerBtn.className = 'input-btn';
                powerBtn.textContent = '^';
                powerBtn.onclick = () => {
                    playSound('click');
                    appendToInput('^');
                };
                inputButtons.appendChild(powerBtn);
            }
            
            // Add comma button for expanded form
            if (gameState.currentMode === 'expanded' || gameState.currentMode === 'both') {
                const commaBtn = document.createElement('button');
                commaBtn.className = 'input-btn';
                commaBtn.textContent = ',';
                commaBtn.onclick = () => {
                    playSound('click');
                    appendToInput(',');
                };
                inputButtons.appendChild(commaBtn);
                
                // Add zero button for expanded form (makes adding many zeros easier)
                const zeroBtn = document.createElement('button');
                zeroBtn.className = 'input-btn';
                zeroBtn.textContent = '000';
                zeroBtn.onclick = () => {
                    playSound('zero');
                    appendToInput('000');
                    if (gameState.currentMode === 'expanded' && gameState.animationsEnabled) {
                        monsterReact();
                    }
                };
                inputButtons.appendChild(zeroBtn);
            }
        }
        
        // Append text to input display
        function appendToInput(text) {
            gameState.currentAnswer += text;
            inputDisplay.textContent = gameState.currentAnswer;
            
            // Count zeros for the Zero Monster
            if (gameState.currentMode === 'expanded' && text.includes('0')) {
                const zeroMatches = gameState.currentAnswer.match(/0/g);
                const zeroNum = zeroMatches ? zeroMatches.length : 0;
                zeroCount.textContent = zeroNum + ' zeros!';
                
                if (zeroNum > 10 && gameState.animationsEnabled) {
                    monsterContainer.classList.add('active');
                }
            }
        }
        
        // Monster reaction to many zeros
        function monsterReact() {
            const zeroMatches = gameState.currentAnswer.match(/0/g);
            const zeroNum = zeroMatches ? zeroMatches.length : 0;
            
            if (zeroNum > 20) {
                playSound('monster');
                monsterSpeech.textContent = 'RAWRR! SO MANY ZEROS! I LOVE IT! KEEP GOING!';
                monsterContainer.style.animation = 'bounce 0.5s';
                setTimeout(() => {
                    monsterContainer.style.animation = '';
                }, 500);
            } else if (zeroNum > 10) {
                monsterSpeech.textContent = 'RAWRR! I see zeros! Good job! More zeros please!';
            }
        }
        
        // Generate a problem based on current level and mode
        function generateProblem() {
            const multiplier = gameState.currentLevel === 1 ? 
                Math.floor(Math.random() * 9) + 1 : // Level 1: single digit multiplier
                ((Math.floor(Math.random() * 90) + 10) / 10); // Level 2: single digit with decimal
            
            const power = Math.floor(Math.random() * gameState.maxPower / 3) * 3; // Multiple of 3 for place value names
            
            let problem, answer;
            
            if (gameState.currentMode === 'scientific') {
                // Generate expanded form, answer is scientific notation
                const expandedForm = multiplier * Math.pow(10, power);
                let expandedFormStr = expandedForm.toString();
                
                // Format large numbers with commas
                if (power <= 21) { // JavaScript handles numbers up to 21 digits reliably
                    expandedFormStr = expandedForm.toLocaleString();
                } else {
                    // For extremely large numbers, construct the string manually
                    expandedFormStr = multiplier.toString();
                    for (let i = 0; i < power; i++) {
                        expandedFormStr += '0';
                    }
                    
                    // Add commas
                    expandedFormStr = expandedFormStr.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
                
                // Get place value name if available
                let placeName = '';
                let wordForm = '';
                if (power > 0 && power % 3 === 0) {
                    const placeIndex = power / 3;
                    if (placeIndex < placeValueNames.length) {
                        const multiplierWord = numberToWords(Math.floor(multiplier));
                        placeName = ` (${multiplier} ${placeValueNames[placeIndex]})`;
                        wordForm = `${multiplierWord} ${placeValueNames[placeIndex]}`;
                    }
                }
                
                // Choose between showing the number or only words based on settings
                if (gameState.wordsOnly && wordForm) {
                    problem = `Convert this number to scientific notation: ${wordForm}`;
                } else {
                    problem = `Convert this number to scientific notation: ${expandedFormStr}${placeName}`;
                }
                
                answer = `${multiplier} × 10^${power}`;
                
                if (gameState.currentLevel === 2 && multiplier !== Math.floor(multiplier)) {
                    answer = `${multiplier} × 10^${power}`;
                }
            } else {
                // For scientific to expanded conversion
                if (gameState.wordsOnly) {
                    const multiplierWord = numberToWords(Math.floor(multiplier));
                    const powerWord = power.toString();
                    problem = `Write this number in expanded form: ${multiplierWord} times ten to the power of ${powerWord}`;
                } else {
                    problem = `Write this number in expanded form: ${multiplier} × 10^${power}`;
                }
                
                // Calculate expanded form
                const expandedForm = multiplier * Math.pow(10, power);
                let answer;
                
                if (power <= 21) { // JavaScript handles numbers up to 21 digits reliably
                    answer = expandedForm.toLocaleString();
                } else {
                    // For extremely large numbers, construct the string manually
                    answer = multiplier.toString();
                    for (let i = 0; i < power; i++) {
                        answer += '0';
                    }
                    
                    // Add commas
                    answer = answer.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            }
            
            return { problem, answer, power, multiplier };
        }
        
        // Set up a new question
        function setUpQuestion() {
            // Clear previous input
            gameState.currentAnswer = '';
            inputDisplay.textContent = '';
            
            // Generate a new problem
            gameState.currentProblem = generateProblem();
            problemText.textContent = gameState.currentProblem.problem;
            
            // Reset monster
            monsterContainer.classList.remove('active');
            zeroCount.textContent = '0 zeros!';
            
            // Update progress bar
            const progress = (gameState.currentQuestion / gameState.totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Update wizard speech
            if (gameState.currentQuestion === 0) {
                if (gameState.currentMode === 'scientific') {
                    if (gameState.wordsOnly) {
                        wizardSpeech.textContent = "Let's convert word numbers to scientific notation! Try to figure out how many zeros from the number words!";
                    } else {
                        wizardSpeech.textContent = "Let's convert big numbers to scientific notation! It's a shorter way to write huge numbers.";
                    }
                } else {
                    if (gameState.wordsOnly) {
                        wizardSpeech.textContent = "Let's convert from words to expanded form. Can you figure out how many zeros to write?";
                    } else {
                        wizardSpeech.textContent = "Let's write scientific notation as expanded form. Get ready for lots of zeros!";
                    }
                }
            } else {
                // Random encouraging messages
                const messages = [
                    "You're doing great! Keep it up!",
                    "Amazing number skills! Try this one!",
                    "You're becoming a number master!",
                    "Fantastic work! Here's another challenge!",
                    "Your number powers are growing stronger!"
                ];
                wizardSpeech.textContent = messages[Math.floor(Math.random() * messages.length)];
            }
            
            // Make wizard float
            document.getElementById('wizard').style.animation = 'float 3s infinite';
        }
        
        // Check the answer
        function checkAnswer() {
            const userAnswer = gameState.currentAnswer.trim();
            const correctAnswer = gameState.currentProblem.answer;
            
            // Normalize answers for comparison (remove spaces, handle different ways to write multiplication)
            const normalizedUserAnswer = userAnswer.replace(/\s+/g, '').replace(/×/g, '*');
            const normalizedCorrectAnswer = correctAnswer.replace(/\s+/g, '').replace(/×/g, '*');
            
            const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
            
            if (isCorrect) {
                // Show correct feedback
                feedbackElement.textContent = 'CORRECT!';
                feedbackElement.className = 'feedback correct active';
                playSound('correct');
                
                if (gameState.animationsEnabled) {
                    createConfetti();
                }
                
                // Update score
                gameState.score += 10;
                scoreDisplay.textContent = gameState.score;
                
                // Show wizard reaction
                wizardSpeech.textContent = "Great job! That's correct!";
                
                // Proceed to next question after delay
                setTimeout(() => {
                    feedbackElement.className = 'feedback';
                    gameState.currentQuestion++;
                    
                    if (gameState.currentQuestion >= gameState.totalQuestions) {
                        // Level complete
                        showLevelComplete();
                    } else {
                        setUpQuestion();
                    }
                }, 2000);
            } else {
                // Show incorrect feedback
                feedbackElement.textContent = 'TRY AGAIN';
                feedbackElement.className = 'feedback incorrect active';
                playSound('incorrect');
                
                // Show wizard reaction
                wizardSpeech.textContent = `Not quite. Try again! The correct answer is: ${correctAnswer}`;
                
                // Clear after delay
                setTimeout(() => {
                    feedbackElement.className = 'feedback';
                }, 2000);
            }
        }
        
        // Show level complete screen
        function showLevelComplete() {
            gameScreen.classList.remove('active-screen');
            levelCompleteScreen.classList.add('active-screen');
            finalScoreDisplay.textContent = gameState.score;
        }
        
        // Start a new game
        function startGame(level, mode) {
            gameState.currentLevel = level;
            gameState.currentMode = mode;
            gameState.currentQuestion = 0;
            gameState.score = 0;
            
            // Update displays
            scoreDisplay.textContent = gameState.score;
            currentLevelDisplay.textContent = gameState.currentLevel;
            
            // Create input buttons based on mode
            createInputButtons();
            
            // Set up first question
            setUpQuestion();
            
            // Show game screen
            levelSelectScreen.classList.remove('active-screen');
            gameScreen.classList.add('active-screen');
        }
        
        // Event Listeners
        startBtn.addEventListener('click', () => {
            playSound('click');
            welcomeScreen.classList.remove('active-screen');
            levelSelectScreen.classList.add('active-screen');
            initAudio();
        });
        
        settingsBtn.addEventListener('click', () => {
            playSound('click');
            welcomeScreen.classList.remove('active-screen');
            settingsScreen.classList.add('active-screen');
            initAudio();
        });
        
        saveSettingsBtn.addEventListener('click', () => {
            playSound('click');
            
            // Save settings
            gameState.maxPower = parseInt(maxPowerInput.value);
            gameState.totalQuestions = parseInt(questionsPerLevelInput.value);
            gameState.soundEnabled = soundEnabledCheckbox.checked;
            gameState.volume = volumeSlider.value / 100;
            gameState.animationsEnabled = animationsEnabledCheckbox.checked;
            gameState.wordsOnly = wordsOnlyCheckbox.checked;
            
            if (masterGainNode) {
                masterGainNode.gain.value = gameState.volume;
            }
            
            settingsScreen.classList.remove('active-screen');
            welcomeScreen.classList.add('active-screen');
        });
        
        backToWelcomeBtn.addEventListener('click', () => {
            playSound('click');
            settingsScreen.classList.remove('active-screen');
            welcomeScreen.classList.add('active-screen');
        });
        
        level1Btn.addEventListener('click', () => {
            playSound('click');
            // Just set level, wait for mode selection
            gameState.currentLevel = 1;
            level1Btn.classList.add('btn-green');
            level1Btn.classList.remove('btn');
            level2Btn.classList.add('btn');
            level2Btn.classList.remove('btn-green');
        });
        
        level2Btn.addEventListener('click', () => {
            playSound('click');
            // Just set level, wait for mode selection
            gameState.currentLevel = 2;
            level2Btn.classList.add('btn-green');
            level2Btn.classList.remove('btn');
            level1Btn.classList.add('btn');
            level1Btn.classList.remove('btn-green');
        });
        
        practiceScientificBtn.addEventListener('click', () => {
            playSound('click');
            startGame(gameState.currentLevel, 'scientific');
        });
        
        practiceExpandedBtn.addEventListener('click', () => {
            playSound('click');
            startGame(gameState.currentLevel, 'expanded');
        });
        
        practiceBothBtn.addEventListener('click', () => {
            playSound('click');
            startGame(gameState.currentLevel, 'both');
        });
        
        backFromLevelBtn.addEventListener('click', () => {
            playSound('click');
            levelSelectScreen.classList.remove('active-screen');
            welcomeScreen.classList.add('active-screen');
        });
        
        submitAnswerBtn.addEventListener('click', () => {
            playSound('click');
            checkAnswer();
        });
        
        clearInputBtn.addEventListener('click', () => {
            playSound('click');
            gameState.currentAnswer = '';
            inputDisplay.textContent = '';
            monsterContainer.classList.remove('active');
            zeroCount.textContent = '0 zeros!';
        });
        
        nextLevelBtn.addEventListener('click', () => {
            playSound('click');
            // Increment level and reset
            gameState.currentLevel = Math.min(gameState.currentLevel + 1, 2);
            levelCompleteScreen.classList.remove('active-screen');
            
            // Start new game with same mode
            startGame(gameState.currentLevel, gameState.currentMode);
        });
        
        replayLevelBtn.addEventListener('click', () => {
            playSound('click');
            levelCompleteScreen.classList.remove('active-screen');
            
            // Start new game with same level and mode
            startGame(gameState.currentLevel, gameState.currentMode);
        });
        
        backToMenuBtn.addEventListener('click', () => {
            playSound('click');
            levelCompleteScreen.classList.remove('active-screen');
            levelSelectScreen.classList.add('active-screen');
        });
        
        helpBtn.addEventListener('click', () => {
            playSound('click');
            helpContent.classList.add('active');
        });
        
        closeHelpBtn.addEventListener('click', () => {
            playSound('click');
            helpContent.classList.remove('active');
        });
        
        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            // Set up input buttons with default mode
            createInputButtons();
            
            // Set up wizard animation
            document.getElementById('wizard').style.animation = 'float 3s infinite';
        });
    </script>
</body>
</html>