<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Adventure: Solve & Explore</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Baloo 2', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #6e45e2, #88d3ce);
            color: #333;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-container {
            position: relative;
            width: 900px;
            height: 600px;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            user-select: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        h1 {
            font-size: 3em;
            margin-top: 30px;
            margin-bottom: 20px;
            text-align: center;
            color: #4b0082;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        h2 {
            font-size: 2em;
            margin-top: 20px;
            margin-bottom: 15px;
            text-align: center;
            color: #4b0082;
        }
        
        button {
            font-family: 'Baloo 2', sans-serif;
            font-size: 18px;
            padding: 12px 24px;
            margin: 10px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #FF9A00, #FF6D00);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
            outline: none;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .mode-button {
            width: 200px;
            margin: 10px 20px;
            background: linear-gradient(45deg, #4b0082, #9370DB);
            font-size: 22px;
        }
        
        .back-button {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(45deg, #6e45e2, #88d3ce);
        }
        
        .settings-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #6e45e2, #88d3ce);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            font-size: 24px;
        }
        
        .timer-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            right: 90px;
            font-size: 24px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .question-container {
            width: 80%;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .question-text {
            font-size: 28px;
            margin: 20px 0;
            color: #4b0082;
            min-height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .options-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            margin-top: 20px;
        }
        
        .option-button {
            width: 40%;
            height: 60px;
            font-size: 24px;
            background: linear-gradient(45deg, #6e45e2, #9370DB);
            border-radius: 15px;
        }
        
        .option-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .option-button.correct {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .option-button.incorrect {
            background: linear-gradient(45deg, #f44336, #FF5722);
            color: white;
        }
        
        .character {
            position: absolute;
            transition: transform 0.5s ease;
        }
        
        .message-bubble {
            position: absolute;
            background-color: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        
        .settings-panel {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 80%;
            overflow-y: auto;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }
        
        .slider-container {
            width: 60%;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4b0082;
            cursor: pointer;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8;
        }
        
        .progress-container {
            width: 80%;
            height: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #4b0082, #9370DB);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .avatar-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 40px;
        }
        
        .avatar {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .avatar:hover {
            transform: scale(1.1);
        }
        
        .avatar.selected {
            border: 4px solid #4b0082;
            transform: scale(1.1);
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 20;
        }
        
        .hint-button {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            margin-top: 20px;
        }
        
        .hint-text {
            font-size: 18px;
            padding: 10px 15px;
            background-color: rgba(3, 169, 244, 0.1);
            border-left: 4px solid #03A9F4;
            border-radius: 4px;
            margin: 10px 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .reward-image {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            display: block;
        }
        
        .checkmark {
            display: none;
            color: #4CAF50;
            font-size: 24px;
            margin-left: 10px;
        }
        
        /* Backgrounds for different modes */
        .bg-home {
            background: linear-gradient(135deg, #6e45e2, #88d3ce);
        }
        
        .bg-addition {
            background: linear-gradient(135deg, #FF9A00, #FF6D00);
        }
        
        .bg-subtraction {
            background: linear-gradient(135deg, #4b0082, #9370DB);
        }
        
        .bg-multiplication {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }
        
        .bg-division {
            background: linear-gradient(135deg, #2196F3, #03A9F4);
        }
        
        .bg-mixed {
            background: linear-gradient(135deg, #f44336, #FF5722);
        }
        
        /* Modal for different screens */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        /* Pause Menu */
        .pause-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .pause-menu {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .paused-text {
            font-size: 36px;
            color: #4b0082;
            margin-bottom: 30px;
        }
        
        /* Character Styles */
        .character-container {
            position: absolute;
            width: 150px;
            height: 200px;
            pointer-events: none;
            z-index: 5;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .sidebar {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 0;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: width 0.3s ease;
            overflow-y: auto;
            z-index: 50;
        }
        
        .sidebar.open {
            width: 300px;
        }
        
        .sidebar-content {
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .sidebar.open .sidebar-content {
            opacity: 1;
            pointer-events: auto;
        }
        
        .close-sidebar {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: #4b0082;
        }
        
        .learning-path {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            height: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .path-segment {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ddd;
            position: absolute;
            top: -2.5px;
            transform: translateX(-50%);
        }
        
        .path-segment.completed {
            background-color: #4CAF50;
        }
        
        .path-segment.current {
            background-color: #FF9A00;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.2); }
            100% { transform: translateX(-50%) scale(1); }
        }
        
        .help-content {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .celebration-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }
        
        /* Responsive adjustments */
        @media (max-width: 900px) {
            #game-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
            
            .question-text {
                font-size: 24px;
            }
            
            .option-button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Home Screen -->
        <div id="homeScreen" class="screen visible">
            <div class="background bg-home"></div>
            <h1>Algebra Adventure</h1>
            <div id="characterIntro" style="text-align: center; margin-bottom: 20px;">
                <div style="display: inline-block; margin: 0 20px;">
                    <svg width="120" height="120" viewBox="0 0 120 120">
                        <!-- Professor character -->
                        <circle cx="60" cy="40" r="25" fill="#FFD700" />
                        <ellipse cx="60" cy="95" rx="30" ry="35" fill="#1E88E5" />
                        <!-- Eyes -->
                        <circle cx="50" cy="35" r="5" fill="white" />
                        <circle cx="70" cy="35" r="5" fill="white" />
                        <circle cx="50" cy="35" r="2" fill="black" />
                        <circle cx="70" cy="35" r="2" fill="black" />
                        <!-- Glasses -->
                        <circle cx="50" cy="35" r="7" fill="none" stroke="black" stroke-width="1.5" />
                        <circle cx="70" cy="35" r="7" fill="none" stroke="black" stroke-width="1.5" />
                        <line x1="57" y1="35" x2="63" y2="35" stroke="black" stroke-width="1.5" />
                        <!-- Smile -->
                        <path d="M45,50 Q60,65 75,50" fill="none" stroke="black" stroke-width="1.5" />
                        <!-- Beard -->
                        <path d="M45,55 Q60,70 75,55 Q60,60 45,55" fill="#A0522D" />
                        <!-- Arms -->
                        <line x1="40" y1="85" x2="25" y2="75" stroke="#FFD700" stroke-width="7" stroke-linecap="round" />
                        <line x1="80" y1="85" x2="95" y2="75" stroke="#FFD700" stroke-width="7" stroke-linecap="round" />
                        <!-- Legs -->
                        <line x1="50" y1="130" x2="45" y2="145" stroke="#1E88E5" stroke-width="8" stroke-linecap="round" />
                        <line x1="70" y1="130" x2="75" y2="145" stroke="#1E88E5" stroke-width="8" stroke-linecap="round" />
                        <!-- Equation -->
                        <text x="60" y="100" font-family="Arial" font-size="16" text-anchor="middle" fill="white">Ax+B=C</text>
                    </svg>
                    <p><strong>Professor X</strong></p>
                </div>
                <div style="display: inline-block; margin: 0 20px;">
                    <svg width="120" height="120" viewBox="0 0 120 120">
                        <!-- Algebro character -->
                        <circle cx="60" cy="40" r="25" fill="#FFEB3B" />
                        <ellipse cx="60" cy="95" rx="30" ry="35" fill="#FF6D00" />
                        <!-- Eyes -->
                        <circle cx="50" cy="35" r="5" fill="white" />
                        <circle cx="70" cy="35" r="5" fill="white" />
                        <circle cx="50" cy="35" r="2" fill="black" />
                        <circle cx="70" cy="35" r="2" fill="black" />
                        <!-- Smile -->
                        <path d="M45,50 Q60,65 75,50" fill="none" stroke="black" stroke-width="1.5" />
                        <!-- Arms -->
                        <line x1="40" y1="85" x2="25" y2="95" stroke="#FFEB3B" stroke-width="7" stroke-linecap="round" />
                        <line x1="80" y1="85" x2="95" y2="95" stroke="#FFEB3B" stroke-width="7" stroke-linecap="round" />
                        <!-- Legs -->
                        <line x1="50" y1="125" x2="45" y2="145" stroke="#FF6D00" stroke-width="8" stroke-linecap="round" />
                        <line x1="70" y1="125" x2="75" y2="145" stroke="#FF6D00" stroke-width="8" stroke-linecap="round" />
                        <!-- Variable -->
                        <text x="60" y="45" font-family="Arial" font-size="24" text-anchor="middle" fill="#FF5722" font-weight="bold">x</text>
                    </svg>
                    <p><strong>Algebro</strong></p>
                </div>
            </div>
            <p style="font-size: 18px; max-width: 80%; text-align: center; margin-bottom: 30px;">
                Join Professor X and Algebro on an exciting journey through the world of algebra! 
                Solve equations, unlock achievements, and become a true algebra master!
            </p>
            <div id="modeSelection" style="display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px;">
                <button class="mode-button" data-mode="Addition">Addition</button>
                <button class="mode-button" data-mode="Subtraction">Subtraction</button>
                <button class="mode-button" data-mode="Multiplication">Multiplication</button>
                <button class="mode-button" data-mode="Division">Division</button>
                <button class="mode-button" data-mode="Mixed">Mixed Challenge</button>
            </div>
            <button id="helpButton" style="margin-top: 20px; background: linear-gradient(45deg, #2196F3, #03A9F4);">How to Play</button>
            <button id="settingsButton" class="settings-button">⚙️</button>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div id="gameBackground" class="background"></div>
            <div class="timer-display">Time: <span id="timerValue">60</span>s</div>
            <div class="score-display">Score: <span id="scoreValue">0</span></div>
            
            <div class="question-container">
                <div class="question-text" id="questionText">Loading question...</div>
                <div class="options-container" id="optionsContainer">
                    <button class="option-button" data-index="0"></button>
                    <button class="option-button" data-index="1"></button>
                    <button class="option-button" data-index="2"></button>
                    <button class="option-button" data-index="3"></button>
                </div>
                <button id="hintButton" class="hint-button">Show Hint</button>
                <div id="hintText" class="hint-text"></div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div id="characterProfessor" class="character-container" style="left: 30px; bottom: 30px;">
                <svg width="120" height="150" viewBox="0 0 120 150">
                    <!-- Professor character -->
                    <circle cx="60" cy="40" r="25" fill="#FFD700" />
                    <ellipse cx="60" cy="95" rx="30" ry="35" fill="#1E88E5" />
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2" fill="black" />
                    <circle cx="70" cy="35" r="2" fill="black" />
                    <!-- Glasses -->
                    <circle cx="50" cy="35" r="7" fill="none" stroke="black" stroke-width="1.5" />
                    <circle cx="70" cy="35" r="7" fill="none" stroke="black" stroke-width="1.5" />
                    <line x1="57" y1="35" x2="63" y2="35" stroke="black" stroke-width="1.5" />
                    <!-- Smile -->
                    <path d="M45,50 Q60,65 75,50" fill="none" stroke="black" stroke-width="1.5" />
                    <!-- Beard -->
                    <path d="M45,55 Q60,70 75,55 Q60,60 45,55" fill="#A0522D" />
                    <!-- Arms -->
                    <line x1="40" y1="85" x2="25" y2="75" stroke="#FFD700" stroke-width="7" stroke-linecap="round" />
                    <line x1="80" y1="85" x2="95" y2="75" stroke="#FFD700" stroke-width="7" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="characterAlgebro" class="character-container" style="right: 30px; bottom: 30px;">
                <svg width="120" height="150" viewBox="0 0 120 150">
                    <!-- Algebro character -->
                    <circle cx="60" cy="40" r="25" fill="#FFEB3B" />
                    <ellipse cx="60" cy="95" rx="30" ry="35" fill="#FF6D00" />
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2" fill="black" />
                    <circle cx="70" cy="35" r="2" fill="black" />
                    <!-- Smile -->
                    <path d="M45,50 Q60,65 75,50" fill="none" stroke="black" stroke-width="1.5" />
                    <!-- Arms -->
                    <line x1="40" y1="85" x2="25" y2="95" stroke="#FFEB3B" stroke-width="7" stroke-linecap="round" />
                    <line x1="80" y1="85" x2="95" y2="95" stroke="#FFEB3B" stroke-width="7" stroke-linecap="round" />
                    <!-- Variable -->
                    <text x="60" y="45" font-family="Arial" font-size="24" text-anchor="middle" fill="#FF5722" font-weight="bold">x</text>
                </svg>
            </div>
            
            <div id="professorBubble" class="message-bubble" style="left: 150px; bottom: 150px;">
                Let's solve this equation together!
            </div>
            
            <div id="algebraBubble" class="message-bubble" style="right: 150px; bottom: 150px;">
                You can do it! Find the value of x!
            </div>
            
            <button id="pauseButton" style="position: absolute; top: 20px; right: 90px; border-radius: 50%; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; padding: 0; font-size: 24px;">⏸️</button>
            <button id="backToHomeButton" class="back-button">Home</button>
        </div>
        
        <!-- Reward Screen -->
        <div id="rewardScreen" class="screen">
            <div class="background bg-home"></div>
            <h1>Congratulations!</h1>
            <div id="rewardText" style="font-size: 24px; text-align: center; margin: 20px 0;">
                You're becoming a true Algebra Master!
            </div>
            
            <div id="rewardAnimation" style="width: 300px; height: 300px; margin: 20px auto;">
                <!-- Trophy SVG -->
                <svg width="300" height="300" viewBox="0 0 300 300">
                    <!-- Trophy cup -->
                    <path d="M100,50 L200,50 Q240,50 240,90 Q240,150 200,150 Q170,170 170,200 L130,200 Q130,170 100,150 Q60,150 60,90 Q60,50 100,50" fill="#FFD700" />
                    <!-- Base -->
                    <rect x="110" y="200" width="80" height="20" fill="#A67C00" />
                    <rect x="90" y="220" width="120" height="20" fill="#8D6E00" />
                    <!-- Equation -->
                    <text x="150" y="120" font-family="Arial" font-size="24" text-anchor="middle" fill="#4b0082" font-weight="bold">Ax+B=C</text>
                    <line x1="125" y1="130" x2="175" y2="130" stroke="#4b0082" stroke-width="3" />
                    <text x="150" y="160" font-family="Arial" font-size="24" text-anchor="middle" fill="#4b0082" font-weight="bold">Solved!</text>
                </svg>
            </div>
            
            <div id="achievementUnlocked" style="font-size: 20px; text-align: center; margin: 20px 0; color: #4b0082;">
                Achievement Unlocked: Equation Explorer
            </div>
            
            <div id="statsContainer" style="display: flex; justify-content: space-around; margin: 20px auto; max-width: 500px;">
                <div class="stat">
                    <div style="font-size: 36px; font-weight: bold; color: #4b0082;" id="finalScore">0</div>
                    <div>Score</div>
                </div>
                <div class="stat">
                    <div style="font-size: 36px; font-weight: bold; color: #4b0082;" id="problemsSolved">0</div>
                    <div>Problems Solved</div>
                </div>
                <div class="stat">
                    <div style="font-size: 36px; font-weight: bold; color: #4b0082;" id="timeBonus">0</div>
                    <div>Time Bonus</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: center; margin-top: 20px;">
                <button id="nextLevelButton">Next Level</button>
                <button id="rewardHomeButton" class="back-button" style="position: static; margin-left: 20px;">Home</button>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content settings-panel">
                <h2>Game Settings</h2>
                
                <div class="settings-row">
                    <label>Difficulty Level:</label>
                    <div class="slider-container">
                        <input type="range" min="1" max="5" value="3" class="slider" id="difficultySlider">
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span>Easy</span>
                            <span>Hard</span>
                        </div>
                    </div>
                    <span id="difficultyValue">3</span>
                </div>
                
                <div class="settings-row">
                    <label>Time Limit (seconds):</label>
                    <div class="slider-container">
                        <input type="range" min="30" max="120" value="60" step="10" class="slider" id="timeSlider">
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span>30s</span>
                            <span>120s</span>
                        </div>
                    </div>
                    <span id="timeValue">60</span>
                </div>
                
                <div class="settings-row">
                    <label>Sound Volume:</label>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="70" class="slider" id="volumeSlider">
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span>Off</span>
                            <span>Loud</span>
                        </div>
                    </div>
                    <span id="volumeValue">70%</span>
                </div>
                
                <div class="settings-row">
                    <label>Max Number in Problems:</label>
                    <div class="slider-container">
                        <input type="range" min="5" max="30" value="12" class="slider" id="maxNumberSlider">
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span>5</span>
                            <span>30</span>
                        </div>
                    </div>
                    <span id="maxNumberValue">12</span>
                </div>
                
                <div class="settings-row">
                    <label>Color Theme:</label>
                    <select id="themeSelect" style="padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="default">Colorful (Default)</option>
                        <option value="dark">Dark Mode</option>
                        <option value="light">Light Mode</option>
                        <option value="contrast">High Contrast</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label>Show Animations:</label>
                    <input type="checkbox" id="animationsCheckbox" checked style="width: 20px; height: 20px;">
                </div>
                
                <div class="settings-row">
                    <label>Show Character Tips:</label>
                    <input type="checkbox" id="tipsCheckbox" checked style="width: 20px; height: 20px;">
                </div>
                
                <button id="saveSettingsButton" style="margin-top: 20px;">Save Settings</button>
                <button id="closeSettingsButton" style="margin-top: 10px; background: linear-gradient(45deg, #6e45e2, #88d3ce);">Cancel</button>
            </div>
        </div>
        
        <!-- Help Modal -->
        <div id="helpModal" class="modal">
            <div class="modal-content">
                <h2>How to Play Algebra Adventure</h2>
                
                <div class="help-content">
                    <h3>Welcome to the Exciting World of Algebra!</h3>
                    <p>
                        In Algebra Adventure, you'll learn how to solve equations step by step with the help of 
                        Professor X and Algebro. Here's how to play:
                    </p>
                    
                    <h3>Game Modes:</h3>
                    <ul style="text-align: left;">
                        <li><strong>Addition:</strong> Solve equations like 3x + 5 = 20</li>
                        <li><strong>Subtraction:</strong> Solve equations like 4x - 7 = 13</li>
                        <li><strong>Multiplication:</strong> Solve equations like 5x × 3 = 45</li>
                        <li><strong>Division:</strong> Solve equations like 8x ÷ 4 = 6</li>
                        <li><strong>Mixed Challenge:</strong> A mix of all operations!</li>
                    </ul>
                    
                    <h3>How to Solve Algebra Problems:</h3>
                    <p>Let's learn how to solve a basic equation like 3x + 5 = 20:</p>
                    
                    <div style="background-color: #f5f5f5; padding: 15px; border-radius: 10px; margin: 10px 0; text-align: left;">
                        <p><strong>Step 1:</strong> Subtract 5 from both sides to isolate the term with x.</p>
                        <p style="margin-left: 20px;">3x + 5 - 5 = 20 - 5</p>
                        <p style="margin-left: 20px;">3x = 15</p>
                        
                        <p><strong>Step 2:</strong> Divide both sides by 3 to find the value of x.</p>
                        <p style="margin-left: 20px;">3x ÷ 3 = 15 ÷ 3</p>
                        <p style="margin-left: 20px;">x = 5</p>
                        
                        <p><strong>Step 3:</strong> Check your answer by substituting x = 5 back into the original equation.</p>
                        <p style="margin-left: 20px;">3 × 5 + 5 = 20</p>
                        <p style="margin-left: 20px;">15 + 5 = 20</p>
                        <p style="margin-left: 20px;">20 = 20 ✓</p>
                    </div>
                    
                    <h3>Tips for Success:</h3>
                    <ul style="text-align: left;">
                        <li>Always undo addition/subtraction first, then multiplication/division</li>
                        <li>Use the hint button if you get stuck</li>
                        <li>Practice each operation separately before trying Mixed mode</li>
                        <li>Press 'P' to pause the game anytime</li>
                        <li>Adjust difficulty and time in Settings to match your skill level</li>
                    </ul>
                    
                    <p>Ready to become an algebra master? Let's solve some equations!</p>
                </div>
                
                <button id="closeHelpButton">Got It!</button>
            </div>
        </div>
        
        <!-- Pause Overlay -->
        <div id="pauseOverlay" class="pause-overlay">
            <div class="pause-menu">
                <div class="paused-text">GAME PAUSED</div>
                <p>Press 'P' or click Resume to continue playing</p>
                <button id="resumeButton">Resume Game</button>
                <button id="pauseHomeButton" style="background: linear-gradient(45deg, #6e45e2, #88d3ce);">Return to Home</button>
            </div>
        </div>
        
        <!-- Sidebar for Learning Resources -->
        <div id="sidebar" class="sidebar">
            <div class="sidebar-content">
                <button class="close-sidebar">×</button>
                <h2>Algebra Concepts</h2>
                
                <div class="concept-section">
                    <h3>What is Algebra?</h3>
                    <p>
                        Algebra is a branch of mathematics that uses letters (variables) to represent unknown numbers. 
                        It helps us solve problems and find unknown values.
                    </p>
                    
                    <h3>Variables & Constants</h3>
                    <p>
                        <strong>Variables</strong> are letters like x, y, z that represent unknown values.
                        <br>
                        <strong>Constants</strong> are fixed numbers like 5, 42, or 100.
                    </p>
                    
                    <h3>Basic Equation Forms</h3>
                    <ul style="text-align: left;">
                        <li><strong>Addition:</strong> ax + b = c</li>
                        <li><strong>Subtraction:</strong> ax - b = c</li>
                        <li><strong>Multiplication:</strong> ax × b = c</li>
                        <li><strong>Division:</strong> ax ÷ b = c</li>
                    </ul>
                    
                    <h3>Solving Equations Step by Step</h3>
                    <p>Always follow these steps:</p>
                    <ol style="text-align: left;">
                        <li>Move all variable terms to one side</li>
                        <li>Move all constant terms to the other side</li>
                        <li>Combine like terms if needed</li>
                        <li>Isolate the variable by dividing both sides</li>
                        <li>Check your answer</li>
                    </ol>
                    
                    <h3>Real-World Applications</h3>
                    <p>
                        Algebra helps us solve many practical problems:
                    </p>
                    <ul style="text-align: left;">
                        <li>Calculating distances and speeds</li>
                        <li>Finding unknown quantities in recipes</li>
                        <li>Determining how much something will cost</li>
                        <li>Planning how much time you need for tasks</li>
                    </ul>
                </div>
                
                <button id="showMoreConceptsButton" style="margin-top: 20px;">Show Advanced Concepts</button>
            </div>
        </div>
        
        <!-- Celebration container for particles -->
        <div id="celebrationContainer" class="celebration-container"></div>
    </div>

    <script>
        // Game state object
        const gameState = {
            currentMode: null,
            score: 0,
            problemsSolved: 0,
            correctAnswer: null,
            timerSeconds: 60,
            maxNumber: 12,
            difficultyLevel: 3,
            soundVolume: 0.7,
            showAnimations: true,
            showTips: true,
            paused: false,
            audioContext: null,
            currentLevel: 1,
            maxLevel: 10,
            progress: 0,
            userAnswer: null,
            hints: {
                addition: "Add the constant to both sides, then divide by the coefficient.",
                subtraction: "Add the constant to both sides, then divide by the coefficient.",
                multiplication: "Divide both sides by the constant, then solve for x.",
                division: "Multiply both sides by the divisor, then solve for x.",
                mixed: "Identify the operation, then isolate x using inverse operations."
            },
            characterMessages: {
                professor: {
                    start: "Welcome to algebra! Let's solve some equations.",
                    correct: [
                        "Excellent work! You're getting the hang of it!",
                        "Perfect! You solved it correctly!",
                        "Bravo! That's exactly right!",
                        "Excellent algebraic thinking!",
                        "You're becoming an algebra master!"
                    ],
                    incorrect: [
                        "Not quite. Remember to isolate the variable first.",
                        "Let's try again. Check your calculations.",
                        "Almost there! Remember the order of operations.",
                        "Close, but not quite. Let's review the steps.",
                        "Keep trying! Algebra takes practice."
                    ],
                    hint: [
                        "Try to get the x term by itself on one side.",
                        "Remember to apply the same operation to both sides.",
                        "First, remove any constants from the variable side.",
                        "Think about what operation will isolate the variable.",
                        "The key is to use inverse operations to solve for x."
                    ]
                },
                algebro: {
                    start: "I'm Algebro! Find the value of x to win!",
                    correct: [
                        "Wow! You're a natural at this!",
                        "That's it! You found me!",
                        "You solved for x perfectly!",
                        "You're getting really good at finding x!",
                        "Amazing algebraic skills!"
                    ],
                    incorrect: [
                        "Not me! Keep looking for the right value of x.",
                        "That's not my value. Try another approach.",
                        "I'm hiding at a different value. Keep solving!",
                        "Almost found me! Double-check your math.",
                        "Not yet! Remember to check your solution."
                    ],
                    hint: [
                        "Remember to balance the equation like a scale.",
                        "What you do to one side, do to the other!",
                        "Look for the pattern in the equation.",
                        "Try working backwards from the answer.",
                        "Divide both sides by the coefficient to find me!"
                    ]
                }
            },
            timerId: null,
            animations: {
                confetti: [],
                stars: [],
                timers: []
            }
        };

        // DOM Elements
        const elements = {
            screens: {
                homeScreen: document.getElementById('homeScreen'),
                gameScreen: document.getElementById('gameScreen'),
                rewardScreen: document.getElementById('rewardScreen')
            },
            displays: {
                timerValue: document.getElementById('timerValue'),
                scoreValue: document.getElementById('scoreValue'),
                questionText: document.getElementById('questionText'),
                optionsContainer: document.getElementById('optionsContainer'),
                progressBar: document.getElementById('progressBar'),
                hintText: document.getElementById('hintText'),
                rewardText: document.getElementById('rewardText'),
                finalScore: document.getElementById('finalScore'),
                problemsSolved: document.getElementById('problemsSolved'),
                timeBonus: document.getElementById('timeBonus'),
                difficultyValue: document.getElementById('difficultyValue'),
                timeValue: document.getElementById('timeValue'),
                volumeValue: document.getElementById('volumeValue'),
                maxNumberValue: document.getElementById('maxNumberValue'),
                gameBackground: document.getElementById('gameBackground')
            },
            buttons: {
                modeButtons: document.querySelectorAll('.mode-button'),
                optionButtons: document.querySelectorAll('.option-button'),
                hintButton: document.getElementById('hintButton'),
                pauseButton: document.getElementById('pauseButton'),
                backToHomeButton: document.getElementById('backToHomeButton'),
                nextLevelButton: document.getElementById('nextLevelButton'),
                rewardHomeButton: document.getElementById('rewardHomeButton'),
                settingsButton: document.getElementById('settingsButton'),
                saveSettingsButton: document.getElementById('saveSettingsButton'),
                closeSettingsButton: document.getElementById('closeSettingsButton'),
                helpButton: document.getElementById('helpButton'),
                closeHelpButton: document.getElementById('closeHelpButton'),
                resumeButton: document.getElementById('resumeButton'),
                pauseHomeButton: document.getElementById('pauseHomeButton'),
                showMoreConceptsButton: document.getElementById('showMoreConceptsButton')
            },
            characters: {
                professor: document.getElementById('characterProfessor'),
                algebro: document.getElementById('characterAlgebro'),
                professorBubble: document.getElementById('professorBubble'),
                algebraBubble: document.getElementById('algebraBubble')
            },
            modals: {
                settingsModal: document.getElementById('settingsModal'),
                helpModal: document.getElementById('helpModal')
            },
            pauseOverlay: document.getElementById('pauseOverlay'),
            sidebar: document.getElementById('sidebar'),
            celebrationContainer: document.getElementById('celebrationContainer')
        };

        // Sliders
        const sliders = {
            difficulty: document.getElementById('difficultySlider'),
            time: document.getElementById('timeSlider'),
            volume: document.getElementById('volumeSlider'),
            maxNumber: document.getElementById('maxNumberSlider')
        };

        // Game Initialization
        function initGame() {
            // Initialize audio context
            try {
                gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API not supported.');
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Create learning path
            createLearningPath();
            
            // Hide all screens except home screen
            showScreen('homeScreen');
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Mode selection
            elements.buttons.modeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    gameState.currentMode = button.getAttribute('data-mode');
                    startGame();
                });
            });
            
            // Option buttons
            elements.buttons.optionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    checkAnswer(button.textContent);
                });
            });
            
            // Hint button
            elements.buttons.hintButton.addEventListener('click', toggleHint);
            
            // Back button
            elements.buttons.backToHomeButton.addEventListener('click', goToHomeScreen);
            
            // Pause button
            elements.buttons.pauseButton.addEventListener('click', togglePause);
            
            // Resume button
            elements.buttons.resumeButton.addEventListener('click', togglePause);
            
            // Pause home button
            elements.buttons.pauseHomeButton.addEventListener('click', goToHomeScreen);
            
            // Next level button
            elements.buttons.nextLevelButton.addEventListener('click', nextLevel);
            
            // Reward home button
            elements.buttons.rewardHomeButton.addEventListener('click', goToHomeScreen);
            
            // Settings button
            elements.buttons.settingsButton.addEventListener('click', () => {
                elements.modals.settingsModal.classList.add('visible');
            });
            
            // Save settings button
            elements.buttons.saveSettingsButton.addEventListener('click', saveSettings);
            
            // Close settings button
            elements.buttons.closeSettingsButton.addEventListener('click', () => {
                elements.modals.settingsModal.classList.remove('visible');
            });
            
            // Help button
            elements.buttons.helpButton.addEventListener('click', () => {
                elements.modals.helpModal.classList.add('visible');
            });
            
            // Close help button
            elements.buttons.closeHelpButton.addEventListener('click', () => {
                elements.modals.helpModal.classList.remove('visible');
            });
            
            // Show more concepts button
            elements.buttons.showMoreConceptsButton.addEventListener('click', toggleMoreConcepts);
            
            // Close sidebar button
            document.querySelector('.close-sidebar').addEventListener('click', () => {
                elements.sidebar.classList.remove('open');
            });
            
            // Keyboard events
            document.addEventListener('keydown', (e) => {
                // 'P' key for pause
                if (e.key === 'p' || e.key === 'P') {
                    togglePause();
                }
                
                // Number keys for answering
                if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    if (index >= 0 && index < elements.buttons.optionButtons.length) {
                        const optionButton = elements.buttons.optionButtons[index];
                        if (optionButton.disabled === false) {
                            checkAnswer(optionButton.textContent);
                        }
                    }
                }
                
                // 'H' key for hint
                if (e.key === 'h' || e.key === 'H') {
                    toggleHint();
                }
            });
            
            // Sliders event listeners
            sliders.difficulty.addEventListener('input', () => {
                elements.displays.difficultyValue.textContent = sliders.difficulty.value;
            });
            
            sliders.time.addEventListener('input', () => {
                elements.displays.timeValue.textContent = sliders.time.value;
            });
            
            sliders.volume.addEventListener('input', () => {
                elements.displays.volumeValue.textContent = sliders.volume.value + '%';
            });
            
            sliders.maxNumber.addEventListener('input', () => {
                elements.displays.maxNumberValue.textContent = sliders.maxNumber.value;
            });
        }

        // Start Game
        function startGame() {
            // Reset game state
            gameState.score = 0;
            gameState.problemsSolved = 0;
            gameState.timerSeconds = parseInt(sliders.time.value);
            gameState.paused = false;
            
            // Update UI
            elements.displays.scoreValue.textContent = gameState.score;
            elements.displays.timerValue.textContent = gameState.timerSeconds;
            
            // Set background based on mode
            elements.displays.gameBackground.className = `background bg-${gameState.currentMode.toLowerCase()}`;
            
            // Show game screen
            showScreen('gameScreen');
            
            // Generate first question
            generateQuestion();
            
            // Start timer
            startTimer();
            
            // Show welcome message
            if (gameState.showTips) {
                showMessage(elements.characters.professorBubble, gameState.characterMessages.professor.start);
                showMessage(elements.characters.algebraBubble, gameState.characterMessages.algebro.start);
            }
        }

        // Generate Question
        function generateQuestion() {
            // Generate algebra problem based on current mode
            const problem = generateAlgebraProblem(gameState.currentMode);
            
            // Update question text
            elements.displays.questionText.innerHTML = problem.questionText;
            
            // Store correct answer
            gameState.correctAnswer = problem.correctAnswer;
            
            // Generate answer options
            const options = generateOptions(problem.correctAnswer);
            
            // Update option buttons
            elements.buttons.optionButtons.forEach((button, index) => {
                button.textContent = options[index];
                button.classList.remove('correct', 'incorrect');
                button.disabled = false;
            });
            
            // Set hint text based on current mode
            elements.displays.hintText.textContent = gameState.hints[gameState.currentMode.toLowerCase()];
            elements.displays.hintText.style.opacity = '0';
            
            // Update progress
            updateProgress();
        }

        // Generate Algebra Problem
        function generateAlgebraProblem(mode) {
            // Get max number from settings, adjusted by difficulty
            const maxNum = parseInt(sliders.maxNumber.value);
            const difficulty = parseInt(sliders.difficulty.value);
            
            // Adjust coefficient range based on difficulty
            const minCoefficient = Math.max(1, Math.floor(difficulty / 2));
            const maxCoefficient = Math.min(maxNum, Math.floor(difficulty * 2));
            
            // Generate coefficient and constants based on difficulty
            const a = Math.floor(Math.random() * (maxCoefficient - minCoefficient + 1)) + minCoefficient;
            
            // Solution (x value) - keep it reasonable for kids
            const solution = Math.floor(Math.random() * 10) + 1;
            
            let b, result, questionText;
            
            // Create problem based on mode
            switch(mode) {
                case 'Addition':
                    b = Math.floor(Math.random() * maxNum) + 1;
                    result = (a * solution) + b;
                    questionText = `<span style="font-size: 1.5em">Solve for x:<br>${a}x + ${b} = ${result}</span>`;
                    break;
                    
                case 'Subtraction':
                    b = Math.floor(Math.random() * maxNum) + 1;
                    result = (a * solution) - b;
                    questionText = `<span style="font-size: 1.5em">Solve for x:<br>${a}x - ${b} = ${result}</span>`;
                    break;
                    
                case 'Multiplication':
                    b = Math.floor(Math.random() * (maxNum / 2)) + 1;
                    result = (a * solution) * b;
                    questionText = `<span style="font-size: 1.5em">Solve for x:<br>${a}x × ${b} = ${result}</span>`;
                    break;
                    
                case 'Division':
                    b = Math.floor(Math.random() * (maxNum / 2)) + 1;
                    // To avoid decimal answers, ensure clean division
                    result = Math.floor((a * solution) / b);
                    // Adjust to ensure result * b = a * solution
                    const adjustedSolution = (result * b) / a;
                    if (Number.isInteger(adjustedSolution)) {
                        questionText = `<span style="font-size: 1.5em">Solve for x:<br>${a}x ÷ ${b} = ${result}</span>`;
                        return { questionText, correctAnswer: adjustedSolution };
                    } else {
                        // If not a clean division, create a new one
                        return generateAlgebraProblem(mode);
                    }
                    
                case 'Mixed':
                    // Randomly select an operation
                    const operations = ['Addition', 'Subtraction', 'Multiplication', 'Division'];
                    const randomOp = operations[Math.floor(Math.random() * operations.length)];
                    return generateAlgebraProblem(randomOp);
                    
                default:
                    // Default to addition if mode is not recognized
                    b = Math.floor(Math.random() * maxNum) + 1;
                    result = (a * solution) + b;
                    questionText = `<span style="font-size: 1.5em">Solve for x:<br>${a}x + ${b} = ${result}</span>`;
            }
            
            return { questionText, correctAnswer: solution };
        }

        // Generate Answer Options
        function generateOptions(correctAnswer) {
            const options = [correctAnswer.toString()];
            
            // Generate plausible distractors
            while (options.length < 4) {
                // Create variations close to the correct answer
                let distractor;
                const rand = Math.random();
                
                if (rand < 0.25) {
                    // Off by one
                    distractor = correctAnswer + 1;
                } else if (rand < 0.5) {
                    // Off by one in the other direction
                    distractor = Math.max(1, correctAnswer - 1);
                } else if (rand < 0.75) {
                    // Double or half
                    distractor = Math.random() < 0.5 ? correctAnswer * 2 : Math.max(1, Math.floor(correctAnswer / 2));
                } else {
                    // Random offset
                    const offset = Math.floor(Math.random() * 5) + 1;
                    distractor = Math.max(1, Math.abs(correctAnswer + (Math.random() < 0.5 ? offset : -offset)));
                }
                
                // Ensure no duplicates
                if (!options.includes(distractor.toString())) {
                    options.push(distractor.toString());
                }
            }
            
            // Shuffle options
            return shuffleArray(options);
        }

        // Check Answer
        function checkAnswer(selectedAnswer) {
            // Ignore if paused
            if (gameState.paused) return;
            
            // Parse selected answer
            const selected = parseInt(selectedAnswer);
            
            // Disable all option buttons
            elements.buttons.optionButtons.forEach(button => {
                button.disabled = true;
                
                // Highlight correct answer
                if (parseInt(button.textContent) === gameState.correctAnswer) {
                    button.classList.add('correct');
                } 
                // Highlight selected incorrect answer
                else if (button.textContent === selectedAnswer && selected !== gameState.correctAnswer) {
                    button.classList.add('incorrect');
                }
            });
            
            // Check if correct
            if (selected === gameState.correctAnswer) {
                // Correct answer
                gameState.score++;
                gameState.problemsSolved++;
                
                // Update score display
                elements.displays.scoreValue.textContent = gameState.score;
                
                // Play success sound
                playSuccessSound();
                
                // Create celebration effect
                if (gameState.showAnimations) {
                    createConfetti();
                }
                
                // Show character messages
                if (gameState.showTips) {
                    const professorMessage = getRandomMessage(gameState.characterMessages.professor.correct);
                    const algebraMessage = getRandomMessage(gameState.characterMessages.algebro.correct);
                    
                    showMessage(elements.characters.professorBubble, professorMessage);
                    showMessage(elements.characters.algebraBubble, algebraMessage);
                }
                
                // Check if level complete (5 correct answers)
                if (gameState.score >= 5) {
                    // Stop timer
                    clearInterval(gameState.timerId);
                    
                    // Show celebration and go to reward screen after delay
                    setTimeout(() => {
                        showRewardScreen();
                    }, 1500);
                } else {
                    // Next question after delay
                    setTimeout(() => {
                        generateQuestion();
                    }, 1500);
                }
            } else {
                // Incorrect answer
                gameState.problemsSolved++;
                
                // Play error sound
                playErrorSound();
                
                // Show character messages
                if (gameState.showTips) {
                    const professorMessage = getRandomMessage(gameState.characterMessages.professor.incorrect);
                    const algebraMessage = getRandomMessage(gameState.characterMessages.algebro.incorrect);
                    
                    showMessage(elements.characters.professorBubble, professorMessage);
                    showMessage(elements.characters.algebraBubble, algebraMessage);
                }
                
                // Next question after delay
                setTimeout(() => {
                    generateQuestion();
                }, 2000);
            }
        }

        // Timer Functions
        function startTimer() {
            // Clear any existing timer
            if (gameState.timerId) {
                clearInterval(gameState.timerId);
            }
            
            // Set timer value from settings
            gameState.timerSeconds = parseInt(sliders.time.value);
            elements.displays.timerValue.textContent = gameState.timerSeconds;
            
            // Start interval
            gameState.timerId = setInterval(() => {
                // Only count down if not paused
                if (!gameState.paused) {
                    gameState.timerSeconds--;
                    elements.displays.timerValue.textContent = gameState.timerSeconds;
                    
                    // Play tick sound when 10 seconds or less
                    if (gameState.timerSeconds <= 10) {
                        playTickSound();
                    }
                    
                    // Check if time's up
                    if (gameState.timerSeconds <= 0) {
                        clearInterval(gameState.timerId);
                        
                        // Play error sound
                        playErrorSound();
                        
                        // Show time's up message
                        if (gameState.showTips) {
                            showMessage(elements.characters.professorBubble, "Time's up! Let's try a new question.");
                        }
                        
                        // Next question
                        setTimeout(() => {
                            generateQuestion();
                            startTimer();
                        }, 1500);
                    }
                }
            }, 1000);
        }

        // Pause Game
        function togglePause() {
            // Only toggle pause if in game screen
            if (elements.screens.gameScreen.classList.contains('visible')) {
                gameState.paused = !gameState.paused;
                
                if (gameState.paused) {
                    // Show pause overlay
                    elements.pauseOverlay.style.opacity = '1';
                    elements.pauseOverlay.style.pointerEvents = 'auto';
                    
                    // Play pause sound
                    playButtonSound();
                } else {
                    // Hide pause overlay
                    elements.pauseOverlay.style.opacity = '0';
                    elements.pauseOverlay.style.pointerEvents = 'none';
                    
                    // Play resume sound
                    playSelectSound();
                }
            }
        }

        // Show Reward Screen
        function showRewardScreen() {
            // Calculate time bonus
            const timeBonus = Math.floor(gameState.timerSeconds / 10);
            
            // Update reward screen stats
            elements.displays.finalScore.textContent = gameState.score;
            elements.displays.problemsSolved.textContent = gameState.problemsSolved;
            elements.displays.timeBonus.textContent = timeBonus;
            
            // Update reward text based on score
            if (gameState.score >= 5) {
                elements.displays.rewardText.textContent = "Amazing! You're an Algebra Master!";
            } else if (gameState.score >= 3) {
                elements.displays.rewardText.textContent = "Great job! You're getting really good with algebra!";
            } else {
                elements.displays.rewardText.textContent = "Good effort! Keep practicing to master algebra!";
            }
            
            // Play celebration sound
            playCelebrationSound();
            
            // Create reward animation
            if (gameState.showAnimations) {
                createConfetti();
            }
            
            // Show reward screen
            showScreen('rewardScreen');
        }

        // Go to Next Level
        function nextLevel() {
            // Increment level
            gameState.currentLevel++;
            
            // Cap at max level
            if (gameState.currentLevel > gameState.maxLevel) {
                gameState.currentLevel = gameState.maxLevel;
            }
            
            // Update learning path
            updateLearningPath();
            
            // Increase difficulty slightly
            const newDifficulty = Math.min(5, parseInt(sliders.difficulty.value) + 1);
            sliders.difficulty.value = newDifficulty;
            elements.displays.difficultyValue.textContent = newDifficulty;
            
            // Start game with current mode
            startGame();
        }

        // Go to Home Screen
        function goToHomeScreen() {
            // Clear timer
            if (gameState.timerId) {
                clearInterval(gameState.timerId);
                gameState.timerId = null;
            }
            
            // Reset pause state
            gameState.paused = false;
            elements.pauseOverlay.style.opacity = '0';
            elements.pauseOverlay.style.pointerEvents = 'none';
            
            // Play button sound
            playButtonSound();
            
            // Show home screen
            showScreen('homeScreen');
        }

        // Show/Hide Screens
        function showScreen(screenName) {
            // Hide all screens
            Object.values(elements.screens).forEach(screen => {
                screen.classList.remove('visible');
            });
            
            // Show requested screen
            elements.screens[screenName].classList.add('visible');
        }

        // Toggle Hint
        function toggleHint() {
            const hintText = elements.displays.hintText;
            
            if (hintText.style.opacity === '1') {
                hintText.style.opacity = '0';
            } else {
                hintText.style.opacity = '1';
                
                // Show character hint messages
                if (gameState.showTips) {
                    const professorHint = getRandomMessage(gameState.characterMessages.professor.hint);
                    const algebraHint = getRandomMessage(gameState.characterMessages.algebro.hint);
                    
                    showMessage(elements.characters.professorBubble, professorHint);
                    showMessage(elements.characters.algebraBubble, algebraHint);
                }
                
                // Play hint sound
                playSelectSound();
                
                // Auto-hide after 6 seconds
                setTimeout(() => {
                    hintText.style.opacity = '0';
                }, 6000);
            }
        }

        // Show Character Message
        function showMessage(bubbleElement, message) {
            // Set message text
            bubbleElement.textContent = message;
            
            // Show bubble
            bubbleElement.style.opacity = '1';
            
            // Auto-hide after delay based on message length
            const delay = Math.max(3000, message.length * 50);
            setTimeout(() => {
                bubbleElement.style.opacity = '0';
            }, delay);
        }

        // Save Settings
        function saveSettings() {
            // Update game state with settings values
            gameState.difficultyLevel = parseInt(sliders.difficulty.value);
            gameState.timerSeconds = parseInt(sliders.time.value);
            gameState.soundVolume = parseInt(sliders.volume.value) / 100;
            gameState.maxNumber = parseInt(sliders.maxNumber.value);
            
            // Update display values
            elements.displays.timerValue.textContent = gameState.timerSeconds;
            
            // Get checkbox values
            gameState.showAnimations = document.getElementById('animationsCheckbox').checked;
            gameState.showTips = document.getElementById('tipsCheckbox').checked;
            
            // Apply theme
            applyTheme(document.getElementById('themeSelect').value);
            
            // Close settings modal
            elements.modals.settingsModal.classList.remove('visible');
            
            // Play confirmation sound
            playSuccessSound();
        }

        // Create Learning Path
        function createLearningPath() {
            const pathContainer = document.querySelector('.learning-path');
            
            // Clear any existing segments
            pathContainer.innerHTML = '';
            
            // Create segments for each level
            for (let i = 0; i < gameState.maxLevel; i++) {
                const segment = document.createElement('div');
                segment.className = 'path-segment';
                segment.style.left = `${(i / (gameState.maxLevel - 1)) * 100}%`;
                segment.setAttribute('data-level', i + 1);
                pathContainer.appendChild(segment);
            }
            
            // Update learning path
            updateLearningPath();
        }

        // Update Learning Path
        function updateLearningPath() {
            const segments = document.querySelectorAll('.path-segment');
            
            segments.forEach((segment, index) => {
                const level = index + 1;
                
                if (level < gameState.currentLevel) {
                    segment.className = 'path-segment completed';
                } else if (level === gameState.currentLevel) {
                    segment.className = 'path-segment current';
                } else {
                    segment.className = 'path-segment';
                }
            });
        }

        // Update Progress Bar
        function updateProgress() {
            // Calculate progress (as a percentage of questions needed to complete level)
            const progress = (gameState.score / 5) * 100;
            elements.displays.progressBar.style.width = `${progress}%`;
        }

        // Toggle More Concepts
        function toggleMoreConcepts() {
            // Toggle sidebar
            elements.sidebar.classList.toggle('open');
            
            // Play select sound
            playSelectSound();
        }

        // Apply Theme
        function applyTheme(theme) {
            // Get root element for CSS variables
            const root = document.documentElement;
            
            // Apply theme based on selection
            switch(theme) {
                case 'dark':
                    // Dark theme
                    document.body.style.background = '#222';
                    break;
                    
                case 'light':
                    // Light theme
                    document.body.style.background = '#f0f0f0';
                    break;
                    
                case 'contrast':
                    // High contrast theme
                    document.body.style.background = '#000';
                    break;
                    
                default:
                    // Default colorful theme
                    document.body.style.background = 'linear-gradient(135deg, #6e45e2, #88d3ce)';
            }
        }

        // Sound Functions
        function playButtonSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                const oscillator = gameState.audioContext.createOscillator();
                const gainNode = gameState.audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, gameState.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(gameState.soundVolume, gameState.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(gameState.audioContext.destination);
                
                oscillator.start();
                oscillator.stop(gameState.audioContext.currentTime + 0.3);
            }
        }

        function playTickSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                const oscillator = gameState.audioContext.createOscillator();
                const gainNode = gameState.audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, gameState.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(gameState.soundVolume * 0.3, gameState.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + 0.1);
                
                oscillator.connect(gainNode);
                gainNode.connect(gameState.audioContext.destination);
                
                oscillator.start();
                oscillator.stop(gameState.audioContext.currentTime + 0.1);
            }
        }

        function playSelectSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                const oscillator = gameState.audioContext.createOscillator();
                const gainNode = gameState.audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(660, gameState.audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(880, gameState.audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(gameState.soundVolume * 0.5, gameState.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + 0.2);
                
                oscillator.connect(gainNode);
                gainNode.connect(gameState.audioContext.destination);
                
                oscillator.start();
                oscillator.stop(gameState.audioContext.currentTime + 0.2);
            }
        }

        function playSuccessSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                
                notes.forEach((frequency, index) => {
                    const oscillator = gameState.audioContext.createOscillator();
                    const gainNode = gameState.audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(frequency, gameState.audioContext.currentTime + index * 0.1);
                    
                    gainNode.gain.setValueAtTime(0, gameState.audioContext.currentTime + index * 0.1);
                    gainNode.gain.linearRampToValueAtTime(gameState.soundVolume * 0.5, gameState.audioContext.currentTime + index * 0.1 + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + index * 0.1 + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(gameState.audioContext.destination);
                    
                    oscillator.start(gameState.audioContext.currentTime + index * 0.1);
                    oscillator.stop(gameState.audioContext.currentTime + index * 0.1 + 0.3);
                });
            }
        }

        function playErrorSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                const frequencies = [349.23, 329.63, 311.13]; // F4, E4, D#4/Eb4
                
                frequencies.forEach((frequency, index) => {
                    const oscillator = gameState.audioContext.createOscillator();
                    const gainNode = gameState.audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(frequency, gameState.audioContext.currentTime + index * 0.15);
                    
                    gainNode.gain.setValueAtTime(0, gameState.audioContext.currentTime + index * 0.15);
                    gainNode.gain.linearRampToValueAtTime(gameState.soundVolume * 0.5, gameState.audioContext.currentTime + index * 0.15 + 0.01);
                    gainNode.gain.linearRampToValueAtTime(0.001, gameState.audioContext.currentTime + index * 0.15 + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(gameState.audioContext.destination);
                    
                    oscillator.start(gameState.audioContext.currentTime + index * 0.15);
                    oscillator.stop(gameState.audioContext.currentTime + index * 0.15 + 0.3);
                });
            }
        }

        function playCelebrationSound() {
            if (gameState.audioContext && gameState.soundVolume > 0) {
                // Major scale ascending and then chord
                const notes = [
                    { freq: 523.25, time: 0 },    // C5
                    { freq: 587.33, time: 0.15 }, // D5
                    { freq: 659.25, time: 0.3 },  // E5
                    { freq: 698.46, time: 0.45 }, // F5
                    { freq: 783.99, time: 0.6 },  // G5
                    { freq: 880.00, time: 0.75 }, // A5
                    { freq: 987.77, time: 0.9 },  // B5
                    { freq: 1046.50, time: 1.05 }, // C6
                    // Final chord
                    { freq: 523.25, time: 1.3 }, // C5
                    { freq: 659.25, time: 1.3 }, // E5
                    { freq: 783.99, time: 1.3 }, // G5
                    { freq: 1046.50, time: 1.3 }  // C6
                ];
                
                notes.forEach(note => {
                    const oscillator = gameState.audioContext.createOscillator();
                    const gainNode = gameState.audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(note.freq, gameState.audioContext.currentTime + note.time);
                    
                    gainNode.gain.setValueAtTime(0, gameState.audioContext.currentTime + note.time);
                    gainNode.gain.linearRampToValueAtTime(gameState.soundVolume * 0.3, gameState.audioContext.currentTime + note.time + 0.01);
                    
                    // Longer sustain for the final chord
                    if (note.time === 1.3) {
                        gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + note.time + 1.0);
                        oscillator.start(gameState.audioContext.currentTime + note.time);
                        oscillator.stop(gameState.audioContext.currentTime + note.time + 1.0);
                    } else {
                        gainNode.gain.exponentialRampToValueAtTime(0.001, gameState.audioContext.currentTime + note.time + 0.2);
                        oscillator.start(gameState.audioContext.currentTime + note.time);
                        oscillator.stop(gameState.audioContext.currentTime + note.time + 0.2);
                    }
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(gameState.audioContext.destination);
                });
            }
        }

        // Create Confetti Effect
        function createConfetti() {
            // Clear any existing confetti
            clearConfetti();
            
            // Create confetti particles
            const particleCount = 100;
            const container = elements.celebrationContainer;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'confetti';
                    
                    // Random position
                    const x = Math.random() * container.offsetWidth;
                    const y = -20; // Start above the container
                    
                    // Random size
                    const size = Math.random() * 10 + 5;
                    
                    // Random color
                    const colors = ['#FF9A00', '#4b0082', '#4CAF50', '#f44336', '#2196F3', '#FFEB3B', '#FF6D00'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Random shape
                    const shapes = [
                        'circle',
                        'square',
                        'triangle'
                    ];
                    const shape = shapes[Math.floor(Math.random() * shapes.length)];
                    
                    // Apply styles
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.backgroundColor = color;
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    
                    // Add shape for variety
                    if (shape === 'square') {
                        particle.style.borderRadius = '0';
                    } else if (shape === 'triangle') {
                        particle.style.width = '0';
                        particle.style.height = '0';
                        particle.style.backgroundColor = 'transparent';
                        particle.style.borderLeft = `${size/2}px solid transparent`;
                        particle.style.borderRight = `${size/2}px solid transparent`;
                        particle.style.borderBottom = `${size}px solid ${color}`;
                    }
                    
                    // Add to container
                    container.appendChild(particle);
                    
                    // Animation
                    const speed = Math.random() * 2 + 1;
                    const rotation = Math.random() * 360;
                    const rotationSpeed = (Math.random() - 0.5) * 10;
                    const horizontalMovement = (Math.random() - 0.5) * 3;
                    
                    let posY = y;
                    let posX = x;
                    let currentRotation = rotation;
                    
                    const animation = setInterval(() => {
                        posY += speed;
                        posX += horizontalMovement;
                        currentRotation += rotationSpeed;
                        
                        particle.style.top = `${posY}px`;
                        particle.style.left = `${posX}px`;
                        particle.style.transform = `rotate(${currentRotation}deg)`;
                        
                        // Remove when out of view
                        if (posY > container.offsetHeight) {
                            clearInterval(animation);
                            if (particle.parentNode) {
                                particle.remove();
                            }
                        }
                    }, 20);
                    
                    // Track animations for cleanup
                    gameState.animations.confetti.push(particle);
                    gameState.animations.timers.push(animation);
                }, i * 20); // Stagger creation for more natural effect
            }
        }

        // Clear Confetti
        function clearConfetti() {
            // Clear all animation timers
            gameState.animations.timers.forEach(timer => {
                clearInterval(timer);
            });
            
            // Remove all confetti elements
            gameState.animations.confetti.forEach(confetti => {
                if (confetti.parentNode) {
                    confetti.remove();
                }
            });
            
            // Reset arrays
            gameState.animations.confetti = [];
            gameState.animations.timers = [];
        }

        // Helper function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Helper function to get random message from array
        function getRandomMessage(messages) {
            return messages[Math.floor(Math.random() * messages.length)];
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
