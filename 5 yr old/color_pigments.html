<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color & Pigment Genius Academy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: clamp(24px, 5vw, 36px);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
            font-weight: bold;
            margin-bottom: 10px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .score-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .score, .level-display {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .level-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .level-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .color-wheel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .color-card {
            aspect-ratio: 1;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .color-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .color-card.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px #fff, 0 0 0 8px #ff6b6b;
        }

        .color-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        .learning-content {
            min-height: 300px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .fact-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .fact-level {
            display: inline-block;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .molecule-diagram {
            text-align: center;
            margin: 15px 0;
            font-family: monospace;
            font-size: 18px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .quiz-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .quiz-question {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .quiz-option.selected {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.3);
        }

        .quiz-option.correct {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.3);
        }

        .quiz-option.incorrect {
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.3);
        }

        .quiz-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .genius-insight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border-left: 6px solid #ffd700;
            position: relative;
        }

        .genius-insight::before {
            content: "💡";
            position: absolute;
            top: -10px;
            left: 15px;
            font-size: 24px;
            background: #ffd700;
            border-radius: 50%;
            padding: 5px;
        }

        .genius-insight h4 {
            margin-bottom: 10px;
            color: #ffd700;
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .color-wheel {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 10px;
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">🎨 Color & Pigment Genius Academy 🧠</h1>
            <div class="score-level">
                <div class="score">Score: <span id="score">0</span></div>
                <div class="level-display">Level: <span id="currentLevel">Elementary</span></div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <div class="level-selector">
            <button class="level-btn active" data-level="elementary">🎈 Elementary</button>
            <button class="level-btn" data-level="middle">🎯 Middle School</button>
            <button class="level-btn" data-level="high">🚀 High School</button>
            <button class="level-btn" data-level="college">🎓 College</button>
            <button class="level-btn" data-level="phd">🧬 PhD Level</button>
        </div>

        <div class="main-content">
            <div class="color-wheel" id="colorWheel">
                <!-- Colors will be generated dynamically -->
            </div>

            <div class="learning-content" id="learningContent">
                <h3>Welcome to Color & Pigment Genius Academy!</h3>
                <p>Select a color above to discover the amazing science behind it! 🌈</p>
            </div>

            <div class="quiz-section" id="quizSection" style="display: none;">
                <h3>🧠 Quiz Time!</h3>
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
                <div class="quiz-controls">
                    <button class="btn" id="submitAnswer" disabled>Submit Answer</button>
                    <button class="btn" id="nextQuestion" style="display: none;">Next Question</button>
                    <button class="btn" id="startQuiz">Start Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration"></div>

    <script>
        class ColorPigmentAcademy {
            constructor() {
                this.score = 0;
                this.currentLevel = 'elementary';
                this.selectedColor = null;
                this.currentQuiz = null;
                this.questionIndex = 0;
                this.audioContext = null;
                
                this.colors = {
                    red: {
                        name: 'Red',
                        hex: '#e74c3c',
                        chemistry: 'Fe₂O₃ (Iron Oxide)',
                        facts: {
                            elementary: [
                                'Red is the color of fire trucks and stop signs!',
                                'Many red things get their color from iron, just like rust!',
                                'Blood is red because of iron in our red blood cells.'
                            ],
                            middle: [
                                'Iron oxide (Fe₂O₃) is responsible for most red colors in nature.',
                                'Mars appears red because its surface is covered in iron oxide dust.',
                                'Hemoglobin contains iron, which makes blood red when it carries oxygen.'
                            ],
                            high: [
                                'Iron oxide forms when iron atoms lose electrons to oxygen atoms.',
                                'Different forms of iron oxide create different shades of red.',
                                'Red ochre (iron oxide) was used in cave paintings 40,000 years ago.'
                            ],
                            college: [
                                'Iron(III) oxide has a rhombohedral crystal structure.',
                                'The red color comes from d-d electronic transitions in Fe³⁺ ions.',
                                'Hematite (α-Fe₂O₃) is the most stable form of iron oxide at room temperature.'
                            ],
                            phd: [
                                'The electronic configuration of Fe³⁺ is [Ar] 3d⁵, creating a high-spin state.',
                                'Ligand field theory explains why octahedral Fe³⁺ complexes absorb blue-green light (500-600nm).',
                                'Quantum mechanical selection rules make d⁵ → d⁵ transitions weakly allowed through spin-orbit coupling.'
                            ]
                        },
                        geniusInsights: {
                            elementary: 'The same chemical that makes Mars red also makes your blood red - iron!',
                            middle: 'Iron + Oxygen = Most red things on Earth and in space!',
                            high: 'Ancient humans used the same iron oxide chemistry for art that colors distant planets.',
                            college: 'The crystal structure of iron oxide determines whether something looks red, yellow, or black.',
                            phd: 'Quantum mechanics explains why iron makes things red through forbidden electronic transitions!'
                        }
                    },
                    blue: {
                        name: 'Blue',
                        hex: '#3498db',
                        chemistry: 'Cu²⁺ or Co²⁺',
                        facts: {
                            elementary: [
                                'The sky and ocean look blue, but water is actually colorless!',
                                'Blue paint often comes from copper or cobalt metals.',
                                'Blueberries get their color from special molecules called anthocyanins.'
                            ],
                            middle: [
                                'Rayleigh scattering makes the sky appear blue - shorter wavelengths scatter more.',
                                'Copper carbonate creates beautiful blue-green patina on old copper.',
                                'Cobalt glass has been used to make blue colors for thousands of years.'
                            ],
                            high: [
                                'Copper(II) ions absorb red light, reflecting blue wavelengths.',
                                'Egyptian blue (CaCuSi₄O₁₀) was the first synthetic pigment ever made.',
                                'Ultramarine blue comes from the mineral lapis lazuli, containing sulfur radicals.'
                            ],
                            college: [
                                'Cu²⁺ has a d⁹ electronic configuration, creating Jahn-Teller distortion.',
                                'Cobalt(II) in tetrahedral coordination appears blue due to d-d transitions.',
                                'Prussian blue contains iron in both +2 and +3 oxidation states.'
                            ],
                            phd: [
                                'The blue color in Cu²⁺ comes from ²E_g → ²T₂g transitions in octahedral fields.',
                                'Intervalence charge transfer in Prussian blue creates intense blue absorption.',
                                'Sulfur radical anions S₃⁻ in ultramarine create blue through π* ← π transitions.'
                            ]
                        },
                        geniusInsights: {
                            elementary: 'The same copper that makes pennies also makes the most beautiful blues!',
                            middle: 'Light scattering makes the sky blue, but metals make paint blue!',
                            high: 'Ancient Egyptians invented the first artificial blue 5,000 years ago using copper!',
                            college: 'Electron geometry determines whether copper makes things blue, green, or red!',
                            phd: 'Quantum orbital theory explains why d⁹ copper creates the most intense blues!'
                        }
                    },
                    green: {
                        name: 'Green',
                        hex: '#27ae60',
                        chemistry: 'Chlorophyll Mg or Cr₂O₃',
                        facts: {
                            elementary: [
                                'Green leaves get their color from chlorophyll, which helps plants eat sunlight!',
                                'Emeralds are green because they contain the metal chromium.',
                                'Green paint can be made from copper or chromium.'
                            ],
                            middle: [
                                'Chlorophyll contains magnesium at its center, just like blood contains iron.',
                                'Chromium oxide (Cr₂O₃) creates a permanent, stable green color.',
                                'Malachite is a green copper mineral that was ground up for ancient paint.'
                            ],
                            high: [
                                'Chlorophyll absorbs red and blue light but reflects green wavelengths.',
                                'Chromium(III) in octahedral coordination creates intense green colors.',
                                'Verdigris forms when copper reacts with acids, creating blue-green patina.'
                            ],
                            college: [
                                'Chlorophyll uses resonance structures to stabilize its excited states.',
                                'Cr³⁺ has a d³ configuration with strong ligand field stabilization energy.',
                                'Green fluorescent protein uses a chromophore formed from three amino acids.'
                            ],
                            phd: [
                                'Chlorophyll\'s extended π-system allows efficient energy transfer in photosynthesis.',
                                'Spin-forbidden d-d transitions in Cr³⁺ create long-lived excited states.',
                                'The GFP chromophore undergoes excited-state proton transfer for fluorescence.'
                            ]
                        },
                        geniusInsights: {
                            elementary: 'Plants are green because of magnesium, like how blood is red because of iron!',
                            middle: 'The same chromium that colors emeralds also makes stainless steel strong!',
                            high: 'Chlorophyll is chemically related to blood - they\'re both metal-centered molecules!',
                            college: 'Plants chose green because it\'s the perfect color for capturing sunlight energy!',
                            phd: 'Quantum coherence in chlorophyll achieves 95% energy transfer efficiency!'
                        }
                    },
                    yellow: {
                        name: 'Yellow',
                        hex: '#f1c40f',
                        chemistry: 'CdS or PbCrO₄',
                        facts: {
                            elementary: [
                                'The sun looks yellow because of the gases around it.',
                                'Yellow paint often comes from cadmium or lead compounds.',
                                'Bananas turn yellow as they ripen and chlorophyll breaks down.'
                            ],
                            middle: [
                                'Cadmium sulfide (CdS) creates bright, permanent yellow pigments.',
                                'Chrome yellow (lead chromate) was used by Van Gogh in his paintings.',
                                'Carotenoids make carrots orange and give yellow colors to many flowers.'
                            ],
                            high: [
                                'The bandgap in cadmium sulfide determines its yellow color.',
                                'Lead chromate\'s yellow comes from charge transfer transitions.',
                                'β-carotene has 11 conjugated double bonds that absorb blue light.'
                            ],
                            college: [
                                'CdS is a semiconductor with a 2.4 eV bandgap matching yellow light.',
                                'Intervalence charge transfer in PbCrO₄ creates intense yellow absorption.',
                                'Xanthophyll pigments protect chlorophyll from photo-oxidative damage.'
                            ],
                            phd: [
                                'Quantum confinement effects in CdS nanocrystals tune the yellow emission.',
                                'Pb²⁺ → Cr⁶⁺ charge transfer bands dominate the yellow absorption spectrum.',
                                'Conjugated π-systems in carotenoids follow particle-in-a-box quantum mechanics.'
                            ]
                        },
                        geniusInsights: {
                            elementary: 'Yellow comes from the same type of chemistry that makes computer chips!',
                            middle: 'Van Gogh\'s yellow paint contained lead - dangerous but beautiful!',
                            high: 'The length of molecules determines what color they absorb and reflect!',
                            college: 'Semiconductor physics explains why some crystals are yellow!',
                            phd: 'Quantum size effects let us tune nanocrystals to any yellow shade we want!'
                        }
                    },
                    purple: {
                        name: 'Purple',
                        hex: '#9b59b6',
                        chemistry: 'C₁₆H₁₈ClN₃S',
                        facts: {
                            elementary: [
                                'Purple was once the most expensive color - worth more than gold!',
                                'Ancient purple came from thousands of sea snails.',
                                'Purple flowers often contain anthocyanin molecules.'
                            ],
                            middle: [
                                'Tyrian purple required 12,000 murex snails for one gram of dye.',
                                'The first synthetic purple dye was discovered by accident in 1856.',
                                'Anthocyanins change color based on pH - they can be red, purple, or blue.'
                            ],
                            high: [
                                'Mauve was synthesized by William Perkin while trying to make quinine.',
                                'The indigo molecule has extended conjugation that absorbs orange light.',
                                'Rhodopsin in our eyes uses a purple chromophore to detect light.'
                            ],
                            college: [
                                'Tyrian purple contains a bromine-substituted indigo structure.',
                                'Anthocyanins are flavonoid glycosides with pH-dependent protonation.',
                                'Purple membranes in bacteria use bacteriorhodopsin for photosynthesis.'
                            ],
                            phd: [
                                'The chromophore in rhodopsin undergoes cis-trans isomerization upon photon absorption.',
                                'Density functional theory predicts anthocyanin colors from molecular orbitals.',
                                'Bacteriorhodopsin uses a proton pump mechanism driven by retinal isomerization.'
                            ]
                        },
                        geniusInsights: {
                            elementary: 'Purple was so rare that only kings and queens could afford it!',
                            middle: 'A teenager accidentally invented purple dye and started the chemical industry!',
                            high: 'The same molecule that makes vision possible also makes some things purple!',
                            college: 'Ocean creatures invented purple chemistry millions of years before humans!',
                            phd: 'Your eyes use purple quantum chemistry to turn light into brain signals!'
                        }
                    }
                };

                this.quizQuestions = {
                    elementary: [
                        {
                            question: "What metal makes blood red and Mars red?",
                            options: ["Iron", "Copper", "Gold", "Silver"],
                            correct: 0,
                            explanation: "Iron (Fe) in different forms creates most red colors in nature!"
                        },
                        {
                            question: "Which metal is often found in blue paint?",
                            options: ["Iron", "Copper", "Lead", "Zinc"],
                            correct: 1,
                            explanation: "Copper compounds create beautiful blue colors!"
                        }
                    ],
                    middle: [
                        {
                            question: "What is the chemical formula for the iron compound that makes things red?",
                            options: ["FeO", "Fe₂O₃", "FeCl₃", "FeS"],
                            correct: 1,
                            explanation: "Fe₂O₃ (iron oxide) is the main red pigment in nature!"
                        },
                        {
                            question: "Why does the sky appear blue?",
                            options: ["Blue gases", "Water reflection", "Light scattering", "Oxygen molecules"],
                            correct: 2,
                            explanation: "Rayleigh scattering makes shorter blue wavelengths scatter more than red!"
                        }
                    ],
                    high: [
                        {
                            question: "Which electronic transition causes the red color in iron oxide?",
                            options: ["s-p transitions", "d-d transitions", "p-d transitions", "f-f transitions"],
                            correct: 1,
                            explanation: "d-d electronic transitions in Fe³⁺ ions absorb blue-green light, making objects appear red!"
                        }
                    ],
                    college: [
                        {
                            question: "What crystal structure does hematite (α-Fe₂O₃) have?",
                            options: ["Cubic", "Hexagonal", "Rhombohedral", "Tetragonal"],
                            correct: 2,
                            explanation: "Hematite has a rhombohedral crystal structure that contributes to its optical properties!"
                        }
                    ],
                    phd: [
                        {
                            question: "Why are d⁵ → d⁵ transitions in Fe³⁺ weakly allowed?",
                            options: ["Vibronic coupling", "Spin-orbit coupling", "Crystal field effects", "Jahn-Teller distortion"],
                            correct: 1,
                            explanation: "Spin-orbit coupling makes these spin-forbidden transitions weakly allowed!"
                        }
                    ]
                };

                this.initializeAudio();
                this.setupEventListeners();
                this.renderColorWheel();
                this.showWelcome();
            }

            initializeAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            playSound(frequency, duration = 200) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);

                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + duration / 1000);
            }

            setupEventListeners() {
                // Level selector
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentLevel = e.target.dataset.level;
                        document.getElementById('currentLevel').textContent = this.currentLevel.charAt(0).toUpperCase() + this.currentLevel.slice(1);
                        this.playSound(440, 100);
                        if (this.selectedColor) {
                            this.showColorInfo(this.selectedColor);
                        }
                    });
                });

                // Quiz controls
                document.getElementById('startQuiz').addEventListener('click', () => {
                    this.startQuiz();
                });

                document.getElementById('submitAnswer').addEventListener('click', () => {
                    this.submitAnswer();
                });

                document.getElementById('nextQuestion').addEventListener('click', () => {
                    this.nextQuestion();
                });
            }

            renderColorWheel() {
                const colorWheel = document.getElementById('colorWheel');
                colorWheel.innerHTML = '';

                Object.entries(this.colors).forEach(([key, color]) => {
                    const colorCard = document.createElement('div');
                    colorCard.className = 'color-card';
                    colorCard.style.background = `linear-gradient(135deg, ${color.hex}, ${this.adjustBrightness(color.hex, -20)})`;
                    colorCard.innerHTML = `<div class="color-name">${color.name}</div>`;
                    
                    colorCard.addEventListener('click', () => {
                        this.selectColor(key, colorCard);
                    });

                    colorWheel.appendChild(colorCard);
                });
            }

            adjustBrightness(hex, percent) {
                const num = parseInt(hex.replace("#", ""), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) + amt;
                const G = (num >> 8 & 0x00FF) + amt;
                const B = (num & 0x0000FF) + amt;
                return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                    (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
            }

            selectColor(colorKey, element) {
                // Remove previous selection
                document.querySelectorAll('.color-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // Select new color
                element.classList.add('selected');
                this.selectedColor = colorKey;
                this.playSound(523, 150);
                this.showColorInfo(colorKey);
            }

            showColorInfo(colorKey) {
                const color = this.colors[colorKey];
                const content = document.getElementById('learningContent');
                const facts = color.facts[this.currentLevel];
                const insight = color.geniusInsights[this.currentLevel];

                content.innerHTML = `
                    <h3 style="color: ${color.hex}">🎨 ${color.name} - The Science Behind the Color</h3>
                    
                    <div class="molecule-diagram">
                        <strong>Key Chemistry: ${color.chemistry}</strong>
                    </div>

                    ${facts.map((fact, index) => `
                        <div class="fact-card" style="animation-delay: ${index * 0.2}s">
                            <div class="fact-level">${this.currentLevel.toUpperCase()}</div>
                            <p>${fact}</p>
                        </div>
                    `).join('')}

                    <div class="genius-insight">
                        <h4>💡 Genius Insight</h4>
                        <p>${insight}</p>
                    </div>
                `;

                // Show quiz section
                document.getElementById('quizSection').style.display = 'block';
            }

            showWelcome() {
                const content = document.getElementById('learningContent');
                content.innerHTML = `
                    <h3>🌈 Welcome to Color & Pigment Genius Academy! 🧠</h3>
                    <p>Discover the amazing science behind colors! Each color has incredible chemistry that most adults don't even know.</p>
                    
                    <div class="genius-insight">
                        <h4>💡 Did You Know?</h4>
                        <p>The same iron that makes your blood red also makes Mars red! Science connects everything in the universe! 🌌</p>
                    </div>
                    
                    <p><strong>Instructions:</strong></p>
                    <ul>
                        <li>🎯 Select a color above to learn its secrets</li>
                        <li>📈 Choose your learning level (Elementary to PhD!)</li>
                        <li>🧠 Take quizzes to test your genius knowledge</li>
                        <li>🏆 Earn points and unlock deeper understanding</li>
                    </ul>
                `;
            }

            startQuiz() {
                const questions = this.quizQuestions[this.currentLevel];
                if (!questions || questions.length === 0) {
                    this.showNotification('No quiz available for this level yet!', 'info');
                    return;
                }

                this.currentQuiz = questions;
                this.questionIndex = 0;
                this.showQuestion();

                document.getElementById('startQuiz').style.display = 'none';
                this.playSound(659, 200);
            }

            showQuestion() {
                if (!this.currentQuiz || this.questionIndex >= this.currentQuiz.length) {
                    this.endQuiz();
                    return;
                }

                const question = this.currentQuiz[this.questionIndex];
                document.getElementById('quizQuestion').textContent = question.question;

                const optionsContainer = document.getElementById('quizOptions');
                optionsContainer.innerHTML = '';

                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option';
                    optionDiv.textContent = option;
                    optionDiv.addEventListener('click', () => {
                        this.selectOption(index, optionDiv);
                    });
                    optionsContainer.appendChild(optionDiv);
                });

                document.getElementById('submitAnswer').disabled = true;
                document.getElementById('nextQuestion').style.display = 'none';
            }

            selectOption(index, element) {
                // Remove previous selections
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected');
                });

                // Select new option
                element.classList.add('selected');
                this.selectedOption = index;
                document.getElementById('submitAnswer').disabled = false;
                this.playSound(349, 100);
            }

            submitAnswer() {
                const question = this.currentQuiz[this.questionIndex];
                const isCorrect = this.selectedOption === question.correct;

                // Show correct/incorrect styling
                document.querySelectorAll('.quiz-option').forEach((opt, index) => {
                    if (index === question.correct) {
                        opt.classList.add('correct');
                    } else if (index === this.selectedOption && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });

                if (isCorrect) {
                    this.score += 10;
                    this.playSuccessSound();
                    this.createCelebration();
                    this.showNotification('🎉 Correct! ' + question.explanation, 'success');
                } else {
                    this.playErrorSound();
                    this.showNotification('❌ ' + question.explanation, 'error');
                }

                document.getElementById('score').textContent = this.score;
                this.updateProgress();

                document.getElementById('submitAnswer').style.display = 'none';
                document.getElementById('nextQuestion').style.display = 'inline-block';
            }

            nextQuestion() {
                this.questionIndex++;
                this.showQuestion();
                document.getElementById('submitAnswer').style.display = 'inline-block';
            }

            endQuiz() {
                document.getElementById('quizQuestion').textContent = '🎊 Quiz Complete!';
                document.getElementById('quizOptions').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>Amazing work! 🌟</h3>
                        <p>You've mastered ${this.currentLevel} level color science!</p>
                        <p>Ready to try a harder level or explore more colors?</p>
                    </div>
                `;
                document.getElementById('nextQuestion').style.display = 'none';
                document.getElementById('startQuiz').style.display = 'inline-block';
                this.createCelebration();
                this.playVictorySound();
            }

            playSuccessSound() {
                this.playSound(523, 150);
                setTimeout(() => this.playSound(659, 150), 100);
                setTimeout(() => this.playSound(784, 200), 200);
            }

            playErrorSound() {
                this.playSound(220, 300);
                setTimeout(() => this.playSound(196, 300), 150);
            }

            playVictorySound() {
                const notes = [523, 587, 659, 698, 784, 880, 988];
                notes.forEach((note, index) => {
                    setTimeout(() => this.playSound(note, 200), index * 100);
                });
            }

            createCelebration() {
                const celebration = document.getElementById('celebration');
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];

                for (let i = 0; i < 20; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    celebration.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }
            }

            updateProgress() {
                const maxScore = Object.keys(this.colors).length * 100; // Assuming 100 points per color
                const progress = Math.min((this.score / maxScore) * 100, 100);
                document.getElementById('progressFill').style.width = progress + '%';
            }

            showNotification(message, type) {
                // Create a temporary notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#00ff88' : type === 'error' ? '#ff4757' : '#4ecdc4'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 1001;
                    max-width: 300px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => notification.remove(), 3000);
            }
        }

        // Start the app when page loads
        window.addEventListener('load', () => {
            new ColorPigmentAcademy();
        });

        // Handle audio context resumption for mobile
        document.addEventListener('click', function() {
            if (window.colorApp && window.colorApp.audioContext && window.colorApp.audioContext.state === 'suspended') {
                window.colorApp.audioContext.resume();
            }
        }, { once: true });
    </script>
</body>
</html>