<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Explorers: Math & Science Dress-Up Adventure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        /* Base styles */
        body {
            font-family: 'Arial Rounded MT Bold', 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: #f0faff;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }
        
        /* Main container */
        #game-container {
            display: flex;
            width: 95%;
            height: 85vh;
            margin-top: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background-color: #ffffff;
            overflow: hidden;
        }
        
        /* Left panel - clothes selection */
        #clothes-panel {
            width: 25%;
            height: 100%;
            background-color: #ffecf5;
            padding: 10px;
            overflow-y: auto;
            border-right: 3px solid #ff9ec5;
        }
        
        /* Center panel - character display */
        #character-panel {
            width: 45%;
            height: 100%;
            background-color: #fff;
            position: relative;
            overflow: hidden;
        }
        
        /* Right panel - learning content */
        #learning-panel {
            width: 30%;
            height: 100%;
            background-color: #e6f7ff;
            padding: 15px;
            overflow-y: auto;
            border-left: 3px solid #87ceeb;
        }
        
        /* Category tabs */
        .category-tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        
        .tab {
            padding: 8px 15px;
            background-color: #ffb6e1;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab:hover, .tab.active {
            background-color: #ff69b4;
            color: white;
            transform: scale(1.05);
        }
        
        /* Clothing items */
        .clothing-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .clothing-item {
            width: 80px;
            height: 80px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .clothing-item:hover {
            transform: scale(1.1);
            border-color: #ff69b4;
        }
        
        .clothing-item.selected {
            border-color: #ff1493;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }
        
        /* Progress bar */
        .progress-container {
            width: 90%;
            margin: 15px auto;
            background-color: #eee;
            border-radius: 10px;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background-color: #ff69b4;
            width: 0%;
            transition: width 0.5s;
        }
        
        /* Learning content */
        .learning-content {
            margin-bottom: 20px;
        }
        
        .learning-title {
            color: #0066cc;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .fun-fact {
            background-color: #fff;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #ffcc00;
        }
        
        /* Character customization */
        #character-customization {
            background-color: #e0f7fa;
            border-radius: 10px;
            padding: 10px;
            margin-top: 15px;
        }
        
        .slider-container {
            margin-bottom: 10px;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #0099cc;
        }
        
        .slider-container input {
            width: 100%;
            margin-top: 5px;
        }
        
        /* Quiz styles */
        .quiz-container {
            background-color: #f8f8ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #b19cd9;
        }
        
        .quiz-question {
            font-weight: bold;
            margin-bottom: 10px;
            color: #4b0082;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .quiz-option {
            background-color: #e6e6fa;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-option:hover {
            background-color: #d8bfd8;
        }
        
        .quiz-option.correct {
            background-color: #90ee90;
        }
        
        .quiz-option.incorrect {
            background-color: #ffcccb;
        }
        
        .quiz-feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            display: none;
        }
        
        .correct-feedback {
            background-color: #dff2bf;
            color: #4f8a10;
        }
        
        .incorrect-feedback {
            background-color: #ffbaba;
            color: #d8000c;
        }
        
        /* Buttons */
        .button {
            padding: 10px 15px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
            margin: 10px 0;
        }
        
        .button:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        
        /* Header */
        .game-header {
            width: 95%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        
        .game-title {
            font-size: 24px;
            color: #ff1493;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Level indicator */
        .level-indicator {
            background-color: #ffcc00;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        /* Modal dialog */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        /* Learning module specific styles */
        .geometry-demo, .color-theory, .pattern-demo {
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
            padding: 10px;
            background-color: #fff;
        }
        
        /* Canvas container */
        #canvas-container {
            width: 100%;
            height: 70%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Parameter panel */
        .parameter-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255,255,255,0.9);
            padding: 10px;
            border-top: 2px solid #ff9ec5;
        }
        
        /* Character selection */
        .character-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .character-option {
            width: 80px;
            height: 120px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
        }
        
        .character-option:hover {
            transform: scale(1.1);
            background-color: #ffe6f2;
        }
        
        .character-option.selected {
            background-color: #ffb6c1;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10;
            display: none;
        }
        
        /* Learning toggle */
        .learning-toggle {
            background-color: #f0f8ff;
            border-radius: 20px;
            padding: 5px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .toggle-dot {
            width: 20px;
            height: 20px;
            background-color: #0099cc;
            border-radius: 50%;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <!-- Game Header -->
    <div class="game-header">
        <div class="game-title">Fashion Explorers: Math & Science Dress-Up Adventure</div>
        <div class="level-indicator">Level: <span id="current-level">1</span></div>
    </div>
    
    <!-- Main Game Container -->
    <div id="game-container">
        <!-- Left Panel - Clothing Selection -->
        <div id="clothes-panel">
            <div class="category-tabs">
                <div class="tab active" data-category="tops">Tops</div>
                <div class="tab" data-category="bottoms">Bottoms</div>
                <div class="tab" data-category="shoes">Shoes</div>
                <div class="tab" data-category="accessories">Extras</div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <!-- Clothing Items Containers -->
            <div class="clothing-container" id="tops-container"></div>
            <div class="clothing-container" id="bottoms-container" style="display: none;"></div>
            <div class="clothing-container" id="shoes-container" style="display: none;"></div>
            <div class="clothing-container" id="accessories-container" style="display: none;"></div>
            
            <!-- Character Customization -->
            <div id="character-customization">
                <h3>Design Parameters</h3>
                <div class="slider-container">
                    <label for="symmetry-slider">Symmetry: <span id="symmetry-value">5</span></label>
                    <input type="range" id="symmetry-slider" min="1" max="10" value="5">
                </div>
                <div class="slider-container">
                    <label for="pattern-complexity">Pattern Complexity: <span id="complexity-value">5</span></label>
                    <input type="range" id="pattern-complexity" min="1" max="10" value="5">
                </div>
                <div class="slider-container">
                    <label for="color-harmony">Color Harmony: <span id="harmony-value">5</span></label>
                    <input type="range" id="color-harmony" min="1" max="10" value="5">
                </div>
            </div>
        </div>
        
        <!-- Center Panel - Character Display -->
        <div id="character-panel">
            <div class="character-selection">
                <div class="character-option selected" data-character="character1">
                    <svg width="60" height="60" viewBox="0 0 60 60">
                        <circle cx="30" cy="20" r="15" fill="#ffdbac" />
                        <path d="M15 60 L30 35 L45 60" fill="#a569bd" />
                    </svg>
                    <span>Alex</span>
                </div>
                <div class="character-option" data-character="character2">
                    <svg width="60" height="60" viewBox="0 0 60 60">
                        <circle cx="30" cy="20" r="15" fill="#f5cba7" />
                        <path d="M15 60 L30 35 L45 60" fill="#5dade2" />
                    </svg>
                    <span>Jordan</span>
                </div>
            </div>
            
            <div id="canvas-container">
                <!-- P5.js canvas will be created here -->
            </div>
            
            <div class="parameter-panel">
                <div class="button" id="random-outfit">Random Outfit</div>
                <div class="button" id="take-quiz">Take Quiz</div>
            </div>
        </div>
        
        <!-- Right Panel - Learning Content -->
        <div id="learning-panel">
            <div class="learning-toggle">
                Learning Mode: Advanced <span class="toggle-dot"></span>
            </div>
            
            <div class="learning-content" id="current-learning">
                <div class="learning-title">Welcome to Fashion Explorers!</div>
                <p>Let's learn about fashion, math, and science while creating awesome outfits!</p>
                <p>Choose clothes from the left panel and watch how math and science concepts come to life!</p>
                
                <div class="fun-fact">
                    <strong>Fun Fact:</strong> Did you know that fashion designers use geometry to create patterns? Shapes like circles, triangles, and squares are the building blocks of fashion!
                </div>
            </div>
            
            <!-- This div will hold dynamic learning content based on selected items -->
            <div id="dynamic-learning"></div>
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div class="modal" id="quiz-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Fashion & Math Quiz</h2>
            <div id="quiz-container"></div>
        </div>
    </div>
    
    <script>
        // Main game variables
        let currentCategory = 'tops';
        let learningLevel = 'advanced';
        let currentCharacter = 'character1';
        let userProgress = 0;
        let currentLevel = 1;
        let p5Canvas;
        let outfitItems = {
            tops: null,
            bottoms: null,
            shoes: null,
            accessories: []
        };
        
        // Parameters
        let symmetryValue = 5;
        let patternComplexity = 5;
        let colorHarmony = 5;
        
        // Define clothing items with educational concepts
        const clothingItems = {
            tops: [
                { id: 't1', name: 'T-Shirt', color: '#FF5733', pattern: 'solid', geometry: 'rectangle', 
                  concept: 'Solid colors teach us about primary colors in the RGB color model used in digital screens!' },
                { id: 't2', name: 'Blouse', color: '#C70039', pattern: 'polka', geometry: 'circle', 
                  concept: 'Polka dots demonstrate the mathematical concept of "regular point patterns" - this is related to circle packing problems in discrete geometry.' },
                { id: 't3', name: 'Sweater', color: '#900C3F', pattern: 'stripe', geometry: 'line', 
                  concept: 'Stripes illustrate the concept of parallel lines in Euclidean geometry - lines that never intersect and maintain the same distance from each other.' },
                { id: 't4', name: 'Hoodie', color: '#581845', pattern: 'gradient', geometry: 'rectangle', 
                  concept: 'Color gradients represent continuous functions in mathematics, showing how one value smoothly transitions to another.' },
                { id: 't5', name: 'Vest', color: '#FFC300', pattern: 'plaid', geometry: 'square', 
                  concept: 'Plaid patterns are based on the Cartesian coordinate system, with intersecting horizontal and vertical lines forming a grid!' }
            ],
            bottoms: [
                { id: 'b1', name: 'Jeans', color: '#0074D9', pattern: 'solid', geometry: 'cylinder', 
                  concept: 'Jeans are shaped like cylinders - a 3D geometric shape with two circular bases connected by a curved surface!' },
                { id: 'b2', name: 'Skirt', color: '#7FDBFF', pattern: 'pleated', geometry: 'cone', 
                  concept: 'Pleated skirts demonstrate the principle of "developable surfaces" - surfaces that can be flattened without stretching or tearing.' },
                { id: 'b3', name: 'Shorts', color: '#39CCCC', pattern: 'solid', geometry: 'trapezoid', 
                  concept: 'Shorts often form a trapezoid shape - a quadrilateral with exactly one pair of parallel sides!' },
                { id: 'b4', name: 'Leggings', color: '#3D9970', pattern: 'print', geometry: 'cylinder', 
                  concept: 'Printed leggings can demonstrate tessellation - patterns of shapes that fit together perfectly without gaps or overlaps!' },
                { id: 'b5', name: 'Pants', color: '#2ECC40', pattern: 'stripe', geometry: 'cylinder', 
                  concept: 'Stripes on pants can demonstrate the mathematical concept of frequency - the number of repetitions in a given space.' }
            ],
            shoes: [
                { id: 's1', name: 'Sneakers', color: '#FF851B', pattern: 'solid', geometry: 'oval', 
                  concept: 'Sneaker designs often use ergonomics - the scientific study of human body measurements to create comfortable products!' },
                { id: 's2', name: 'Boots', color: '#FF4136', pattern: 'texture', geometry: 'cylinder', 
                  concept: 'The height of boots relates to the golden ratio (approximately 1.618), a special number that appears in many patterns in nature!' },
                { id: 's3', name: 'Sandals', color: '#85144b', pattern: 'solid', geometry: 'strap', 
                  concept: 'Sandal straps demonstrate the mathematical concept of "minimal paths" - the shortest distance needed to connect multiple points!' },
                { id: 's4', name: 'Slippers', color: '#F012BE', pattern: 'fluffy', geometry: 'oval', 
                  concept: 'Fuzzy textures in slippers relate to fractal geometry - patterns that repeat at different scales, creating complex surfaces!' },
                { id: 's5', name: 'Dress Shoes', color: '#B10DC9', pattern: 'solid', geometry: 'oval', 
                  concept: 'The curves in dress shoes demonstrate principles of calculus, particularly how derivatives describe the rate of change along a curve!' }
            ],
            accessories: [
                { id: 'a1', name: 'Hat', color: '#AAAAAA', pattern: 'solid', geometry: 'circle', 
                  concept: 'Hats often use the geometric principles of conic sections - curves formed by the intersection of a cone with a plane!' },
                { id: 'a2', name: 'Scarf', color: '#DDDDDD', pattern: 'stripe', geometry: 'rectangle', 
                  concept: 'The way scarves fold and drape demonstrates principles of topological transformation - how shapes can be bent and twisted!' },
                { id: 'a3', name: 'Glasses', color: '#111111', pattern: 'solid', geometry: 'circle', 
                  concept: 'Glasses demonstrate principles of optics and how lenses focus light through refraction - the bending of light as it passes through different materials!' },
                { id: 'a4', name: 'Necklace', color: '#FFDC00', pattern: 'beaded', geometry: 'circle', 
                  concept: 'Beaded necklaces show the mathematical concept of sequences - ordered collections of objects following specific patterns!' },
                { id: 'a5', name: 'Backpack', color: '#01FF70', pattern: 'solid', geometry: 'rectangle', 
                  concept: 'Backpack designs apply principles of weight distribution and center of gravity - concepts from physics that determine balance and stability!' }
            ]
        };
        
        // Quiz questions
        const quizQuestions = [
            {
                question: "What geometric shape is most like a pleated skirt?",
                options: ["Sphere", "Cone", "Cube", "Cylinder"],
                correctAnswer: "Cone",
                explanation: "A pleated skirt forms a cone shape, wide at the bottom and narrowing at the waist!"
            },
            {
                question: "Which pattern demonstrates parallel lines in geometry?",
                options: ["Polka dots", "Plaid", "Stripes", "Zigzag"],
                correctAnswer: "Stripes",
                explanation: "Stripes are made of parallel lines that never intersect and maintain the same distance from each other!"
            },
            {
                question: "If a shirt has red and blue polka dots in an alternating pattern, what mathematical concept is this showing?",
                options: ["Addition", "Sequences", "Fractions", "Multiplication"],
                correctAnswer: "Sequences",
                explanation: "An alternating pattern of different colored dots forms a sequence - a specific order that follows a rule!"
            },
            {
                question: "If a sweater has a symmetrical design, what does that mean?",
                options: ["It has no pattern", "One side matches the other side", "It changes colors", "It's made of wool"],
                correctAnswer: "One side matches the other side",
                explanation: "Symmetry means one side is a mirror image of the other - if you fold it down the middle, the sides match up perfectly!"
            },
            {
                question: "What fraction of a necklace with 3 red beads and 5 blue beads is red?",
                options: ["3/5", "5/8", "3/8", "1/3"],
                correctAnswer: "3/8",
                explanation: "There are 3 red beads out of 8 total beads (3 red + 5 blue), so the fraction is 3/8!"
            },
            {
                question: "If a pair of pants is shaped like a cylinder, what 3D shape is that?",
                options: ["A shape with circular top and bottom connected by a curved surface", 
                        "A shape with all flat sides", 
                        "A round ball shape", 
                        "A pointy shape with a circular bottom"],
                correctAnswer: "A shape with circular top and bottom connected by a curved surface",
                explanation: "A cylinder has two circular bases connected by a curved surface - just like how pant legs are shaped!"
            },
            {
                question: "What do we call it when a pattern of shapes fills a space with no gaps or overlaps?",
                options: ["Symmetry", "Tessellation", "Gradient", "Fraction"],
                correctAnswer: "Tessellation",
                explanation: "Tessellation is when shapes fit together perfectly like puzzle pieces, with no gaps or overlaps!"
            },
            {
                question: "If a jacket has a zipper down the middle, what type of symmetry does it have?",
                options: ["Rotational symmetry", "Reflection symmetry", "No symmetry", "Translational symmetry"],
                correctAnswer: "Reflection symmetry",
                explanation: "A jacket with a center zipper has reflection symmetry - the left side mirrors the right side along the center line!"
            }
        ];
        
        // Learning modules by level
        const learningModules = {
            basic: {
                symmetry: "Symmetry means when one side looks like the other! Like when you fold a paper heart in half and both sides match.",
                patterns: "Patterns are designs that repeat over and over in a special way. Like stripes that go blue, red, blue, red!",
                colors: "Colors can be mixed to make new colors! Red and blue make purple. Yellow and blue make green!"
            },
            intermediate: {
                symmetry: "There are different types of symmetry! Reflection symmetry is like a mirror image. Rotational symmetry means the design looks the same when you turn it.",
                patterns: "Patterns in fashion can be regular (same all over) or irregular (changing). They're based on math rules that designers follow!",
                colors: "Colors have relationships on a color wheel! Complementary colors are opposite each other. Analogous colors are next to each other."
            },
            advanced: {
                symmetry: "Bilateral symmetry in fashion creates balance, while asymmetry creates visual interest! The golden ratio (1.618:1) is often used to create pleasing proportions in design.",
                patterns: "Tessellations are patterns made of shapes that fit perfectly together with no gaps! Artist M.C. Escher was famous for his tessellations of animals and other figures.",
                colors: "The RGB color model uses additive synthesis, while CMYK uses subtractive synthesis! Digital screens use RGB (Red, Green, Blue) to create millions of colors."
            }
        };

        // Initialize P5.js sketch
        new p5(function(p) {
            p.setup = function() {
                const canvas = p.createCanvas(400, 500);
                canvas.parent('canvas-container');
                p5Canvas = p;
                p.noLoop();
                drawCharacter();
            };
            
            p.draw = function() {
                // Main drawing happens in drawCharacter function
            };
        });
        
        // Draw character with selected outfit
        function drawCharacter() {
            p5Canvas.background(255);
            
            // Character basics
            if (currentCharacter === 'character1') {
                // Draw character body - Alex
                p5Canvas.fill(255, 219, 172); // Skin tone
                p5Canvas.ellipse(200, 100, 80, 80); // Head
                
                // Draw character body silhouette
                p5Canvas.fill(240, 240, 240);
                p5Canvas.rect(170, 140, 60, 100, 10); // Torso
                p5Canvas.rect(160, 240, 30, 120, 10); // Left leg
                p5Canvas.rect(210, 240, 30, 120, 10); // Right leg
                p5Canvas.rect(150, 150, 25, 80, 10); // Left arm
                p5Canvas.rect(225, 150, 25, 80, 10); // Right arm
                
            } else {
                // Draw character body - Jordan
                p5Canvas.fill(245, 203, 167); // Skin tone
                p5Canvas.ellipse(200, 100, 80, 80); // Head
                
                // Draw character body silhouette
                p5Canvas.fill(240, 240, 240);
                p5Canvas.rect(170, 140, 60, 100, 10); // Torso
                p5Canvas.rect(160, 240, 30, 120, 10); // Left leg
                p5Canvas.rect(210, 240, 30, 120, 10); // Right leg
                p5Canvas.rect(150, 150, 25, 80, 10); // Left arm
                p5Canvas.rect(225, 150, 25, 80, 10); // Right arm
            }
            
            // Draw outfit items
            drawOutfitItems();
            
            // Draw face
            p5Canvas.fill(0);
            p5Canvas.ellipse(185, 95, 8, 8); // Left eye
            p5Canvas.ellipse(215, 95, 8, 8); // Right eye
            p5Canvas.stroke(0);
            p5Canvas.noFill();
            p5Canvas.arc(200, 115, 30, 20, 0, p5Canvas.PI); // Smile
        }
        
        // Draw the selected outfit items on the character
        function drawOutfitItems() {
            // Draw tops
            if (outfitItems.tops) {
                let item = getItemById(outfitItems.tops, 'tops');
                p5Canvas.fill(item.color);
                
                // Apply symmetry and complexity to the pattern
                if (item.pattern === 'solid') {
                    p5Canvas.rect(165, 140, 70, 100, 10); // Simple top
                } else if (item.pattern === 'polka') {
                    p5Canvas.rect(165, 140, 70, 100, 10); // Base top
                    p5Canvas.fill(255);
                    // Draw polka dots with complexity
                    for (let i = 0; i < patternComplexity * 3; i++) {
                        p5Canvas.ellipse(
                            p5Canvas.random(175, 225),
                            p5Canvas.random(150, 230),
                            8, 8
                        );
                    }
                } else if (item.pattern === 'stripe') {
                    p5Canvas.rect(165, 140, 70, 100, 10); // Base top
                    p5Canvas.fill(255);
                    // Draw stripes with complexity
                    let stripeWidth = 10 / patternComplexity;
                    for (let i = 150; i < 240; i += stripeWidth * 2) {
                        p5Canvas.rect(165, i, 70, stripeWidth);
                    }
                } else if (item.pattern === 'gradient') {
                    // Create gradient effect
                    for (let i = 0; i < 100; i++) {
                        let c = p5Canvas.lerpColor(
                            p5Canvas.color(item.color),
                            p5Canvas.color(255),
                            i / 100
                        );
                        p5Canvas.fill(c);
                        p5Canvas.rect(165, 140 + i, 70, 1, 10);
                    }
                } else if (item.pattern === 'plaid') {
                    p5Canvas.rect(165, 140, 70, 100, 10); // Base top
                    p5Canvas.fill(255);
                    // Horizontal stripes
                    let stripeWidth = 15 / patternComplexity;
                    for (let i = 150; i < 240; i += stripeWidth * 2) {
                        p5Canvas.rect(165, i, 70, stripeWidth/2);
                    }
                    // Vertical stripes
                    for (let i = 175; i < 225; i += stripeWidth * 2) {
                        p5Canvas.rect(i, 140, stripeWidth/2, 100);
                    }
                }
            }
            
            // Draw bottoms
            if (outfitItems.bottoms) {
                let item = getItemById(outfitItems.bottoms, 'bottoms');
                p5Canvas.fill(item.color);
                
                if (item.pattern === 'solid') {
                    p5Canvas.rect(160, 240, 80, 120, 10); // Simple bottoms
                } else if (item.pattern === 'pleated') {
                    // Draw pleated skirt
                    p5Canvas.rect(160, 240, 80, 120, 10); // Base
                    p5Canvas.fill(p5Canvas.lerpColor(p5Canvas.color(item.color), p5Canvas.color(0), 0.2));
                    let pleats = patternComplexity + 2;
                    let pleatWidth = 80 / pleats;
                    for (let i = 0; i < pleats; i++) {
                        if (i % 2 === 0) {
                            p5Canvas.rect(160 + i * pleatWidth, 240, pleatWidth, 120);
                        }
                    }
                } else if (item.pattern === 'stripe') {
                    p5Canvas.rect(160, 240, 80, 120, 10); // Base
                    p5Canvas.fill(255);
                    // Horizontal stripes
                    let stripeWidth = 15 / patternComplexity;
                    for (let i = 250; i < 360; i += stripeWidth * 2) {
                        p5Canvas.rect(160, i, 80, stripeWidth);
                    }
                } else if (item.pattern === 'print') {
                    p5Canvas.rect(160, 240, 80, 120, 10); // Base
                    p5Canvas.fill(255);
                    // Various shapes based on complexity
                    for (let i = 0; i < patternComplexity * 5; i++) {
                        let x = p5Canvas.random(165, 235);
                        let y = p5Canvas.random(250, 350);
                        let size = p5Canvas.random(5, 10);
                        
                        if (i % 3 === 0) {
                            p5Canvas.ellipse(x, y, size, size); // Circles
                        } else if (i % 3 === 1) {
                            p5Canvas.rect(x, y, size, size); // Squares
                        } else {
                            p5Canvas.triangle(x, y, x + size, y, x + size/2, y - size); // Triangles
                        }
                    }
                }
            }
            
            // Draw shoes
            if (outfitItems.shoes) {
                let item = getItemById(outfitItems.shoes, 'shoes');
                p5Canvas.fill(item.color);
                
                // Left shoe
                p5Canvas.ellipse(175, 370, 40, 20);
                // Right shoe
                p5Canvas.ellipse(225, 370, 40, 20);
                
                if (item.pattern === 'texture') {
                    p5Canvas.fill(p5Canvas.lerpColor(p5Canvas.color(item.color), p5Canvas.color(0), 0.2));
                    for (let i = 0; i < patternComplexity * 3; i++) {
                        p5Canvas.ellipse(
                            p5Canvas.random(155, 195),
                            p5Canvas.random(365, 375),
                            3, 3
                        );
                        p5Canvas.ellipse(
                            p5Canvas.random(205, 245),
                            p5Canvas.random(365, 375),
                            3, 3
                        );
                    }
                } else if (item.pattern === 'fluffy') {
                    // Fluffy texture effect
                    for (let i = 0; i < patternComplexity * 10; i++) {
                        p5Canvas.stroke(255);
                        p5Canvas.line(
                            p5Canvas.random(155, 195),
                            p5Canvas.random(360, 380),
                            p5Canvas.random(155, 195),
                            p5Canvas.random(360, 380)
                        );
                        p5Canvas.line(
                            p5Canvas.random(205, 245),
                            p5Canvas.random(360, 380),
                            p5Canvas.random(205, 245),
                            p5Canvas.random(360, 380)
                        );
                    }
                    p5Canvas.noStroke();
                }
            }
            
            // Draw accessories
            outfitItems.accessories.forEach(accId => {
                let item = getItemById(accId, 'accessories');
                p5Canvas.fill(item.color);
                
                if (item.name === 'Hat') {
                    p5Canvas.ellipse(200, 65, 90, 30); // Hat brim
                    p5Canvas.rect(180, 35, 40, 30, 5); // Hat top
                } else if (item.name === 'Scarf') {
                    p5Canvas.rect(180, 135, 40, 20, 5); // Scarf around neck
                    p5Canvas.rect(220, 145, 20, 50, 5); // Scarf hanging down
                } else if (item.name === 'Glasses') {
                    p5Canvas.noFill();
                    p5Canvas.stroke(item.color);
                    p5Canvas.strokeWeight(2);
                    p5Canvas.ellipse(185, 95, 20, 20); // Left lens
                    p5Canvas.ellipse(215, 95, 20, 20); // Right lens
                    p5Canvas.line(195, 95, 205, 95); // Bridge
                    p5Canvas.noStroke();
                    p5Canvas.strokeWeight(1);
                } else if (item.name === 'Necklace') {
                    p5Canvas.noFill();
                    p5Canvas.stroke(item.color);
                    p5Canvas.strokeWeight(2);
                    p5Canvas.arc(200, 130, 40, 20, 0, p5Canvas.PI); // Necklace arc
                    p5Canvas.noStroke();
                    p5Canvas.strokeWeight(1);
                } else if (item.name === 'Backpack') {
                    p5Canvas.rect(150, 170, 20, 40, 5); // Backpack
                }
            });
        }
        
        // Helper to get item by id from a category
        function getItemById(id, category) {
            return clothingItems[category].find(item => item.id === id);
        }
        
        // Initialize the game
        function initGame() {
            // Add event listeners to tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    switchCategory(category);
                });
            });
            
            // Generate clothing items
            generateClothingItems();
            
            // Add event listeners to character options
            document.querySelectorAll('.character-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.character-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    currentCharacter = this.getAttribute('data-character');
                    drawCharacter();
                });
            });
            
            // Add event listeners to sliders
            document.getElementById('symmetry-slider').addEventListener('input', function() {
                symmetryValue = parseInt(this.value);
                document.getElementById('symmetry-value').textContent = symmetryValue;
                drawCharacter();
                updateLearningContent();
            });
            
            document.getElementById('pattern-complexity').addEventListener('input', function() {
                patternComplexity = parseInt(this.value);
                document.getElementById('complexity-value').textContent = patternComplexity;
                drawCharacter();
                updateLearningContent();
            });
            
            document.getElementById('color-harmony').addEventListener('input', function() {
                colorHarmony = parseInt(this.value);
                document.getElementById('harmony-value').textContent = colorHarmony;
                drawCharacter();
                updateLearningContent();
            });
            
            // Random outfit button
            document.getElementById('random-outfit').addEventListener('click', function() {
                createRandomOutfit();
            });
            
            // Quiz button
            document.getElementById('take-quiz').addEventListener('click', function() {
                openQuiz();
            });
            
            // Learning toggle
            document.querySelector('.learning-toggle').addEventListener('click', function() {
                if (learningLevel === 'basic') {
                    learningLevel = 'intermediate';
                    this.innerHTML = 'Learning Mode: Intermediate <span class="toggle-dot"></span>';
                } else if (learningLevel === 'intermediate') {
                    learningLevel = 'advanced';
                    this.innerHTML = 'Learning Mode: Advanced <span class="toggle-dot"></span>';
                } else {
                    learningLevel = 'basic';
                    this.innerHTML = 'Learning Mode: Basic <span class="toggle-dot"></span>';
                }
                updateLearningContent();
            });
            
            // Close modal
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('quiz-modal').style.display = 'none';
            });
            
            // Initial content update
            updateLearningContent();
        }
        
        // Switch between clothing categories
        function switchCategory(category) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-category') === category) {
                    tab.classList.add('active');
                }
            });
            
            // Hide all containers
            document.querySelectorAll('.clothing-container').forEach(container => {
                container.style.display = 'none';
            });
            
            // Show selected container
            document.getElementById(category + '-container').style.display = 'flex';
            
            currentCategory = category;
        }
        
        // Generate clothing items in the UI
        function generateClothingItems() {
            // Generate for each category
            Object.keys(clothingItems).forEach(category => {
                const container = document.getElementById(category + '-container');
                container.innerHTML = ''; // Clear container
                
                clothingItems[category].forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'clothing-item';
                    itemEl.setAttribute('data-id', item.id);
                    itemEl.style.backgroundColor = item.color;
                    
                    // Add pattern indicator
                    if (item.pattern === 'polka') {
                        itemEl.innerHTML = '<div style="width:10px;height:10px;background-color:white;border-radius:50%;"></div>';
                    } else if (item.pattern === 'stripe') {
                        itemEl.innerHTML = '<div style="width:30px;height:5px;background-color:white;"></div>';
                    } else if (item.pattern === 'plaid') {
                        itemEl.innerHTML = '<div style="width:30px;height:30px;background:linear-gradient(to right, transparent 40%, white 40%, white 60%, transparent 60%),linear-gradient(to bottom, transparent 40%, white 40%, white 60%, transparent 60%);"></div>';
                    } else if (item.pattern === 'gradient') {
                        itemEl.style.background = `linear-gradient(${item.color}, white)`;
                    }
                    
                    // Create tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = item.name;
                    itemEl.appendChild(tooltip);
                    
                    // Show tooltip on hover
                    itemEl.addEventListener('mouseover', function() {
                        tooltip.style.display = 'block';
                        tooltip.style.top = '-25px';
                        tooltip.style.left = '0';
                    });
                    
                    itemEl.addEventListener('mouseout', function() {
                        tooltip.style.display = 'none';
                    });
                    
                    // Add click event
                    itemEl.addEventListener('click', function() {
                        selectItem(item.id, category);
                    });
                    
                    container.appendChild(itemEl);
                });
            });
        }
        
        // Select a clothing item
        function selectItem(itemId, category) {
            // Update UI
            document.querySelectorAll(`#${category}-container .clothing-item`).forEach(item => {
                item.classList.remove('selected');
                if (item.getAttribute('data-id') === itemId) {
                    item.classList.add('selected');
                }
            });
            
            // Update outfit
            if (category === 'accessories') {
                // Toggle accessory
                const index = outfitItems.accessories.indexOf(itemId);
                if (index === -1) {
                    outfitItems.accessories.push(itemId);
                } else {
                    outfitItems.accessories.splice(index, 1);
                }
            } else {
                outfitItems[category] = itemId;
            }
            
            // Redraw character
            drawCharacter();
            
            // Update learning content
            updateLearningContent();
            
            // Update progress
            updateProgress();
        }
        
        // Create a random outfit
        function createRandomOutfit() {
            // Clear accessories
            outfitItems.accessories = [];
            
            // Random top
            const randomTop = clothingItems.tops[Math.floor(Math.random() * clothingItems.tops.length)].id;
            selectItem(randomTop, 'tops');
            
            // Random bottom
            const randomBottom = clothingItems.bottoms[Math.floor(Math.random() * clothingItems.bottoms.length)].id;
            selectItem(randomBottom, 'bottoms');
            
            // Random shoes
            const randomShoes = clothingItems.shoes[Math.floor(Math.random() * clothingItems.shoes.length)].id;
            selectItem(randomShoes, 'shoes');
            
            // Random number of accessories (0-2)
            const numAccessories = Math.floor(Math.random() * 3);
            for (let i = 0; i < numAccessories; i++) {
                const randomAccessory = clothingItems.accessories[Math.floor(Math.random() * clothingItems.accessories.length)].id;
                // Avoid duplicates
                if (!outfitItems.accessories.includes(randomAccessory)) {
                    selectItem(randomAccessory, 'accessories');
                }
            }
            
            // Random parameters
            document.getElementById('symmetry-slider').value = Math.floor(Math.random() * 10) + 1;
            document.getElementById('symmetry-value').textContent = document.getElementById('symmetry-slider').value;
            symmetryValue = parseInt(document.getElementById('symmetry-slider').value);
            
            document.getElementById('pattern-complexity').value = Math.floor(Math.random() * 10) + 1;
            document.getElementById('complexity-value').textContent = document.getElementById('pattern-complexity').value;
            patternComplexity = parseInt(document.getElementById('pattern-complexity').value);
            
            document.getElementById('color-harmony').value = Math.floor(Math.random() * 10) + 1;
            document.getElementById('harmony-value').textContent = document.getElementById('color-harmony').value;
            colorHarmony = parseInt(document.getElementById('color-harmony').value);
            
            // Redraw character
            drawCharacter();
            updateLearningContent();
        }
        
        // Update learning content
        function updateLearningContent() {
            const dynamicContent = document.getElementById('dynamic-learning');
            let content = '';
            
            // Get outfit items concepts
            if (outfitItems.tops) {
                const topItem = getItemById(outfitItems.tops, 'tops');
                content += `<div class="learning-content">
                    <div class="learning-title">About Your Top</div>
                    <p>${topItem.concept}</p>
                </div>`;
            }
            
            if (outfitItems.bottoms) {
                const bottomItem = getItemById(outfitItems.bottoms, 'bottoms');
                content += `<div class="learning-content">
                    <div class="learning-title">About Your Bottoms</div>
                    <p>${bottomItem.concept}</p>
                </div>`;
            }
            
            if (outfitItems.shoes) {
                const shoesItem = getItemById(outfitItems.shoes, 'shoes');
                content += `<div class="learning-content">
                    <div class="learning-title">About Your Shoes</div>
                    <p>${shoesItem.concept}</p>
                </div>`;
            }
            
            // Add parameter-based learning content
            content += `<div class="learning-content">
                <div class="learning-title">Symmetry in Fashion</div>
                <p>${learningModules[learningLevel].symmetry}</p>
                <div class="geometry-demo">
                    <p>Your symmetry setting (${symmetryValue}/10) affects balance in design.</p>
                    <p>High symmetry creates formal, traditional designs, while lower symmetry creates more dynamic, artistic outfits.</p>
                </div>
            </div>`;
            
            content += `<div class="learning-content">
                <div class="learning-title">Pattern Mathematics</div>
                <p>${learningModules[learningLevel].patterns}</p>
                <div class="pattern-demo">
                    <p>Your pattern complexity (${patternComplexity}/10) relates to how many elements repeat in your design.</p>
                    <p>This demonstrates mathematical concepts like frequency, recursion, and fractal geometry!</p>
                </div>
            </div>`;
            
            content += `<div class="learning-content">
                <div class="learning-title">Color Theory</div>
                <p>${learningModules[learningLevel].colors}</p>
                <div class="color-theory">
                    <p>Your color harmony setting (${colorHarmony}/10) affects how colors work together.</p>
                    <p>This uses principles from the RGB color model, where Red + Green + Blue = White light!</p>
                </div>
            </div>`;
            
            // Add outfit harmony analysis
            if (outfitItems.tops && outfitItems.bottoms && outfitItems.shoes) {
                const harmonyScore = calculateHarmonyScore();
                content += `<div class="learning-content">
                    <div class="learning-title">Outfit Harmony Analysis</div>
                    <p>Your outfit harmony score is: ${harmonyScore}/10</p>
                    <p>${getHarmonyFeedback(harmonyScore)}</p>
                </div>`;
            }
            
            dynamicContent.innerHTML = content;
        }
        
        // Calculate outfit harmony score
        function calculateHarmonyScore() {
            if (!outfitItems.tops || !outfitItems.bottoms || !outfitItems.shoes) {
                return 0;
            }
            
            // Base score from user parameters
            let score = (symmetryValue + patternComplexity + colorHarmony) / 3;
            
            // Adjust based on color complementarity
            const topColor = getItemById(outfitItems.tops, 'tops').color;
            const bottomColor = getItemById(outfitItems.bottoms, 'bottoms').color;
            const shoesColor = getItemById(outfitItems.shoes, 'shoes').color;
            
            // Simple color harmony check (simplified)
            if (topColor === bottomColor && bottomColor === shoesColor) {
                // Monochromatic - can be good or boring depending on complexity
                score = Math.min(10, score + patternComplexity * 0.2);
            } else if (topColor !== bottomColor && bottomColor !== shoesColor && topColor !== shoesColor) {
                // All different colors - can be chaotic or interesting
                score = Math.min(10, score + colorHarmony * 0.2);
            } else {
                // Two matching colors - often balanced
                score = Math.min(10, score + symmetryValue * 0.2);
            }
            
            return Math.round(score);
        }
        
        // Get feedback based on harmony score
        function getHarmonyFeedback(score) {
            if (score >= 8) {
                return "Excellent! Your outfit shows mastery of fashion principles. It demonstrates balance between symmetry, pattern complexity, and color harmony.";
            } else if (score >= 6) {
                return "Good work! Your outfit shows understanding of key fashion concepts. Consider how adjusting symmetry, patterns, or colors might enhance it further.";
            } else {
                return "Keep experimenting! Fashion design is all about creativity. Try different combinations of colors, patterns, and balancing symmetry to see how they work together.";
            }
        }
        
        // Update progress
        function updateProgress() {
            let progress = 0;
            
            // Calculate progress based on items selected and parameters adjusted
            if (outfitItems.tops) progress += 15;
            if (outfitItems.bottoms) progress += 15;
            if (outfitItems.shoes) progress += 15;
            if (outfitItems.accessories.length > 0) progress += 15;
            
            // Parameter adjustments
            if (symmetryValue !== 5) progress += 10;
            if (patternComplexity !== 5) progress += 10;
            if (colorHarmony !== 5) progress += 10;
            
            // Limit to 100%
            progress = Math.min(100, progress);
            
            // Update progress bar
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = progress + '%';
            
            // Update user progress
            userProgress = progress;
            
            // Check for level up
            checkForLevelUp();
        }
        
        // Check for level up
        function checkForLevelUp() {
            const oldLevel = currentLevel;
            
            // Level up based on progress
            if (userProgress >= 90 && currentLevel < 3) {
                currentLevel = 3;
            } else if (userProgress >= 60 && currentLevel < 2) {
                currentLevel = 2;
            }
            
            // Update level display
            document.getElementById('current-level').textContent = currentLevel;
            
            // Show level up message if changed
            if (oldLevel !== currentLevel) {
                alert(`Congratulations! You've reached Level ${currentLevel}!`);
            }
        }
        
        // Open quiz
        function openQuiz() {
            // Show modal
            document.getElementById('quiz-modal').style.display = 'flex';
            
            // Select questions based on level
            let numQuestions = currentLevel * 2;
            const selectedQuestions = [];
            
            // Randomly select questions
            const availableQuestions = [...quizQuestions];
            for (let i = 0; i < numQuestions && availableQuestions.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                selectedQuestions.push(availableQuestions[randomIndex]);
                availableQuestions.splice(randomIndex, 1);
            }
            
            // Generate quiz HTML
            let quizHTML = '';
            selectedQuestions.forEach((q, index) => {
                quizHTML += `
                    <div class="quiz-item" data-index="${index}">
                        <div class="quiz-question">${index + 1}. ${q.question}</div>
                        <div class="quiz-options">
                            ${q.options.map((option, i) => `
                                <div class="quiz-option" data-correct="${option === q.correctAnswer}" data-index="${i}">${option}</div>
                            `).join('')}
                        </div>
                        <div class="quiz-feedback correct-feedback" style="display: none;">
                            Correct! ${q.explanation}
                        </div>
                        <div class="quiz-feedback incorrect-feedback" style="display: none;">
                            Not quite. ${q.explanation}
                        </div>
                    </div>
                `;
            });
            
            quizHTML += `<div class="button" id="check-answers">Check Answers</div>`;
            
            // Add to container
            document.getElementById('quiz-container').innerHTML = quizHTML;
            
            // Add event listeners to options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Deselect other options in this question
                    const questionIndex = this.parentElement.parentElement.getAttribute('data-index');
                    document.querySelectorAll(`.quiz-item[data-index="${questionIndex}"] .quiz-option`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select this option
                    this.classList.add('selected');
                });
            });
            
            // Add event listener to check answers button
            document.getElementById('check-answers').addEventListener('click', function() {
                checkQuizAnswers();
            });
        }
        
        // Check quiz answers
        function checkQuizAnswers() {
            let correctAnswers = 0;
            let totalQuestions = document.querySelectorAll('.quiz-item').length;
            
            // Check each question
            document.querySelectorAll('.quiz-item').forEach(question => {
                const selectedOption = question.querySelector('.quiz-option.selected');
                
                // If an option is selected
                if (selectedOption) {
                    if (selectedOption.getAttribute('data-correct') === 'true') {
                        selectedOption.classList.add('correct');
                        question.querySelector('.correct-feedback').style.display = 'block';
                        question.querySelector('.incorrect-feedback').style.display = 'none';
                        correctAnswers++;
                    } else {
                        selectedOption.classList.add('incorrect');
                        question.querySelector('.incorrect-feedback').style.display = 'block';
                        question.querySelector('.correct-feedback').style.display = 'none';
                        
                        // Highlight correct answer
                        question.querySelectorAll('.quiz-option').forEach(option => {
                            if (option.getAttribute('data-correct') === 'true') {
                                option.classList.add('correct');
                            }
                        });
                    }
                }
            });
            
            // Show results
            let resultMessage = `You got ${correctAnswers} out of ${totalQuestions} correct!`;
            if (correctAnswers === totalQuestions) {
                resultMessage += " Perfect score! You're a fashion and math genius!";
            } else if (correctAnswers >= totalQuestions * 0.7) {
                resultMessage += " Great job! You're learning fast!";
            } else {
                resultMessage += " Keep learning and try again!";
            }
            
            alert(resultMessage);
            
            // Update progress
            userProgress += Math.round((correctAnswers / totalQuestions) * 20);
            updateProgress();
        }
        
        // Initialize the game on load
        window.addEventListener('load', function() {
            initGame();
            
            // Create initial outfit
            createRandomOutfit();
        });
    </script>
</body>
</html>