<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factor Friends: Binomial and Trinomial Adventure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        :root {
            --primary-color: #4287f5;
            --secondary-color: #f542a7;
            --tertiary-color: #42f5b3;
            --background-color: #f0f8ff;
            --text-color: #333;
            --success-color: #42f56f;
            --error-color: #f54242;
            --neutral-color: #f5d442;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Arial', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 18px;
            line-height: 1.6;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        h2 {
            font-size: 2rem;
            margin: 1rem 0;
            color: var(--primary-color);
        }

        h3 {
            font-size: 1.5rem;
            margin: 0.8rem 0;
            color: var(--secondary-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            flex: 1;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
        }

        #gameCanvas {
            border: 5px solid var(--primary-color);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: white;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button.secondary {
            background-color: var(--secondary-color);
        }

        button.tertiary {
            background-color: var(--tertiary-color);
            color: var(--text-color);
        }

        .section {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab {
            padding: 0.6rem 1.2rem;
            background-color: #e0e0e0;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .character {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .character-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--neutral-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .character-speech {
            background-color: #fff;
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            padding: 1rem;
            position: relative;
            max-width: 70%;
        }

        .character-speech:before {
            content: '';
            position: absolute;
            top: 20px;
            left: -15px;
            border-width: 15px 15px 15px 0;
            border-style: solid;
            border-color: transparent var(--primary-color) transparent transparent;
        }

        .character-speech:after {
            content: '';
            position: absolute;
            top: 20px;
            left: -12px;
            border-width: 15px 15px 15px 0;
            border-style: solid;
            border-color: transparent #fff transparent transparent;
        }

        .quiz-container {
            background-color: #fff;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .quiz-question {
            margin-bottom: 1rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .quiz-option {
            padding: 0.8rem;
            background-color: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .quiz-option:hover {
            background-color: #e0e0e0;
        }

        .quiz-option.selected {
            background-color: var(--neutral-color);
        }

        .quiz-option.correct {
            background-color: var(--success-color);
            color: white;
        }

        .quiz-option.incorrect {
            background-color: var(--error-color);
            color: white;
        }

        .quiz-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
        }

        .quiz-feedback.correct {
            background-color: rgba(66, 245, 111, 0.2);
            border: 1px solid var(--success-color);
        }

        .quiz-feedback.incorrect {
            background-color: rgba(245, 66, 66, 0.2);
            border: 1px solid var(--error-color);
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            width: 0;
            transition: width 0.5s;
        }

        .star-container {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .star {
            font-size: 2rem;
            color: #ccc;
        }

        .star.earned {
            color: var(--neutral-color);
            animation: starPulse 0.5s ease-in-out;
        }

        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            background-color: var(--neutral-color);
            color: var(--text-color);
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 0.3rem;
        }

        .badge.earned {
            background-color: var(--success-color);
            color: white;
        }

        .parameter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
        }

        .parameter-control {
            display: flex;
            flex-direction: column;
            width: 200px;
        }

        .parameter-control label {
            margin-bottom: 0.3rem;
            font-weight: bold;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .slider-container input {
            flex: 1;
        }

        .slider-value {
            min-width: 30px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            border-bottom: 1px dotted var(--primary-color);
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .badge-collection {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        footer {
            background-color: var(--text-color);
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: auto;
        }

        .challenge-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .challenge-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .challenge-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        .challenge-body {
            padding: 1rem;
        }

        .challenge-footer {
            padding: 1rem;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.8rem;
            }
            
            h3 {
                font-size: 1.3rem;
            }
            
            .character {
                flex-direction: column;
                text-align: center;
            }
            
            .character-speech {
                max-width: 100%;
            }
            
            .character-speech:before, .character-speech:after {
                display: none;
            }
            
            .parameter-control {
                width: 100%;
            }
        }

        /* Animation classes */
        .bounce {
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .pulse {
            animation: pulse 1s ease infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .rotate {
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .factory-ui {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
        }

        .factory-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .machine-container {
            position: relative;
            width: 100%;
            height: 400px;
            background-color: #f9f9f9;
            border: 3px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }

        .conveyor-belt {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            height: 30px;
            background-color: #777;
        }

        .conveyor-markings {
            height: 100%;
            background-image: repeating-linear-gradient(90deg, #999, #999 20px, #777 20px, #777 40px);
            animation: conveyorMove 2s linear infinite;
        }

        @keyframes conveyorMove {
            from { background-position: 0 0; }
            to { background-position: 40px 0; }
        }

        .machine-body {
            position: absolute;
            width: 200px;
            height: 250px;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            border-radius: 15px;
            border: 5px solid #444;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
        }

        .machine-screen {
            width: 90%;
            height: 60px;
            background-color: #222;
            border-radius: 8px;
            color: #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-family: 'Courier New', monospace;
        }

        .machine-buttons {
            display: flex;
            gap: 10px;
        }

        .machine-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f00;
            cursor: pointer;
            border: 2px solid #000;
        }

        .machine-input {
            position: absolute;
            top: 320px;
            left: 20%;
            width: 60px;
            height: 40px;
            background-color: #ff0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #000;
        }

        .machine-output {
            position: absolute;
            top: 320px;
            right: 20%;
            width: 60px;
            height: 40px;
            background-color: #0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #000;
        }

        .tile {
            width: 50px;
            height: 50px;
            background-color: var(--neutral-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .tile:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .tile-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin: 1rem 0;
        }

        .exercise-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
        }

        .equation-display {
            font-size: 2rem;
            margin: 1rem 0;
            padding: 1rem;
            background-color: white;
            border-radius: 10px;
            border: 2px solid var(--primary-color);
            min-width: 300px;
            text-align: center;
        }

        .drop-area {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
            min-height: 100px;
            border: 3px dashed var(--primary-color);
            border-radius: 10px;
            padding: 1rem;
            background-color: rgba(66, 135, 245, 0.1);
        }

        /* Game-specific styles */
        .binomial-info, .trinomial-info {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>Factor Friends: Binomial and Trinomial Adventure</h1>
        <p>An exciting journey into the world of factoring expressions!</p>
    </header>

    <div class="container">
        <div class="section">
            <div class="character">
                <div class="character-image" style="background-color: #f542a7;">
                    <span>B</span>
                </div>
                <div class="character-speech">
                    <h3>Meet Binny!</h3>
                    <p>Hi there! I'm Binny the Binomial! I have two terms, like x² + 3x or 5y - 10. Let's explore how to factor binomials together!</p>
                </div>
            </div>

            <div class="character">
                <div class="character-image" style="background-color: #42f5b3;">
                    <span>T</span>
                </div>
                <div class="character-speech">
                    <h3>Meet Trio!</h3>
                    <p>Hello! I'm Trio the Trinomial! I have three terms, like x² + 5x + 6 or 2y² - 7y + 3. Let me show you how to break me down into factors!</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Choose Your Adventure!</h2>
            <div class="tabs">
                <div class="tab active" data-tab="learn">Learn</div>
                <div class="tab" data-tab="play">Play</div>
                <div class="tab" data-tab="challenge">Challenge</div>
                <div class="tab" data-tab="settings">Settings</div>
            </div>

            <div class="tab-content active" id="learn">
                <div class="character">
                    <div class="character-image" style="background-color: #4287f5;">
                        <span>P</span>
                    </div>
                    <div class="character-speech">
                        <h3>Meet Professor Poly!</h3>
                        <p>Welcome to Factor Friends! I'll guide you through the exciting world of factoring. Let's start by understanding what factoring means.</p>
                        <p>Factoring is like finding the ingredients that make up a recipe. When we factor an expression, we're breaking it down into simpler parts that multiply together to give us the original expression.</p>
                    </div>
                </div>

                <div class="tabs" style="margin-top: 2rem;">
                    <div class="tab active" data-tab="binomial-info">Binomials</div>
                    <div class="tab" data-tab="trinomial-info">Trinomials</div>
                </div>

                <div class="tab-content active" id="binomial-info">
                    <h3>What is a Binomial?</h3>
                    <p>A binomial is an expression with exactly two terms. For example:</p>
                    <ul>
                        <li>x² - 4</li>
                        <li>5y + 10</li>
                        <li>3z² - 12</li>
                    </ul>

                    <h3>Factoring Binomials: Special Patterns</h3>
                    
                    <h4>1. Difference of Squares</h4>
                    <p>When a binomial looks like a² - b², it can be factored as (a + b)(a - b).</p>
                    <p>For example: x² - 4 = x² - 2² = (x + 2)(x - 2)</p>
                    
                    <div class="machine-container">
                        <div class="conveyor-belt">
                            <div class="conveyor-markings"></div>
                        </div>
                        <div class="machine-body">
                            <div class="machine-screen">a² - b²</div>
                            <div>↓ Factoring Machine ↓</div>
                            <div class="machine-screen">(a + b)(a - b)</div>
                        </div>
                        <div class="machine-input" id="binomialInput">x² - 4</div>
                        <div class="machine-output" id="binomialOutput">(x + 2)(x - 2)</div>
                    </div>

                    <h4>2. Perfect Square Trinomials (as special binomials)</h4>
                    <p>Sometimes, we have expressions like (x + 3)² which expands to x² + 6x + 9. The reverse process is factoring.</p>
                    <p>Key pattern: a² + 2ab + b² = (a + b)²</p>
                    <p>Key pattern: a² - 2ab + b² = (a - b)²</p>

                    <h4>3. Common Factor</h4>
                    <p>If both terms share a common factor, we can factor it out.</p>
                    <p>For example: 5x + 10 = 5(x + 2)</p>

                    <button class="try-binomial">Try Factoring Binomials Now!</button>
                </div>

                <div class="tab-content" id="trinomial-info">
                    <h3>What is a Trinomial?</h3>
                    <p>A trinomial is an expression with exactly three terms. For example:</p>
                    <ul>
                        <li>x² + 5x + 6</li>
                        <li>2y² - 7y + 3</li>
                        <li>3z² + 2z - 8</li>
                    </ul>

                    <h3>Factoring Trinomials: Step by Step</h3>
                    
                    <h4>1. First, look for common factors</h4>
                    <p>If all terms share a common factor, factor it out first.</p>
                    <p>For example: 3x² + 6x + 9 = 3(x² + 2x + 3)</p>
                    
                    <h4>2. For trinomials like x² + bx + c</h4>
                    <p>Find two numbers m and n such that:</p>
                    <ul>
                        <li>m × n = c (the last term)</li>
                        <li>m + n = b (the coefficient of the middle term)</li>
                    </ul>
                    <p>Then the factored form is (x + m)(x + n)</p>
                    <p>For example: x² + 5x + 6</p>
                    <p>We need numbers that multiply to 6 and add to 5. The numbers are 2 and 3.</p>
                    <p>So, x² + 5x + 6 = (x + 2)(x + 3)</p>

                    <div class="machine-container">
                        <div class="conveyor-belt">
                            <div class="conveyor-markings"></div>
                        </div>
                        <div class="machine-body">
                            <div class="machine-screen">x² + bx + c</div>
                            <div>↓ Factoring Machine ↓</div>
                            <div class="machine-screen">(x + m)(x + n)</div>
                        </div>
                        <div class="machine-input" id="trinomialInput">x² + 5x + 6</div>
                        <div class="machine-output" id="trinomialOutput">(x + 2)(x + 3)</div>
                    </div>

                    <h4>3. For trinomials like ax² + bx + c (where a ≠ 1)</h4>
                    <p>This is a bit more complex, but here's a simple approach:</p>
                    <ol>
                        <li>Multiply a × c to get ac</li>
                        <li>Find two numbers p and q such that p × q = ac and p + q = b</li>
                        <li>Rewrite the middle term bx as px + qx</li>
                        <li>Group the terms and factor by pairs</li>
                    </ol>
                    <p>Example: 2x² + 7x + 3</p>
                    <p>ac = 2 × 3 = 6</p>
                    <p>We need numbers that multiply to 6 and add to 7. The numbers are 1 and 6.</p>
                    <p>Rewrite: 2x² + x + 6x + 3</p>
                    <p>Group: (2x² + x) + (6x + 3)</p>
                    <p>Factor out common factors: x(2x + 1) + 3(2x + 1)</p>
                    <p>Factor out (2x + 1): (2x + 1)(x + 3)</p>

                    <button class="try-trinomial">Try Factoring Trinomials Now!</button>
                </div>
            </div>

            <div class="tab-content" id="play">
                <h2>Factoring Factory Game</h2>
                <p>Help Binny and Trio factor expressions by playing these fun games!</p>
                
                <div class="tabs" style="margin-top: 1rem;">
                    <div class="tab active" data-tab="binomial-game">Binomial Factory</div>
                    <div class="tab" data-tab="trinomial-game">Trinomial Factory</div>
                    <div class="tab" data-tab="mixed-game">Mixed Challenges</div>
                </div>

                <div class="tab-content active" id="binomial-game">
                    <div class="game-area">
                        <h3>Binomial Factoring Challenge</h3>
                        <p>Break down these binomials into their factors!</p>
                        
                        <div class="progress-container">
                            <div class="progress-bar" id="binomialProgress" style="width: 0%"></div>
                        </div>

                        <div class="star-container" id="binomialStars">
                            <div class="star star-1">★</div>
                            <div class="star star-2">★</div>
                            <div class="star star-3">★</div>
                            <div class="star star-4">★</div>
                            <div class="star star-5">★</div>
                        </div>

                        <div class="equation-display" id="binomialEquation">x² - 4</div>
                        
                        <div class="drop-area" id="binomialFactorArea">
                            <p>Drag factors here</p>
                        </div>
                        
                        <div class="tile-container" id="binomialTiles">
                            <div class="tile" draggable="true" data-value="(x+2)">x+2</div>
                            <div class="tile" draggable="true" data-value="(x-2)">x-2</div>
                            <div class="tile" draggable="true" data-value="(x+4)">x+4</div>
                            <div class="tile" draggable="true" data-value="(x-4)">x-4</div>
                            <div class="tile" draggable="true" data-value="(2x+1)">2x+1</div>
                            <div class="tile" draggable="true" data-value="(2x-1)">2x-1</div>
                        </div>

                        <div class="controls">
                            <button id="checkBinomialButton">Check Answer</button>
                            <button id="nextBinomialButton" class="secondary">Next Problem</button>
                            <button id="hintBinomialButton" class="tertiary">Hint</button>
                        </div>

                        <div class="quiz-feedback" id="binomialFeedback"></div>
                    </div>
                </div>

                <div class="tab-content" id="trinomial-game">
                    <div class="game-area">
                        <h3>Trinomial Factoring Challenge</h3>
                        <p>Break down these trinomials into their factors!</p>
                        
                        <div class="progress-container">
                            <div class="progress-bar" id="trinomialProgress" style="width: 0%"></div>
                        </div>

                        <div class="star-container" id="trinomialStars">
                            <div class="star star-1">★</div>
                            <div class="star star-2">★</div>
                            <div class="star star-3">★</div>
                            <div class="star star-4">★</div>
                            <div class="star star-5">★</div>
                        </div>

                        <div class="equation-display" id="trinomialEquation">x² + 5x + 6</div>
                        
                        <div class="drop-area" id="trinomialFactorArea">
                            <p>Drag factors here</p>
                        </div>
                        
                        <div class="tile-container" id="trinomialTiles">
                            <div class="tile" draggable="true" data-value="(x+2)">x+2</div>
                            <div class="tile" draggable="true" data-value="(x+3)">x+3</div>
                            <div class="tile" draggable="true" data-value="(x+1)">x+1</div>
                            <div class="tile" draggable="true" data-value="(x+6)">x+6</div>
                            <div class="tile" draggable="true" data-value="(x-1)">x-1</div>
                            <div class="tile" draggable="true" data-value="(x-6)">x-6</div>
                        </div>

                        <div class="controls">
                            <button id="checkTrinomialButton">Check Answer</button>
                            <button id="nextTrinomialButton" class="secondary">Next Problem</button>
                            <button id="hintTrinomialButton" class="tertiary">Hint</button>
                        </div>

                        <div class="quiz-feedback" id="trinomialFeedback"></div>
                    </div>
                </div>

                <div class="tab-content" id="mixed-game">
                    <div class="game-area">
                        <h3>Mixed Factoring Challenge</h3>
                        <p>Factor these expressions and earn rewards!</p>
                        
                        <div class="progress-container">
                            <div class="progress-bar" id="mixedProgress" style="width: 0%"></div>
                        </div>

                        <div class="star-container" id="mixedStars">
                            <div class="star star-1">★</div>
                            <div class="star star-2">★</div>
                            <div class="star star-3">★</div>
                            <div class="star star-4">★</div>
                            <div class="star star-5">★</div>
                        </div>

                        <div class="equation-display" id="mixedEquation">2x² - 8</div>
                        
                        <div class="drop-area" id="mixedFactorArea">
                            <p>Drag factors here</p>
                        </div>
                        
                        <div class="tile-container" id="mixedTiles">
                            <!-- Tiles will be dynamically generated -->
                        </div>

                        <div class="controls">
                            <button id="checkMixedButton">Check Answer</button>
                            <button id="nextMixedButton" class="secondary">Next Problem</button>
                            <button id="hintMixedButton" class="tertiary">Hint</button>
                        </div>

                        <div class="quiz-feedback" id="mixedFeedback"></div>

                        <div class="badge-collection">
                            <div class="badge" id="badge-beginner">Beginner</div>
                            <div class="badge" id="badge-intermediate">Intermediate</div>
                            <div class="badge" id="badge-advanced">Advanced</div>
                            <div class="badge" id="badge-master">Master Factorer</div>
                            <div class="badge" id="badge-perfect">Perfect Score</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="challenge">
                <h2>Challenge Mode</h2>
                <p>Test your factoring skills with these exciting challenges!</p>
                
                <div class="challenge-container">
                    <div class="challenge-card" id="challenge-1">
                        <div class="challenge-header">
                            <h3>Speed Challenge</h3>
                        </div>
                        <div class="challenge-body">
                            <p>Factor as many expressions as you can in 60 seconds!</p>
                            <p><strong>Difficulty:</strong> Easy to Medium</p>
                        </div>
                        <div class="challenge-footer">
                            <button class="start-challenge" data-challenge="1">Start Challenge</button>
                        </div>
                    </div>
                    
                    <div class="challenge-card" id="challenge-2">
                        <div class="challenge-header" style="background-color: var(--secondary-color)">
                            <h3>Advanced Factoring</h3>
                        </div>
                        <div class="challenge-body">
                            <p>Tackle complex expressions with multiple factoring steps.</p>
                            <p><strong>Difficulty:</strong> Hard</p>
                        </div>
                        <div class="challenge-footer">
                            <button class="start-challenge" data-challenge="2">Start Challenge</button>
                        </div>
                    </div>
                    
                    <div class="challenge-card" id="challenge-3">
                        <div class="challenge-header" style="background-color: var(--tertiary-color); color: var(--text-color)">
                            <h3>Factor Memory</h3>
                        </div>
                        <div class="challenge-body">
                            <p>Match expressions with their factored forms in this memory game.</p>
                            <p><strong>Difficulty:</strong> Medium</p>
                        </div>
                        <div class="challenge-footer">
                            <button class="start-challenge" data-challenge="3">Start Challenge</button>
                        </div>
                    </div>
                    
                    <div class="challenge-card" id="challenge-4">
                        <div class="challenge-header" style="background-color: #f54242">
                            <h3>Ultimate Factoring Quiz</h3>
                        </div>
                        <div class="challenge-body">
                            <p>Test all your factoring knowledge with this comprehensive quiz.</p>
                            <p><strong>Difficulty:</strong> Mixed</p>
                        </div>
                        <div class="challenge-footer">
                            <button class="start-challenge" data-challenge="4">Start Challenge</button>
                        </div>
                    </div>
                </div>

                <div id="challenge-area" style="display: none;">
                    <!-- Challenge content will be dynamically loaded here -->
                </div>
            </div>

            <div class="tab-content" id="settings">
                <h2>Game Settings</h2>
                <p>Customize your factoring adventure experience!</p>
                
                <h3>Learning Parameters</h3>
                <div class="parameter-controls">
                    <div class="parameter-control">
                        <label for="difficulty">Difficulty Level</label>
                        <div class="slider-container">
                            <input type="range" id="difficulty" min="1" max="5" value="2">
                            <span class="slider-value" id="difficulty-value">2</span>
                        </div>
                        <small>Adjusts the complexity of expressions</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="hintFrequency">Hint Frequency</label>
                        <div class="slider-container">
                            <input type="range" id="hintFrequency" min="0" max="3" value="1">
                            <span class="slider-value" id="hintFrequency-value">1</span>
                        </div>
                        <small>How often hints are offered</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="expressionTypes">Expression Types</label>
                        <select id="expressionTypes">
                            <option value="all">All Types</option>
                            <option value="binomial">Binomials Only</option>
                            <option value="trinomial">Trinomials Only</option>
                            <option value="common">Common Factor Focus</option>
                            <option value="difference">Difference of Squares Focus</option>
                            <option value="perfect">Perfect Square Focus</option>
                        </select>
                        <small>Choose which types of expressions to practice</small>
                    </div>
                </div>
                
                <h3>Visual Settings</h3>
                <div class="parameter-controls">
                    <div class="parameter-control">
                        <label for="animationSpeed">Animation Speed</label>
                        <div class="slider-container">
                            <input type="range" id="animationSpeed" min="0.5" max="2" step="0.1" value="1">
                            <span class="slider-value" id="animationSpeed-value">1</span>
                        </div>
                        <small>Adjust how fast animations play</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="fontSize">Font Size</label>
                        <div class="slider-container">
                            <input type="range" id="fontSize" min="0.8" max="1.5" step="0.1" value="1">
                            <span class="slider-value" id="fontSize-value">1</span>
                        </div>
                        <small>Make text bigger or smaller</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="colorTheme">Color Theme</label>
                        <select id="colorTheme">
                            <option value="default">Default Theme</option>
                            <option value="contrast">High Contrast</option>
                            <option value="pastel">Pastel Colors</option>
                            <option value="dark">Dark Mode</option>
                            <option value="space">Space Theme</option>
                        </select>
                        <small>Change the game's appearance</small>
                    </div>
                </div>
                
                <h3>Game Mechanics</h3>
                <div class="parameter-controls">
                    <div class="parameter-control">
                        <label for="timerEnabled">Timer Enabled</label>
                        <input type="checkbox" id="timerEnabled" checked>
                        <small>Turn the timer on or off during challenges</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="soundEnabled">Sound Effects</label>
                        <input type="checkbox" id="soundEnabled" checked>
                        <small>Turn sound effects on or off</small>
                    </div>
                    
                    <div class="parameter-control">
                        <label for="showAnimation">Show Animations</label>
                        <input type="checkbox" id="showAnimation" checked>
                        <small>Turn animations on or off</small>
                    </div>
                </div>
                
                <button id="saveSettings" class="secondary">Save Settings</button>
                <button id="resetSettings" class="tertiary">Reset to Default</button>
            </div>
        </div>

        <div class="section">
            <h2>Quiz: Test Your Knowledge</h2>
            <div class="quiz-container" id="factoring-quiz">
                <div class="quiz-question">
                    <h3>Question 1: Which expression is a binomial?</h3>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">x² + 3x + 2</div>
                        <div class="quiz-option" data-correct="true">x² - 9</div>
                        <div class="quiz-option" data-correct="false">x³ + x² + x + 1</div>
                        <div class="quiz-option" data-correct="false">5</div>
                    </div>
                </div>
                
                <div class="quiz-question" style="display: none;">
                    <h3>Question 2: What is the factored form of x² - 16?</h3>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">(x - 8)(x - 2)</div>
                        <div class="quiz-option" data-correct="false">(x - 4)²</div>
                        <div class="quiz-option" data-correct="true">(x + 4)(x - 4)</div>
                        <div class="quiz-option" data-correct="false">(x + 8)(x - 2)</div>
                    </div>
                </div>
                
                <div class="quiz-question" style="display: none;">
                    <h3>Question 3: Which pattern does x² + 6x + 9 follow?</h3>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Difference of squares</div>
                        <div class="quiz-option" data-correct="true">Perfect square trinomial</div>
                        <div class="quiz-option" data-correct="false">Sum of cubes</div>
                        <div class="quiz-option" data-correct="false">General trinomial</div>
                    </div>
                </div>
                
                <div class="quiz-question" style="display: none;">
                    <h3>Question 4: What is the factored form of x² + 7x + 12?</h3>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">(x + 6)(x + 2)</div>
                        <div class="quiz-option" data-correct="false">(x + 12)(x + 1)</div>
                        <div class="quiz-option" data-correct="true">(x + 4)(x + 3)</div>
                        <div class="quiz-option" data-correct="false">(x + 6)(x + 1)</div>
                    </div>
                </div>
                
                <div class="quiz-question" style="display: none;">
                    <h3>Question 5: Which is the first step when factoring 6x² + 18x + 12?</h3>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="true">Factor out the GCF (greatest common factor)</div>
                        <div class="quiz-option" data-correct="false">Find numbers that multiply to give the last term</div>
                        <div class="quiz-option" data-correct="false">Rewrite as a difference of squares</div>
                        <div class="quiz-option" data-correct="false">Check if it's a perfect square trinomial</div>
                    </div>
                </div>
                
                <div class="quiz-feedback" id="quiz-feedback"></div>
                
                <button id="check-quiz" class="secondary">Check Answer</button>
                <button id="next-question" style="display: none;">Next Question</button>
            </div>
        </div>
    </div>

    <div id="speedChallengeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Speed Challenge</h2>
            <div id="timerDisplay">60</div>
            <div id="speedChallengeQuestion"></div>
            <input type="text" id="speedChallengeAnswer" placeholder="Enter factored form...">
            <button id="submitSpeedAnswer">Submit</button>
            <div id="speedChallengeScore">Score: 0</div>
        </div>
    </div>

    <div id="advancedChallengeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Advanced Factoring Challenge</h2>
            <div id="advancedChallengeProgress"></div>
            <div id="advancedChallengeQuestion"></div>
            <div class="step-by-step-container" id="advancedSteps">
                <div class="step">
                    <h3>Step 1: Identify the type of expression</h3>
                    <select id="expressionTypeSelect">
                        <option value="">Select type...</option>
                        <option value="common">Common factor</option>
                        <option value="difference">Difference of squares</option>
                        <option value="perfect">Perfect square trinomial</option>
                        <option value="general">General trinomial</option>
                    </select>
                </div>
                <div class="step" style="display: none;">
                    <h3>Step 2: Apply factoring method</h3>
                    <textarea id="factorStepInput" placeholder="Show your work here..."></textarea>
                </div>
                <div class="step" style="display: none;">
                    <h3>Step 3: Final factored form</h3>
                    <input type="text" id="finalFactoredForm" placeholder="Enter final factored form...">
                </div>
            </div>
            <button id="checkAdvancedStep">Check Step</button>
            <div id="advancedChallengeFeedback"></div>
        </div>
    </div>

    <div id="memoryGameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Factor Memory Game</h2>
            <div id="memoryGameBoard"></div>
            <div id="memoryGameScore">Pairs: 0/8</div>
        </div>
    </div>

    <div id="quizChallengeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Ultimate Factoring Quiz</h2>
            <div id="quizProgress"></div>
            <div id="quizQuestion"></div>
            <div id="quizOptions"></div>
            <button id="submitQuizAnswer">Submit Answer</button>
            <div id="quizFeedback"></div>
            <button id="nextQuizQuestion" style="display: none;">Next Question</button>
            <div id="quizScore">Score: 0/10</div>
        </div>
    </div>

    <footer>
        <p>Factor Friends: Binomial and Trinomial Adventure | An interactive learning game for young mathematicians</p>
    </footer>

    <script>
        // Global game settings and state
        const gameSettings = {
            difficulty: 2,
            hintFrequency: 1,
            expressionTypes: 'all',
            animationSpeed: 1,
            fontSize: 1,
            colorTheme: 'default',
            timerEnabled: true,
            soundEnabled: true,
            showAnimation: true
        };

        const gameState = {
            binomialLevel: 1,
            trinomialLevel: 1,
            mixedLevel: 1,
            binomialScore: 0,
            trinomialScore: 0,
            mixedScore: 0,
            binomialStars: 0,
            trinomialStars: 0,
            mixedStars: 0,
            currentBinomialProblem: null,
            currentTrinomialProblem: null,
            currentMixedProblem: null,
            binomialFactors: [],
            trinomialFactors: [],
            mixedFactors: [],
            hintsUsed: 0,
            correctAnswers: 0,
            totalAttempts: 0,
            badges: [],
            quizProgress: 0
        };

        // Problems database
        const binomialProblems = [
            { expression: "x² - 4", factors: ["(x+2)", "(x-2)"], type: "difference", difficulty: 1 },
            { expression: "x² - 9", factors: ["(x+3)", "(x-3)"], type: "difference", difficulty: 1 },
            { expression: "4x² - 1", factors: ["(2x+1)", "(2x-1)"], type: "difference", difficulty: 2 },
            { expression: "25x² - 16", factors: ["(5x+4)", "(5x-4)"], type: "difference", difficulty: 2 },
            { expression: "x² - 16y²", factors: ["(x+4y)", "(x-4y)"], type: "difference", difficulty: 3 },
            { expression: "4x² - 25y²", factors: ["(2x+5y)", "(2x-5y)"], type: "difference", difficulty: 3 },
            { expression: "3x - 12", factors: ["3", "(x-4)"], type: "common", difficulty: 1 },
            { expression: "5x² - 10x", factors: ["5x", "(x-2)"], type: "common", difficulty: 2 },
            { expression: "6x³ - 24x", factors: ["6x", "(x²-4)"], type: "common", difficulty: 3 },
            { expression: "7xy - 21y", factors: ["7y", "(x-3)"], type: "common", difficulty: 2 }
        ];

        const trinomialProblems = [
            { expression: "x² + 5x + 6", factors: ["(x+2)", "(x+3)"], type: "general", difficulty: 1 },
            { expression: "x² + 6x + 8", factors: ["(x+2)", "(x+4)"], type: "general", difficulty: 1 },
            { expression: "x² - 7x + 12", factors: ["(x-3)", "(x-4)"], type: "general", difficulty: 2 },
            { expression: "x² - 5x - 14", factors: ["(x-7)", "(x+2)"], type: "general", difficulty: 2 },
            { expression: "x² + 6x + 9", factors: ["(x+3)", "(x+3)"], type: "perfect", difficulty: 1 },
            { expression: "x² - 10x + 25", factors: ["(x-5)", "(x-5)"], type: "perfect", difficulty: 2 },
            { expression: "2x² + 7x + 3", factors: ["(2x+1)", "(x+3)"], type: "general", difficulty: 3 },
            { expression: "3x² - 5x - 2", factors: ["(3x+1)", "(x-2)"], type: "general", difficulty: 3 },
            { expression: "6x² + 18x + 12", factors: ["6", "(x+1)", "(x+2)"], type: "common", difficulty: 2 },
            { expression: "4x² - 36", factors: ["4", "(x+3)", "(x-3)"], type: "common", difficulty: 2 }
        ];

        const advancedProblems = [
            { 
                expression: "2x⁴ - 2x²", 
                steps: [
                    { type: "common", work: "Factor out 2x²: 2x²(x² - 1)" },
                    { type: "difference", work: "Factor x² - 1 as a difference of squares: 2x²(x+1)(x-1)" }
                ],
                answer: "2x²(x+1)(x-1)" 
            },
            { 
                expression: "x³ - 4x", 
                steps: [
                    { type: "common", work: "Factor out x: x(x² - 4)" },
                    { type: "difference", work: "Factor x² - 4 as a difference of squares: x(x+2)(x-2)" }
                ],
                answer: "x(x+2)(x-2)" 
            },
            { 
                expression: "x² + 6x + 9 - y²", 
                steps: [
                    { type: "perfect", work: "Recognize x² + 6x + 9 as (x+3)²: (x+3)² - y²" },
                    { type: "difference", work: "Factor as a difference of squares: ((x+3)+y)((x+3)-y)" }
                ],
                answer: "(x+3+y)(x+3-y)" 
            }
        ];

        const mixedProblems = [...binomialProblems, ...trinomialProblems];

        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabGroup = tab.parentElement;
                const tabContent = tabGroup.nextElementSibling;
                const tabId = tab.getAttribute('data-tab');
                
                // If it's a nested tab, handle differently
                if (tabContent && tabContent.classList.contains('tab-content')) {
                    // For second-level tabs
                    tabGroup.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    tabGroup.parentElement.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                } else {
                    // For top-level tabs
                    document.querySelectorAll('.tabs > .tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.querySelectorAll('.section > .tab-content').forEach(tc => tc.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                }
            });
        });

        // Settings sliders
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            const valueDisplay = document.getElementById(`${slider.id}-value`);
            valueDisplay.textContent = slider.value;
            
            slider.addEventListener('input', () => {
                valueDisplay.textContent = slider.value;
                gameSettings[slider.id] = parseFloat(slider.value);
                applySettings();
            });
        });

        // Settings selects
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', () => {
                gameSettings[select.id] = select.value;
                applySettings();
            });
        });

        // Settings checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                gameSettings[checkbox.id] = checkbox.checked;
                applySettings();
            });
        });

        // Apply settings function
        function applySettings() {
            // Apply font size
            document.documentElement.style.setProperty('--font-size-multiplier', gameSettings.fontSize);
            
            // Apply animation speed
            document.documentElement.style.setProperty('--animation-speed', `${1/gameSettings.animationSpeed}s`);
            
            // Apply color theme
            switch (gameSettings.colorTheme) {
                case 'contrast':
                    document.documentElement.style.setProperty('--primary-color', '#000099');
                    document.documentElement.style.setProperty('--secondary-color', '#990000');
                    document.documentElement.style.setProperty('--tertiary-color', '#009900');
                    document.documentElement.style.setProperty('--background-color', '#ffffff');
                    document.documentElement.style.setProperty('--text-color', '#000000');
                    break;
                case 'pastel':
                    document.documentElement.style.setProperty('--primary-color', '#a0d2eb');
                    document.documentElement.style.setProperty('--secondary-color', '#e5eaf5');
                    document.documentElement.style.setProperty('--tertiary-color', '#d0bdf4');
                    document.documentElement.style.setProperty('--background-color', '#f8f8ff');
                    document.documentElement.style.setProperty('--text-color', '#494949');
                    break;
                case 'dark':
                    document.documentElement.style.setProperty('--primary-color', '#8a2be2');
                    document.documentElement.style.setProperty('--secondary-color', '#ff1493');
                    document.documentElement.style.setProperty('--tertiary-color', '#00ff7f');
                    document.documentElement.style.setProperty('--background-color', '#1a1a1a');
                    document.documentElement.style.setProperty('--text-color', '#ffffff');
                    break;
                case 'space':
                    document.documentElement.style.setProperty('--primary-color', '#663399');
                    document.documentElement.style.setProperty('--secondary-color', '#ff6b6b');
                    document.documentElement.style.setProperty('--tertiary-color', '#00ffcc');
                    document.documentElement.style.setProperty('--background-color', '#000033');
                    document.documentElement.style.setProperty('--text-color', '#e0e0ff');
                    break;
                default:
                    document.documentElement.style.setProperty('--primary-color', '#4287f5');
                    document.documentElement.style.setProperty('--secondary-color', '#f542a7');
                    document.documentElement.style.setProperty('--tertiary-color', '#42f5b3');
                    document.documentElement.style.setProperty('--background-color', '#f0f8ff');
                    document.documentElement.style.setProperty('--text-color', '#333');
            }
            
            // Adjust difficulty
            updateProblems();
        }

        // Save and reset settings
        document.getElementById('saveSettings').addEventListener('click', () => {
            localStorage.setItem('factorFriendsSettings', JSON.stringify(gameSettings));
            showMessage('Settings saved!', 'correct');
        });

        document.getElementById('resetSettings').addEventListener('click', () => {
            gameSettings.difficulty = 2;
            gameSettings.hintFrequency = 1;
            gameSettings.expressionTypes = 'all';
            gameSettings.animationSpeed = 1;
            gameSettings.fontSize = 1;
            gameSettings.colorTheme = 'default';
            gameSettings.timerEnabled = true;
            gameSettings.soundEnabled = true;
            gameSettings.showAnimation = true;
            
            // Update UI to match reset settings
            document.getElementById('difficulty').value = 2;
            document.getElementById('difficulty-value').textContent = 2;
            document.getElementById('hintFrequency').value = 1;
            document.getElementById('hintFrequency-value').textContent = 1;
            document.getElementById('expressionTypes').value = 'all';
            document.getElementById('animationSpeed').value = 1;
            document.getElementById('animationSpeed-value').textContent = 1;
            document.getElementById('fontSize').value = 1;
            document.getElementById('fontSize-value').textContent = 1;
            document.getElementById('colorTheme').value = 'default';
            document.getElementById('timerEnabled').checked = true;
            document.getElementById('soundEnabled').checked = true;
            document.getElementById('showAnimation').checked = true;
            
            applySettings();
            showMessage('Settings reset to default!', 'correct');
        });

        // Load settings from localStorage if available
        if (localStorage.getItem('factorFriendsSettings')) {
            const savedSettings = JSON.parse(localStorage.getItem('factorFriendsSettings'));
            Object.assign(gameSettings, savedSettings);
            
            // Update UI to match loaded settings
            document.getElementById('difficulty').value = gameSettings.difficulty;
            document.getElementById('difficulty-value').textContent = gameSettings.difficulty;
            document.getElementById('hintFrequency').value = gameSettings.hintFrequency;
            document.getElementById('hintFrequency-value').textContent = gameSettings.hintFrequency;
            document.getElementById('expressionTypes').value = gameSettings.expressionTypes;
            document.getElementById('animationSpeed').value = gameSettings.animationSpeed;
            document.getElementById('animationSpeed-value').textContent = gameSettings.animationSpeed;
            document.getElementById('fontSize').value = gameSettings.fontSize;
            document.getElementById('fontSize-value').textContent = gameSettings.fontSize;
            document.getElementById('colorTheme').value = gameSettings.colorTheme;
            document.getElementById('timerEnabled').checked = gameSettings.timerEnabled;
            document.getElementById('soundEnabled').checked = gameSettings.soundEnabled;
            document.getElementById('showAnimation').checked = gameSettings.showAnimation;
            
            applySettings();
        }

        // Utility functions
        function showMessage(message, type) {
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messageElement.style.position = 'fixed';
            messageElement.style.top = '20px';
            messageElement.style.left = '50%';
            messageElement.style.transform = 'translateX(-50%)';
            messageElement.style.padding = '10px 20px';
            messageElement.style.borderRadius = '5px';
            messageElement.style.zIndex = '1000';
            
            if (type === 'correct') {
                messageElement.style.backgroundColor = 'var(--success-color)';
                messageElement.style.color = 'white';
            } else if (type === 'incorrect') {
                messageElement.style.backgroundColor = 'var(--error-color)';
                messageElement.style.color = 'white';
            } else {
                messageElement.style.backgroundColor = 'var(--neutral-color)';
                messageElement.style.color = 'var(--text-color)';
            }
            
            document.body.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.style.opacity = '0';
                messageElement.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(messageElement);
                }, 500);
            }, 2000);
        }

        function playSound(type) {
            if (!gameSettings.soundEnabled) return;
            
            const audio = new Audio();
            switch (type) {
                case 'correct':
                    audio.src = 'data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pY1N0dWRpb3MuY29tAFRYWFgAAAASAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAFWgD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwAc0AAAAAAAAAABSAJAJAQgAAgAAABVrwXqLhAAAAAAAAAAAAAAAAAAAA//vUZAAP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==';
                    break;
                case 'incorrect':
                    audio.src = 'data:audio/wav;base64,UklGRXwAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVgAAAAAOjkrJ00wJyVgIzUsSDsrQDM5OTkqNzY2MyU2KTkjMy0vMUMwQSwzNzoxNTE3MEAxNSs9OTUtMyxDNSMzKiwvRDA9KEE3OCsyOS4tNTQ4LjgkNy4rMjY4JEA1LSZILDQrPA==';
                    break;
                case 'click':
                    audio.src = 'data:audio/wav;base64,UklGRXQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVAAAACZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmQ==';
                    break;
                case 'level-up':
                    audio.src = 'data:audio/wav;base64,UklGRZAAAABXQVZFZm10IBAAAAABAAIAESsAABErAAABAAgAZGF0YWwAAAB1dXVyeHV5c3YxNDg8QkdMUlZdYGFmZGBcUUtEPTkzKyUeGRMOBwH7+fHq497a0M3KxsTGxsnM0NTc4+3w+/8JERkmKzg/TVNZY2hra3NydHZzdXRvbGdgWlRQSUQ8OC8rIx8YDwf/9+7m3tjUzs7P0NHZ3OLq8vz+AAgRGR4nKjM8P0lLUFNYVldaWFdXUlFMR0I8ODErJyAaEQsD/fXu5uHb19XT0tPW3ODl7PT8AAkSGCApLTQ9QEdNUFZXWVlaV1dSUUtHQTs1MCkkHRYQCQP79O3m4NvZ1dTT1Nfd4ujv9v8GDhUeIysxOD5ER0xQU1ZYWFhXVlJPSkRAPDcwKyQfFxAJAgAAA==';
                    break;
            }
            
            audio.play();
        }

        function updateStars(container, count) {
            const starContainer = document.getElementById(container);
            const stars = starContainer.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                if (index < count) {
                    star.classList.add('earned');
                } else {
                    star.classList.remove('earned');
                }
            });
        }

        function updateProgress(container, percentage) {
            const progressBar = document.getElementById(container);
            progressBar.style.width = `${percentage}%`;
        }

        function getRandomProblem(problems, difficulty) {
            const filteredProblems = problems.filter(p => p.difficulty <= difficulty);
            if (filteredProblems.length === 0) return problems[0]; // Fallback
            return filteredProblems[Math.floor(Math.random() * filteredProblems.length)];
        }

        function updateProblems() {
            const difficulty = gameSettings.difficulty;
            const expressionTypes = gameSettings.expressionTypes;
            
            // Filter problems based on settings
            let filteredBinomials = binomialProblems;
            let filteredTrinomials = trinomialProblems;
            
            if (expressionTypes !== 'all') {
                switch (expressionTypes) {
                    case 'binomial':
                        filteredTrinomials = [];
                        break;
                    case 'trinomial':
                        filteredBinomials = [];
                        break;
                    case 'common':
                        filteredBinomials = binomialProblems.filter(p => p.type === 'common');
                        filteredTrinomials = trinomialProblems.filter(p => p.type === 'common');
                        break;
                    case 'difference':
                        filteredBinomials = binomialProblems.filter(p => p.type === 'difference');
                        filteredTrinomials = [];
                        break;
                    case 'perfect':
                        filteredBinomials = [];
                        filteredTrinomials = trinomialProblems.filter(p => p.type === 'perfect');
                        break;
                }
            }
            
            // Set current problems
            if (filteredBinomials.length > 0) {
                gameState.currentBinomialProblem = getRandomProblem(filteredBinomials, difficulty);
                document.getElementById('binomialEquation').textContent = gameState.currentBinomialProblem.expression;
            }
            
            if (filteredTrinomials.length > 0) {
                gameState.currentTrinomialProblem = getRandomProblem(filteredTrinomials, difficulty);
                document.getElementById('trinomialEquation').textContent = gameState.currentTrinomialProblem.expression;
            }
            
            gameState.currentMixedProblem = getRandomProblem([...filteredBinomials, ...filteredTrinomials], difficulty);
            document.getElementById('mixedEquation').textContent = gameState.currentMixedProblem.expression;
            
            // Update tiles for mixed game
            updateMixedTiles();
        }

        function updateMixedTiles() {
            const tilesContainer = document.getElementById('mixedTiles');
            tilesContainer.innerHTML = '';
            
            // Get correct factors
            const correctFactors = gameState.currentMixedProblem.factors;
            
            // Create tiles for correct factors
            correctFactors.forEach(factor => {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.setAttribute('draggable', 'true');
                tile.setAttribute('data-value', factor);
                tile.textContent = factor.replace(/[()]/g, '');
                tilesContainer.appendChild(tile);
            });
            
            // Add some incorrect factors
            const incorrectCount = Math.min(6 - correctFactors.length, 4); // Max 4 incorrect, total max 6
            const allFactors = [...binomialProblems, ...trinomialProblems].flatMap(p => p.factors);
            const uniqueFactors = [...new Set(allFactors)].filter(f => !correctFactors.includes(f));
            
            for (let i = 0; i < incorrectCount; i++) {
                if (uniqueFactors.length === 0) break;
                const randomIndex = Math.floor(Math.random() * uniqueFactors.length);
                const factor = uniqueFactors[randomIndex];
                uniqueFactors.splice(randomIndex, 1);
                
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.setAttribute('draggable', 'true');
                tile.setAttribute('data-value', factor);
                tile.textContent = factor.replace(/[()]/g, '');
                tilesContainer.appendChild(tile);
            }
            
            // Shuffle tiles
            const tiles = Array.from(tilesContainer.children);
            for (let i = tiles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                tilesContainer.appendChild(tiles[j]);
                tiles[j] = tiles[i];
            }
            
            // Set up drag and drop
            setupDragAndDrop('mixedTiles', 'mixedFactorArea');
        }

        // Set up drag and drop functionality
        function setupDragAndDrop(tilesId, dropAreaId) {
            const tiles = document.querySelectorAll(`#${tilesId} .tile`);
            const dropArea = document.getElementById(dropAreaId);
            
            tiles.forEach(tile => {
                tile.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', tile.getAttribute('data-value'));
                    setTimeout(() => {
                        tile.classList.add('dragging');
                    }, 0);
                });
                
                tile.addEventListener('dragend', () => {
                    tile.classList.remove('dragging');
                });
                
                // Touch support
                tile.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const clone = tile.cloneNode(true);
                    clone.style.position = 'absolute';
                    clone.style.left = `${touch.clientX - 25}px`;
                    clone.style.top = `${touch.clientY - 25}px`;
                    clone.style.opacity = '0.8';
                    clone.style.zIndex = '1000';
                    clone.setAttribute('data-original', tile.getAttribute('data-value'));
                    document.body.appendChild(clone);
                    
                    document.addEventListener('touchmove', touchMove);
                    document.addEventListener('touchend', touchEnd);
                    
                    function touchMove(e) {
                        const touch = e.touches[0];
                        clone.style.left = `${touch.clientX - 25}px`;
                        clone.style.top = `${touch.clientY - 25}px`;
                    }
                    
                    function touchEnd(e) {
                        document.removeEventListener('touchmove', touchMove);
                        document.removeEventListener('touchend', touchEnd);
                        
                        const touch = e.changedTouches[0];
                        const dropRect = dropArea.getBoundingClientRect();
                        
                        if (touch.clientX >= dropRect.left && touch.clientX <= dropRect.right &&
                            touch.clientY >= dropRect.top && touch.clientY <= dropRect.bottom) {
                            // Drop successful
                            const cloneTile = tile.cloneNode(true);
                            cloneTile.setAttribute('draggable', 'false');
                            if (dropArea.querySelector('p')) {
                                dropArea.innerHTML = '';
                            }
                            dropArea.appendChild(cloneTile);
                            
                            // Update gameState
                            const gameId = tilesId.replace('Tiles', '');
                            gameState[`${gameId}Factors`].push(clone.getAttribute('data-original'));
                        }
                        
                        document.body.removeChild(clone);
                    }
                });
            });
            
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                
                const factor = e.dataTransfer.getData('text/plain');
                const draggedTile = document.querySelector(`.tile.dragging`);
                
                if (draggedTile) {
                    const cloneTile = draggedTile.cloneNode(true);
                    cloneTile.classList.remove('dragging');
                    cloneTile.setAttribute('draggable', 'false');
                    
                    if (dropArea.querySelector('p')) {
                        dropArea.innerHTML = '';
                    }
                    
                    dropArea.appendChild(cloneTile);
                    
                    // Update gameState
                    const gameId = tilesId.replace('Tiles', '');
                    gameState[`${gameId}Factors`].push(factor);
                }
            });
        }

        // Initialize drag and drop
        setupDragAndDrop('binomialTiles', 'binomialFactorArea');
        setupDragAndDrop('trinomialTiles', 'trinomialFactorArea');

        // Check answer functions
        function checkBinomialAnswer() {
            const userFactors = gameState.binomialFactors;
            const correctFactors = gameState.currentBinomialProblem.factors;
            
            // Check if all correct factors are present (order doesn't matter)
            let isCorrect = true;
            if (userFactors.length !== correctFactors.length) {
                isCorrect = false;
            } else {
                correctFactors.forEach(factor => {
                    if (!userFactors.includes(factor)) {
                        isCorrect = false;
                    }
                });
            }
            
            const feedback = document.getElementById('binomialFeedback');
            
            if (isCorrect) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = '<p>Correct! Great job factoring this binomial!</p>';
                gameState.binomialScore += 10;
                gameState.correctAnswers++;
                updateProgress('binomialProgress', (gameState.binomialScore / (gameState.binomialLevel * 50)) * 100);
                
                // Level up if needed
                if (gameState.binomialScore >= gameState.binomialLevel * 50) {
                    gameState.binomialLevel++;
                    gameState.binomialScore = 0;
                    gameState.binomialStars = Math.min(5, gameState.binomialStars + 1);
                    updateStars('binomialStars', gameState.binomialStars);
                    updateProgress('binomialProgress', 0);
                    
                    showMessage(`Level up! Youre now at level ${gameState.binomialLevel}`, 'correct');
                    playSound('level-up');
                } else {
                    playSound('correct');
                }
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `<p>Not quite right. The correct factorization is: ${correctFactors.join(' × ')}.</p>`;
                playSound('incorrect');
            }
            
            gameState.totalAttempts++;
            gameState.binomialFactors = []; // Reset factors for next problem
        }

        function checkTrinomialAnswer() {
            const userFactors = gameState.trinomialFactors;
            const correctFactors = gameState.currentTrinomialProblem.factors;
            
            // Check if all correct factors are present (order doesn't matter)
            let isCorrect = true;
            if (userFactors.length !== correctFactors.length) {
                isCorrect = false;
            } else {
                correctFactors.forEach(factor => {
                    if (!userFactors.includes(factor)) {
                        isCorrect = false;
                    }
                });
            }
            
            const feedback = document.getElementById('trinomialFeedback');
            
            if (isCorrect) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = '<p>Correct! Youve mastered this trinomial!</p>';
                gameState.trinomialScore += 10;
                gameState.correctAnswers++;
                updateProgress('trinomialProgress', (gameState.trinomialScore / (gameState.trinomialLevel * 50)) * 100);
                
                // Level up if needed
                if (gameState.trinomialScore >= gameState.trinomialLevel * 50) {
                    gameState.trinomialLevel++;
                    gameState.trinomialScore = 0;
                    gameState.trinomialStars = Math.min(5, gameState.trinomialStars + 1);
                    updateStars('trinomialStars', gameState.trinomialStars);
                    updateProgress('trinomialProgress', 0);
                    
                    showMessage(`Level up! Youre now at level ${gameState.trinomialLevel}`, 'correct');
                    playSound('level-up');
                } else {
                    playSound('correct');
                }
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `<p>Not quite right. The correct factorization is: ${correctFactors.join(' × ')}.</p>`;
                playSound('incorrect');
            }
            
            gameState.totalAttempts++;
            gameState.trinomialFactors = []; // Reset factors for next problem
        }

        function checkMixedAnswer() {
            const userFactors = gameState.mixedFactors;
            const correctFactors = gameState.currentMixedProblem.factors;
            
            // Check if all correct factors are present (order doesn't matter)
            let isCorrect = true;
            if (userFactors.length !== correctFactors.length) {
                isCorrect = false;
            } else {
                correctFactors.forEach(factor => {
                    if (!userFactors.includes(factor)) {
                        isCorrect = false;
                    }
                });
            }
            
            const feedback = document.getElementById('mixedFeedback');
            
            if (isCorrect) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = '<p>Correct! Excellent factoring skills!</p>';
                gameState.mixedScore += 10;
                gameState.correctAnswers++;
                updateProgress('mixedProgress', (gameState.mixedScore / (gameState.mixedLevel * 50)) * 100);
                
                // Check for badges
                checkBadges();
                
                // Level up if needed
                if (gameState.mixedScore >= gameState.mixedLevel * 50) {
                    gameState.mixedLevel++;
                    gameState.mixedScore = 0;
                    gameState.mixedStars = Math.min(5, gameState.mixedStars + 1);
                    updateStars('mixedStars', gameState.mixedStars);
                    updateProgress('mixedProgress', 0);
                    
                    showMessage(`Level up! Youre now at level ${gameState.mixedLevel}`, 'correct');
                    playSound('level-up');
                } else {
                    playSound('correct');
                }
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `<p>Not quite right. The correct factorization is: ${correctFactors.join(' × ')}.</p>`;
                playSound('incorrect');
            }
            
            gameState.totalAttempts++;
            gameState.mixedFactors = []; // Reset factors for next problem
        }

        // Badge system
        function checkBadges() {
            // Check for beginner badge
            if (gameState.correctAnswers >= 5 && !gameState.badges.includes('beginner')) {
                gameState.badges.push('beginner');
                document.getElementById('badge-beginner').classList.add('earned');
                showMessage('Badge earned: Beginner Factorer!', 'correct');
            }
            
            // Check for intermediate badge
            if (gameState.correctAnswers >= 15 && !gameState.badges.includes('intermediate')) {
                gameState.badges.push('intermediate');
                document.getElementById('badge-intermediate').classList.add('earned');
                showMessage('Badge earned: Intermediate Factorer!', 'correct');
            }
            
            // Check for advanced badge
            if (currentQuestionIndex < quizQuestions.length) {
                    displayQuestion();
                } else {
                    // Quiz completed
                    questionDisplay.textContent = `Quiz completed! Final score: ${score}/${quizQuestions.length}`;
                    optionsDisplay.innerHTML = '';
                    nextButton.style.display = 'none';
                    
                    if (score >= 8) {
                        feedbackDisplay.textContent = 'Excellent work! Youve mastered factoring concepts!';
                        feedbackDisplay.className = 'quiz-feedback correct';
                        
                        // Award badge
                        if (!gameState.badges.includes('quiz-master')) {
                            gameState.badges.push('quiz-master');
                            showMessage('Badge earned: Quiz Master!', 'correct');
                        }
                    } else if (score >= 5) {
                        feedbackDisplay.textContent = 'Good job! You have a solid understanding of factoring.';
                        feedbackDisplay.className = 'quiz-feedback correct';
                    } else {
                        feedbackDisplay.textContent = 'Keep practicing! Youll get better with more practice.';
                        feedbackDisplay.className = 'quiz-feedback';
                    }
                    
                    // Close modal after 5 seconds
                    setTimeout(() => {
                        modal.style.display = 'none';
                        endChallenge();
                        
                        // Reset for next time
                        currentQuestionIndex = 0;
                        score = 0;
                    }, 5000);
                }
            };
            
            // Close button
            modal.querySelector('.close-modal').addEventListener('click', () => {
                modal.style.display = 'none';
                endChallenge();
                
                // Reset for next time
                currentQuestionIndex = 0;
                score = 0;
            });
        

        // Add event listeners for buttons
        document.getElementById('checkBinomialButton').addEventListener('click', () => {
            if (gameState.binomialFactors.length === 0) {
                showMessage('Please drag at least one factor first.', 'incorrect');
                return;
            }
            checkBinomialAnswer();
            document.getElementById('binomialFactorArea').innerHTML = '<p>Drag factors here</p>';
        });

        document.getElementById('nextBinomialButton').addEventListener('click', () => {
            gameState.currentBinomialProblem = getRandomProblem(binomialProblems.filter(p => p.difficulty <= gameSettings.difficulty), gameSettings.difficulty);
            document.getElementById('binomialEquation').textContent = gameState.currentBinomialProblem.expression;
            document.getElementById('binomialFactorArea').innerHTML = '<p>Drag factors here</p>';
            document.getElementById('binomialFeedback').innerHTML = '';
            document.getElementById('binomialFeedback').className = 'quiz-feedback';
            gameState.binomialFactors = [];
        });

        document.getElementById('hintBinomialButton').addEventListener('click', getBinomialHint);

        document.getElementById('checkTrinomialButton').addEventListener('click', () => {
            if (gameState.trinomialFactors.length === 0) {
                showMessage('Please drag at least one factor first.', 'incorrect');
                return;
            }
            checkTrinomialAnswer();
            document.getElementById('trinomialFactorArea').innerHTML = '<p>Drag factors here</p>';
        });

        document.getElementById('nextTrinomialButton').addEventListener('click', () => {
            gameState.currentTrinomialProblem = getRandomProblem(trinomialProblems.filter(p => p.difficulty <= gameSettings.difficulty), gameSettings.difficulty);
            document.getElementById('trinomialEquation').textContent = gameState.currentTrinomialProblem.expression;
            document.getElementById('trinomialFactorArea').innerHTML = '<p>Drag factors here</p>';
            document.getElementById('trinomialFeedback').innerHTML = '';
            document.getElementById('trinomialFeedback').className = 'quiz-feedback';
            gameState.trinomialFactors = [];
        });

        document.getElementById('hintTrinomialButton').addEventListener('click', getTrinomialHint);

        document.getElementById('checkMixedButton').addEventListener('click', () => {
            if (gameState.mixedFactors.length === 0) {
                showMessage('Please drag at least one factor first.', 'incorrect');
                return;
            }
            checkMixedAnswer();
            document.getElementById('mixedFactorArea').innerHTML = '<p>Drag factors here</p>';
        });

        document.getElementById('nextMixedButton').addEventListener('click', () => {
            gameState.currentMixedProblem = getRandomProblem([...binomialProblems, ...trinomialProblems].filter(p => p.difficulty <= gameSettings.difficulty), gameSettings.difficulty);
            document.getElementById('mixedEquation').textContent = gameState.currentMixedProblem.expression;
            document.getElementById('mixedFactorArea').innerHTML = '<p>Drag factors here</p>';
            document.getElementById('mixedFeedback').innerHTML = '';
            document.getElementById('mixedFeedback').className = 'quiz-feedback';
            gameState.mixedFactors = [];
            updateMixedTiles();
        });

        document.getElementById('hintMixedButton').addEventListener('click', getMixedHint);

        // "Try It Now" buttons
        document.querySelector('.try-binomial').addEventListener('click', () => {
            document.querySelectorAll('.tabs > .tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="play"]').classList.add('active');
            
            document.querySelectorAll('.section > .tab-content').forEach(tc => tc.classList.remove('active'));
            document.getElementById('play').classList.add('active');
            
            document.querySelectorAll('#play .tabs > .tab').forEach(t => t.classList.remove('active'));
            document.querySelector('#play .tab[data-tab="binomial-game"]').classList.add('active');
            
            document.querySelectorAll('#play .tab-content').forEach(tc => tc.classList.remove('active'));
            document.getElementById('binomial-game').classList.add('active');
        });

        document.querySelector('.try-trinomial').addEventListener('click', () => {
            document.querySelectorAll('.tabs > .tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="play"]').classList.add('active');
            
            document.querySelectorAll('.section > .tab-content').forEach(tc => tc.classList.remove('active'));
            document.getElementById('play').classList.add('active');
            
            document.querySelectorAll('#play .tabs > .tab').forEach(t => t.classList.remove('active'));
            document.querySelector('#play .tab[data-tab="trinomial-game"]').classList.add('active');
            
            document.querySelectorAll('#play .tab-content').forEach(tc => tc.classList.remove('active'));
            document.getElementById('trinomial-game').classList.add('active');
        });

        // Close modals when clicking outside the content
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    endChallenge();
                }
            });
        });

        // Initialize the game
        updateProblems();
        updateStars('binomialStars', gameState.binomialStars);
        updateStars('trinomialStars', gameState.trinomialStars);
        updateStars('mixedStars', gameState.mixedStars);
        updateProgress('binomialProgress', (gameState.binomialScore / (gameState.binomialLevel * 50)) * 100);
        updateProgress('trinomialProgress', (gameState.trinomialScore / (gameState.trinomialLevel * 50)) * 100);
        updateProgress('mixedProgress', (gameState.mixedScore / (gameState.mixedLevel * 50)) * 100);

        // Create animated factoring machine demo
        let binomialDemo = setInterval(() => {
            const examples = [
                { input: "x² - 4", output: "(x+2)(x-2)" },
                { input: "x² - 9", output: "(x+3)(x-3)" },
                { input: "4x² - 1", output: "(2x+1)(2x-1)" },
                { input: "25x² - 16", output: "(5x+4)(5x-4)" }
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            const binomialInput = document.getElementById('binomialInput');
            const binomialOutput = document.getElementById('binomialOutput');
            
            // Animate
            binomialInput.style.transition = 'opacity 0.5s';
            binomialOutput.style.transition = 'opacity 0.5s';
            
            binomialInput.style.opacity = '0';
            
            setTimeout(() => {
                binomialInput.textContent = randomExample.input;
                binomialInput.style.opacity = '1';
                
                setTimeout(() => {
                    binomialOutput.style.opacity = '0';
                    
                    setTimeout(() => {
                        binomialOutput.textContent = randomExample.output;
                        binomialOutput.style.opacity = '1';
                    }, 500);
                }, 1000);
            }, 500);
        }, 5000);

        let trinomialDemo = setInterval(() => {
            const examples = [
                { input: "x² + 5x + 6", output: "(x+2)(x+3)" },
                { input: "x² - 5x + 6", output: "(x-2)(x-3)" },
                { input: "x² + 3x - 4", output: "(x+4)(x-1)" },
                { input: "2x² + 7x + 3", output: "(2x+1)(x+3)" }
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            const trinomialInput = document.getElementById('trinomialInput');
            const trinomialOutput = document.getElementById('trinomialOutput');
            
            // Animate
            trinomialInput.style.transition = 'opacity 0.5s';
            trinomialOutput.style.transition = 'opacity 0.5s';
            
            trinomialInput.style.opacity = '0';
            
            setTimeout(() => {
                trinomialInput.textContent = randomExample.input;
                trinomialInput.style.opacity = '1';
                
                setTimeout(() => {
                    trinomialOutput.style.opacity = '0';
                    
                    setTimeout(() => {
                        trinomialOutput.textContent = randomExample.output;
                        trinomialOutput.style.opacity = '1';
                    }, 500);
                }, 1000);
            }, 500);
        }, 5000);

        // Show welcome message
        setTimeout(() => {
            showMessage('Welcome to Factor Friends! Let\'s learn about factoring!', 'correct');
        }, 1000);
    </script>
</body>
</html>                          