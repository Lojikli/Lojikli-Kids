<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Explorer: 3D Geography Game for Young Geniuses</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;700&display=swap');
        
        :root {
            --primary-color: #4285F4;
            --secondary-color: #34A853;
            --accent-color: #FBBC05;
            --error-color: #EA4335;
            --background-color: #F8F9FA;
            --text-color: #202124;
            --light-text: #5F6368;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        
        h1, h2, h3, h4, h5 {
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo h1 {
            font-size: 24px;
        }
        
        .globe-icon {
            width: 40px;
            height: 40px;
        }
        
        .score-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .score, .streak, .timer {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 16px;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
            position: relative;
        }
        
        .control-panel {
            width: 300px;
            background-color: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 10;
            transition: transform 0.3s ease;
            max-height: calc(100vh - 60px);
        }
        
        .control-panel.hidden {
            transform: translateX(-300px);
        }
        
        .toggle-panel {
            position: absolute;
            left: 300px;
            top: 70px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 10px;
            cursor: pointer;
            z-index: 11;
            transition: left 0.3s ease;
        }
        
        .toggle-panel.hidden {
            left: 0;
        }
        
        .map-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .checkbox-group, .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        input[type="checkbox"], input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        label {
            cursor: pointer;
            font-size: 14px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #3367d6;
        }
        
        .slider-container {
            margin-bottom: 10px;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 5px;
        }
        
        .slider-container input {
            width: 100%;
        }
        
        .character-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 20;
            display: flex;
            align-items: flex-end;
            pointer-events: none;
        }
        
        .character {
            width: 150px;
            height: 150px;
            filter: drop-shadow(3px 3px 3px rgba(0, 0, 0, 0.3));
        }
        
        .speech-bubble {
            background-color: white;
            border-radius: 10px;
            padding: 10px 15px;
            max-width: 250px;
            position: relative;
            margin-left: -20px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 5;
            font-size: 14px;
            pointer-events: none;
        }
        
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 15px;
            left: -10px;
            width: 20px;
            height: 20px;
            background-color: white;
            transform: rotate(45deg);
            z-index: -1;
            box-shadow: -2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .challenge-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            min-width: 300px;
            text-align: center;
        }
        
        .challenge-title {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .challenge-description {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .hint-button {
            background-color: var(--accent-color);
            margin-top: 10px;
        }
        
        .hint-button:hover {
            background-color: #e0a800;
        }
        
        .feedback-container {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            max-width: 300px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(-20px);
        }
        
        .feedback-container.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .feedback-container.correct {
            background-color: var(--secondary-color);
        }
        
        .feedback-container.incorrect {
            background-color: var(--error-color);
        }
        
        .feedback-title {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .fact-container {
            font-size: 14px;
            margin-top: 10px;
        }
        
        .quiz-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 20;
            width: 400px;
            max-width: 90%;
            display: none;
        }
        
        .quiz-title {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .quiz-question {
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-option {
            background-color: var(--background-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .quiz-option:hover {
            background-color: #e8eaed;
        }
        
        .quiz-option.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .quiz-submit {
            width: 100%;
            margin-top: 10px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 15;
            display: none;
        }
        
        .advanced-section {
            background-color: #f1f3f4;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .advanced-section h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .advanced-param {
            margin-bottom: 8px;
        }
        
        .advanced-param label {
            display: block;
            margin-bottom: 3px;
            font-size: 12px;
        }
        
        .advanced-param input, .advanced-param select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: var(--light-text);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Certificate styles */
        .certificate-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 30;
            width: 600px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            display: none;
            text-align: center;
        }
        
        .certificate {
            border: 15px solid var(--primary-color);
            padding: 20px;
            position: relative;
            background-color: #fffdf7;
        }
        
        .certificate:before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px solid var(--accent-color);
        }
        
        .certificate-content {
            position: relative;
            z-index: 2;
        }
        
        .certificate-title {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-family: 'Comic Neue', cursive;
        }
        
        .certificate-recipient {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--text-color);
        }
        
        .certificate-text {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .certificate-date {
            margin-top: 20px;
            font-style: italic;
        }
        
        .certificate-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .settings-button {
            position: absolute;
            top: 70px;
            right: 20px;
            background-color: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            padding: 8px 12px;
            z-index: 20;
            font-weight: bold;
        }
        
        .progress-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 20;
            width: 200px;
        }
        
        .progress-title {
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .progress-bar-container {
            width: 100%;
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--secondary-color);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }
        
        /* 3D Globe Styles */
        #earth-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 5;
            display: none;
        }
        
        .view-toggle-container {
            position: absolute;
            top: 70px;
            left: 20px;
            z-index: 20;
            display: flex;
            gap: 10px;
        }
        
        .view-toggle {
            background-color: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            padding: 8px 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .view-toggle.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .earth-view-controls {
            position: absolute;
            bottom: 100px;
            right: 20px;
            z-index: 20;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .earth-control-btn {
            width: 40px;
            height: 40px;
            margin: 5px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .earth-control-row {
            display: flex;
            justify-content: center;
        }
        
        /* Earth fact panel */
        .earth-fact-panel {
            position: absolute;
            left: 20px;
            bottom: 180px;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            max-width: 300px;
            display: none;
        }
        
        .earth-fact-title {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .earth-fact-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .earth-fact-next {
            margin-top: 10px;
            background-color: var(--accent-color);
            color: var(--text-color);
            font-size: 14px;
            padding: 5px 10px;
        }
        
        /* Country info popup */
        .country-info-popup {
            position: absolute;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            max-width: 300px;
            display: none;
        }
        
        .country-info-title {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .country-info-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .country-info-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        /* Animation classes */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-30px);}
            60% {transform: translateY(-15px);}
        }
        
        .bounce {
            animation: bounce 1s;
        }
        
        @keyframes pulse {
            0% {transform: scale(1);}
            50% {transform: scale(1.1);}
            100% {transform: scale(1);}
        }
        
        .pulse {
            animation: pulse 0.5s;
        }
        
        /* Loading spinner */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            z-index: 25;
            display: none;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .control-panel {
                width: 250px;
            }
            
            .toggle-panel.hidden {
                left: 0;
            }
            
            .toggle-panel {
                left: 250px;
            }
            
            .character {
                width: 100px;
                height: 100px;
            }
            
            .speech-bubble {
                max-width: 200px;
                font-size: 12px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <svg class="globe-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </svg>
            <h1>World Explorer 3D</h1>
        </div>
        <div class="score-container">
            <div class="score">Score: <span id="score">0</span></div>
            <div class="streak">Streak: <span id="streak">0</span></div>
            <div class="timer">Time: <span id="timer">00:00</span></div>
        </div>
    </header>
    
    <div class="main-container">
        <div class="control-panel">
            <div class="settings-section">
                <h3>Game Settings</h3>
                <div class="slider-container">
                    <label for="difficulty">Difficulty Level: <span id="difficulty-value">Medium</span></label>
                    <input type="range" id="difficulty" min="1" max="3" value="2">
                </div>
                
                <div class="settings-section">
                    <h3>Continents</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="africa" checked>
                            <label for="africa">Africa</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="asia" checked>
                            <label for="asia">Asia</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="europe" checked>
                            <label for="europe">Europe</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="north-america" checked>
                            <label for="north-america">North America</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="south-america" checked>
                            <label for="south-america">South America</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="oceania" checked>
                            <label for="oceania">Oceania</label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Game Mode</h3>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="countries" name="mode" checked>
                            <label for="countries">Find Countries</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="capitals" name="mode">
                            <label for="capitals">Find Capitals</label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Learning Focus</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="facts" checked>
                            <label for="facts">Country Facts</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="population" checked>
                            <label for="population">Population</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="culture" checked>
                            <label for="culture">Culture</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="landmarks" checked>
                            <label for="landmarks">Landmarks</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="earth-shape" checked>
                            <label for="earth-shape">Earth Shape Facts</label>
                        </div>
                    </div>
                </div>
                
                <button id="start-game">Start New Game</button>
                
                <div class="advanced-section">
                    <h4>Advanced Parameters <span class="help-icon tooltip">?
                        <span class="tooltiptext">Adjust these parameters to customize your learning experience!</span>
                    </span></h4>
                    <div class="advanced-param">
                        <label for="map-style">Map Style:</label>
                        <select id="map-style">
                            <option value="political">Political</option>
                            <option value="terrain">Terrain</option>
                            <option value="satellite">Satellite</option>
                        </select>
                    </div>
                    <div class="advanced-param">
                        <label for="quiz-frequency">Quiz Frequency:</label>
                        <input type="number" id="quiz-frequency" min="3" max="20" value="5">
                    </div>
                    <div class="advanced-param">
                        <label for="time-limit">Time Limit (seconds):</label>
                        <input type="number" id="time-limit" min="15" max="120" value="30">
                    </div>
                    <div class="advanced-param">
                        <label for="border-brightness">Border Visibility:</label>
                        <input type="range" id="border-brightness" min="0" max="100" value="50">
                    </div>
                    <div class="advanced-param">
                        <label for="learning-depth">Learning Depth:</label>
                        <select id="learning-depth">
                            <option value="basic">Basic</option>
                            <option value="intermediate" selected>Intermediate</option>
                            <option value="advanced">Advanced</option>
                            <option value="genius">Genius</option>
                        </select>
                    </div>
                    <div class="advanced-param">
                        <label for="globe-rotation-speed">Globe Rotation Speed:</label>
                        <input type="range" id="globe-rotation-speed" min="1" max="10" value="5">
                    </div>
                    <div class="advanced-param">
                        <label for="earth-radius">Earth Size:</label>
                        <input type="range" id="earth-radius" min="50" max="200" value="100">
                    </div>
                </div>
            </div>
        </div>
        
        <button class="toggle-panel">≡</button>
        
        <div class="view-toggle-container">
            <button class="view-toggle active" id="map-view-btn">Map View</button>
            <button class="view-toggle" id="earth-view-btn">3D Earth View</button>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div id="earth-container"></div>
            
            <div class="character-container">
                <svg class="character" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
                    <!-- Globe Head -->
                    <circle cx="100" cy="80" r="40" fill="#4285F4" />
                    <path d="M70 80 C75 60, 125 60, 130 80" fill="none" stroke="#34A853" stroke-width="3" />
                    <path d="M70 80 C75 100, 125 100, 130 80" fill="none" stroke="#34A853" stroke-width="3" />
                    <path d="M100 40 C100 60, 100 100, 100 120" fill="none" stroke="#34A853" stroke-width="3" />
                    <circle cx="85" cy="70" r="5" fill="#FBBC05" />
                    <circle cx="115" cy="70" r="5" fill="#FBBC05" />
                    <circle cx="95" cy="90" r="5" fill="#FBBC05" />
                    <circle cx="115" cy="95" r="5" fill="#FBBC05" />
                    <circle cx="80" cy="85" r="5" fill="#FBBC05" />
                    
                    <!-- Eyes -->
                    <circle cx="85" cy="75" r="6" fill="white" />
                    <circle cx="115" cy="75" r="6" fill="white" />
                    <circle cx="85" cy="75" r="3" fill="black" />
                    <circle cx="115" cy="75" r="3" fill="black" />
                    
                    <!-- Mouth -->
                    <path d="M85 95 C90 105, 110 105, 115 95" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" />
                    
                    <!-- Body -->
                    <rect x="80" y="120" width="40" height="40" rx="10" fill="#EA4335" />
                    
                    <!-- Arms -->
                    <rect x="60" y="125" width="20" height="10" rx="5" fill="#EA4335" />
                    <rect x="120" y="125" width="20" height="10" rx="5" fill="#EA4335" />
                    
                    <!-- Legs -->
                    <rect x="85" y="160" width="10" height="20" rx="5" fill="#4285F4" />
                    <rect x="105" y="160" width="10" height="20" rx="5" fill="#4285F4" />
                </svg>
                <div class="speech-bubble">
                    Hi there! I'm Globey! Let's explore our round planet Earth together and learn about different countries! Switch between Map View and 3D Earth View to see how our planet really looks!
                </div>
            </div>
            
            <div class="challenge-container">
                <h3 class="challenge-title">Find This Country!</h3>
                <div class="challenge-description">Click on the map to begin</div>
                <button class="hint-button">Need a Hint?</button>
            </div>
            
            <div class="feedback-container">
                <h3 class="feedback-title">Correct!</h3>
                <div class="feedback-message">Great job finding that country!</div>
                <div class="fact-container">Fun fact about this country will appear here.</div>
            </div>
            
            <div class="progress-container">
                <div class="progress-title">Level Progress</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <div class="progress-text">0/10 Countries</div>
            </div>
            
            <div class="earth-view-controls">
                <div class="earth-control-row">
                    <button class="earth-control-btn" id="tilt-up">↑</button>
                </div>
                <div class="earth-control-row">
                    <button class="earth-control-btn" id="rotate-left">←</button>
                    <button class="earth-control-btn" id="reset-view">⦿</button>
                    <button class="earth-control-btn" id="rotate-right">→</button>
                </div>
                <div class="earth-control-row">
                    <button class="earth-control-btn" id="tilt-down">↓</button>
                </div>
                <div class="earth-control-row">
                    <button class="earth-control-btn" id="zoom-in">+</button>
                    <button class="earth-control-btn" id="zoom-out">−</button>
                </div>
            </div>
            
            <div class="earth-fact-panel">
                <h3 class="earth-fact-title">Earth is a Sphere!</h3>
                <div class="earth-fact-content">
                    Our planet Earth is not flat - it's a sphere (well, technically an oblate spheroid, slightly flattened at the poles). That's why when you zoom out in 3D Earth View, you can see the curvature of the Earth!
                </div>
                <button class="earth-fact-next">Next Fact</button>
            </div>
            
            <div class="country-info-popup">
                <button class="country-info-close">&times;</button>
                <h3 class="country-info-title">Country Name</h3>
                <div class="country-info-content">
                    Country information will appear here.
                </div>
            </div>
            
            <button class="settings-button">⚙️ Settings</button>
            
            <div class="loading-spinner"></div>
        </div>
    </div>
    
    <div class="quiz-container">
        <h3 class="quiz-title">Geography Quiz</h3>
        <div class="quiz-question">Question will appear here</div>
        <div class="quiz-options">
            <div class="quiz-option" data-index="0">Option 1</div>
            <div class="quiz-option" data-index="1">Option 2</div>
            <div class="quiz-option" data-index="2">Option 3</div>
            <div class="quiz-option" data-index="3">Option 4</div>
        </div>
        <button class="quiz-submit">Submit Answer</button>
    </div>
    
    <div class="overlay"></div>
    
    <div class="certificate-container">
        <button class="certificate-close">&times;</button>
        <div class="certificate">
            <div class="certificate-content">
                <h2 class="certificate-title">Certificate of Achievement</h2>
                <h3 class="certificate-recipient">Young Explorer Name</h3>
                <p class="certificate-text">
                    has successfully completed the World Explorer 3D geography challenge 
                    by identifying countries from around the world and demonstrating exceptional 
                    geographical knowledge of our spherical planet Earth!
                </p>
                <div class="certificate-stats">
                    <p>Countries Found: <span id="cert-countries">0</span></p>
                    <p>Continents Explored: <span id="cert-continents">0</span></p>
                    <p>Quiz Score: <span id="cert-quiz">0</span>/10</p>
                </div>
                <p class="certificate-date">Date: <span id="cert-date">Today</span></p>
            </div>
        </div>
    </div>

    <script>
        // Character speeches - defined before they're used
        const characterSpeeches = {
            welcome: [
                "Hi there! I'm Globey! Let's explore our round planet Earth together and learn about different countries! Switch between Map View and 3D Earth View to see how our planet really looks!",
                "Welcome to World Explorer 3D! I'll be your guide as we travel around our amazing spherical planet!",
                "Hello young explorer! Ready to discover amazing places around our round world? You can see Earth from space in 3D Earth View!"
            ],
            challenge: [
                "Can you find {{country}}? Here's a hint: it's in {{continent}}!",
                "Your mission: locate {{country}}! It's somewhere in {{continent}}.",
                "Let's search for {{country}}! Look in {{continent}} to find it!"
            ],
            correct: [
                "Great job! You found {{country}}!",
                "Wow! You're amazing at geography! {{country}} is correct!",
                "You did it! {{country}} is exactly right! You're a geography genius!"
            ],
            incorrect: [
                "Not quite! That's {{selected}}. Keep looking for {{country}}!",
                "Oops! That's {{selected}}. {{country}} is somewhere else!",
                "That's {{selected}}. Let's keep searching for {{country}}!"
            ],
            hint: [
                "Here's a hint: {{country}} is located in the {{direction}} part of {{continent}}.",
                "Look in the {{direction}} of {{continent}} to find {{country}}.",
                "Try searching in the {{direction}} region of {{continent}}."
            ],
            quiz: [
                "Time for a quiz! Let's see how much you've learned!",
                "Pop quiz time! Show me your geography knowledge!",
                "Let's test your geography skills with a quick quiz!"
            ],
            completion: [
                "Amazing job! You've completed this round! Let's see how many points you earned!",
                "Congratulations on finishing the round! You're becoming a geography expert!",
                "Round complete! Your geography skills are impressive! Let's review your score!"
            ],
            earthView: [
                "Welcome to 3D Earth View! This shows you that our planet is actually a sphere, not flat. Try rotating it with the controls!",
                "Look at our beautiful round planet! From space, astronauts can see Earth is a sphere. You can rotate and tilt to explore!",
                "This is how Earth actually looks from space - a beautiful blue sphere! You can use the controls to spin it around!"
            ]
        };
        
        // Country data with coordinates, continent, difficulty, and facts
        const countryData = {
            "United States": {
                lat: 37.0902, lng: -95.7129, continent: "north-america", difficulty: 1,
                capital: "Washington, D.C.",
                facts: [
                    "The United States has 50 states and its flag has 50 stars, one for each state.",
                    "The Grand Canyon, located in Arizona, is one of the Seven Natural Wonders of the World.",
                    "The United States is home to Yellowstone, the world's first national park."
                ],
                population: "331 million people",
                culture: "The United States is known for Hollywood movies, jazz music, and sports like baseball and American football.",
                landmarks: "Famous landmarks include the Statue of Liberty, Golden Gate Bridge, and Mount Rushmore."
            },
            "Canada": {
                lat: 56.1304, lng: -106.3468, continent: "north-america", difficulty: 1,
                capital: "Ottawa",
                facts: [
                    "Canada has the longest coastline of any country in the world.",
                    "Canada has two official languages: English and French.",
                    "About 90% of Canadians live within 100 miles of the US border."
                ],
                population: "38 million people",
                culture: "Canada is known for being very friendly and polite, and loves hockey!",
                landmarks: "Famous landmarks include Niagara Falls, CN Tower, and Banff National Park."
            },
            "Brazil": {
                lat: -14.2350, lng: -51.9253, continent: "south-america", difficulty: 1,
                capital: "Brasília",
                facts: [
                    "Brazil is home to the Amazon Rainforest, which produces about 20% of the world's oxygen.",
                    "Brazil is the largest country in South America.",
                    "The famous Christ the Redeemer statue is in Rio de Janeiro, Brazil."
                ],
                population: "213 million people",
                culture: "Brazil is famous for soccer (football), samba dancing, and its colorful Carnival celebration.",
                landmarks: "Famous landmarks include Christ the Redeemer statue, Iguazu Falls, and Amazon Rainforest."
            },
            "United Kingdom": {
                lat: 55.3781, lng: -3.4360, continent: "europe", difficulty: 1,
                capital: "London",
                facts: [
                    "The United Kingdom consists of four countries: England, Scotland, Wales, and Northern Ireland.",
                    "Big Ben is actually the name of the bell inside the clock tower, not the tower itself.",
                    "The London Underground is the oldest underground railway network in the world."
                ],
                population: "68 million people",
                culture: "The UK is known for its royal family, afternoon tea, and famous authors like Shakespeare.",
                landmarks: "Famous landmarks include Big Ben, Stonehenge, and Buckingham Palace."
            },
            "France": {
                lat: 46.2276, lng: 2.2137, continent: "europe", difficulty: 1,
                capital: "Paris",
                facts: [
                    "The Eiffel Tower was originally built for the 1889 World's Fair.",
                    "France is the most visited country in the world.",
                    "French was the official language of England for over 300 years."
                ],
                population: "65 million people",
                culture: "France is famous for its art, fashion, and delicious food like croissants and cheeses.",
                landmarks: "Famous landmarks include the Eiffel Tower, Louvre Museum, and Notre-Dame Cathedral."
            },
            "Germany": {
                lat: 51.1657, lng: 10.4515, continent: "europe", difficulty: 1,
                capital: "Berlin",
                facts: [
                    "Germany has over 1,000 kinds of sausages and 1,500 types of beer.",
                    "The first printed book was in German.",
                    "The tradition of the Christmas tree originated in Germany."
                ],
                population: "83 million people",
                culture: "Germany is known for its classical music composers, Oktoberfest celebration, and car manufacturing.",
                landmarks: "Famous landmarks include Neuschwanstein Castle, Brandenburg Gate, and the Berlin Wall."
            },
            "Italy": {
                lat: 41.8719, lng: 12.5674, continent: "europe", difficulty: 1,
                capital: "Rome",
                facts: [
                    "Italy is shaped like a boot.",
                    "The Vatican City, the smallest country in the world, is located within Rome, Italy.",
                    "Pizza was invented in Naples, Italy."
                ],
                population: "60 million people",
                culture: "Italy is famous for its art, architecture, and delicious food like pasta and pizza.",
                landmarks: "Famous landmarks include the Colosseum, Leaning Tower of Pisa, and Venice canals."
            },
            "China": {
                lat: 35.8617, lng: 104.1954, continent: "asia", difficulty: 1,
                capital: "Beijing",
                facts: [
                    "The Great Wall of China is the largest man-made structure in the world.",
                    "China has the largest population of any country.",
                    "Giant pandas are native to China."
                ],
                population: "1.4 billion people",
                culture: "China has one of the world's oldest civilizations with a rich history in arts, writing, and inventions.",
                landmarks: "Famous landmarks include the Great Wall, Forbidden City, and Terracotta Army."
            },
            "India": {
                lat: 20.5937, lng: 78.9629, continent: "asia", difficulty: 1,
                capital: "New Delhi",
                facts: [
                    "India is the second most populated country in the world.",
                    "The Taj Mahal took 22 years to build.",
                    "India has the most post offices in the world."
                ],
                population: "1.38 billion people",
                culture: "India is known for its colorful festivals, spicy food, and Bollywood movies.",
                landmarks: "Famous landmarks include the Taj Mahal, Golden Temple, and Gateway of India."
            },
            "Japan": {
                lat: 36.2048, lng: 138.2529, continent: "asia", difficulty: 1,
                capital: "Tokyo",
                facts: [
                    "Japan consists of 6,852 islands.",
                    "Mt. Fuji is the highest mountain in Japan.",
                    "Japan has more than 200 volcanoes."
                ],
                population: "126 million people",
                culture: "Japan is famous for anime, samurai traditions, cherry blossom festivals, and advanced technology.",
                landmarks: "Famous landmarks include Mount Fuji, Tokyo Skytree, and Fushimi Inari Shrine."
            },
            "Australia": {
                lat: -25.2744, lng: 133.7751, continent: "oceania", difficulty: 1,
                capital: "Canberra",
                facts: [
                    "Australia is both a country and a continent.",
                    "The Great Barrier Reef is the largest coral reef system in the world.",
                    "Kangaroos and koalas are native to Australia."
                ],
                population: "25 million people",
                culture: "Australia is known for its laid-back lifestyle, surfing, and unique wildlife.",
                landmarks: "Famous landmarks include Sydney Opera House, Uluru (Ayers Rock), and Great Barrier Reef."
            },
            "Egypt": {
                lat: 26.8206, lng: 30.8025, continent: "africa", difficulty: 1,
                capital: "Cairo",
                facts: [
                    "The Great Pyramid of Giza is the only one of the Seven Wonders of the Ancient World that still exists.",
                    "The ancient Egyptians invented the 365-day calendar.",
                    "The Nile River runs through Egypt and is the longest river in the world."
                ],
                population: "102 million people",
                culture: "Egypt has one of the oldest civilizations in the world, dating back to 3100 BCE.",
                landmarks: "Famous landmarks include the Pyramids of Giza, the Sphinx, and the Valley of the Kings."
            },
            "Mexico": {
                lat: 23.6345, lng: -102.5528, continent: "north-america", difficulty: 2,
                capital: "Mexico City",
                facts: [
                    "Mexico introduced chocolate, chilies, and corn to the world.",
                    "The ancient Mayans and Aztecs lived in what is now Mexico.",
                    "Mexico City is the oldest capital city in the Americas."
                ],
                population: "128 million people",
                culture: "Mexico is known for its vibrant music, dance, colorful festivals like Day of the Dead, and delicious cuisine.",
                landmarks: "Famous landmarks include Chichen Itza, Teotihuacan pyramids, and the Copper Canyon."
            },
            "Argentina": {
                lat: -38.4161, lng: -63.6167, continent: "south-america", difficulty: 2,
                capital: "Buenos Aires",
                facts: [
                    "Argentina is home to the highest peak in the Western Hemisphere, Mount Aconcagua.",
                    "Tango dancing originated in Argentina.",
                    "Argentina's name comes from the Latin word for silver, 'argentum'."
                ],
                population: "45 million people",
                culture: "Argentina is famous for tango dancing, soccer, and its delicious beef and wines.",
                landmarks: "Famous landmarks include Iguazu Falls, Perito Moreno Glacier, and Teatro Colón opera house."
            },
            "Peru": {
                lat: -9.1900, lng: -75.0152, continent: "south-america", difficulty: 2,
                capital: "Lima",
                facts: [
                    "Machu Picchu is an ancient Incan city in Peru.",
                    "The Nazca Lines are mysterious geoglyphs drawn in the desert in Peru.",
                    "Peru has the highest sand dune in the world, Cerro Blanco."
                ],
                population: "33 million people",
                culture: "Peru has a rich indigenous heritage with Incan traditions still practiced today.",
                landmarks: "Famous landmarks include Machu Picchu, Nazca Lines, and Lake Titicaca."
            },
            "Spain": {
                lat: 40.4637, lng: -3.7492, continent: "europe", difficulty: 2,
                capital: "Madrid",
                facts: [
                    "Spain has the third-largest number of UNESCO World Heritage Sites.",
                    "Spanish is the second most spoken native language in the world.",
                    "The Sagrada Familia church in Barcelona has been under construction since 1882."
                ],
                population: "47 million people",
                culture: "Spain is known for flamenco dancing, bullfighting, and afternoon siestas.",
                landmarks: "Famous landmarks include Sagrada Familia, Alhambra Palace, and Plaza Mayor."
            },
            "Russia": {
                lat: 61.5240, lng: 105.3188, continent: "europe", difficulty: 2,
                capital: "Moscow",
                facts: [
                    "Russia is the largest country in the world by area.",
                    "Russia spans 11 time zones.",
                    "Lake Baikal in Russia is the deepest lake in the world."
                ],
                population: "144 million people",
                culture: "Russia has a rich heritage of ballet, classical music, and literature from famous authors like Tolstoy.",
                landmarks: "Famous landmarks include Red Square, St. Basil's Cathedral, and the Kremlin."
            },
            "South Africa": {
                lat: -30.5595, lng: 22.9375, continent: "africa", difficulty: 2,
                capital: "Pretoria (administrative), Cape Town (legislative), Bloemfontein (judicial)",
                facts: [
                    "South Africa has three capital cities for different branches of government.",
                    "South Africa has 11 official languages.",
                    "Table Mountain is one of the oldest mountains in the world."
                ],
                population: "60 million people",
                culture: "South Africa is known for its diverse cultures, wildlife safaris, and history of apartheid.",
                landmarks: "Famous landmarks include Table Mountain, Robben Island, and Kruger National Park."
            },
            "Morocco": {
                lat: 31.7917, lng: -7.0926, continent: "africa", difficulty: 2,
                capital: "Rabat",
                facts: [
                    "Morocco is only 8 miles from Europe across the Strait of Gibraltar.",
                    "The blue city of Chefchaouen is famous for its blue-painted buildings.",
                    "Morocco has been a film location for many Hollywood movies."
                ],
                population: "37 million people",
                culture: "Morocco is famous for its vibrant markets (souks), mint tea, and traditional crafts.",
                landmarks: "Famous landmarks include the Hassan II Mosque, Majorelle Garden, and the medina of Fez."
            },
            "Thailand": {
                lat: 15.8700, lng: 100.9925, continent: "asia", difficulty: 2,
                capital: "Bangkok",
                facts: [
                    "Thailand was formerly known as Siam.",
                    "Thailand is the only Southeast Asian country that was never colonized by a European power.",
                    "The world's smallest mammal, the bumblebee bat, lives in Thailand."
                ],
                population: "70 million people",
                culture: "Thailand is known for its spicy food, beautiful temples, and friendly attitude called 'Thai smile'.",
                landmarks: "Famous landmarks include the Grand Palace, Wat Arun Temple, and the beaches of Phuket."
            },
            "South Korea": {
                lat: 35.9078, lng: 127.7669, continent: "asia", difficulty: 2,
                capital: "Seoul",
                facts: [
                    "South Korea is one of the most technologically advanced countries in the world.",
                    "Taekwondo, a popular martial art, originated in Korea.",
                    "South Korea has the fastest average internet speed in the world."
                ],
                population: "52 million people",
                culture: "South Korea is famous for K-pop music, K-dramas, and delicious foods like kimchi and bulgogi.",
                landmarks: "Famous landmarks include Gyeongbokgung Palace, N Seoul Tower, and Jeju Island."
            },
            "New Zealand": {
                lat: -40.9006, lng: 174.8860, continent: "oceania", difficulty: 2,
                capital: "Wellington",
                facts: [
                    "New Zealand was the first country to give women the right to vote in 1893.",
                    "The Lord of the Rings movies were filmed in New Zealand.",
                    "There are more sheep than people in New Zealand."
                ],
                population: "5 million people",
                culture: "New Zealand has a strong indigenous Māori culture and is known for the haka dance.",
                landmarks: "Famous landmarks include Milford Sound, Auckland Sky Tower, and Hobbiton movie set."
            },
            "Greece": {
                lat: 39.0742, lng: 21.8243, continent: "europe", difficulty: 2,
                capital: "Athens",
                facts: [
                    "Greece is considered the cradle of Western civilization.",
                    "The Olympic Games originated in ancient Greece.",
                    "Greece has about 6,000 islands, but only 227 are inhabited."
                ],
                population: "10.7 million people",
                culture: "Greece is known for its ancient philosophers, mythology, and Mediterranean diet.",
                landmarks: "Famous landmarks include the Acropolis, Parthenon, and Santorini's white buildings."
            },
            "Chile": {
                lat: -35.6751, lng: -71.5430, continent: "south-america", difficulty: 3,
                capital: "Santiago",
                facts: [
                    "Chile is the longest country in the world from north to south.",
                    "The Atacama Desert in Chile is the driest non-polar desert in the world.",
                    "Easter Island, with its famous stone statues, belongs to Chile."
                ],
                population: "19 million people",
                culture: "Chile is known for its poets like Pablo Neruda and its traditional cueca dance.",
                landmarks: "Famous landmarks include Torres del Paine National Park, Easter Island, and Valle de la Luna."
            },
            "Finland": {
                lat: 61.9241, lng: 25.7482, continent: "europe", difficulty: 3,
                capital: "Helsinki",
                facts: [
                    "Finland is known as the Land of a Thousand Lakes, but actually has over 188,000 lakes.",
                    "The Northern Lights can be seen from Finland about 200 nights a year.",
                    "Finland has the most saunas per capita in the world."
                ],
                population: "5.5 million people",
                culture: "Finland is known for its excellent education system, saunas, and Santa Claus Village.",
                landmarks: "Famous landmarks include Helsinki Cathedral, Suomenlinna Fortress, and Lapland."
            },
            "Vietnam": {
                lat: 14.0583, lng: 108.2772, continent: "asia", difficulty: 3,
                capital: "Hanoi",
                facts: [
                    "Vietnam is shaped like the letter S.",
                    "Vietnam is the world's largest exporter of cashew nuts and black pepper.",
                    "Ha Long Bay in Vietnam has over 1,600 limestone islands and islets."
                ],
                population: "97 million people",
                culture: "Vietnam is known for its delicious pho soup, conical hats, and rich history.",
                landmarks: "Famous landmarks include Ha Long Bay, Hoi An Ancient Town, and Cu Chi Tunnels."
            },
            "Kenya": {
                lat: -0.0236, lng: 37.9062, continent: "africa", difficulty: 3,
                capital: "Nairobi",
                facts: [
                    "Kenya is home to the Great Migration, where millions of wildebeest migrate each year.",
                    "Kenya has the world's fastest runners.",
                    "Lake Turkana is the world's largest permanent desert lake and is in Kenya."
                ],
                population: "54 million people",
                culture: "Kenya has over 40 different ethnic groups, each with their own language and culture.",
                landmarks: "Famous landmarks include Mount Kenya, Maasai Mara National Reserve, and Lamu Old Town."
            },
            "Iceland": {
                lat: 64.9631, lng: -19.0208, continent: "europe", difficulty: 3,
                capital: "Reykjavik",
                facts: [
                    "Iceland has no mosquitoes.",
                    "Iceland runs almost entirely on renewable energy.",
                    "The Blue Lagoon in Iceland is a geothermal spa with healing properties."
                ],
                population: "366,000 people",
                culture: "Iceland has strong traditions in literature and is known for its belief in elves and trolls.",
                landmarks: "Famous landmarks include Blue Lagoon, Gullfoss waterfall, and Thingvellir National Park."
            },
            "Mongolia": {
                lat: 46.8625, lng: 103.8467, continent: "asia", difficulty: 3,
                capital: "Ulaanbaatar",
                facts: [
                    "Mongolia is the most sparsely populated independent country in the world.",
                    "Genghis Khan, who created the largest land empire in history, was from Mongolia.",
                    "About 30% of Mongolia's population are nomadic or semi-nomadic."
                ],
                population: "3.3 million people",
                culture: "Mongolia is known for its nomadic culture, throat singing, and traditional yurts (gers).",
                landmarks: "Famous landmarks include the Gobi Desert, Gorkhi-Terelj National Park, and Genghis Khan Statue Complex."
            },
            "Uruguay": {
                lat: -32.5228, lng: -55.7658, continent: "south-america", difficulty: 3,
                capital: "Montevideo",
                facts: [
                    "Uruguay was the first country to fully legalize marijuana.",
                    "Almost 95% of Uruguay's electricity comes from renewable energy.",
                    "Uruguay has more sheep than people."
                ],
                population: "3.5 million people",
                culture: "Uruguay is famous for mate tea, candombe music, and its passionate soccer culture.",
                landmarks: "Famous landmarks include Casapueblo, Palacio Salvo, and Colonia del Sacramento."
            },
            "Jordan": {
                lat: 30.5852, lng: 36.2384, continent: "asia", difficulty: 3,
                capital: "Amman",
                facts: [
                    "Petra, the famous archaeological site, is in Jordan.",
                    "The Dead Sea, the lowest point on Earth, borders Jordan.",
                    "Wadi Rum, also known as the Valley of the Moon, has a landscape similar to Mars."
                ],
                population: "10.2 million people",
                culture: "Jordan has a rich Bedouin culture known for hospitality and traditional dance.",
                landmarks: "Famous landmarks include Petra, Dead Sea, and the ancient city of Jerash."
            },
            "Costa Rica": {
                lat: 9.7489, lng: -83.7534, continent: "north-america", difficulty: 3,
                capital: "San José",
                facts: [
                    "Costa Rica has no army, it was abolished in 1949.",
                    "Costa Rica is one of the most environmentally friendly countries in the world.",
                    "Costa Rica has 5% of the world's biodiversity despite being only 0.03% of the Earth's surface."
                ],
                population: "5.1 million people",
                culture: "Costa Rica is known for its 'pura vida' (pure life) philosophy and coffee production.",
                landmarks: "Famous landmarks include Arenal Volcano, Manuel Antonio National Park, and Monteverde Cloud Forest."
            },
            "Botswana": {
                lat: -22.3285, lng: 24.6849, continent: "africa", difficulty: 3,
                capital: "Gaborone",
                facts: [
                    "The Okavango Delta, the world's largest inland delta, is in Botswana.",
                    "Botswana has the world's largest elephant population.",
                    "Botswana is one of Africa's most stable and democratic countries."
                ],
                population: "2.4 million people",
                culture: "Botswana is known for its traditional basket weaving and diamond mining.",
                landmarks: "Famous landmarks include Okavango Delta, Chobe National Park, and Kalahari Desert."
            },
            "Fiji": {
                lat: -17.7134, lng: 178.0650, continent: "oceania", difficulty: 3,
                capital: "Suva",
                facts: [
                    "Fiji consists of more than 330 islands, but only about 110 are inhabited.",
                    "Fiji Water, the popular bottled water brand, comes from Fiji.",
                    "Fiji was once known as the Cannibal Isles."
                ],
                population: "896,000 people",
                culture: "Fiji is known for its welcoming 'Bula' spirit and traditional kava drink ceremony.",
                landmarks: "Famous landmarks include the Garden of the Sleeping Giant, Sigatoka Sand Dunes, and Beqa Island."
            }
        };
        
        // Quiz questions
        const quizQuestions = [
            {
                question: "Which country is known as the Land of the Rising Sun?",
                options: ["China", "Japan", "Thailand", "South Korea"],
                answer: 1
            },
            {
                question: "What is the largest country in the world by area?",
                options: ["United States", "China", "Russia", "Canada"],
                answer: 2
            },
            {
                question: "Which of these countries is both a continent and a country?",
                options: ["South Africa", "Brazil", "Australia", "Egypt"],
                answer: 2
            },
            {
                question: "The Great Pyramid of Giza is in which country?",
                options: ["Egypt", "Morocco", "Jordan", "Greece"],
                answer: 0
            },
            {
                question: "Which country is home to the kangaroo?",
                options: ["New Zealand", "South Africa", "Australia", "Fiji"],
                answer: 2
            },
            {
                question: "The Eiffel Tower is located in which city?",
                options: ["Rome", "Berlin", "London", "Paris"],
                answer: 3
            },
            {
                question: "Which country has the largest population in the world?",
                options: ["United States", "India", "Russia", "China"],
                answer: 3
            },
            {
                question: "The Amazon Rainforest is mainly located in which country?",
                options: ["Colombia", "Peru", "Brazil", "Venezuela"],
                answer: 2
            },
            {
                question: "Which country is known for the Taj Mahal?",
                options: ["Pakistan", "India", "Thailand", "China"],
                answer: 1
            },
            {
                question: "Which country is made up of over 17,000 islands?",
                options: ["Philippines", "Japan", "Indonesia", "Fiji"],
                answer: 2
            },
            {
                question: "Which continent has the most countries?",
                options: ["Africa", "Asia", "Europe", "South America"],
                answer: 0
            },
            {
                question: "Which country is shaped like a boot?",
                options: ["Portugal", "Greece", "Italy", "Spain"],
                answer: 2
            },
            {
                question: "The Great Wall is located in which country?",
                options: ["Japan", "South Korea", "Mongolia", "China"],
                answer: 3
            },
            {
                question: "Which country's flag has a maple leaf on it?",
                options: ["Canada", "United States", "Australia", "New Zealand"],
                answer: 0
            },
            {
                question: "Which country is known for creating LEGO toys?",
                options: ["Sweden", "Norway", "Denmark", "Finland"],
                answer: 2
            },
            {
                question: "Which country is known as the Land of a Thousand Lakes?",
                options: ["Norway", "Finland", "Sweden", "Iceland"],
                answer: 1
            },
            {
                question: "Machu Picchu is an ancient city located in which country?",
                options: ["Mexico", "Peru", "Colombia", "Chile"],
                answer: 1
            },
            {
                question: "Which country is known for its tulips and windmills?",
                options: ["Denmark", "Belgium", "Netherlands", "Germany"],
                answer: 2
            },
            {
                question: "The Sahara Desert covers much of which continent?",
                options: ["Asia", "Africa", "South America", "Australia"],
                answer: 1
            },
            {
                question: "Which country has the most pyramids in the world?",
                options: ["Egypt", "Mexico", "Sudan", "Peru"],
                answer: 2
            }
        ];
        
        // Earth facts
        const earthFacts = [
            {
                title: "Earth is a Sphere!",
                content: "Our planet Earth is not flat - it's a sphere (technically an oblate spheroid, slightly flattened at the poles). That's why when you zoom out in 3D Earth View, you can see the curvature of the Earth!"
            },
            {
                title: "Proof of a Round Earth",
                content: "Ships disappear hull-first over the horizon because of Earth's curvature. If Earth were flat, ships would just appear smaller and smaller until you couldn't see them anymore."
            },
            {
                title: "Earth's Shadow on the Moon",
                content: "During a lunar eclipse, you can see Earth's round shadow on the Moon. If Earth were flat, it would cast a line-shaped shadow instead of a circular one!"
            },
            {
                title: "Different Star Patterns",
                content: "People in different parts of the world see different stars in the night sky. This happens because Earth is a sphere, and your location on that sphere determines what part of space you're facing at night."
            },
            {
                title: "Gravity and a Round Earth",
                content: "Gravity pulls everything toward the center of Earth. This is why we stand upright no matter where we are on the planet. On a flat Earth, gravity wouldn't work this way!"
            },
            {
                title: "Time Zones Exist!",
                content: "Different parts of Earth experience day and night at different times because Earth rotates as a sphere. When it's bedtime in America, children in China are already at school!"
            },
            {
                title: "You Can Fly Around the World",
                content: "Airplanes can fly all the way around Earth and return to where they started. This wouldn't be possible if Earth were flat!"
            },
            {
                title: "Earth from Space",
                content: "Astronauts have taken thousands of photographs of Earth from space, and they all show that our planet is round. No flat Earth here!"
            },
            {
                title: "Earth's Circumference",
                content: "The circumference (distance around) Earth is about 40,075 kilometers (24,901 miles). Ancient Greek scientist Eratosthenes calculated this over 2,000 years ago by measuring shadows!"
            },
            {
                title: "Satellite Orbits",
                content: "Satellites orbit around Earth in circular paths because Earth is a sphere with gravity pulling them into orbit. This is how we get TV signals, GPS, and weather forecasts!"
            }
        ];
        
        // Advanced geographical concepts for different learning depths
        const advancedConcepts = {
            "basic": {
                title: "Did you know?",
                facts: [
                    "Earth is made up of 7 continents: Africa, Antarctica, Asia, Europe, North America, South America, and Oceania.",
                    "There are about 195 countries in the world.",
                    "The equator is an imaginary line that divides Earth into the Northern and Southern Hemispheres.",
                    "Mountains are formed when pieces of Earth's crust push against each other."
                ]
            },
            "intermediate": {
                title: "Geography Concepts",
                facts: [
                    "Latitude lines run east-west and tell you how far north or south you are from the equator.",
                    "Longitude lines run north-south and tell you how far east or west you are from the Prime Meridian.",
                    "The Ring of Fire is an area around the Pacific Ocean with many volcanoes and earthquakes.",
                    "Climate zones are different based on distance from the equator: tropical, temperate, and polar."
                ]
            },
            "advanced": {
                title: "Advanced Geography",
                facts: [
                    "Plate tectonics explains how the Earth's crust is divided into plates that move on the mantle below.",
                    "A watershed is an area of land where all water flows to the same place, like a river or ocean.",
                    "The Coriolis effect causes winds and ocean currents to curve due to Earth's rotation.",
                    "Isthmus, peninsula, archipelago, and mesa are all landforms with specific geographical definitions."
                ]
            },
            "genius": {
                title: "PhD-Level Geography",
                facts: [
                    "The Mercator projection and other map projections distort the Earth's surface in different ways when shown on a flat map.",
                    "Biogeography is the study of how species are distributed across geographic space and through time.",
                    "Anthropogenic biomes ('anthromes') classify Earth's ecosystems based on human influence, not just natural characteristics.",
                    "Desakota is a term describing regions where urban and rural characteristics mix in densely populated parts of Asia."
                ]
            }
        };

        // Map initialization and game variables
        let map;
        let countryLayer;
        let currentCountry = "";
        let score = 0;
        let streak = 0;
        let quizScore = 0;
        let timer;
        let timeLeft = 30;
        let gameActive = false;
        let countriesInRound = [];
        let countriesFound = 0;
        let totalCountriesInRound = 10;
        let currentQuizQuestion = 0;
        let selectedQuizAnswer = -1;
        let continentsExplored = new Set();
        let mapStyle = "political";
        let quizFrequency = 5;
        let learningDepth = "intermediate";
        let currentView = "map"; // "map" or "earth"
        let currentEarthFactIndex = 0;
        let googleMapsLoaded = false;
        
        // Three.js variables for 3D Earth
        let scene, camera, renderer, earth, clouds;
        let earthRotationSpeed = 0.001;
        let earthRadius = 100;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let targetRotation = { x: 0, y: 0 };
        let currentRotation = { x: 0, y: 0 };
        let markers = [];
        
        // Get DOM elements - moved to one place and defined before use
        let controlPanel, togglePanelBtn, startGameBtn, difficultySlider, difficultyValue, 
            challengeContainer, challengeDescription, hintButton, feedbackContainer, 
            feedbackTitle, feedbackMessage, factContainer, speechBubble, scoreDisplay, 
            streakDisplay, timerDisplay, quizContainer, quizQuestion, quizOptions, 
            quizSubmitBtn, overlay, certificateContainer, certificateRecipient, certCountries, 
            certContinents, certQuiz, certDate, certificateCloseBtn, settingsButton, 
            progressBar, progressText, mapStyleSelect, quizFrequencyInput, timeLimitInput, 
            borderBrightnessSlider, learningDepthSelect, mapViewBtn, earthViewBtn, 
            earthContainer, mapContainer, earthViewControls, tiltUpBtn, tiltDownBtn, 
            rotateLeftBtn, rotateRightBtn, resetViewBtn, zoomInBtn, zoomOutBtn, 
            earthFactPanel, earthFactTitle, earthFactContent, earthFactNextBtn, 
            countryInfoPopup, countryInfoTitle, countryInfoContent, countryInfoCloseBtn, 
            loadingSpinner, globeRotationSpeedSlider, earthRadiusSlider;
            
        // Initialize DOM elements once document is loaded
        function initializeElements() {
            controlPanel = document.querySelector(".control-panel");
            togglePanelBtn = document.querySelector(".toggle-panel");
            startGameBtn = document.getElementById("start-game");
            difficultySlider = document.getElementById("difficulty");
            difficultyValue = document.getElementById("difficulty-value");
            challengeContainer = document.querySelector(".challenge-container");
            challengeDescription = document.querySelector(".challenge-description");
            hintButton = document.querySelector(".hint-button");
            feedbackContainer = document.querySelector(".feedback-container");
            feedbackTitle = document.querySelector(".feedback-title");
            feedbackMessage = document.querySelector(".feedback-message");
            factContainer = document.querySelector(".fact-container");
            speechBubble = document.querySelector(".speech-bubble");
            scoreDisplay = document.getElementById("score");
            streakDisplay = document.getElementById("streak");
            timerDisplay = document.getElementById("timer");
            quizContainer = document.querySelector(".quiz-container");
            quizQuestion = document.querySelector(".quiz-question");
            quizOptions = document.querySelectorAll(".quiz-option");
            quizSubmitBtn = document.querySelector(".quiz-submit");
            overlay = document.querySelector(".overlay");
            certificateContainer = document.querySelector(".certificate-container");
            certificateRecipient = document.querySelector(".certificate-recipient");
            certCountries = document.getElementById("cert-countries");
            certContinents = document.getElementById("cert-continents");
            certQuiz = document.getElementById("cert-quiz");
            certDate = document.getElementById("cert-date");
            certificateCloseBtn = document.querySelector(".certificate-close");
            settingsButton = document.querySelector(".settings-button");
            progressBar = document.querySelector(".progress-bar");
            progressText = document.querySelector(".progress-text");
            mapStyleSelect = document.getElementById("map-style");
            quizFrequencyInput = document.getElementById("quiz-frequency");
            timeLimitInput = document.getElementById("time-limit");
            borderBrightnessSlider = document.getElementById("border-brightness");
            learningDepthSelect = document.getElementById("learning-depth");
            mapViewBtn = document.getElementById("map-view-btn");
            earthViewBtn = document.getElementById("earth-view-btn");
            earthContainer = document.getElementById("earth-container");
            mapContainer = document.getElementById("map");
            earthViewControls = document.querySelector(".earth-view-controls");
            tiltUpBtn = document.getElementById("tilt-up");
            tiltDownBtn = document.getElementById("tilt-down");
            rotateLeftBtn = document.getElementById("rotate-left");
            rotateRightBtn = document.getElementById("rotate-right");
            resetViewBtn = document.getElementById("reset-view");
            zoomInBtn = document.getElementById("zoom-in");
            zoomOutBtn = document.getElementById("zoom-out");
            earthFactPanel = document.querySelector(".earth-fact-panel");
            earthFactTitle = document.querySelector(".earth-fact-title");
            earthFactContent = document.querySelector(".earth-fact-content");
            earthFactNextBtn = document.querySelector(".earth-fact-next");
            countryInfoPopup = document.querySelector(".country-info-popup");
            countryInfoTitle = document.querySelector(".country-info-title");
            countryInfoContent = document.querySelector(".country-info-content");
            countryInfoCloseBtn = document.querySelector(".country-info-close");
            loadingSpinner = document.querySelector(".loading-spinner");
            globeRotationSpeedSlider = document.getElementById("globe-rotation-speed");
            earthRadiusSlider = document.getElementById("earth-radius");
        }
        
        // Initialize Google Map
        function initMap() {
            if (googleMapsLoaded) return;
            googleMapsLoaded = true;
            
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 20, lng: 0 },
                zoom: 2,
                minZoom: 2,
                maxZoom: 6,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false,
                styles: [
                    {
                        featureType: "administrative.country",
                        elementType: "geometry.stroke",
                        stylers: [{ color: "#4285F4" }, { weight: 2 }]
                    },
                    {
                        featureType: "administrative.country",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "administrative.province",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "administrative.locality",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "road",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });
            
            // Add click event listener to the map
            map.addListener("click", function(event) {
                if (!gameActive) return;
                
                const clickedLat = event.latLng.lat();
                const clickedLng = event.latLng.lng();
                
                // Find the closest country to the clicked point
                let closestCountry = "";
                let minDistance = Infinity;
                
                for (const country in countryData) {
                    const countryLat = countryData[country].lat;
                    const countryLng = countryData[country].lng;
                    
                    // Calculate distance (simple version)
                    const distance = Math.sqrt(
                        Math.pow(clickedLat - countryLat, 2) + 
                        Math.pow(clickedLng - countryLng, 2)
                    );
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestCountry = country;
                    }
                }
                
                // Check if the closest country is the target country
                checkAnswer(closestCountry);
            });
            
            // Set up initial game state
            updateSpeechBubble(getRandomSpeech("welcome"));
            challengeDescription.textContent = "Click 'Start New Game' to begin your adventure!";
        }
        
        // Initialize 3D Earth
        function init3DEarth() {
            loadingSpinner.style.display = "block";
            
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera
            camera = new THREE.PerspectiveCamera(45, earthContainer.clientWidth / earthContainer.clientHeight, 0.1, 1000);
            camera.position.z = 300;
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(earthContainer.clientWidth, earthContainer.clientHeight);
            renderer.setClearColor(0x000000, 1);
            earthContainer.appendChild(renderer.domElement);
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            // Add directional light (sun)
            const sunLight = new THREE.DirectionalLight(0xffffff, 1);
            sunLight.position.set(5, 3, 5);
            scene.add(sunLight);
            
            // Load Earth texture
            const earthTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg', function() {
                // Load cloud texture
                const cloudTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_clouds_1024.png', function() {
                    // Create Earth sphere
                    const earthGeometry = new THREE.SphereGeometry(earthRadius, 32, 32);
                    const earthMaterial = new THREE.MeshPhongMaterial({
                        map: earthTexture,
                        specular: new THREE.Color(0x333333),
                        shininess: 5
                    });
                    earth = new THREE.Mesh(earthGeometry, earthMaterial);
                    scene.add(earth);
                    
                    // Create clouds
                    const cloudGeometry = new THREE.SphereGeometry(earthRadius + 2, 32, 32);
                    const cloudMaterial = new THREE.MeshPhongMaterial({
                        map: cloudTexture,
                        transparent: true,
                        opacity: 0.8
                    });
                    clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
                    scene.add(clouds);
                    
                    // Add country markers
                    addCountryMarkers();
                    
                    // Hide loading spinner
                    loadingSpinner.style.display = "none";
                    
                    // Start animation
                    animate();
                });
            });
            
            // Add window resize listener
            window.addEventListener('resize', onWindowResize);
            
            // Add mouse event listeners for earth rotation
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            
            // Add touch event listeners for mobile
            renderer.domElement.addEventListener('touchstart', onTouchStart);
            renderer.domElement.addEventListener('touchmove', onTouchMove);
            renderer.domElement.addEventListener('touchend', onTouchEnd);
            
            // Show earth fact panel
            earthFactPanel.style.display = "block";
            updateEarthFact(0);
        }
        
        // Add country markers to 3D Earth
        function addCountryMarkers() {
            // Clear existing markers
            markers.forEach(marker => scene.remove(marker));
            markers = [];
            
            for (const country in countryData) {
                const countryInfo = countryData[country];
                const lat = countryInfo.lat;
                const lng = countryInfo.lng;
                
                // Convert lat/lng to 3D position
                const position = latLngToVector3(lat, lng, earthRadius + 1);
                
                // Create marker geometry
                const markerGeometry = new THREE.SphereGeometry(2, 8, 8);
                const markerMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xff0000,
                    transparent: true,
                    opacity: 0.7
                });
                const marker = new THREE.Mesh(markerGeometry, markerMaterial);
                marker.position.copy(position);
                marker.userData = { country: country };
                scene.add(marker);
                markers.push(marker);
            }
        }
        
        // Convert latitude/longitude to 3D vector position
        function latLngToVector3(lat, lng, radius) {
            const phi = (90 - lat) * Math.PI / 180;
            const theta = (lng + 180) * Math.PI / 180;
            
            const x = -radius * Math.sin(phi) * Math.cos(theta);
            const y = radius * Math.cos(phi);
            const z = radius * Math.sin(phi) * Math.sin(theta);
            
            return new THREE.Vector3(x, y, z);
        }
        
        // Animation loop for 3D Earth
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isDragging) {
                // Smoothly transition to target rotation
                currentRotation.x += (targetRotation.x - currentRotation.x) * 0.1;
                currentRotation.y += (targetRotation.y - currentRotation.y) * 0.1;
                
                // Auto-rotate when not dragging
                targetRotation.y += earthRotationSpeed;
            }
            
            // Apply rotation
            earth.rotation.x = currentRotation.x;
            earth.rotation.y = currentRotation.y;
            
            clouds.rotation.x = currentRotation.x;
            clouds.rotation.y = currentRotation.y + 0.001; // Clouds rotate slightly faster
            
            renderer.render(scene, camera);
        }
        
        // Window resize handler
        function onWindowResize() {
            camera.aspect = earthContainer.clientWidth / earthContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(earthContainer.clientWidth, earthContainer.clientHeight);
        }
        
        // Mouse down handler
        function onMouseDown(event) {
            isDragging = true;
            previousMousePosition = {
                x: event.clientX,
                y: event.clientY
            };
            
            // Check if a marker was clicked
            checkMarkerClick(event);
        }
        
        // Mouse move handler
        function onMouseMove(event) {
            if (isDragging) {
                const deltaMove = {
                    x: event.clientX - previousMousePosition.x,
                    y: event.clientY - previousMousePosition.y
                };
                
                targetRotation.y += deltaMove.x * 0.01;
                targetRotation.x += deltaMove.y * 0.01;
                
                // Limit vertical rotation
                targetRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotation.x));
                
                previousMousePosition = {
                    x: event.clientX,
                    y: event.clientY
                };
            }
        }
        
        // Mouse up handler
        function onMouseUp() {
            isDragging = false;
        }
        
        // Mouse wheel handler
        function onMouseWheel(event) {
            event.preventDefault();
            
            // Adjust camera distance
            camera.position.z += event.deltaY * 0.1;
            
            // Limit zoom
            camera.position.z = Math.max(150, Math.min(400, camera.position.z));
        }
        
        // Touch start handler
        function onTouchStart(event) {
            if (event.touches.length === 1) {
                isDragging = true;
                previousMousePosition = {
                    x: event.touches[0].clientX,
                    y: event.touches[0].clientY
                };
                
                // Check if a marker was touched
                checkMarkerClick(event.touches[0]);
            }
        }
        
        // Touch move handler
        function onTouchMove(event) {
            if (isDragging && event.touches.length === 1) {
                const deltaMove = {
                    x: event.touches[0].clientX - previousMousePosition.x,
                    y: event.touches[0].clientY - previousMousePosition.y
                };
                
                targetRotation.y += deltaMove.x * 0.01;
                targetRotation.x += deltaMove.y * 0.01;
                
                // Limit vertical rotation
                targetRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotation.x));
                
                previousMousePosition = {
                    x: event.touches[0].clientX,
                    y: event.touches[0].clientY
                };
            }
        }
        
        // Touch end handler
        function onTouchEnd() {
            isDragging = false;
        }
        
        // Check if a marker was clicked
        function checkMarkerClick(event) {
            if (!gameActive) return;
            
            // Get mouse position
            const mouse = new THREE.Vector2();
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            // Raycasting
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            
            // Check intersections with markers
            const intersects = raycaster.intersectObjects(markers);
            
            if (intersects.length > 0) {
                const selectedCountry = intersects[0].object.userData.country;
                
                // Check if the clicked country is the target country
                checkAnswer(selectedCountry);
            }
        }
        
        // Update earth rotation speed
        function updateEarthRotationSpeed() {
            earthRotationSpeed = parseFloat(globeRotationSpeedSlider.value) * 0.001;
        }
        
        // Update earth radius
        function updateEarthRadius() {
            const newRadius = parseInt(earthRadiusSlider.value);
            
            if (earth && clouds) {
                // Scale earth and clouds
                earth.scale.set(newRadius / 100, newRadius / 100, newRadius / 100);
                clouds.scale.set(newRadius / 100, newRadius / 100, newRadius / 100);
                
                // Update earthRadius for marker positioning
                earthRadius = newRadius;
                
                // Update markers
                addCountryMarkers();
            }
        }
        
        // Update earth fact panel
        function updateEarthFact(index) {
            currentEarthFactIndex = index;
            const fact = earthFacts[index];
            
            earthFactTitle.textContent = fact.title;
            earthFactContent.textContent = fact.content;
        }
        
        // Show next earth fact
        function showNextEarthFact() {
            currentEarthFactIndex = (currentEarthFactIndex + 1) % earthFacts.length;
            updateEarthFact(currentEarthFactIndex);
            
            // Add animation
            earthFactPanel.classList.add("pulse");
            setTimeout(() => {
                earthFactPanel.classList.remove("pulse");
            }, 500);
        }
        
        // Toggle between map and earth view
        function toggleView(view) {
            currentView = view;
            
            if (view === "map") {
                // Show map, hide earth
                mapContainer.style.display = "block";
                earthContainer.style.display = "none";
                earthViewControls.style.display = "none";
                earthFactPanel.style.display = "none";
                
                // Update buttons
                mapViewBtn.classList.add("active");
                earthViewBtn.classList.remove("active");
                
                // Update speech
                updateSpeechBubble("We're looking at a flat map of our round planet! This is useful for finding countries, but remember Earth is actually a sphere!");
            } else {
                // Initialize 3D Earth if needed
                if (!scene) {
                    init3DEarth();
                }
                
                // Show earth, hide map
                mapContainer.style.display = "none";
                earthContainer.style.display = "block";
                earthViewControls.style.display = "block";
                earthFactPanel.style.display = "block";
                
                // Update buttons
                mapViewBtn.classList.remove("active");
                earthViewBtn.classList.add("active");
                
                // Update speech
                updateSpeechBubble(getRandomSpeech("earthView"));
            }
        }
        
        // Earth view controls
        function tiltUp() {
            targetRotation.x -= 0.1;
            targetRotation.x = Math.max(-Math.PI / 2, targetRotation.x);
        }
        
        function tiltDown() {
            targetRotation.x += 0.1;
            targetRotation.x = Math.min(Math.PI / 2, targetRotation.x);
        }
        
        function rotateLeft() {
            targetRotation.y -= 0.1;
        }
        
        function rotateRight() {
            targetRotation.y += 0.1;
        }
        
        function resetView() {
            targetRotation = { x: 0, y: 0 };
            camera.position.z = 300;
        }
        
        function zoomIn() {
            camera.position.z -= 20;
            camera.position.z = Math.max(150, camera.position.z);
        }
        
        function zoomOut() {
            camera.position.z += 20;
            camera.position.z = Math.min(400, camera.position.z);
        }
        
        // Show country info popup
        function showCountryInfo(country) {
            const countryInfo = countryData[country];
            
            countryInfoTitle.textContent = country;
            
            let content = `
                <p><strong>Capital:</strong> ${countryInfo.capital}</p>
                <p><strong>Population:</strong> ${countryInfo.population}</p>
                <p><strong>Continent:</strong> ${formatContinentName(countryInfo.continent)}</p>
                <p><strong>Fun Fact:</strong> ${countryInfo.facts[0]}</p>
            `;
            
            countryInfoContent.innerHTML = content;
            
            // Position popup
            countryInfoPopup.style.top = "50%";
            countryInfoPopup.style.left = "50%";
            countryInfoPopup.style.transform = "translate(-50%, -50%)";
            
            // Show popup
            countryInfoPopup.style.display = "block";
        }
        
        // Load the Google Maps API
        function loadGoogleMapsAPI() {
            if (window.google && window.google.maps) {
                // Google Maps API is already loaded
                initMap();
                return;
            }
            
            const script = document.createElement("script");
            script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&loading=async";
            script.async = true;
            document.head.appendChild(script);
        }
        
        // Start new game
        function startGame() {
            // Reset game variables
            score = 0;
            streak = 0;
            countriesFound = 0;
            continentsExplored = new Set();
            quizScore = 0;
            currentQuizQuestion = 0;
            gameActive = true;
            totalCountriesInRound = 10;
            
            // Reset displays
            scoreDisplay.textContent = score;
            streakDisplay.textContent = streak;
            updateProgressBar();
            
            // Get selected continents
            const selectedContinents = [];
            document.querySelectorAll(".checkbox-item input[type='checkbox']:checked").forEach(checkbox => {
                if (checkbox.id !== "facts" && checkbox.id !== "population" && checkbox.id !== "culture" && checkbox.id !== "landmarks" && checkbox.id !== "earth-shape") {
                    selectedContinents.push(checkbox.id);
                }
            });
            
            // Get selected difficulty
            const difficulty = parseInt(difficultySlider.value);
            
            // Get game mode
            const isCapitalsMode = document.getElementById("capitals").checked;
            
            // Get selected learning parameters
            quizFrequency = parseInt(quizFrequencyInput.value);
            const timeLimit = parseInt(timeLimitInput.value);
            timeLeft = timeLimit;
            learningDepth = learningDepthSelect.value;
            
            // Update earth rotation speed and radius
            updateEarthRotationSpeed();
            updateEarthRadius();
            
            // Filter countries based on selections
            const eligibleCountries = Object.keys(countryData).filter(country => {
                const countryInfo = countryData[country];
                const matchesContinent = selectedContinents.includes(countryInfo.continent);
                const matchesDifficulty = countryInfo.difficulty <= difficulty;
                return matchesContinent && matchesDifficulty;
            });
            
            // Check if we have enough countries
            if (eligibleCountries.length < totalCountriesInRound) {
                totalCountriesInRound = eligibleCountries.length;
                if (totalCountriesInRound === 0) {
                    updateSpeechBubble("Please select at least one continent to start the game!");
                    return;
                }
            }
            
            // Randomly select countries for this round
            countriesInRound = [];
            const tempCountries = [...eligibleCountries];
            for (let i = 0; i < totalCountriesInRound; i++) {
                if (tempCountries.length === 0) break;
                const randomIndex = Math.floor(Math.random() * tempCountries.length);
                countriesInRound.push(tempCountries[randomIndex]);
                tempCountries.splice(randomIndex, 1);
            }
            
            // Start first challenge
            nextChallenge();
            
            // Start timer
            startTimer(timeLimit);
            
            // Update UI
            hideControlPanel();
            updateSpeechBubble("Let's begin our adventure! I'll help you find countries around the world! Switch between Map View and 3D Earth View to see our planet from different perspectives!");
        }
        
        // Next challenge
        function nextChallenge() {
            if (countriesInRound.length === 0) {
                endGame();
                return;
            }
            
            // Get next country
            const randomIndex = Math.floor(Math.random() * countriesInRound.length);
            currentCountry = countriesInRound[randomIndex];
            countriesInRound.splice(randomIndex, 1);
            
            // Update challenge display
            const countryInfo = countryData[currentCountry];
            const continentName = formatContinentName(countryInfo.continent);
            
            // Format challenge based on game mode
            const isCapitalsMode = document.getElementById("capitals").checked;
            if (isCapitalsMode) {
                challengeDescription.textContent = `Find the capital city of ${currentCountry}`;
            } else {
                challengeDescription.textContent = `Find ${currentCountry}`;
            }
            
            // Reset timer for this challenge
            const timeLimit = parseInt(timeLimitInput.value);
            timeLeft = timeLimit;
            
            // Update character speech
            let speech = getRandomSpeech("challenge")
                .replace("{{country}}", currentCountry)
                .replace("{{continent}}", continentName);
            updateSpeechBubble(speech);
            
            // Center map or earth on general area
            const continent = countryInfo.continent;
            
            if (currentView === "map") {
                let continentCenter = { lat: 0, lng: 0 };
                let zoomLevel = 3;
                
                switch (continent) {
                    case "north-america":
                        continentCenter = { lat: 40, lng: -100 };
                        break;
                    case "south-america":
                        continentCenter = { lat: -15, lng: -60 };
                        break;
                    case "europe":
                        continentCenter = { lat: 50, lng: 10 };
                        break;
                    case "africa":
                        continentCenter = { lat: 0, lng: 20 };
                        break;
                    case "asia":
                        continentCenter = { lat: 30, lng: 100 };
                        break;
                    case "oceania":
                        continentCenter = { lat: -25, lng: 135 };
                        break;
                }
                
                map.setCenter(continentCenter);
                map.setZoom(zoomLevel);
            } else {
                // Rotate 3D Earth to show continent
                const lat = countryInfo.lat;
                const lng = countryInfo.lng;
                
                // Convert lat/lng to rotation
                targetRotation.x = (lat / 90) * (Math.PI / 2);
                targetRotation.y = (lng / 180) * Math.PI;
            }
            
            // Check if it's time for a quiz
            if (countriesFound > 0 && countriesFound % quizFrequency === 0) {
                startQuiz();
            }
            
            // Hide feedback container
            feedbackContainer.classList.remove("show");
        }
        
        // Check answer
        function checkAnswer(selectedCountry) {
            if (selectedCountry === currentCountry) {
                // Correct answer
                score += 100 + (streak * 10);
                streak++;
                countriesFound++;
                
                // Add continent to explored list
                continentsExplored.add(countryData[currentCountry].continent);
                
                // Update displays
                scoreDisplay.textContent = score;
                streakDisplay.textContent = streak;
                updateProgressBar();
                
                // Show feedback
                feedbackContainer.classList.remove("incorrect");
                feedbackContainer.classList.add("correct", "show");
                feedbackTitle.textContent = "Correct!";
                feedbackMessage.textContent = `Great job finding ${currentCountry}!`;
                
                // Show random fact based on learning focus
                const learningFoci = [];
                if (document.getElementById("facts").checked) learningFoci.push("facts");
                if (document.getElementById("population").checked) learningFoci.push("population");
                if (document.getElementById("culture").checked) learningFoci.push("culture");
                if (document.getElementById("landmarks").checked) learningFoci.push("landmarks");
                if (document.getElementById("earth-shape").checked) learningFoci.push("earth-shape");
                
                if (learningFoci.length > 0) {
                    const randomFocus = learningFoci[Math.floor(Math.random() * learningFoci.length)];
                    
                    if (randomFocus === "facts") {
                        const facts = countryData[currentCountry].facts;
                        factContainer.textContent = facts[Math.floor(Math.random() * facts.length)];
                    } else if (randomFocus === "earth-shape") {
                        // Show an Earth shape fact
                        const earthFact = earthFacts[Math.floor(Math.random() * earthFacts.length)];
                        factContainer.textContent = earthFact.content;
                    } else {
                        factContainer.textContent = countryData[currentCountry][randomFocus];
                    }
                } else {
                    factContainer.textContent = "";
                }
                
                // Update character speech
                const speech = getRandomSpeech("correct").replace("{{country}}", currentCountry);
                updateSpeechBubble(speech);
                
                // If in 3D Earth view, highlight the country
                if (currentView === "earth") {
                    // Add a visual pulse to the marker
                    const marker = markers.find(m => m.userData.country === currentCountry);
                    if (marker) {
                        const originalScale = marker.scale.x;
                        
                        // Animation sequence
                        const pulseMarker = () => {
                            marker.scale.set(originalScale * 2, originalScale * 2, originalScale * 2);
                            marker.material.color.setHex(0x00ff00);
                            
                            setTimeout(() => {
                                marker.scale.set(originalScale, originalScale, originalScale);
                                marker.material.color.setHex(0xff0000);
                            }, 500);
                        };
                        
                        pulseMarker();
                    }
                }
                
                // Proceed to next challenge after a delay
                setTimeout(() => {
                    nextChallenge();
                }, 3000);
            } else {
                // Incorrect answer
                streak = 0;
                streakDisplay.textContent = streak;
                
                // Show feedback
                feedbackContainer.classList.remove("correct");
                feedbackContainer.classList.add("incorrect", "show");
                feedbackTitle.textContent = "Try Again!";
                feedbackMessage.textContent = `That's ${selectedCountry}. Keep looking for ${currentCountry}!`;
                factContainer.textContent = "";
                
                // Update character speech
                const speech = getRandomSpeech("incorrect")
                    .replace("{{selected}}", selectedCountry)
                    .replace("{{country}}", currentCountry);
                updateSpeechBubble(speech);
                
                // If in 3D Earth view, show info about the wrong country
                if (currentView === "earth") {
                    showCountryInfo(selectedCountry);
                }
                
                // Hide feedback after a delay
                setTimeout(() => {
                    feedbackContainer.classList.remove("show");
                }, 2000);
            }
        }
        
        // Start timer
        function startTimer(seconds) {
            clearInterval(timer);
            timeLeft = seconds;
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    // Time's up for this challenge
                    clearInterval(timer);
                    
                    // Show feedback
                    feedbackContainer.classList.remove("correct");
                    feedbackContainer.classList.add("incorrect", "show");
                    feedbackTitle.textContent = "Time's Up!";
                    feedbackMessage.textContent = `You ran out of time to find ${currentCountry}.`;
                    factContainer.textContent = `${currentCountry} is located in ${formatContinentName(countryData[currentCountry].continent)}.`;
                    
                    // Reset streak
                    streak = 0;
                    streakDisplay.textContent = streak;
                    
                    // Update character speech
                    updateSpeechBubble(`Time's up! ${currentCountry} is located at latitude ${countryData[currentCountry].lat.toFixed(1)} and longitude ${countryData[currentCountry].lng.toFixed(1)}.`);
                    
                    // In 3D Earth view, highlight the country
                    if (currentView === "earth") {
                        // Center on the country
                        const lat = countryData[currentCountry].lat;
                        const lng = countryData[currentCountry].lng;
                        
                        targetRotation.x = (lat / 90) * (Math.PI / 2);
                        targetRotation.y = (lng / 180) * Math.PI;
                        
                        // Highlight the marker
                        const marker = markers.find(m => m.userData.country === currentCountry);
                        if (marker) {
                            marker.material.color.setHex(0x00ff00);
                            
                            setTimeout(() => {
                                marker.material.color.setHex(0xff0000);
                            }, 3000);
                        }
                    }
                    
                    // Proceed to next challenge after a delay
                    setTimeout(() => {
                        nextChallenge();
                    }, 3000);
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // End game
        function endGame() {
            gameActive = false;
            clearInterval(timer);
            
            // Show certificate
            certificateRecipient.textContent = "Young Explorer";
            certCountries.textContent = countriesFound;
            certContinents.textContent = continentsExplored.size;
            certQuiz.textContent = quizScore;
            
            const today = new Date();
            const dateString = `${today.getMonth() + 1}/${today.getDate()}/${today.getFullYear()}`;
            certDate.textContent = dateString;
            
            certificateContainer.style.display = "block";
            overlay.style.display = "block";
            
            // Update character speech
            updateSpeechBubble(getRandomSpeech("completion"));
        }
        
        // Start quiz
        function startQuiz() {
            // Pause the game
            clearInterval(timer);
            
            // Select a random quiz question
            const randomIndex = Math.floor(Math.random() * quizQuestions.length);
            const quiz = quizQuestions[randomIndex];
            
            // Update quiz container
            quizQuestion.textContent = quiz.question;
            quiz.options.forEach((option, index) => {
                quizOptions[index].textContent = option;
            });
            
            // Reset selected answer
            selectedQuizAnswer = -1;
            quizOptions.forEach(option => {
                option.classList.remove("selected");
            });
            
            // Show quiz
            quizContainer.style.display = "block";
            overlay.style.display = "block";
            
            // Update character speech
            updateSpeechBubble(getRandomSpeech("quiz"));
            
            currentQuizQuestion = randomIndex;
        }
        
        // Submit quiz answer
        function submitQuizAnswer() {
            if (selectedQuizAnswer === -1) return;
            
            const quiz = quizQuestions[currentQuizQuestion];
            
            if (selectedQuizAnswer === quiz.answer) {
                // Correct answer
                score += 200;
                quizScore++;
                scoreDisplay.textContent = score;
                
                // Update character speech
                updateSpeechBubble("Correct answer! You're a geography genius!");
            } else {
                // Incorrect answer
                updateSpeechBubble(`Almost! The correct answer is: ${quiz.options[quiz.answer]}`);
            }
            
            // Hide quiz after a delay
            setTimeout(() => {
                quizContainer.style.display = "none";
                overlay.style.display = "none";
                
                // Resume game
                startTimer(parseInt(timeLimitInput.value));
            }, 2000);
        }
        
        // Update progress bar
        function updateProgressBar() {
            const progress = (countriesFound / totalCountriesInRound) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${countriesFound}/${totalCountriesInRound} Countries`;
        }
        
        // Toggle control panel
        function toggleControlPanel() {
            controlPanel.classList.toggle("hidden");
            togglePanelBtn.classList.toggle("hidden");
        }
        
        // Hide control panel
        function hideControlPanel() {
            controlPanel.classList.add("hidden");
            togglePanelBtn.classList.add("hidden");
        }
        
        // Show control panel
        function showControlPanel() {
            controlPanel.classList.remove("hidden");
            togglePanelBtn.classList.remove("hidden");
        }
        
        // Update speech bubble
        function updateSpeechBubble(text) {
            speechBubble.textContent = text;
            
            // Add bounce animation
            const character = document.querySelector(".character");
            character.classList.add("bounce");
            setTimeout(() => {
                character.classList.remove("bounce");
            }, 1000);
        }
        
        // Get a random speech from the given category
        function getRandomSpeech(category) {
            const speeches = characterSpeeches[category];
            return speeches[Math.floor(Math.random() * speeches.length)];
        }
        
        // Format continent name
        function formatContinentName(continent) {
            switch (continent) {
                case "north-america":
                    return "North America";
                case "south-america":
                    return "South America";
                default:
                    return continent.charAt(0).toUpperCase() + continent.slice(1);
            }
        }
        
        // Get direction hint
        function getDirectionHint(country) {
            const countryInfo = countryData[country];
            const continent = countryInfo.continent;
            
            // Get all countries in the same continent
            const continentCountries = Object.keys(countryData).filter(c => 
                countryData[c].continent === continent
            );
            
            // Calculate average latitude and longitude for the continent
            let totalLat = 0;
            let totalLng = 0;
            continentCountries.forEach(c => {
                totalLat += countryData[c].lat;
                totalLng += countryData[c].lng;
            });
            
            const avgLat = totalLat / continentCountries.length;
            const avgLng = totalLng / continentCountries.length;
            
            // Determine direction relative to continent center
            let direction = "";
            
            if (countryInfo.lat > avgLat + 10) {
                direction += "northern ";
            } else if (countryInfo.lat < avgLat - 10) {
                direction += "southern ";
            }
            
            if (countryInfo.lng > avgLng + 15) {
                direction += "eastern";
            } else if (countryInfo.lng < avgLng - 15) {
                direction += "western";
            } else {
                if (direction === "") {
                    direction = "central";
                }
            }
            
            return direction.trim();
        }
        
        // Show hint
        function showHint() {
            const direction = getDirectionHint(currentCountry);
            const continent = formatContinentName(countryData[currentCountry].continent);
            
            const speech = getRandomSpeech("hint")
                .replace("{{country}}", currentCountry)
                .replace("{{direction}}", direction)
                .replace("{{continent}}", continent);
            
            updateSpeechBubble(speech);
            
            // In 3D Earth view, provide additional visual hint
            if (currentView === "earth") {
                // Briefly highlight the general area
                const lat = countryData[currentCountry].lat;
                const lng = countryData[currentCountry].lng;
                
                // Center on the approximate area
                targetRotation.x = (lat / 90) * (Math.PI / 2);
                targetRotation.y = (lng / 180) * Math.PI;
                
                // Create a temporary highlight sphere
                const hintGeometry = new THREE.SphereGeometry(10, 16, 16);
                const hintMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffff00,
                    transparent: true,
                    opacity: 0.3
                });
                const hint = new THREE.Mesh(hintGeometry, hintMaterial);
                
                // Position hint near the target country
                hint.position.copy(latLngToVector3(lat, lng, earthRadius + 10));
                scene.add(hint);
                
                // Remove hint after a few seconds
                setTimeout(() => {
                    scene.remove(hint);
                }, 3000);
            }
        }
        
        // Update map style
        function updateMapStyle(style) {
            if (!map) return; // Guard against updating before map is loaded
            
            let mapStyles = [];
            
            // Base styles for all map types
            const countryBorders = {
                featureType: "administrative.country",
                elementType: "geometry.stroke",
                stylers: [{ color: "#4285F4" }, { weight: parseInt(borderBrightnessSlider.value) / 25 }]
            };
            
            const hideLabels = {
                featureType: "administrative.country",
                elementType: "labels",
                stylers: [{ visibility: "off" }]
            };
            
            const hideProvince = {
                featureType: "administrative.province",
                stylers: [{ visibility: "off" }]
            };
            
            const hideLocality = {
                featureType: "administrative.locality",
                stylers: [{ visibility: "off" }]
            };
            
            const hideRoads = {
                featureType: "road",
                stylers: [{ visibility: "off" }]
            };
            
            switch (style) {
                case "political":
                    mapStyles = [
                        countryBorders,
                        hideLabels,
                        hideProvince,
                        hideLocality,
                        hideRoads
                    ];
                    map.setMapTypeId(google.maps.MapTypeId.ROADMAP);
                    break;
                case "terrain":
                    mapStyles = [
                        countryBorders,
                        hideLabels,
                        hideProvince,
                        hideLocality,
                        hideRoads
                    ];
                    map.setMapTypeId(google.maps.MapTypeId.TERRAIN);
                    break;
                case "satellite":
                    mapStyles = [
                        countryBorders,
                        hideLabels,
                        hideProvince,
                        hideLocality
                    ];
                    map.setMapTypeId(google.maps.MapTypeId.SATELLITE);
                    break;
            }
            
            map.setOptions({ styles: mapStyles });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Start game button
            startGameBtn.addEventListener("click", startGame);
            
            // Toggle control panel
            togglePanelBtn.addEventListener("click", toggleControlPanel);
            settingsButton.addEventListener("click", showControlPanel);
            
            // Difficulty slider
            difficultySlider.addEventListener("input", function() {
                const value = parseInt(this.value);
                let difficultyText = "";
                
                switch (value) {
                    case 1:
                        difficultyText = "Easy";
                        break;
                    case 2:
                        difficultyText = "Medium";
                        break;
                    case 3:
                        difficultyText = "Hard";
                        break;
                }
                
                difficultyValue.textContent = difficultyText;
            });
            
            // Hint button
            hintButton.addEventListener("click", showHint);
            
            // Quiz options
            quizOptions.forEach(option => {
                option.addEventListener("click", function() {
                    // Remove selected class from all options
                    quizOptions.forEach(opt => opt.classList.remove("selected"));
                    
                    // Add selected class to clicked option
                    this.classList.add("selected");
                    
                    // Store selected answer
                    selectedQuizAnswer = parseInt(this.dataset.index);
                });
            });
            
            // Quiz submit button
            quizSubmitBtn.addEventListener("click", submitQuizAnswer);
            
            // Certificate close button
            certificateCloseBtn.addEventListener("click", function() {
                certificateContainer.style.display = "none";
                overlay.style.display = "none";
                
                // Show settings to start a new game
                showControlPanel();
            });
            
            // Map style select
            mapStyleSelect.addEventListener("change", function() {
                mapStyle = this.value;
                updateMapStyle(mapStyle);
            });
            
            // Border brightness slider
            borderBrightnessSlider.addEventListener("input", function() {
                updateMapStyle(mapStyle);
            });
            
            // Show advanced concept when learning depth changes
            learningDepthSelect.addEventListener("change", function() {
                learningDepth = this.value;
                const concept = advancedConcepts[learningDepth];
                updateSpeechBubble(`${concept.title}: ${concept.facts[Math.floor(Math.random() * concept.facts.length)]}`);
            });
            
            // View toggle buttons
            mapViewBtn.addEventListener("click", function() {
                toggleView("map");
            });
            
            earthViewBtn.addEventListener("click", function() {
                toggleView("earth");
            });
            
            // Earth view control buttons
            if (tiltUpBtn) tiltUpBtn.addEventListener("click", tiltUp);
            if (tiltDownBtn) tiltDownBtn.addEventListener("click", tiltDown);
            if (rotateLeftBtn) rotateLeftBtn.addEventListener("click", rotateLeft);
            if (rotateRightBtn) rotateRightBtn.addEventListener("click", rotateRight);
            if (resetViewBtn) resetViewBtn.addEventListener("click", resetView);
            if (zoomInBtn) zoomInBtn.addEventListener("click", zoomIn);
            if (zoomOutBtn) zoomOutBtn.addEventListener("click", zoomOut);
            
            // Earth fact next button
            if (earthFactNextBtn) earthFactNextBtn.addEventListener("click", showNextEarthFact);
            
            // Country info close button
            if (countryInfoCloseBtn) countryInfoCloseBtn.addEventListener("click", function() {
                countryInfoPopup.style.display = "none";
            });
            
            // Globe rotation speed slider
            if (globeRotationSpeedSlider) globeRotationSpeedSlider.addEventListener("input", updateEarthRotationSpeed);
            
            // Earth radius slider
            if (earthRadiusSlider) earthRadiusSlider.addEventListener("input", updateEarthRadius);
        }
        
        // Initialize the game on document load
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize DOM elements
            initializeElements();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load Google Maps API
            loadGoogleMapsAPI();
            
            // Display an initial advanced concept
            setTimeout(() => {
                const concept = advancedConcepts[learningDepth];
                updateSpeechBubble(`${concept.title}: ${concept.facts[Math.floor(Math.random() * concept.facts.length)]}`);
            }, 5000);
        });
        
        // Define initMap function globally for Google Maps callback
        window.initMap = initMap;
    </script>
</body>
</html>            