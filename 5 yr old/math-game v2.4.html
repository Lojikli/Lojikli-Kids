<!DOCTYPE html>
<html>
<head>
    <title>Base-N Addition Master</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/confetti-js/0.0.18/confetti.min.js"></script>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive;
            text-align: center;
            background: linear-gradient(135deg, #83EAF1, #63A4FF);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin: 2rem;
            max-width: 800px;
        }

        .problem {
            font-size: 2.5rem;
            margin: 1rem;
            color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .digit-grid {
            display: grid;
            grid-auto-flow: column;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem;
        }

        .digit-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }

        .horizontal-line {
            width: 100%;
            height: 2px;
            background: #2c3e50;
            margin: 0.5rem 0;
        }

        .carry-button {
            width: 2rem;
            height: 2rem;
            border: 2px dashed #e74c3c;
            border-radius: 50%;
            background: white;
            color: #e74c3c;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            opacity: 0.3;
            transition: all 0.2s;
        }

        .carry-button:hover {
            opacity: 0.8;
        }

        .carry-button.active {
            opacity: 1;
            background: #e74c3c;
            color: white;
            border-style: solid;
        }

        .digit {
            font-size: 2.5rem;
            width: 2.5rem;
            text-align: center;
        }

        .digit-input {
            width: 2.5rem;
            height: 2.5rem;
            font-size: 2rem;
            text-align: center;
            border: 3px solid #3498db;
            border-radius: 10px;
            margin: 0;
            padding: 0;
        }

        .digit-input:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        button {
            font-size: 1.5rem;
            padding: 0.5rem 2rem;
            margin: 1rem;
            border: none;
            border-radius: 10px;
            background: #2ecc71;
            color: white;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .base-info {
            font-size: 1.2rem;
            margin: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .score {
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 1rem;
        }

        .progress {
            width: 80%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem auto;
        }

        .progress-bar {
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
        }

        .wrong-answer {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <canvas id="confetti"></canvas>
    <div class="container">
        <h1>Base-N Addition Master! ðŸš€</h1>
        
        <div>
            <label for="base">Choose your number base (2-16): </label>
            <select id="base" onchange="generateProblem()">
                <option value="2">Base 2 (Binary)</option>
                <option value="3">Base 3</option>
                <option value="4">Base 4</option>
                <option value="5">Base 5</option>
                <option value="6">Base 6</option>
                <option value="7">Base 7</option>
                <option value="8">Base 8 (Octal)</option>
                <option value="9">Base 9</option>
                <option value="10" selected>Base 10 (Decimal)</option>
                <option value="11">Base 11</option>
                <option value="12">Base 12</option>
                <option value="13">Base 13</option>
                <option value="14">Base 14</option>
                <option value="15">Base 15</option>
                <option value="16">Base 16 (Hex)</option>
            </select>
            
            <label for="goalProblems">Goal problems: </label>
            <select id="goalProblems">
                <option value="10">10</option>
                <option value="30" selected>30</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>

        <div class="base-info" id="baseInfo"></div>
        
        <div class="problem-container">
            <div style="font-size: 2rem; margin-bottom: 1rem;">Solve in base <span id="currentBase">10</span>:</div>
            <div id="problemGrid" class="digit-grid"></div>
        </div>
        
        <button onclick="checkAnswer()">Check Answer</button>
        
        <div class="score">
            Score: <span id="score">0</span> / <span id="total">0</span>
        </div>
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <script>
        let currentSum;
        let score = 0;
        let total = 0;
        let num1, num2;
        let carries = [];
        
        const confettiConfig = {
            target: 'confetti',
            max: 80,
            size: 1.5,
            animate: true,
            props: ['circle', 'square', 'triangle', 'line'],
            colors: [[165,104,246],[230,61,135],[0,199,228],[253,214,126]],
            clock: 25,
        };
        const confetti = new ConfettiGenerator(confettiConfig);
        confetti.render();
        
        function getBaseSymbols(base) {
            const symbols = '0123456789ABCDEF';
            return symbols.slice(0, base);
        }
        
        function updateBaseInfo() {
            const base = parseInt(document.getElementById('base').value);
            const symbols = getBaseSymbols(base);
            const baseInfo = document.getElementById('baseInfo');
            
            let info = `Available digits in base ${base}: ${symbols.split('').join(' ')}`;
            if (base > 10) {
                info += '<br>Hint: A=10, B=11, C=12, D=13, E=14, F=15';
            }
            baseInfo.innerHTML = info;
        }
        
        function padNumber(num, length) {
            return num.padStart(length, '0');
        }

        function calculateCarries(n1, n2, base) {
            const result = [];
            let carry = 0;
            const maxLength = Math.max(n1.length, n2.length);
            
            n1 = padNumber(n1, maxLength);
            n2 = padNumber(n2, maxLength);
            
            for (let i = maxLength - 1; i >= 0; i--) {
                const d1 = parseInt(n1[i], base);
                const d2 = parseInt(n2[i], base);
                const sum = d1 + d2 + carry;
                carry = Math.floor(sum / base);
                result.unshift(carry);
            }
            
            return result;
        }
        
        function createDigitGrid(n1, n2, carries) {
            const grid = document.getElementById('problemGrid');
            grid.innerHTML = '';
            
            const maxLength = Math.max(n1.length, n2.length) + 1;
            const paddedN1 = padNumber(n1, maxLength);
            const paddedN2 = padNumber(n2, maxLength);
            
            for (let i = 0; i < maxLength; i++) {
                const column = document.createElement('div');
                column.className = 'digit-column';
                
                // Carry button
                const carryBtn = document.createElement('button');
                carryBtn.className = 'carry-button';
                carryBtn.textContent = '1';
                carryBtn.onclick = function(e) {
                    e.preventDefault(); // Prevent form submission
                    this.classList.toggle('active');
                };
                column.appendChild(carryBtn);
                
                // First number
                const d1 = document.createElement('div');
                d1.className = 'digit';
                d1.textContent = paddedN1[i] || '';
                column.appendChild(d1);
                
                // Second number
                const d2 = document.createElement('div');
                d2.className = 'digit';
                d2.textContent = paddedN2[i] || '';
                column.appendChild(d2);
                
                // Top horizontal line
                const topLine = document.createElement('div');
                topLine.className = 'horizontal-line';
                column.appendChild(topLine);
                
                // Input box
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'digit-input';
                input.maxLength = 1;
                input.dataset.pos = i;
                input.addEventListener('input', handleDigitInput);
                input.addEventListener('keydown', handleKeyDown);
                column.appendChild(input);
                
                // Bottom horizontal line
                const bottomLine = document.createElement('div');
                bottomLine.className = 'horizontal-line';
                column.appendChild(bottomLine);
                
                grid.insertBefore(column, grid.firstChild);
            }
            
            // Focus on rightmost input
            const inputs = document.querySelectorAll('.digit-input');
            inputs[inputs.length - 1].focus();
        }
        
        function handleDigitInput(e) {
            const base = parseInt(document.getElementById('base').value);
            const input = e.target;
            let value = input.value.toUpperCase();
            
            // Validate input
            const validChars = getBaseSymbols(base);
            if (!validChars.includes(value)) {
                input.value = '';
                return;
            }
            
            // Move to next input if available
            if (value) {
                const inputs = Array.from(document.querySelectorAll('.digit-input'));
                const currentIndex = inputs.indexOf(input);
                if (currentIndex > 0) {
                    inputs[currentIndex - 1].focus();
                }
            }
        }
        
        function handleKeyDown(e) {
            if (e.key === 'Backspace' && !e.target.value) {
                const inputs = Array.from(document.querySelectorAll('.digit-input'));
                const currentIndex = inputs.indexOf(e.target);
                if (currentIndex < inputs.length - 1) {
                    inputs[currentIndex + 1].focus();
                }
            }
        }
        
        function generateProblem() {
            const base = parseInt(document.getElementById('base').value);
            document.getElementById('currentBase').textContent = base;
            
            // Generate numbers that require carrying in at least one position
            do {
                // Generate rightmost digits first
                const d1 = Math.floor(Math.random() * base);
                const d2 = Math.floor(Math.random() * base);
                
                // Generate rest of the numbers
                const remaining1 = Math.floor(Math.random() * Math.min(50, Math.pow(base, 2)));
                const remaining2 = Math.floor(Math.random() * Math.min(50, Math.pow(base, 2)));
                
                num1 = remaining1 * base + d1;
                num2 = remaining2 * base + d2;
                currentSum = num1 + num2;
                
                const n1 = num1.toString(base).toUpperCase();
                const n2 = num2.toString(base).toUpperCase();
                carries = calculateCarries(n1, n2, base);
            } while (!carries.some(carry => carry > 0));
            
            const n1 = num1.toString(base).toUpperCase();
            const n2 = num2.toString(base).toUpperCase();
            
            updateBaseInfo();
            createDigitGrid(n1, n2, carries);
        }
        
        function checkAnswer() {
            const base = parseInt(document.getElementById('base').value);
            const inputs = Array.from(document.querySelectorAll('.digit-input')).reverse();
            const userAnswer = inputs.map(input => input.value.toUpperCase()).join('');
            const correctAnswer = currentSum.toString(base).toUpperCase();
            
            total++;
            if (userAnswer === correctAnswer) {
                score++;
                confetti.render();
                setTimeout(() => {
                    document.getElementById('confetti').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('confetti').style.opacity = '1';
                    }, 100);
                }, 1000);
            } else {
                document.getElementById('problemGrid').classList.add('wrong-answer');
                setTimeout(() => {
                    document.getElementById('problemGrid').classList.remove('wrong-answer');
                }, 500);
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = total;
            
            const goalProblems = parseInt(document.getElementById('goalProblems').value);
            const progress = (total / goalProblems) * 100;
            document.getElementById('progressBar').style.width = `${Math.min(100, progress)}%`;
            
            if (total >= goalProblems) {
                alert(`Game Over! Your score: ${score}/${total}`);
                score = 0;
                total = 0;
                document.getElementById('score').textContent = '0';
                document.getElementById('total').textContent = '0';
                document.getElementById('progressBar').style.width = '0%';
            }
            
            generateProblem();
        }
        
        // Initialize first problem
        generateProblem();
    </script>
</body>
</html>