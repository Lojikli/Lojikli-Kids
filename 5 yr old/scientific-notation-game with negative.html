<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Notation Adventure</title>
    <style>
        /* Base styles */
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f9ff;
            background-image: linear-gradient(to bottom right, #e0f7fa, #bbdefb);
            transition: background-color 0.5s;
            touch-action: manipulation;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        /* Characters */
        .character-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 5;
        }
        
        .character {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .character-body {
            width: 80px;
            height: 80px;
            background: #3f51b5;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .character-eye {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 20px;
        }
        
        .character-eye-left {
            left: 15px;
        }
        
        .character-eye-right {
            right: 15px;
        }
        
        .character-pupil {
            width: 10px;
            height: 10px;
            background: #000;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            left: 5px;
        }
        
        .character-mouth {
            width: 40px;
            height: 20px;
            border-bottom: 5px solid white;
            border-radius: 0 0 20px 20px;
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .character-antenna {
            width: 5px;
            height: 30px;
            background: #f44336;
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .character-antenna-ball {
            width: 15px;
            height: 15px;
            background: #ffeb3b;
            border-radius: 50%;
            position: absolute;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #ffeb3b; }
            50% { box-shadow: 0 0 20px #ffeb3b; }
        }
        
        .character-speech-bubble {
            position: absolute;
            top: -80px;
            left: -150px;
            background: white;
            border-radius: 20px;
            padding: 10px;
            width: 200px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            text-align: center;
        }
        
        .character-speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
        }
        
        /* Header and top elements */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .game-title {
            text-align: center;
            color: #1e40af;
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            flex-grow: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .game-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3f51b5, #9c27b0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            margin-right: 15px;
        }
        
        .score-container {
            background: linear-gradient(135deg, #42a5f5, #1976d2);
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .score-star {
            display: inline-block;
            margin-right: 5px;
            color: #ffeb3b;
        }
        
        /* Progress indicator */
        .progress-container {
            margin: 10px 0 20px;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #42a5f5, #1976d2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 5px;
        }
        
        /* Difficulty selector and options */
        .difficulty, .game-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .difficulty button {
            padding: 8px 16px;
            border: none;
            background: linear-gradient(to bottom, #f5f5f5, #e0e0e0);
            color: #333;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            outline: none;
        }
        
        .difficulty button.active {
            background: linear-gradient(to bottom, #1976d2, #1565c0);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .game-options {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 12px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #1976d2;
        }
        
        .option label {
            font-size: 14px;
            color: #333;
            cursor: pointer;
        }
        
        /* Question area */
        .question-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .question-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, #1976d2, #64b5f6);
            border-radius: 12px 12px 0 0;
        }
        
        .question {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            color: #1565c0;
            font-weight: bold;
        }
        
        /* Decimal point mover */
        .decimal-mover {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(to bottom, #f1f8fe, #e3f2fd);
            border-radius: 12px;
            border: 2px dashed #42a5f5;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .mover-title {
            color: #1976d2;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .number-display {
            position: relative;
            font-family: monospace;
            font-size: 36px;
            min-height: 70px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            padding: 10px 20px;
            border-radius: 40px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            overflow-x: auto;
            max-width: 90%;
        }
        
        .decimal-highlight {
            position: absolute;
            height: 60px;
            width: 20px;
            background-color: rgba(25, 118, 210, 0.2);
            border-radius: 3px;
            transition: left 0.3s;
            z-index: 1;
        }
        
        .digit {
            display: inline-block;
            width: 25px;
            text-align: center;
            position: relative;
            z-index: 2;
            margin: 0 2px;
            transition: all 0.2s;
        }
        
        .digit.highlighted {
            color: #1976d2;
            transform: scale(1.2);
        }
        
        .decimal-point {
            display: inline-block;
            width: 10px;
            text-align: center;
            position: relative;
            z-index: 2;
            color: #1976d2;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .arrow-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .controls-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .arrow-btn, .control-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #42a5f5, #1976d2);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
            outline: none;
        }
        
        .arrow-btn:hover, .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .arrow-btn:active, .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .exponent-display {
            font-size: 22px;
            color: #1976d2;
            margin: 10px 0;
            padding: 10px 20px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            transition: all 0.3s;
        }
        
        .exponent-display.highlight {
            animation: pulse 0.5s;
        }
        
        .fraction-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
            font-size: 22px;
            color: #1976d2;
        }
        
        .fraction-numerator, .fraction-denominator {
            text-align: center;
            padding: 5px 10px;
        }
        
        .fraction-line {
            width: 100%;
            height: 2px;
            background: #1976d2;
            margin: 5px 0;
        }
        
        /* Zero controls for decimal mover */
        .zero-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .zero-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, #26c6da, #00acc1);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
            outline: none;
        }
        
        .zero-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .zero-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Answer input */
        .answer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 12px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .input-label {
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .coefficient-input, .exponent-input, .decimal-input {
            width: 80px;
            padding: 12px;
            font-size: 18px;
            border: 2px solid #42a5f5;
            border-radius: 8px;
            text-align: center;
            background-color: white;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s;
            outline: none;
        }
        
        .coefficient-input:focus, .exponent-input:focus, .decimal-input:focus {
            border-color: #1976d2;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2), inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .decimal-input {
            width: 200px;
        }
        
        .notation-text {
            font-size: 24px;
            color: #333;
            font-weight: bold;
        }
        
        /* Fraction input */
        .fraction-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }
        
        .fraction-input {
            width: 80px;
            padding: 8px;
            font-size: 16px;
            border: 2px solid #42a5f5;
            border-radius: 5px;
            text-align: center;
            background-color: white;
        }
        
        .fraction-divider {
            width: 90px;
            height: 2px;
            background-color: #333;
            margin: 5px 0;
        }
        
        /* Number keyboard */
        .keyboard-container {
            margin: 20px 0;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .keyboard-tabs {
            display: flex;
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .keyboard-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            color: #757575;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .keyboard-tab.active {
            background-color: white;
            color: #1976d2;
            box-shadow: 0 2px 0 #1976d2;
        }
        
        .number-keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px;
            background-color: white;
            border-radius: 0 0 12px 12px;
        }
        
        .number-key {
            width: 60px;
            height: 60px;
            font-size: 22px;
            background: linear-gradient(to bottom, #f5f5f5, #e0e0e0);
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
            margin: 0 auto;
            color: #333;
            font-weight: bold;
            outline: none;
        }
        
        .number-key:hover {
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0,0,0,0.15);
        }
        
        .number-key:active {
            transform: scale(0.95);
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        
        .action-key {
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
            color: #1976d2;
            font-size: 16px;
            font-weight: bold;
        }
        
        .negative-key {
            background: linear-gradient(to bottom, #ffebee, #ffcdd2);
            color: #d32f2f;
            font-weight: bold;
        }
        
        .fraction-key {
            background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
            color: #2e7d32;
            font-weight: bold;
        }
        
        .wide-key {
            grid-column: span 2;
            width: auto;
        }
        
        .extra-wide-key {
            grid-column: span 4;
            width: auto;
        }
        
        #clear-key {
            background: linear-gradient(to bottom, #ffebee, #ffcdd2);
            color: #d32f2f;
        }
        
        /* Fraction keyboard */
        .fraction-keyboard {
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px;
            background-color: white;
            border-radius: 0 0 12px 12px;
        }
        
        .fraction-preset {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px 5px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .fraction-preset:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            background: #bbdefb;
        }
        
        .fraction-preset-num, .fraction-preset-denom {
            font-size: 16px;
            font-weight: bold;
            color: #1976d2;
        }
        
        .fraction-preset-line {
            width: 80%;
            height: 2px;
            background: #1976d2;
            margin: 5px 0;
        }
        
        /* Buttons */
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            font-size: 18px;
            background: linear-gradient(135deg, #42a5f5, #1976d2);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            outline: none;
            min-width: 120px;
            text-align: center;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }
        
        .btn:active {
            transform: scale(0.98) translateY(0);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% { transform: scale(0, 0); opacity: 1; }
            20% { transform: scale(25, 25); opacity: 0.8; }
            100% { transform: scale(50, 50); opacity: 0; }
        }
        
        .btn:disabled {
            background: linear-gradient(135deg, #90caf9, #64b5f6);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Feedback */
        .feedback {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            min-height: 30px;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .feedback.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .correct {
            color: #2e7d32;
            background-color: #e8f5e9;
            border-left: 5px solid #2e7d32;
        }
        
        .incorrect {
            color: #d32f2f;
            background-color: #ffebee;
            border-left: 5px solid #d32f2f;
        }
        
        /* Confetti animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            overflow: hidden;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 0;
            transform: rotate(45deg);
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 150px)) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Celebration effects */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        @keyframes pulse {
            0% {transform: scale(1); box-shadow: 0 0 0 0 rgba(25, 118, 210, 0.4);}
            70% {transform: scale(1.1); box-shadow: 0 0 0 10px rgba(25, 118, 210, 0);}
            100% {transform: scale(1); box-shadow: 0 0 0 0 rgba(25, 118, 210, 0);}
        }
        
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);}
            20%, 40%, 60%, 80% {transform: translateX(5px);}
        }
        
        .bounce {animation: bounce 1s;}
        .pulse {animation: pulse 0.5s;}
        .shake {animation: shake 0.5s;}
        
        /* Floating emojis animation */
        .floating-emoji {
            position: absolute;
            animation: float-up 3s ease-out forwards;
            z-index: 100;
            pointer-events: none;
            font-size: 30px;
        }
        
        @keyframes float-up {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Theme switcher */
        .theme-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
            transition: all 0.3s;
        }
        
        .theme-switcher:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        /* Space theme */
        body.space-theme {
            background-color: #0a1128;
            background-image: linear-gradient(to bottom right, #0a1128, #1a237e);
            color: #f5f5f5;
        }
        
        body.space-theme .container {
            background: rgba(26, 35, 126, 0.8);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        body.space-theme .game-title {
            color: #f5f5f5;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        body.space-theme .question {
            color: #bbdefb;
        }
        
        body.space-theme .game-options {
            background-color: rgba(25, 118, 210, 0.2);
        }
        
        body.space-theme .option label {
            color: #f5f5f5;
        }
        
        body.space-theme .mover-title {
            color: #bbdefb;
        }
        
        body.space-theme .decimal-mover {
            background: linear-gradient(to bottom, rgba(25, 118, 210, 0.2), rgba(13, 71, 161, 0.3));
            border: 2px dashed #42a5f5;
        }
        
        body.space-theme .number-display {
            background: rgba(255, 255, 255, 0.1);
            color: #f5f5f5;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        
        body.space-theme .question-container {
            background: rgba(13, 71, 161, 0.5);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        body.space-theme .answer-container {
            background: rgba(13, 71, 161, 0.3);
        }
        
        body.space-theme .input-label {
            color: #f5f5f5;
        }
        
        body.space-theme .coefficient-input, 
        body.space-theme .exponent-input, 
        body.space-theme .decimal-input {
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        body.space-theme .notation-text {
            color: #f5f5f5;
        }
        
        body.space-theme .exponent-display {
            background: rgba(255, 255, 255, 0.1);
            color: #bbdefb;
        }
        
        /* Underwater theme */
        body.underwater-theme {
            background-color: #01579b;
            background-image: linear-gradient(to bottom right, #01579b, #0288d1);
            color: #f5f5f5;
        }
        
        body.underwater-theme .container {
            background: rgba(1, 87, 155, 0.6);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        body.underwater-theme .game-title {
            color: #e1f5fe;
            text-shadow: 0 0 10px rgba(225, 245, 254, 0.5);
        }
        
        body.underwater-theme .question {
            color: #e1f5fe;
        }
        
        body.underwater-theme .game-options {
            background-color: rgba(2, 136, 209, 0.5);
        }
        
        body.underwater-theme .option label {
            color: #f5f5f5;
        }
        
        body.underwater-theme .mover-title {
            color: #e1f5fe;
        }
        
        body.underwater-theme .decimal-mover {
            background: linear-gradient(to bottom, rgba(3, 169, 244, 0.3), rgba(2, 136, 209, 0.4));
            border: 2px dashed #29b6f6;
        }
        
        body.underwater-theme .number-display {
            background: rgba(255, 255, 255, 0.2);
            color: #f5f5f5;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        
        body.underwater-theme .question-container {
            background: rgba(2, 136, 209, 0.5);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        body.underwater-theme .answer-container {
            background: rgba(2, 136, 209, 0.3);
        }
        
        body.underwater-theme .input-label {
            color: #f5f5f5;
        }
        
        body.underwater-theme .coefficient-input, 
        body.underwater-theme .exponent-input, 
        body.underwater-theme .decimal-input {
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        body.underwater-theme .notation-text {
            color: #f5f5f5;
        }
        
        body.underwater-theme .exponent-display {
            background: rgba(255, 255, 255, 0.2);
            color: #e1f5fe;
        }
        
        /* Bubbles animation */
        .bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        
        .bubble {
            position: absolute;
            bottom: -100px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            opacity: 0.5;
            animation: bubble-rise linear infinite;
        }
        
        @keyframes bubble-rise {
            0% {
                transform: translateY(0) scale(0.3);
                opacity: 0;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100vh) scale(1);
                opacity: 0;
            }
        }
        
        /* Stars animation */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle linear infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }
        
        .tooltip .tooltip-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #1976d2;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Mobile adjustments */
        @media (max-width: 600px) {
            .game-title {
                font-size: 22px;
            }
            
            .question {
                font-size: 18px;
            }
            
            .input-group {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .number-key {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .arrow-btn, .control-btn {
                width: 40px;
                height: 40px;
            }
            
            .zero-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 16px;
            }
            
            .game-options {
                padding: 10px;
            }
            
            .option label {
                font-size: 12px;
            }
            
            .difficulty button {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .tooltip .tooltip-text {
                width: 150px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Theme backgrounds -->
    <div class="bubbles" style="display: none;"></div>
    <div class="stars" style="display: none;"></div>
    
    <!-- Theme switcher -->
    <div class="theme-switcher" id="theme-switcher">üåà</div>
    
    <div class="container">
        <div class="game-header">
            <div class="game-logo">SN</div>
            <h1 class="game-title">Scientific Notation Adventure</h1>
            <div class="score-container">
                <span class="score-star">‚≠ê</span> Score: <span id="score">0</span>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="difficulty">
            <button class="active" data-level="easy">Easy</button>
            <button data-level="medium">Medium</button>
            <button data-level="hard">Hard</button>
            <button data-level="genius">Genius</button>
        </div>
        
        <div class="game-options">
            <div class="option">
                <input type="checkbox" id="hideExponentCounter" />
                <label for="hideExponentCounter">Hide Exponent Counter</label>
                <div class="tooltip">
                    <div class="tooltip-icon">?</div>
                    <span class="tooltip-text">Count the decimal moves yourself! Great for practice.</span>
                </div>
            </div>
            <div class="option">
                <input type="checkbox" id="alwaysShowDecimalMover" checked />
                <label for="alwaysShowDecimalMover">Show Decimal Mover</label>
            </div>
            <div class="option">
                <input type="checkbox" id="showFractions" checked />
                <label for="showFractions">Show Fractions</label>
                <div class="tooltip">
                    <div class="tooltip-icon">?</div>
                    <span class="tooltip-text">See negative exponents as fractions to understand what they mean!</span>
                </div>
            </div>
            <div class="option">
                <input type="checkbox" id="toggle-sound" checked />
                <label for="toggle-sound">Sound Effects</label>
            </div>
        </div>
        
        <div class="question-container">
            <div class="question" id="question"></div>
            
            <!-- Decimal point mover -->
            <div class="decimal-mover" id="decimal-mover">
                <div class="mover-title">Move the decimal point with the arrows:</div>
                <div class="number-display" id="number-display">
                    <div class="decimal-highlight" id="decimal-highlight"></div>
                    <!-- Digits will be added here by JavaScript -->
                </div>
                <div class="arrow-controls">
                    <button class="arrow-btn" id="left-arrow">‚Üê</button>
                    <div class="exponent-display" id="exponent-display">Exponent: <span id="mover-exponent">0</span></div>
                    <button class="arrow-btn" id="right-arrow">‚Üí</button>
                </div>
                
                <!-- Fraction display -->
                <div class="fraction-display" id="fraction-display" style="display: none;">
                    <div>Power of 10 as a fraction:</div>
                    <div class="fraction-container">
                        <div class="fraction-numerator" id="fraction-numerator">1</div>
                        <div class="fraction-line"></div>
                        <div class="fraction-denominator" id="fraction-denominator">1</div>
                    </div>
                </div>
                
                <div class="controls-row">
                    <!-- Zero controls for expanded form -->
                    <button class="zero-btn" id="add-zero-left">Add 0 Left</button>
                    <button class="zero-btn" id="add-zero-right">Add 0 Right</button>
                </div>
                
                <button class="btn" id="use-exponent">Use This Exponent</button>
            </div>
            
            <div class="answer-container">
                <div class="input-label">Your Answer:</div>
                
                <!-- Scientific notation input (a √ó 10^b) -->
                <div class="input-group" id="scientific-input">
                    <input type="text" class="coefficient-input" id="coefficient" placeholder="a" readonly>
                    <span class="notation-text">√ó 10^</span>
                    <input type="text" class="exponent-input" id="exponent" placeholder="b" readonly>
                </div>
                
                <!-- Standard decimal input -->
                <div class="input-group" id="decimal-input" style="display: none;">
                    <input type="text" class="decimal-input" id="decimal" placeholder="Enter number" readonly>
                </div>
                
                <!-- Fraction input -->
                <div class="input-group" id="fraction-input" style="display: none;">
                    <div class="fraction-input-container">
                        <input type="text" class="fraction-input" id="fraction-numerator-input" placeholder="1" readonly>
                        <div class="fraction-divider"></div>
                        <input type="text" class="fraction-input" id="fraction-denominator-input" placeholder="1" readonly>
                    </div>
                </div>
            </div>
            
            <!-- Keyboard tabs and content -->
            <div class="keyboard-container">
                <div class="keyboard-tabs">
                    <div class="keyboard-tab active" data-tab="number-keyboard">Number Keyboard</div>
                    <div class="keyboard-tab" data-tab="fraction-keyboard">Fraction Presets</div>
                </div>
                
                <!-- Number keyboard -->
                <div class="number-keyboard" id="number-keyboard">
                    <button class="number-key">7</button>
                    <button class="number-key">8</button>
                    <button class="number-key">9</button>
                    <button class="number-key action-key" id="backspace-key">‚å´</button>
                    <button class="number-key">4</button>
                    <button class="number-key">5</button>
                    <button class="number-key">6</button>
                    <button class="number-key negative-key" id="negative-key">¬±</button>
                    <button class="number-key">1</button>
                    <button class="number-key">2</button>
                    <button class="number-key">3</button>
                    <button class="number-key fraction-key" id="pi-key">œÄ</button>
                    <button class="number-key">0</button>
                    <button class="number-key">.</button>
                    <button class="number-key fraction-key" id="exp-key">e</button>
                    <button class="number-key action-key" id="clear-key">C</button>
                </div>
                
                <!-- Fraction keyboard -->
                <div class="fraction-keyboard" id="fraction-keyboard">
                    <div class="fraction-preset" data-num="1" data-denom="10">
                        <div class="fraction-preset-num">1</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">10</div>
                    </div>
                    <div class="fraction-preset" data-num="1" data-denom="100">
                        <div class="fraction-preset-num">1</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">100</div>
                    </div>
                    <div class="fraction-preset" data-num="1" data-denom="1000">
                        <div class="fraction-preset-num">1</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">1000</div>
                    </div>
                    <div class="fraction-preset" data-num="1" data-denom="10000">
                        <div class="fraction-preset-num">1</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">10000</div>
                    </div>
                    <div class="fraction-preset" data-num="10" data-denom="1">
                        <div class="fraction-preset-num">10</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">1</div>
                    </div>
                    <div class="fraction-preset" data-num="100" data-denom="1">
                        <div class="fraction-preset-num">100</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">1</div>
                    </div>
                    <div class="fraction-preset" data-num="1000" data-denom="1">
                        <div class="fraction-preset-num">1000</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">1</div>
                    </div>
                    <div class="fraction-preset" data-num="10000" data-denom="1">
                        <div class="fraction-preset-num">10000</div>
                        <div class="fraction-preset-line"></div>
                        <div class="fraction-preset-denom">1</div>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn" id="checkAnswer">Check Answer</button>
                <button class="btn" id="nextQuestion" disabled>Next Question</button>
            </div>
        </div>
        
        <div class="feedback" id="feedback"></div>
        
        <!-- Character -->
        <div class="character-container">
            <div class="character">
                <div class="character-antenna"></div>
                <div class="character-antenna-ball"></div>
                <div class="character-body">
                    <div class="character-eye character-eye-left">
                        <div class="character-pupil"></div>
                    </div>
                    <div class="character-eye character-eye-right">
                        <div class="character-pupil"></div>
                    </div>
                    <div class="character-mouth"></div>
                </div>
                <div class="character-speech-bubble" id="character-speech"></div>
            </div>
        </div>
    </div>
    
    <!-- HTML structure for confetti container -->
    <div class="confetti-container"></div>
    
    <script>
        // Audio context for sound effects
        let audioContext;
        
        // Initialize audio context on first user interaction
        document.addEventListener('click', initAudioContext, { once: true });
        
        function initAudioContext() {
            if (!audioContext) {
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioContext = new AudioContext();
                } catch (e) {
                    console.warn('Web Audio API not supported in this browser');
                }
            }
        }
        
        class ScientificNotationGame {
            constructor() {
                this.score = 0;
                this.totalQuestions = 0;
                this.difficulty = 'easy';
                this.currentQuestion = null;
                this.questionType = null;
                this.correctAnswer = null;
                this.moverExponentValue = 0;
                this.activeInput = null;
                this.soundEnabled = true;
                this.currentTheme = 'default';
                this.bubbles = [];
                this.stars = [];
                
                // Character speech phrases
                this.tipPhrases = [
                    "Remember: Scientific notation is a √ó 10^b where 1 ‚â§ |a| < 10!",
                    "Moving the decimal point right means the exponent decreases!",
                    "Moving the decimal point left means the exponent increases!",
                    "When the exponent is negative, think of it as a fraction!",
                    "10^-2 is the same as 1/100 or 0.01!",
                    "10^3 means 1,000 (a 1 followed by 3 zeros)!",
                    "To multiply in scientific notation, multiply the coefficients and add the exponents!",
                    "Need help? Watch the decimal point move to see how the exponent changes!"
                ];
                
                this.encouragementPhrases = [
                    "You're doing great! Keep it up!",
                    "Wow, you're really good at this!",
                    "You're a scientific notation superstar!",
                    "Amazing work! You're mastering this!",
                    "Your brain is growing with every problem you solve!",
                    "Keep going! You're making excellent progress!",
                    "I'm impressed by your math skills!",
                    "You're thinking like a scientist now!"
                ];
                
                // Get DOM elements
                this.elements = {
                    score: document.getElementById('score'),
                    progressBar: document.getElementById('progress-bar'),
                    question: document.getElementById('question'),
                    scientificInput: document.getElementById('scientific-input'),
                    decimalInput: document.getElementById('decimal-input'),
                    fractionInput: document.getElementById('fraction-input'),
                    coefficient: document.getElementById('coefficient'),
                    exponent: document.getElementById('exponent'),
                    decimal: document.getElementById('decimal'),
                    fractionNumeratorInput: document.getElementById('fraction-numerator-input'),
                    fractionDenominatorInput: document.getElementById('fraction-denominator-input'),
                    checkAnswerBtn: document.getElementById('checkAnswer'),
                    nextQuestionBtn: document.getElementById('nextQuestion'),
                    feedback: document.getElementById('feedback'),
                    decimalMover: document.getElementById('decimal-mover'),
                    numberDisplay: document.getElementById('number-display'),
                    decimalHighlight: document.getElementById('decimal-highlight'),
                    leftArrow: document.getElementById('left-arrow'),
                    rightArrow: document.getElementById('right-arrow'),
                    addZeroLeft: document.getElementById('add-zero-left'),
                    addZeroRight: document.getElementById('add-zero-right'),
                    moverExponent: document.getElementById('mover-exponent'),
                    exponentDisplay: document.getElementById('exponent-display'),
                    fractionDisplay: document.getElementById('fraction-display'),
                    fractionNumerator: document.getElementById('fraction-numerator'),
                    fractionDenominator: document.getElementById('fraction-denominator'),
                    useExponent: document.getElementById('use-exponent'),
                    numberKeyboard: document.getElementById('number-keyboard'),
                    fractionKeyboard: document.getElementById('fraction-keyboard'),
                    backspaceKey: document.getElementById('backspace-key'),
                    toggleSoundBtn: document.getElementById('toggle-sound'),
                    themeSwitcher: document.getElementById('theme-switcher'),
                    characterSpeech: document.getElementById('character-speech')
                };
                
                this.setupEventListeners();
                this.initializeThemes();
                this.generateQuestion();
                this.showCharacterSpeech(this.getRandomTip(), 5000);
            }
            
            setupEventListeners() {
                // Difficulty buttons
                document.querySelectorAll('.difficulty button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.difficulty button').forEach(b => 
                            b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.difficulty = e.target.dataset.level;
                        this.generateQuestion();
                        this.playSound('toggle');
                    });
                });
                
                // Game options event listeners
                document.getElementById('hideExponentCounter').addEventListener('change', () => {
                    // Update the display when this option changes
                    const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                    if (hideExponentCounter) {
                        this.elements.moverExponent.textContent = '?';
                        this.elements.moverExponent.style.color = '#d32f2f';
                        this.playSound('toggle');
                    } else {
                        this.elements.moverExponent.textContent = this.moverExponentValue;
                        this.elements.moverExponent.style.color = '';
                        this.playSound('toggle');
                    }
                });
                
                document.getElementById('alwaysShowDecimalMover').addEventListener('change', () => {
                    // Update the display when this option changes
                    const alwaysShowDecimalMover = document.getElementById('alwaysShowDecimalMover').checked;
                    this.playSound('toggle');
                    
                    if (alwaysShowDecimalMover) {
                        this.elements.decimalMover.style.display = 'flex';
                        // Setup decimal mover for current question if needed
                        if (this.questionType === 'fromScientific') {
                            const { coefficient, exponent } = this.currentQuestion;
                            const expandedNumber = this.calculateExpandedForm(coefficient, exponent);
                            this.setupDecimalMover(expandedNumber);
                        } else if (this.questionType === 'multiply' || this.questionType === 'divide') {
                            const firstCoefficient = this.currentQuestion.num1.coefficient;
                            this.setupDecimalMover(firstCoefficient);
                        }
                    } else if (this.questionType !== 'toScientific') {
                        this.elements.decimalMover.style.display = 'none';
                    }
                });
                
                document.getElementById('showFractions').addEventListener('change', () => {
                    const showFractions = document.getElementById('showFractions').checked;
                    this.playSound('toggle');
                    
                    if (showFractions) {
                        this.elements.fractionDisplay.style.display = 'flex';
                        this.updateFractionDisplay();
                    } else {
                        this.elements.fractionDisplay.style.display = 'none';
                    }
                });
                
                // Sound toggle
                document.getElementById('toggle-sound').addEventListener('change', (e) => {
                    this.soundEnabled = e.target.checked;
                    
                    // Play a sound to confirm if sound is enabled
                    if (this.soundEnabled) {
                        this.playSound('toggle');
                    }
                });
                
                // Arrow key controls for decimal mover
                this.elements.leftArrow.addEventListener('click', () => this.moveDecimalPoint('left'));
                this.elements.rightArrow.addEventListener('click', () => this.moveDecimalPoint('right'));
                
                // Zero controls for expanded form
                this.elements.addZeroLeft.addEventListener('click', () => this.addZero('left'));
                this.elements.addZeroRight.addEventListener('click', () => this.addZero('right'));
                
                // Use exponent button
                this.elements.useExponent.addEventListener('click', () => {
                    this.elements.exponent.value = this.moverExponentValue;
                    // Give feedback
                    this.elements.useExponent.classList.add('pulse');
                    this.playSound('click');
                    setTimeout(() => {
                        this.elements.useExponent.classList.remove('pulse');
                    }, 300);
                });
                
                // Keyboard events for decimal mover
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        this.moveDecimalPoint('left');
                        this.playSound('move');
                    } else if (e.key === 'ArrowRight') {
                        this.moveDecimalPoint('right');
                        this.playSound('move');
                    }
                });
                
                // Input focus events
                this.elements.coefficient.addEventListener('focus', () => {
                    this.activeInput = this.elements.coefficient;
                    this.playSound('tap');
                });
                
                this.elements.exponent.addEventListener('focus', () => {
                    this.activeInput = this.elements.exponent;
                    this.playSound('tap');
                });
                
                this.elements.decimal.addEventListener('focus', () => {
                    this.activeInput = this.elements.decimal;
                    this.playSound('tap');
                });
                
                this.elements.fractionNumeratorInput.addEventListener('focus', () => {
                    this.activeInput = this.elements.fractionNumeratorInput;
                    this.playSound('tap');
                });
                
                this.elements.fractionDenominatorInput.addEventListener('focus', () => {
                    this.activeInput = this.elements.fractionDenominatorInput;
                    this.playSound('tap');
                });
                
                // Setup number keyboard buttons
                this.elements.numberKeyboard.querySelectorAll('button').forEach(key => {
                    if (!key.id || (key.id !== 'backspace-key' && key.id !== 'clear-key' && 
                                  key.id !== 'negative-key' && key.id !== 'pi-key' && key.id !== 'exp-key')) {
                        key.addEventListener('click', () => {
                            if (this.activeInput) {
                                // If the key is a decimal point, check if one already exists
                                if (key.textContent === '.' && this.activeInput.value.includes('.')) {
                                    return; // Don't add another decimal point
                                }
                                this.activeInput.value += key.textContent;
                                this.playSound('click');
                                key.classList.add('pulse');
                                setTimeout(() => key.classList.remove('pulse'), 200);
                            }
                        });
                    }
                });
                
                // Pi key
                if (document.getElementById('pi-key')) {
                    document.getElementById('pi-key').addEventListener('click', () => {
                        if (this.activeInput) {
                            this.activeInput.value = '3.14159';
                            this.playSound('click');
                            document.getElementById('pi-key').classList.add('pulse');
                            setTimeout(() => document.getElementById('pi-key').classList.remove('pulse'), 200);
                        }
                    });
                }
                
                // e key (Euler's number)
                if (document.getElementById('exp-key')) {
                    document.getElementById('exp-key').addEventListener('click', () => {
                        if (this.activeInput) {
                            this.activeInput.value = '2.71828';
                            this.playSound('click');
                            document.getElementById('exp-key').classList.add('pulse');
                            setTimeout(() => document.getElementById('exp-key').classList.remove('pulse'), 200);
                        }
                    });
                }
                
                // Backspace key
                this.elements.backspaceKey.addEventListener('click', () => {
                    if (this.activeInput) {
                        this.activeInput.value = this.activeInput.value.slice(0, -1);
                        this.playSound('backspace');
                        this.elements.backspaceKey.classList.add('pulse');
                        setTimeout(() => this.elements.backspaceKey.classList.remove('pulse'), 200);
                    }
                });
                
                // Clear key
                document.getElementById('clear-key').addEventListener('click', () => {
                    if (this.activeInput) {
                        this.activeInput.value = '';
                        this.playSound('clear');
                        document.getElementById('clear-key').classList.add('pulse');
                        setTimeout(() => document.getElementById('clear-key').classList.remove('pulse'), 200);
                    }
                });
                
                // Negative key
                document.getElementById('negative-key').addEventListener('click', () => {
                    if (this.activeInput) {
                        if (this.activeInput.value.startsWith('-')) {
                            this.activeInput.value = this.activeInput.value.substring(1);
                        } else {
                            this.activeInput.value = '-' + this.activeInput.value;
                        }
                        this.playSound('toggle');
                        document.getElementById('negative-key').classList.add('pulse');
                        setTimeout(() => document.getElementById('negative-key').classList.remove('pulse'), 200);
                    }
                });
                
                // Check answer button
                this.elements.checkAnswerBtn.addEventListener('click', () => this.checkAnswer());
                
                // Next question button
                this.elements.nextQuestionBtn.addEventListener('click', () => {
                    this.generateQuestion();
                    this.elements.nextQuestionBtn.disabled = true;
                    this.elements.checkAnswerBtn.disabled = false;
                    this.playSound('click');
                });
                
                // Keyboard tab switching
                document.querySelectorAll('.keyboard-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.keyboard-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        // Hide all keyboards
                        document.getElementById('number-keyboard').style.display = 'none';
                        document.getElementById('fraction-keyboard').style.display = 'none';
                        
                        // Show the selected keyboard
                        document.getElementById(e.target.dataset.tab).style.display = 'grid';
                        this.playSound('tap');
                    });
                });
                
                // Fraction presets
                document.querySelectorAll('.fraction-preset').forEach(preset => {
                    preset.addEventListener('click', () => {
                        const numerator = preset.dataset.num;
                        const denominator = preset.dataset.denom;
                        
                        if (this.questionType === 'fromScientific') {
                            // For fromScientific questions, set the fraction value to use
                            this.elements.fractionNumeratorInput.value = numerator;
                            this.elements.fractionDenominatorInput.value = denominator;
                            
                            // Calculate the equivalent decimal value
                            const value = numerator / denominator;
                            this.elements.decimal.value = value.toString();
                        } else {
                            // For toScientific questions, calculate the exponent
                            const exponent = Math.log10(numerator / denominator);
                            this.elements.exponent.value = exponent.toString();
                        }
                        
                        preset.classList.add('pulse');
                        this.playSound('click');
                        setTimeout(() => preset.classList.remove('pulse'), 200);
                    });
                });
                
                // Theme switcher
                this.elements.themeSwitcher.addEventListener('click', () => {
                    this.switchTheme();
                    this.playSound('toggle');
                });
            }
            
            initializeThemes() {
                // Create initial set of bubbles for underwater theme
                const bubblesContainer = document.querySelector('.bubbles');
                for (let i = 0; i < 20; i++) {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = `${Math.random() * 100}%`;
                    bubble.style.width = `${Math.random() * 30 + 10}px`;
                    bubble.style.height = bubble.style.width;
                    bubble.style.animationDuration = `${Math.random() * 10 + 5}s`;
                    bubble.style.animationDelay = `${Math.random() * 5}s`;
                    bubblesContainer.appendChild(bubble);
                    this.bubbles.push(bubble);
                }
                
                // Create initial set of stars for space theme
                const starsContainer = document.querySelector('.stars');
                for (let i = 0; i < 100; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    const size = Math.random() * 3 + 1;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.animationDuration = `${Math.random() * 5 + 2}s`;
                    star.style.opacity = Math.random() * 0.8 + 0.2;
                    starsContainer.appendChild(star);
                    this.stars.push(star);
                }
            }
            
            switchTheme() {
                // Rotate through themes
                const themes = ['default', 'space', 'underwater'];
                const currentIndex = themes.indexOf(this.currentTheme);
                const nextIndex = (currentIndex + 1) % themes.length;
                this.currentTheme = themes[nextIndex];
                
                // Apply theme
                document.body.classList.remove('space-theme', 'underwater-theme');
                document.querySelector('.bubbles').style.display = 'none';
                document.querySelector('.stars').style.display = 'none';
                
                switch (this.currentTheme) {
                    case 'space':
                        document.body.classList.add('space-theme');
                        document.querySelector('.stars').style.display = 'block';
                        this.elements.themeSwitcher.textContent = 'üåå';
                        break;
                    case 'underwater':
                        document.body.classList.add('underwater-theme');
                        document.querySelector('.bubbles').style.display = 'block';
                        this.elements.themeSwitcher.textContent = 'üåä';
                        break;
                    default: // default theme
                        this.elements.themeSwitcher.textContent = 'üåà';
                        break;
                }
            }
            
            getRandomTip() {
                // Get a random tip or encouragement
                if (Math.random() > 0.5) {
                    return this.tipPhrases[Math.floor(Math.random() * this.tipPhrases.length)];
                } else {
                    return this.encouragementPhrases[Math.floor(Math.random() * this.encouragementPhrases.length)];
                }
            }
            
            showCharacterSpeech(text, duration = 3000) {
                // Show character speech bubble with text
                this.elements.characterSpeech.textContent = text;
                this.elements.characterSpeech.style.opacity = '1';
                
                // Auto-hide after duration
                setTimeout(() => {
                    this.elements.characterSpeech.style.opacity = '0';
                }, duration);
            }
            
            calculateExpandedForm(coefficient, exponent) {
                // Calculate number in standard form from scientific notation
                return coefficient * Math.pow(10, exponent);
            }
            
            updateFractionDisplay() {
                // Update the fraction display based on the current exponent value
                if (document.getElementById('showFractions').checked) {
                    const exponent = this.moverExponentValue;
                    
                    if (exponent === 0) {
                        // 10^0 = 1
                        this.elements.fractionNumerator.textContent = '1';
                        this.elements.fractionDenominator.textContent = '1';
                    } else if (exponent > 0) {
                        // Positive exponent: 10^n = 10^n/1
                        this.elements.fractionNumerator.textContent = '1' + '0'.repeat(exponent);
                        this.elements.fractionDenominator.textContent = '1';
                    } else if (exponent < 0) {
                        // Negative exponent: 10^-n = 1/10^n
                        this.elements.fractionNumerator.textContent = '1';
                        this.elements.fractionDenominator.textContent = '1' + '0'.repeat(Math.abs(exponent));
                    }
                }
            }
            
            setupDecimalMover(number) {
                // Clear previous content
                this.elements.numberDisplay.innerHTML = '';
                this.moverExponentValue = 0;
                
                // Check if exponent counter should be hidden
                const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                if (hideExponentCounter) {
                    this.elements.moverExponent.textContent = '?';
                    this.elements.moverExponent.style.color = '#d32f2f';
                } else {
                    this.elements.moverExponent.textContent = '0';
                    this.elements.moverExponent.style.color = '';
                }
                
                // Add the decimal highlight element back
                this.elements.numberDisplay.appendChild(this.elements.decimalHighlight);
                
                // Handle negative numbers by extracting the sign
                let isNegative = false;
                let absNumber = number;
                
                if (number < 0) {
                    isNegative = true;
                    absNumber = Math.abs(number);
                }
                
                // Convert number to string and split into digits
                const numberStr = absNumber.toString();
                let digitPosition = 0;
                let decimalPosition = -1;
                
                // Add negative sign if needed
                if (isNegative) {
                    const negativeSign = document.createElement('div');
                    negativeSign.className = 'digit';
                    negativeSign.textContent = '-';
                    negativeSign.style.color = '#d32f2f';
                    this.elements.numberDisplay.appendChild(negativeSign);
                }
                
                // Create digit elements
                for (let i = 0; i < numberStr.length; i++) {
                    if (numberStr[i] === '.') {
                        const decimalPoint = document.createElement('div');
                        decimalPoint.className = 'decimal-point';
                        decimalPoint.textContent = '.';
                        this.elements.numberDisplay.appendChild(decimalPoint);
                        decimalPosition = i;
                    } else {
                        const digit = document.createElement('div');
                        digit.className = 'digit';
                        digit.textContent = numberStr[i];
                        this.elements.numberDisplay.appendChild(digit);
                        digitPosition++;
                    }
                }
                
                // If no decimal point in the number, add one at the end
                if (decimalPosition === -1) {
                    const decimalPoint = document.createElement('div');
                    decimalPoint.className = 'decimal-point';
                    decimalPoint.textContent = '.';
                    this.elements.numberDisplay.appendChild(decimalPoint);
                    decimalPosition = numberStr.length;
                    
                    // Add a zero after the decimal
                    const zeroDigit = document.createElement('div');
                    zeroDigit.className = 'digit';
                    zeroDigit.textContent = '0';
                    this.elements.numberDisplay.appendChild(zeroDigit);
                }
                
                // Position the decimal highlight
                this.updateDecimalHighlight();
                
                // Update the fraction display based on exponent
                this.updateFractionDisplay();
            }
            
            updateDecimalHighlight() {
                // Find the decimal point element
                const decimalPointElement = this.elements.numberDisplay.querySelector('.decimal-point');
                if (decimalPointElement) {
                    const rect = decimalPointElement.getBoundingClientRect();
                    const parentRect = this.elements.numberDisplay.getBoundingClientRect();
                    const left = rect.left - parentRect.left;
                    
                    this.elements.decimalHighlight.style.left = `${left}px`;
                }
            }
            
            moveDecimalPoint(direction) {
                // Find all digits and the decimal point
                const elements = Array.from(this.elements.numberDisplay.children).filter(
                    el => el.classList.contains('digit') || el.classList.contains('decimal-point')
                );
                
                // Find the decimal point and its index
                let decimalIndex = elements.findIndex(el => el.classList.contains('decimal-point'));
                
                if (direction === 'left' && decimalIndex > 1) {
                    // Swap decimal point with the digit to its left
                    const temp = elements[decimalIndex];
                    elements[decimalIndex] = elements[decimalIndex - 1];
                    elements[decimalIndex - 1] = temp;
                    
                    // Update the display order
                    for (let i = 0; i < elements.length; i++) {
                        if (elements[i] !== this.elements.decimalHighlight) {
                            this.elements.numberDisplay.appendChild(elements[i]);
                        }
                    }
                    
                    // Update the exponent value
                    this.moverExponentValue++;
                    
                    // Only update display if not hidden
                    const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                    if (!hideExponentCounter) {
                        this.elements.moverExponent.textContent = this.moverExponentValue;
                    }
                    
                    // Update fraction display
                    this.updateFractionDisplay();
                    
                    // Give visual feedback on the movement
                    this.elements.numberDisplay.classList.add('pulse');
                    
                    // Add a subtle flash effect to the digit that moved
                    const movedDigit = elements[decimalIndex - 1];
                    if (movedDigit) {
                        movedDigit.classList.add('highlighted');
                        setTimeout(() => {
                            movedDigit.classList.remove('highlighted');
                        }, 300);
                    }
                    
                    setTimeout(() => {
                        this.elements.numberDisplay.classList.remove('pulse');
                    }, 300);
                    
                    this.playSound('move');
                    
                } else if (direction === 'right' && decimalIndex < elements.length - 2) {
                    // Swap decimal point with the digit to its right
                    const temp = elements[decimalIndex];
                    elements[decimalIndex] = elements[decimalIndex + 1];
                    elements[decimalIndex + 1] = temp;
                    
                    // Update the display order
                    for (let i = 0; i < elements.length; i++) {
                        if (elements[i] !== this.elements.decimalHighlight) {
                            this.elements.numberDisplay.appendChild(elements[i]);
                        }
                    }
                    
                    // Update the exponent value
                    this.moverExponentValue--;
                    
                    // Only update display if not hidden
                    const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                    if (!hideExponentCounter) {
                        this.elements.moverExponent.textContent = this.moverExponentValue;
                    }
                    
                    // Update fraction display
                    this.updateFractionDisplay();
                    
                    // Give visual feedback on the movement
                    this.elements.numberDisplay.classList.add('pulse');
                    
                    // Add a subtle flash effect to the digit that moved
                    const movedDigit = elements[decimalIndex + 1];
                    if (movedDigit) {
                        movedDigit.classList.add('highlighted');
                        setTimeout(() => {
                            movedDigit.classList.remove('highlighted');
                        }, 300);
                    }
                    
                    setTimeout(() => {
                        this.elements.numberDisplay.classList.remove('pulse');
                    }, 300);
                    
                    this.playSound('move');
                    
                } else {
                    // Play error sound if we can't move further
                    this.playSound('error');
                }
                
                // Update the highlight position
                this.updateDecimalHighlight();
                
                // Update the corresponding input field with the new value from the decimal mover
                this.updateInputFromDecimalMover();
            }
            
            // Add zeros to the left or right of the decimal point for expanded form
            addZero(position) {
                // Find all digits and the decimal point
                const elements = Array.from(this.elements.numberDisplay.children).filter(
                    el => el.classList.contains('digit') || el.classList.contains('decimal-point')
                );
                
                // Find the decimal point and its index
                let decimalIndex = elements.findIndex(el => el.classList.contains('decimal-point'));
                
                if (position === 'left') {
                    // Add a zero to the left of the decimal
                    // Find the position to insert (before the decimal point)
                    const insertIndex = decimalIndex > 0 ? decimalIndex - 1 : 0;
                    
                    // Create a new zero digit
                    const zeroDigit = document.createElement('div');
                    zeroDigit.className = 'digit highlighted';
                    zeroDigit.textContent = '0';
                    
                    // Insert the zero at the appropriate position
                    if (insertIndex === 0) {
                        this.elements.numberDisplay.insertBefore(zeroDigit, elements[0]);
                    } else {
                        this.elements.numberDisplay.insertBefore(zeroDigit, elements[insertIndex + 1]);
                    }
                    
                    // Reset the highlight after a delay
                    setTimeout(() => {
                        zeroDigit.classList.remove('highlighted');
                    }, 300);
                    
                } else if (position === 'right') {
                    // Add a zero to the right of the decimal
                    // Create a new zero digit
                    const zeroDigit = document.createElement('div');
                    zeroDigit.className = 'digit highlighted';
                    zeroDigit.textContent = '0';
                    
                    // Find where to add the zero (after the decimal point and any existing digits)
                    this.elements.numberDisplay.appendChild(zeroDigit);
                    
                    // Reset the highlight after a delay
                    setTimeout(() => {
                        zeroDigit.classList.remove('highlighted');
                    }, 300);
                }
                
                // Play a sound for feedback
                this.playSound('click');
                
                // Update the decimal highlight position
                this.updateDecimalHighlight();
                
                // Update the corresponding input field with the new value from the decimal mover
                this.updateInputFromDecimalMover();
            }
            
            // Update the input field based on the decimal mover current value
            updateInputFromDecimalMover() {
                // Get all the digits and decimal point from the display
                const elements = Array.from(this.elements.numberDisplay.children).filter(
                    el => el.classList.contains('digit') || el.classList.contains('decimal-point')
                );
                
                // Reconstruct the number as a string
                let numberStr = '';
                elements.forEach(el => {
                    numberStr += el.textContent;
                });
                
                // Update the appropriate input field based on the question type
                if (this.questionType === 'fromScientific') {
                    this.elements.decimal.value = numberStr;
                    
                    // Update fraction input if it's visible
                    if (this.elements.fractionInput.style.display !== 'none') {
                        // Determine fraction values based on exponent
                        const exponent = this.moverExponentValue;
                        if (exponent > 0) {
                            this.elements.fractionNumeratorInput.value = '10^' + exponent;
                            this.elements.fractionDenominatorInput.value = '1';
                        } else if (exponent < 0) {
                            this.elements.fractionNumeratorInput.value = '1';
                            this.elements.fractionDenominatorInput.value = '10^' + Math.abs(exponent);
                        } else {
                            this.elements.fractionNumeratorInput.value = '1';
                            this.elements.fractionDenominatorInput.value = '1';
                        }
                    }
                } else if (this.questionType === 'toScientific') {
                    // For toScientific questions, update the coefficient based on the decimal mover position
                    // and also update the exponent if exponent counter is visible
                    const number = parseFloat(numberStr);
                    const exponent = this.moverExponentValue;
                    
                    // Calculate the coefficient based on the current exponent
                    const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                    if (!hideExponentCounter) {
                        this.elements.coefficient.value = number;
                        this.elements.exponent.value = exponent;
                    } else {
                        // If the exponent counter is hidden, just update the coefficient
                        this.elements.coefficient.value = number;
                    }
                }
            }
            
            generateQuestion() {
                // Reset inputs and feedback
                this.elements.coefficient.value = '';
                this.elements.exponent.value = '';
                this.elements.decimal.value = '';
                this.elements.fractionNumeratorInput.value = '';
                this.elements.fractionDenominatorInput.value = '';
                this.elements.feedback.textContent = '';
                this.elements.feedback.className = 'feedback';
                this.moverExponentValue = 0;
                this.elements.moverExponent.textContent = '0';
                
                // Set initial focus to the appropriate input
                this.activeInput = this.elements.coefficient;
                
                // Increment total questions counter
                this.totalQuestions++;
                
                // Update progress bar
                const progress = Math.min(100, (this.score / this.totalQuestions) * 100);
                this.elements.progressBar.style.width = `${progress}%`;
                
                // Determine question type based on difficulty
                this.determineQuestionType();
                
                // Generate the question and answer
                switch (this.questionType) {
                    case 'toScientific':
                        this.generateToScientificQuestion();
                        break;
                    case 'fromScientific':
                        this.generateFromScientificQuestion();
                        break;
                    case 'multiply':
                        this.generateMultiplyQuestion();
                        break;
                    case 'divide':
                        this.generateDivideQuestion();
                        break;
                    case 'compare':
                        this.generateCompareQuestion();
                        break;
                }
                
                // Occasionally show a tip or encouragement
                if (Math.random() < 0.3) {
                    this.showCharacterSpeech(this.getRandomTip(), 5000);
                }
            }
            
            determineQuestionType() {
                const types = {
                    easy: ['toScientific', 'fromScientific'],
                    medium: ['toScientific', 'fromScientific', 'multiply'],
                    hard: ['toScientific', 'fromScientific', 'multiply', 'divide'],
                    genius: ['toScientific', 'fromScientific', 'multiply', 'divide', 'compare']
                };
                
                const availableTypes = types[this.difficulty];
                this.questionType = availableTypes[Math.floor(Math.random() * availableTypes.length)];
                
                // Show/hide appropriate input fields
                if (this.questionType === 'fromScientific') {
                    this.elements.scientificInput.style.display = 'none';
                    this.elements.decimalInput.style.display = 'flex';
                    
                    // Show fraction input for medium and higher difficulties
                    if (this.difficulty !== 'easy') {
                        this.elements.fractionInput.style.display = 'flex';
                    } else {
                        this.elements.fractionInput.style.display = 'none';
                    }
                } else {
                    this.elements.scientificInput.style.display = 'flex';
                    this.elements.decimalInput.style.display = 'none';
                    this.elements.fractionInput.style.display = 'none';
                }
                
                // Check if decimal mover should be shown
                const alwaysShowDecimalMover = document.getElementById('alwaysShowDecimalMover').checked;
                
                if (alwaysShowDecimalMover || this.questionType === 'toScientific') {
                    this.elements.decimalMover.style.display = 'flex';
                    
                    // Setup the appropriate number for the decimal mover
                    if (this.questionType === 'fromScientific') {
                        // For fromScientific, show the coefficient with the exponent applied
                        if (this.currentQuestion) {
                            const { coefficient, exponent } = this.currentQuestion;
                            const expandedNumber = this.calculateExpandedForm(coefficient, exponent);
                            this.setupDecimalMover(expandedNumber);
                        }
                    } else if (this.questionType === 'multiply' || this.questionType === 'divide') {
                        // For multiply/divide, show the first number
                        if (this.currentQuestion) {
                            const firstCoefficient = this.currentQuestion.num1.coefficient;
                            this.setupDecimalMover(firstCoefficient);
                        }
                    }
                } else {
                    this.elements.decimalMover.style.display = 'none';
                }
                
                // Show/hide fraction display based on setting
                const showFractions = document.getElementById('showFractions').checked;
                this.elements.fractionDisplay.style.display = showFractions ? 'flex' : 'none';
                this.updateFractionDisplay();
            }
            
            generateToScientificQuestion() {
                let number;
                
                switch (this.difficulty) {
                    case 'easy':
                        // Simpler numbers for younger kids, including simple negative numbers
                        if (Math.random() < 0.7) {
                            number = Math.floor(Math.random() * 999) + 1;
                        } else {
                            number = -(Math.floor(Math.random() * 999) + 1);
                        }
                        break;
                    case 'medium':
                        // Include smaller numbers (negative exponents) and negative numbers
                        if (Math.random() < 0.4) {
                            number = Math.floor(Math.random() * 9999) + 1;
                        } else if (Math.random() < 0.7) {
                            number = (Math.random() * 0.99) + 0.01;
                            number = parseFloat(number.toFixed(3)); // Limit decimal places
                        } else {
                            // Negative numbers
                            if (Math.random() < 0.5) {
                                number = -(Math.floor(Math.random() * 9999) + 1);
                            } else {
                                number = -((Math.random() * 0.99) + 0.01);
                                number = parseFloat(number.toFixed(3)); // Limit decimal places
                            }
                        }
                        break;
                    case 'hard':
                    case 'genius':
                        // Very large or very small numbers, including negative
                        if (Math.random() < 0.3) {
                            number = Math.floor(Math.random() * 999999) + 1000;
                        } else if (Math.random() < 0.6) {
                            number = Math.random() * 0.001 + 0.0001;
                            number = parseFloat(number.toFixed(6)); // Limit decimal places
                        } else {
                            // Negative numbers
                            if (Math.random() < 0.5) {
                                number = -(Math.floor(Math.random() * 999999) + 1000);
                            } else {
                                number = -((Math.random() * 0.001) + 0.0001);
                                number = parseFloat(number.toFixed(6)); // Limit decimal places
                            }
                        }
                        break;
                }
                
                this.currentQuestion = number;
                this.elements.question.textContent = `Convert ${number} to scientific notation.`;
                
                // Calculate correct answer
                const absNumber = Math.abs(number);
                const exponent = Math.floor(Math.log10(absNumber));
                let coefficient = number / Math.pow(10, exponent);
                
                // Round to avoid floating point issues
                coefficient = parseFloat(coefficient.toFixed(6));
                
                this.correctAnswer = {
                    coefficient: coefficient,
                    exponent: exponent
                };
                
                // Setup the decimal mover with this number
                this.setupDecimalMover(number);
            }
            
            generateFromScientificQuestion() {
                let coefficient, exponent;
                
                switch (this.difficulty) {
                    case 'easy':
                        // Simple scientific notation with positive exponents
                        coefficient = Math.random() * 9 + 1;
                        coefficient = parseFloat(coefficient.toFixed(1));
                        exponent = Math.floor(Math.random() * 3); // 0 to 2
                        
                        // Add negative coefficients sometimes
                        if (Math.random() < 0.3) {
                            coefficient = -coefficient;
                        }
                        break;
                    case 'medium':
                        // Include negative exponents
                        coefficient = Math.random() * 9 + 1;
                        coefficient = parseFloat(coefficient.toFixed(2));
                        exponent = Math.floor(Math.random() * 8) - 4; // -4 to 3
                        
                        // Add negative coefficients sometimes
                        if (Math.random() < 0.4) {
                            coefficient = -coefficient;
                        }
                        break;
                    case 'hard':
                        // Larger range of exponents
                        coefficient = Math.random() * 9 + 1;
                        coefficient = parseFloat(coefficient.toFixed(2));
                        exponent = Math.floor(Math.random() * 16) - 8; // -8 to 7
                        
                        // Add negative coefficients sometimes
                        if (Math.random() < 0.5) {
                            coefficient = -coefficient;
                        }
                        break;
                    case 'genius':
                        // Very large range of exponents with more precision
                        coefficient = Math.random() * 9 + 1;
                        coefficient = parseFloat(coefficient.toFixed(3));
                        exponent = Math.floor(Math.random() * 20) - 10; // -10 to 9
                        
                        // Add negative coefficients sometimes
                        if (Math.random() < 0.5) {
                            coefficient = -coefficient;
                        }
                        break;
                }
                
                this.currentQuestion = { coefficient, exponent };
                
                // Create the question text with appropriate formatting
                let questionText = '';
                if (exponent >= 0) {
                    questionText = `Convert ${coefficient} √ó 10^${exponent} to standard form.`;
                } else {
                    // For negative exponents, offer an alternative representation
                    questionText = `Convert ${coefficient} √ó 10^${exponent} to standard form.`;
                    
                    // Add a hint about fractions for negative exponents
                    if (this.difficulty !== 'easy') {
                        const denominator = Math.pow(10, Math.abs(exponent));
                        questionText += ` (Hint: 10^${exponent} = 1/${denominator})`;
                    }
                }
                
                this.elements.question.textContent = questionText;
                
                // Calculate correct answer
                const standardForm = this.calculateExpandedForm(coefficient, exponent);
                this.correctAnswer = standardForm;
                
                // If showing the decimal mover, set it up with the coefficient
                const alwaysShowDecimalMover = document.getElementById('alwaysShowDecimalMover').checked;
                if (alwaysShowDecimalMover) {
                    this.setupDecimalMover(coefficient);
                    
                    // Set the exponent value to help with visualization
                    this.moverExponentValue = exponent;
                    
                    // Update exponent display if not hidden
                    const hideExponentCounter = document.getElementById('hideExponentCounter').checked;
                    if (!hideExponentCounter) {
                        this.elements.moverExponent.textContent = exponent;
                    }
                    
                    // Update fraction display
                    this.updateFractionDisplay();
                }
            }
            
            generateMultiplyQuestion() {
                let num1Coefficient, num1Exponent, num2Coefficient, num2Exponent;
                
                // Generate two numbers in scientific notation
                switch (this.difficulty) {
                    case 'medium':
                        // Simpler multiplication examples
                        num1Coefficient = Math.random() * 9 + 1;
                        num1Coefficient = parseFloat(num1Coefficient.toFixed(1));
                        num1Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                        
                        num2Coefficient = Math.random() * 9 + 1;
                        num2Coefficient = parseFloat(num2Coefficient.toFixed(1));
                        num2Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                        
                        // Add some negative coefficients
                        if (Math.random() < 0.3) {
                            if (Math.random() < 0.5) {
                                num1Coefficient = -num1Coefficient;
                            } else {
                                num2Coefficient = -num2Coefficient;
                            }
                        }
                        break;
                    case 'hard':
                        // More complex multiplication
                        num1Coefficient = Math.random() * 9 + 1;
                        num1Coefficient = parseFloat(num1Coefficient.toFixed(2));
                        num1Exponent = Math.floor(Math.random() * 10) - 5; // -5 to 4
                        
                        num2Coefficient = Math.random() * 9 + 1;
                        num2Coefficient = parseFloat(num2Coefficient.toFixed(2));
                        num2Exponent = Math.floor(Math.random() * 10) - 5; // -5 to 4
                        
                        // Add some negative coefficients
                        if (Math.random() < 0.4) {
                            if (Math.random() < 0.5) {
                                num1Coefficient = -num1Coefficient;
                            } else {
                                num2Coefficient = -num2Coefficient;
                            }
                        }
                        break;
                    case 'genius':
                        // Advanced multiplication
                        num1Coefficient = Math.random() * 9 + 1;
                        num1Coefficient = parseFloat(num1Coefficient.toFixed(2));
                        num1Exponent = Math.floor(Math.random() * 14) - 7; // -7 to 6
                        
                        num2Coefficient = Math.random() * 9 + 1;
                        num2Coefficient = parseFloat(num2Coefficient.toFixed(2));
                        num2Exponent = Math.floor(Math.random() * 14) - 7; // -7 to 6
                        
                        // Add some negative coefficients
                        if (Math.random() < 0.5) {
                            if (Math.random() < 0.5) {
                                num1Coefficient = -num1Coefficient;
                            } else {
                                num2Coefficient = -num2Coefficient;
                            }
                        }
                        break;
                    default:
                        // Default to medium
                        num1Coefficient = Math.random() * 9 + 1;
                        num1Coefficient = parseFloat(num1Coefficient.toFixed(1));
                        num1Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                        
                        num2Coefficient = Math.random() * 9 + 1;
                        num2Coefficient = parseFloat(num2Coefficient.toFixed(1));
                        num2Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                }
                
                this.currentQuestion = {
                    num1: { coefficient: num1Coefficient, exponent: num1Exponent },
                    num2: { coefficient: num2Coefficient, exponent: num2Exponent }
                };
                
                // Create question text with scientific notation
                let questionText = `Multiply and express in scientific notation: (${num1Coefficient} √ó 10^${num1Exponent}) √ó (${num2Coefficient} √ó 10^${num2Exponent})`;
                
                // Add a hint for harder difficulties
                if (this.difficulty === 'hard' || this.difficulty === 'genius') {
                    questionText += "\nHint: When multiplying scientific notation, multiply the coefficients and add the exponents!";
                }
                
                this.elements.question.textContent = questionText;
                
                // Calculate correct answer
                let resultCoefficient = num1Coefficient * num2Coefficient;
                let resultExponent = num1Exponent + num2Exponent;
                
                // Adjust if coefficient is not between 1 and 10 (or -1 and -10 for negative numbers)
                if (Math.abs(resultCoefficient) >= 10) {
                    resultExponent += 1;
                    resultCoefficient /= 10;
                } else if (Math.abs(resultCoefficient) < 1 && resultCoefficient !== 0) {
                    resultExponent -= 1;
                    resultCoefficient *= 10;
                }
                
                // Round to avoid floating point issues
                resultCoefficient = parseFloat(resultCoefficient.toFixed(6));
                
                this.correctAnswer = {
                    coefficient: resultCoefficient,
                    exponent: resultExponent
                };
                
                // If we're showing the decimal mover for all problems, set it up with the first coefficient
                const alwaysShowDecimalMover = document.getElementById('alwaysShowDecimalMover').checked;
                if (alwaysShowDecimalMover) {
                    this.setupDecimalMover(num1Coefficient);
                }
            }
            
            generateDivideQuestion() {
                let num1Coefficient, num1Exponent, num2Coefficient, num2Exponent;
                
                // Generate two numbers in scientific notation for division
                // Avoid division by zero or very small numbers that could lead to extremely large results
                do {
                    switch (this.difficulty) {
                        case 'hard':
                            num1Coefficient = Math.random() * 9 + 1;
                            num1Coefficient = parseFloat(num1Coefficient.toFixed(2));
                            num1Exponent = Math.floor(Math.random() * 10) - 5; // -5 to 4
                            
                            num2Coefficient = Math.random() * 9 + 1;
                            num2Coefficient = parseFloat(num2Coefficient.toFixed(2));
                            num2Exponent = Math.floor(Math.random() * 10) - 5; // -5 to 4
                            break;
                        case 'genius':
                            num1Coefficient = Math.random() * 9 + 1;
                            num1Coefficient = parseFloat(num1Coefficient.toFixed(2));
                            num1Exponent = Math.floor(Math.random() * 14) - 7; // -7 to 6
                            
                            num2Coefficient = Math.random() * 9 + 1;
                            num2Coefficient = parseFloat(num2Coefficient.toFixed(2));
                            num2Exponent = Math.floor(Math.random() * 14) - 7; // -7 to 6
                            break;
                        default:
                            // Default (medium or unrecognized)
                            num1Coefficient = Math.random() * 9 + 1;
                            num1Coefficient = parseFloat(num1Coefficient.toFixed(1));
                            num1Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                            
                            num2Coefficient = Math.random() * 9 + 1;
                            num2Coefficient = parseFloat(num2Coefficient.toFixed(1));
                            num2Exponent = Math.floor(Math.random() * 6) - 2; // -2 to 3
                    }
                    
                    // Add some negative coefficients
                    if (Math.random() < 0.4) {
                        if (Math.random() < 0.5) {
                            num1Coefficient = -num1Coefficient;
                        } else {
                            num2Coefficient = -num2Coefficient;
                        }
                    }
                    
                } while (Math.abs(num2Coefficient) < 0.1 || // Avoid division by very small numbers
                         Math.abs(num1Exponent - num2Exponent) > 10); // Avoid huge exponent differences
                
                this.currentQuestion = {
                    num1: { coefficient: num1Coefficient, exponent: num1Exponent },
                    num2: { coefficient: num2Coefficient, exponent: num2Exponent }
                };
                
                // Create question text with scientific notation
                let questionText = `Divide and express in scientific notation: (${num1Coefficient} √ó 10^${num1Exponent}) √∑ (${num2Coefficient} √ó 10^${num2Exponent})`;
                
                // Add a hint for harder difficulties
                if (this.difficulty === 'hard' || this.difficulty === 'genius') {
                    questionText += "\nHint: When dividing in scientific notation, divide the coefficients and subtract the exponents!";
                }
                
                this.elements.question.textContent = questionText;
                
                // Calculate correct answer
                let resultCoefficient = num1Coefficient / num2Coefficient;
                let resultExponent = num1Exponent - num2Exponent;
                
                // Adjust if coefficient is not between 1 and 10 (or -1 and -10 for negative numbers)
                if (Math.abs(resultCoefficient) >= 10) {
                    resultExponent += 1;
                    resultCoefficient /= 10;
                } else if (Math.abs(resultCoefficient) < 1 && resultCoefficient !== 0) {
                    resultExponent -= 1;
                    resultCoefficient *= 10;
                }
                
                // Round to avoid floating point issues
                resultCoefficient = parseFloat(resultCoefficient.toFixed(6));
                
                this.correctAnswer = {
                    coefficient: resultCoefficient,
                    exponent: resultExponent
                };
                
                // If we're showing the decimal mover for all problems, set it up with the first coefficient
                const alwaysShowDecimalMover = document.getElementById('alwaysShowDecimalMover').checked;
                if (alwaysShowDecimalMover) {
                    this.setupDecimalMover(num1Coefficient);
                }
            }
            
            generateCompareQuestion() {
                // Only available in genius mode - compare which number is larger
                
                // Generate two different numbers in scientific notation
                let num1Coefficient, num1Exponent, num2Coefficient, num2Exponent;
                let num1Value, num2Value;
                
                // We want them to be reasonably close but definitely different
                do {
                    num1Coefficient = Math.random() * 9 + 1;
                    num1Coefficient = parseFloat(num1Coefficient.toFixed(2));
                    num1Exponent = Math.floor(Math.random() * 20) - 10; // -10 to 9
                    
                    num2Coefficient = Math.random() * 9 + 1;
                    num2Coefficient = parseFloat(num2Coefficient.toFixed(2));
                    
                    // Make the second exponent close to the first
                    const exponentDiff = Math.random() < 0.6 ? 
                        Math.floor(Math.random() * 3) - 1 : // Close by -1, 0, or 1
                        Math.floor(Math.random() * 5) - 2;  // A bit further: -2 to 2
                    
                    num2Exponent = num1Exponent + exponentDiff;
                    
                    // Calculate actual values
                    num1Value = num1Coefficient * Math.pow(10, num1Exponent);
                    num2Value = num2Coefficient * Math.pow(10, num2Exponent);
                    
                    // If they're too close, adjust the coefficient to make a clearer difference
                    if (Math.abs(num1Value - num2Value) / Math.max(Math.abs(num1Value), Math.abs(num2Value)) < 0.01) {
                        if (num1Exponent === num2Exponent) {
                            // If exponents are equal, make coefficients differ more
                            if (num1Coefficient > num2Coefficient) {
                                num1Coefficient += 0.5;
                            } else {
                                num2Coefficient += 0.5;
                            }
                        } else {
                            // If exponents differ, make sure coefficients don't counteract too much
                            if (num1Exponent > num2Exponent) {
                                num1Coefficient += 0.5;
                            } else {
                                num2Coefficient += 0.5;
                            }
                        }
                        
                        // Recalculate values
                        num1Value = num1Coefficient * Math.pow(10, num1Exponent);
                        num2Value = num2Coefficient * Math.pow(10, num2Exponent);
                    }
                    
                } while (Math.abs(num1Value - num2Value) < 0.0001 || Math.abs(num1Value) > 1e15 || Math.abs(num2Value) > 1e15);
                
                this.currentQuestion = {
                    num1: { coefficient: num1Coefficient, exponent: num1Exponent, value: num1Value },
                    num2: { coefficient: num2Coefficient, exponent: num2Exponent, value: num2Value }
                };
                
                // Create question text with scientific notation
                const questionText = `Which number is larger?\nA: ${num1Coefficient} √ó 10^${num1Exponent}\nB: ${num2Coefficient} √ó 10^${num2Exponent}`;
                
                this.elements.question.textContent = questionText;
                
                // Determine the correct answer
                if (num1Value > num2Value) {
                    this.correctAnswer = 'A';
                } else {
                    this.correctAnswer = 'B';
                }
                
                // For compare questions, we need different input UI
                this.elements.scientificInput.style.display = 'none';
                this.elements.decimalInput.style.display = 'none';
                this.elements.fractionInput.style.display = 'none';
                
                // Create radio buttons for A and B if they don't exist
                if (!document.getElementById('compare-input')) {
                    const compareInput = document.createElement('div');
                    compareInput.id = 'compare-input';
                    compareInput.className = 'input-group';
                    compareInput.style.display = 'flex';
                    compareInput.style.justifyContent = 'center';
                    compareInput.style.gap = '20px';
                    
                    const optionA = document.createElement('div');
                    optionA.style.display = 'flex';
                    optionA.style.alignItems = 'center';
                    optionA.style.gap = '8px';
                    
                    const radioA = document.createElement('input');
                    radioA.type = 'radio';
                    radioA.id = 'option-a';
                    radioA.name = 'compare-option';
                    radioA.value = 'A';
                    radioA.style.width = '20px';
                    radioA.style.height = '20px';
                    
                    const labelA = document.createElement('label');
                    labelA.htmlFor = 'option-a';
                    labelA.textContent = 'A';
                    labelA.style.fontSize = '20px';
                    labelA.style.fontWeight = 'bold';
                    
                    optionA.appendChild(radioA);
                    optionA.appendChild(labelA);
                    
                    const optionB = document.createElement('div');
                    optionB.style.display = 'flex';
                    optionB.style.alignItems = 'center';
                    optionB.style.gap = '8px';
                    
                    const radioB = document.createElement('input');
                    radioB.type = 'radio';
                    radioB.id = 'option-b';
                    radioB.name = 'compare-option';
                    radioB.value = 'B';
                    radioB.style.width = '20px';
                    radioB.style.height = '20px';
                    
                    const labelB = document.createElement('label');
                    labelB.htmlFor = 'option-b';
                    labelB.textContent = 'B';
                    labelB.style.fontSize = '20px';
                    labelB.style.fontWeight = 'bold';
                    
                    optionB.appendChild(radioB);
                    optionB.appendChild(labelB);
                    
                    compareInput.appendChild(optionA);
                    compareInput.appendChild(optionB);
                    
                    this.elements.answer.appendChild(compareInput);
                } else {
                    document.getElementById('compare-input').style.display = 'flex';
                    document.getElementsByName('compare-option').forEach(radio => {
                        radio.checked = false;
                    });
                }
                
                // No need for decimal mover in compare questions
                this.elements.decimalMover.style.display = 'none';
            }
            
            checkAnswer() {
                let isCorrect = false;
                let userAnswer;
                
                if (this.questionType === 'fromScientific') {
                    // Check decimal input
                    const userInput = this.elements.decimal.value.replace(/\s|,/g, ''); // Remove spaces and commas
                    userAnswer = parseFloat(userInput);
                    
                    if (isNaN(userAnswer)) {
                        this.elements.feedback.textContent = 'Please enter a valid number!';
                        this.elements.feedback.className = 'feedback incorrect show';
                        this.playSound('error');
                        this.showCharacterSpeech("Make sure to enter a valid number!", 3000);
                        return;
                    }
                    
                    // Allow for floating point precision issues
                    const tolerance = Math.max(Math.abs(this.correctAnswer) * 0.001, 0.0001);
                    isCorrect = Math.abs(userAnswer - this.correctAnswer) <= tolerance;
                    
                    // Check if they've used the fraction input for negative exponents
                    if (!isCorrect && this.elements.fractionInput.style.display !== 'none') {
                        const numerator = parseFloat(this.elements.fractionNumeratorInput.value);
                        const denominator = parseFloat(this.elements.fractionDenominatorInput.value);
                        
                        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                            const fractionValue = numerator / denominator;
                            isCorrect = Math.abs(fractionValue - this.correctAnswer) <= tolerance;
                        }
                    }
                } else if (this.questionType === 'compare') {
                    // Check selected radio button
                    const selectedRadio = document.querySelector('input[name="compare-option"]:checked');
                    if (!selectedRadio) {
                        this.elements.feedback.textContent = 'Please select an option!';
                        this.elements.feedback.className = 'feedback incorrect show';
                        this.playSound('error');
                        this.showCharacterSpeech("You need to choose A or B!", 3000);
                        return;
                    }
                    
                    userAnswer = selectedRadio.value;
                    isCorrect = userAnswer === this.correctAnswer;
                } else {
                    // Check scientific notation input
                    const userCoefficient = parseFloat(this.elements.coefficient.value);
                    const userExponent = parseInt(this.elements.exponent.value);
                    
                    if (isNaN(userCoefficient) || isNaN(userExponent)) {
                        this.elements.feedback.textContent = 'Please enter valid numbers for both coefficient and exponent!';
                        this.elements.feedback.className = 'feedback incorrect show';
                        this.playSound('error');
                        this.showCharacterSpeech("Make sure to enter both a coefficient and exponent!", 3000);
                        return;
                    }
                    
                    // Allow for small rounding differences in coefficient
                    const coefficientTolerance = 0.02;
                    
                    // For scientific notation, the answer is correct if:
                    // 1. The coefficient is within 1-10 range (or -1 to -10 for negative)
                    // 2. The exponent is correct
                    // 3. The value representing by coefficient √ó 10^exponent equals the expected answer
                    
                    const userValue = userCoefficient * Math.pow(10, userExponent);
                    const correctValue = this.correctAnswer.coefficient * Math.pow(10, this.correctAnswer.exponent);
                    
                    const valueCorrect = Math.abs(userValue - correctValue) <= Math.abs(correctValue) * 0.01;
                    
                    // Check if the coefficient is in the correct form (1 ‚â§ |coefficient| < 10)
                    const coefficientInCorrectForm = (Math.abs(userCoefficient) >= 1 && Math.abs(userCoefficient) < 10);
                    
                    if (valueCorrect && coefficientInCorrectForm) {
                        isCorrect = true;
                    } else if (valueCorrect && !coefficientInCorrectForm) {
                        // The value is correct but the coefficient is not in standard form
                        this.elements.feedback.textContent = 'Your answer gives the right value, but remember in scientific notation the coefficient should be between 1 and 10 (or -1 and -10 for negative numbers).';
                        this.elements.feedback.className = 'feedback incorrect show';
                        this.playSound('error');
                        this.showCharacterSpeech("Almost! Remember, the coefficient should be between 1 and 10.", 4000);
                        return;
                    }
                }
                
                if (isCorrect) {
                    this.score++;
                    this.elements.score.textContent = this.score;
                    
                    // Update progress bar
                    const progress = Math.min(100, (this.score / this.totalQuestions) * 100);
                    this.elements.progressBar.style.width = `${progress}%`;
                    
                    // Create different victory messages for variety
                    const victoryMessages = [
                        'Correct! Great job! üåü',
                        'Amazing! You got it right! üéâ',
                        'Fantastic work! That\'s correct! üèÜ',
                        'You\'re a scientific notation superstar! ‚≠ê',
                        'Perfect! Keep up the great work! üíØ',
                        'Wow! You really understand this! üß†'
                    ];
                    const message = victoryMessages[Math.floor(Math.random() * victoryMessages.length)];
                    
                    this.elements.feedback.textContent = message;
                    this.elements.feedback.className = 'feedback correct show';
                    
                    // Show character speech with encouragement
                    const encouragement = this.encouragementPhrases[Math.floor(Math.random() * this.encouragementPhrases.length)];
                    this.showCharacterSpeech(encouragement, 4000);
                    
                    // Add celebratory animations and effects
                    this.celebrate();
                } else {
                    this.elements.feedback.textContent = 'Not quite right. Try again or see the correct answer.';
                    this.elements.feedback.className = 'feedback incorrect show';
                    
                    // Play error sound
                    this.playSound('error');
                    
                    // Show the correct answer after a wrong attempt
                    if (this.questionType === 'fromScientific') {
                        this.elements.feedback.textContent += ` The correct answer is ${this.correctAnswer}.`;
                    } else if (this.questionType === 'compare') {
                        const correctOption = this.correctAnswer;
                        const correctNumber = correctOption === 'A' ? 
                            `${this.currentQuestion.num1.coefficient} √ó 10^${this.currentQuestion.num1.exponent}` :
                            `${this.currentQuestion.num2.coefficient} √ó 10^${this.currentQuestion.num2.exponent}`;
                        this.elements.feedback.textContent += ` The correct answer is ${correctOption}: ${correctNumber}.`;
                    } else {
                        this.elements.feedback.textContent += ` The correct answer is ${this.correctAnswer.coefficient} √ó 10^${this.correctAnswer.exponent}.`;
                    }
                    
                    // Add a small shake animation to show something is wrong
                    const inputToShake = this.questionType === 'fromScientific' ? 
                        this.elements.decimal : 
                        (this.questionType === 'compare' ? 
                            document.getElementById('compare-input') : 
                            this.elements.coefficient);
                    
                    inputToShake.classList.add('shake');
                    setTimeout(() => {
                        inputToShake.classList.remove('shake');
                    }, 500);
                    
                    // Show character speech with hint
                    const tip = this.tipPhrases[Math.floor(Math.random() * this.tipPhrases.length)];
                    this.showCharacterSpeech("That's not quite right. " + tip, 5000);
                }
                
                // Enable next question button, disable check answer
                this.elements.nextQuestionBtn.disabled = false;
                this.elements.checkAnswerBtn.disabled = true;
            }
            
            celebrate() {
                // Create confetti
                this.createConfetti();
                
                // Add celebration animations to various elements
                this.elements.question.classList.add('bounce');
                this.elements.feedback.classList.add('bounce');
                
                // Create floating emojis
                this.createFloatingEmojis();
                
                // Play celebration sound
                this.playSound('success');
                
                // Make the character jump and glow for celebration
                const character = document.querySelector('.character-body');
                character.style.animation = 'bounce 0.8s';
                
                const antenna = document.querySelector('.character-antenna-ball');
                antenna.style.animation = 'glow 0.5s infinite';
                
                // If score is divisible by 5, play a special level up sound
                if (this.score % 5 === 0) {
                    setTimeout(() => {
                        this.playSound('levelUp');
                        this.showCharacterSpeech("WOW! You've reached level " + Math.floor(this.score/5) + "!", 4000);
                        
                        // Additional celebration for leveling up
                        document.body.style.animation = 'pulse 0.5s';
                        setTimeout(() => {
                            document.body.style.animation = '';
                        }, 500);
                    }, 500);
                }
                
                // Remove animations after they complete
                setTimeout(() => {
                    this.elements.question.classList.remove('bounce');
                    this.elements.feedback.classList.remove('bounce');
                    character.style.animation = '';
                    antenna.style.animation = 'glow 2s infinite'; // Reset to normal glow animation
                }, 1000);
            }
            
            createFloatingEmojis() {
                // Create emojis that float up and fade out
                const emojis = ['üåü', 'üéâ', '‚ú®', 'üöÄ', 'üíØ', 'üëç', 'üß†', 'üî¨', 'üëè', 'üèÜ'];
                const container = document.querySelector('.container');
                
                for (let i = 0; i < 10; i++) {
                    const emoji = document.createElement('div');
                    emoji.className = 'floating-emoji';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = `${Math.random() * 80 + 10}%`;
                    emoji.style.fontSize = `${Math.random() * 20 + 20}px`;
                    emoji.style.animationDuration = `${Math.random() * 2 + 2}s`;
                    emoji.style.animationDelay = `${Math.random() * 0.5}s`;
                    
                    container.appendChild(emoji);
                    
                    // Remove the emoji after animation completes
                    setTimeout(() => {
                        if (emoji && emoji.parentNode) {
                            emoji.parentNode.removeChild(emoji);
                        }
                    }, 3000);
                }
            }
            
            createConfetti() {
                // Create confetti container if it doesn't exist
                let confettiContainer = document.querySelector('.confetti-container');
                if (!confettiContainer) {
                    confettiContainer = document.createElement('div');
                    confettiContainer.className = 'confetti-container';
                    document.body.appendChild(confettiContainer);
                }
                
                // Clear any existing confetti
                confettiContainer.innerHTML = '';
                
                // Generate confetti pieces
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', 
                               '#fd5e53', '#21bf73', '#b83b5e', '#6a2c70', '#08d9d6'];
                const confettiCount = 100;
                
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Randomize confetti properties
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const left = Math.random() * 100; // Random position
                    const size = Math.random() * 8 + 4; // Random size
                    const duration = Math.random() * 3 + 2; // Random animation duration
                    const delay = Math.random() * 0.5; // Random delay
                    
                    // Apply random styles
                    confetti.style.backgroundColor = color;
                    confetti.style.left = `${left}%`;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    confetti.style.animationDuration = `${duration}s`;
                    confetti.style.animationDelay = `${delay}s`;
                    
                    // Add different shapes
                    if (Math.random() > 0.6) {
                        confetti.style.borderRadius = '50%'; // Circle
                    } else if (Math.random() > 0.3) {
                        confetti.style.borderRadius = '2px'; // Rounded square
                    }
                    
                    confettiContainer.appendChild(confetti);
                }
                
                // Remove confetti after animations finish
                setTimeout(() => {
                    confettiContainer.innerHTML = '';
                }, 5000);
            }
            
            playSound(type) {
                // Skip if sound is disabled
                if (!this.soundEnabled) return;
                
                // Use Web Audio API if available
                if (audioContext) {
                    try {
                        // Create a new oscillator for the sound
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        const biquadFilter = audioContext.createBiquadFilter();
                        
                        // Connect nodes: oscillator -> filter -> gain -> destination
                        oscillator.connect(biquadFilter);
                        biquadFilter.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        // Set filter properties for softer sound
                        biquadFilter.type = 'lowpass';
                        biquadFilter.frequency.value = 2000; // Lower frequency cutoff for softer sound
                        
                        // Configure sound based on type
                        const now = audioContext.currentTime;
                        let duration = 0.3;
                        let frequencies = [];
                        
                        switch (type) {
                            case 'success':
                                // Playful success chord
                                oscillator.type = 'triangle'; // Smoother waveform
                                frequencies = [523.25, 659.25, 783.99];
                                duration = 0.8;
                                
                                // Gentle attack, longer release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.2, now + 0.1);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);
                                
                                // Play a simple melody
                                for (let i = 0; i < frequencies.length; i++) {
                                    const noteTime = now + (i * 0.15);
                                    oscillator.frequency.setValueAtTime(frequencies[i], noteTime);
                                }
                                break;
                                
                            case 'error':
                                // Gentle error sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(330, now);
                                oscillator.frequency.exponentialRampToValueAtTime(220, now + 0.3);
                                
                                // Gentler attack and decay
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.1, now + 0.05);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                                break;
                                
                            case 'click':
                                // Button click sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(440, now);
                                
                                // Short soft click
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.1, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
                                
                                duration = 0.08;
                                break;
                                
                            case 'move':
                                // Decimal point movement sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(587.33, now);
                                oscillator.frequency.linearRampToValueAtTime(659.25, now + 0.1);
                                
                                // Soft attack and release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.1, now + 0.02);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                                
                                duration = 0.15;
                                break;
                                
                            case 'tap':
                                // Input field tap sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(523.25, now);
                                
                                // Very gentle attack
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                                
                                duration = 0.05;
                                break;
                                
                            case 'backspace':
                                // Backspace key sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(493.88, now);
                                oscillator.frequency.linearRampToValueAtTime(440, now + 0.1);
                                
                                // Gentle attack and release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                                
                                duration = 0.1;
                                break;
                                
                            case 'clear':
                                // Clear key sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(493.88, now);
                                oscillator.frequency.linearRampToValueAtTime(392, now + 0.15);
                                
                                // Gentle attack and release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                                
                                duration = 0.15;
                                break;
                                
                            case 'toggle':
                                // Option toggle sound
                                oscillator.type = 'sine';
                                oscillator.frequency.setValueAtTime(392, now);
                                oscillator.frequency.linearRampToValueAtTime(523.25, now + 0.1);
                                
                                // Gentle attack and release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                                
                                duration = 0.1;
                                break;
                                
                            case 'levelUp':
                                // Level up fanfare
                                oscillator.type = 'triangle';
                                frequencies = [392, 493.88, 587.33, 659.25, 783.99];
                                duration = 1.2;
                                
                                // Soft attack, long release
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.15, now + 0.1);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);
                                
                                // Play ascending notes
                                for (let i = 0; i < frequencies.length; i++) {
                                    const noteTime = now + (i * 0.2);
                                    oscillator.frequency.setValueAtTime(frequencies[i], noteTime);
                                }
                                break;
                                
                            default:
                                // Default gentle sound
                                oscillator.type = 'sine';
                                oscillator.frequency.value = 440;
                                
                                // Default envelope
                                gainNode.gain.setValueAtTime(0, now);
                                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                                
                                duration = 0.1;
                        }
                        
                        // Start and stop the oscillator
                        oscillator.start(now);
                        oscillator.stop(now + duration);
                        
                    } catch (e) {
                        console.warn('Error playing sound:', e);
                    }
                } else {
                    // Fallback for browsers without AudioContext support
                    try {
                        // Create a simple beep sound with different frequencies
                        const beep = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgA");
                        beep.volume = 0.2; // Lower volume for softer sound
                        beep.play().catch(e => {
                            // Suppress errors from browsers that require user interaction
                        });
                    } catch (e) {
                        // Suppress errors for browsers without Audio support
                    }
                }
            }
        }
        
        // Start the game when the page loads
        window.addEventListener('load', () => {
            // Initialize bubbles for underwater theme
            const bubblesContainer = document.querySelector('.bubbles');
            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.width = `${Math.random() * 30 + 10}px`;
                bubble.style.height = bubble.style.width;
                bubble.style.animationDuration = `${Math.random() * 10 + 5}s`;
                bubble.style.animationDelay = `${Math.random() * 5}s`;
                bubblesContainer.appendChild(bubble);
            }
            
            // Initialize stars for space theme
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDuration = `${Math.random() * 5 + 2}s`;
                star.style.opacity = Math.random() * 0.8 + 0.2;
                starsContainer.appendChild(star);
            }
            
            // Initialize the game
            new ScientificNotationGame();
        });
    </script>
</body>
</html>