<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Adventure: Cosmic Gravity Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        /* Main Game Styling */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background-color: #0a0a2a;
            color: #fff;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .game-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Header Styling */
        .game-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
        }
        
        .game-title {
            font-size: 36px;
            color: #f8d347;
            text-shadow: 0 0 15px #f8a547;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }
        
        .game-subtitle {
            font-size: 18px;
            color: #a3e4ff;
            margin-bottom: 20px;
        }
        
        /* Character Styles */
        .character {
            position: fixed;
            bottom: 20px;
            width: 120px;
            height: 120px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .astro-character {
            left: 20px;
            cursor: pointer;
        }
        
        .alien-character {
            right: 20px;
            cursor: pointer;
        }
        
        .character-speech {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            color: #0a0a2a;
            border-radius: 15px;
            padding: 15px;
            width: 250px;
            bottom: 130px;
            font-size: 16px;
            z-index: 101;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .astro-speech {
            left: 20px;
        }
        
        .alien-speech {
            right: 20px;
        }
        
        /* Navigation and Screens */
        .nav-buttons {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 15px;
        }
        
        .nav-button {
            background-color: #3a67cc;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button:hover {
            background-color: #4a77dc;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .nav-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .screen {
            background-color: rgba(20, 30, 70, 0.7);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 5;
            overflow: hidden;
        }
        
        .screen-title {
            color: #f8d347;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        
        /* Canvas Container */
        #canvas-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            min-height: 400px;
        }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #1a2a5a;
            border-radius: 10px;
            margin: 20px 0;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
            transition: width 0.5s ease-in-out;
            position: relative;
        }
        
        /* Controls and Parameters */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .control-group {
            background-color: rgba(30, 40, 80, 0.7);
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
            flex: 1;
        }
        
        .control-title {
            color: #a3e4ff;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            border-radius: 5px;
            background: #1a2a5a;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f8d347;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(248, 211, 71, 0.5);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f8d347;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(248, 211, 71, 0.5);
        }
        
        /* Quiz Styling */
        .quiz-container {
            background-color: rgba(40, 50, 100, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .quiz-question {
            font-size: 18px;
            margin-bottom: 15px;
            color: #a3e4ff;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-option {
            background-color: rgba(30, 40, 80, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quiz-option:hover {
            background-color: rgba(60, 70, 120, 0.7);
        }
        
        .quiz-option.selected {
            background-color: #3a67cc;
            box-shadow: 0 0 10px #4a77dc;
        }
        
        .quiz-option.correct {
            background-color: #4caf50;
            box-shadow: 0 0 10px #4caf50;
        }
        
        .quiz-option.incorrect {
            background-color: #f44336;
            box-shadow: 0 0 10px #f44336;
        }
        
        .quiz-feedback {
            margin-top: 15px;
            font-size: 16px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
        
        .quiz-feedback.correct {
            background-color: rgba(76, 175, 80, 0.3);
            color: #c8ffcc;
        }
        
        .quiz-feedback.incorrect {
            background-color: rgba(244, 67, 54, 0.3);
            color: #ffcccb;
        }
        
        /* Achievement Badges */
        .achievements-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .achievement {
            background-color: rgba(30, 40, 80, 0.7);
            border-radius: 15px;
            padding: 15px;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .achievement.locked {
            filter: grayscale(1);
            opacity: 0.6;
        }
        
        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .achievement-name {
            font-size: 12px;
            text-align: center;
            color: #a3e4ff;
        }
        
        .achievement-tooltip {
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 150px;
            font-size: 12px;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .achievement:hover .achievement-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .game-title {
                font-size: 28px;
            }
            
            .game-subtitle {
                font-size: 16px;
            }
            
            .control-group {
                min-width: 100%;
            }
            
            .character {
                width: 80px;
                height: 80px;
            }
            
            .character-speech {
                width: 200px;
                font-size: 14px;
                bottom: 90px;
            }
            
            .screen {
                padding: 20px;
            }
        }
        
        /* Additional Features */
        .settings-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #a3e4ff;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: rgba(20, 30, 70, 0.95);
            padding: 20px;
            transition: right 0.3s ease;
            z-index: 1000;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .close-settings {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
        
        .settings-group {
            margin-bottom: 20px;
        }
        
        .settings-title {
            color: #f8d347;
            margin-bottom: 10px;
            font-size: 18px;
            padding-top: 20px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-container input {
            margin-right: 10px;
        }
        
        /* Info panel for scientific explanations */
        .info-panel {
            background-color: rgba(20, 30, 70, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .info-title {
            color: #f8d347;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .info-content {
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .info-detail-toggle {
            color: #a3e4ff;
            cursor: pointer;
            text-decoration: underline;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .info-detail {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            font-size: 14px;
            background-color: rgba(30, 40, 80, 0.7);
            border-radius: 10px;
            padding: 0 15px;
            margin-top: 5px;
        }
        
        .info-detail.expanded {
            max-height: 1000px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        /* Formula display */
        .formula {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            color: #f8d347;
            text-align: center;
            overflow-x: auto;
        }
        
        /* Badge notification */
        .badge-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 18px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }
        
        .badge-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-20px);
        }
        
        /* Age difficulty selector */
        .age-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .age-option {
            padding: 10px 15px;
            border-radius: 30px;
            background-color: rgba(30, 40, 80, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .age-option:hover {
            background-color: rgba(60, 70, 120, 0.7);
        }
        
        .age-option.selected {
            background-color: #3a67cc;
            box-shadow: 0 0 10px rgba(74, 119, 220, 0.5);
        }
        
        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0a0a2a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 1s ease;
        }
        
        .loading-title {
            font-size: 36px;
            color: #f8d347;
            margin-bottom: 30px;
            text-shadow: 0 0 15px #f8a547;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 8px solid #f8d347;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Starfield background */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-title">Space Adventure</div>
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Starfield Background -->
    <div class="starfield" id="starfield"></div>
    
    <!-- Game Container -->
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">Space Adventure: Cosmic Gravity Explorer</h1>
            <p class="game-subtitle">Discover the wonders of gravity across the universe!</p>
        </div>
        
        <!-- Settings Button -->
        <button class="settings-button" id="settings-button">‚öôÔ∏è</button>
        
        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <button class="nav-button" id="intro-btn">Introduction</button>
            <button class="nav-button" id="explore-btn">Sandbox</button>
            <button class="nav-button" id="learn-btn">Learn</button>
            <button class="nav-button" id="quiz-btn">Quiz</button>
            <button class="nav-button" id="achieve-btn">Achievements</button>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <!-- Introduction Screen -->
        <div class="screen" id="intro-screen">
            <h2 class="screen-title">Welcome to the Cosmos!</h2>
            <p>Get ready to explore the amazing forces that shape our universe! You'll learn about gravity, planets, stars, and more through fun experiments and challenges.</p>
            <p>In this adventure, you'll discover:</p>
            <ul style="list-style-type: none; padding-left: 20px; margin: 15px 0;">
                <li>ü™ê How planets orbit around stars</li>
                <li>üåå What makes gravity work</li>
                <li>üöÄ How spacecraft move through space</li>
                <li>‚è±Ô∏è Even how time itself can change!</li>
            </ul>
            <p>Choose your difficulty level:</p>
            <div class="age-selector">
                <div class="age-option selected" data-age="5">5-7 Years</div>
                <div class="age-option" data-age="8">8-10 Years</div>
                <div class="age-option" data-age="11">11+ Years</div>
            </div>
            <p>Click the buttons above to start your journey, or just hit the "Learn" button to begin your adventure!</p>
            <div class="nav-buttons">
                <button class="nav-button" id="start-btn">Let's Start!</button>
            </div>
        </div>
        
        <!-- Exploration/Sandbox Screen -->
        <div class="screen hidden" id="explore-screen">
            <h2 class="screen-title">Gravity Sandbox</h2>
            <div id="canvas-container"></div>
            
            <div class="controls">
                <div class="control-group">
                    <h3 class="control-title">Planet Settings</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Planet Mass</span>
                            <span id="planet-mass-value">1000</span>
                        </div>
                        <input type="range" min="100" max="5000" value="1000" class="slider" id="planet-mass">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Planet Size</span>
                            <span id="planet-size-value">30</span>
                        </div>
                        <input type="range" min="10" max="100" value="30" class="slider" id="planet-size">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3 class="control-title">Gravity Settings</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Gravity Strength</span>
                            <span id="gravity-strength-value">1.0</span>
                        </div>
                        <input type="range" min="0.1" max="5" value="1.0" step="0.1" class="slider" id="gravity-strength">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Time Speed</span>
                            <span id="time-speed-value">1.0</span>
                        </div>
                        <input type="range" min="0.1" max="5" value="1.0" step="0.1" class="slider" id="time-speed">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3 class="control-title">Object Settings</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Launch Speed</span>
                            <span id="launch-speed-value">5</span>
                        </div>
                        <input type="range" min="1" max="20" value="5" class="slider" id="launch-speed">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Object Mass</span>
                            <span id="object-mass-value">10</span>
                        </div>
                        <input type="range" min="1" max="100" value="10" class="slider" id="object-mass">
                    </div>
                    <button class="nav-button" id="launch-btn">Launch Object!</button>
                </div>
            </div>
            
            <div class="info-panel">
                <h3 class="info-title">What's Happening?</h3>
                <p class="info-content">
                    You're seeing gravity in action! The planet pulls on the objects because of its mass.
                    This is just like how Earth pulls on you to keep your feet on the ground.
                </p>
                <span class="info-detail-toggle" data-target="gravity-basics">Learn more about gravity...</span>
                <div class="info-detail" id="gravity-basics">
                    <p>Gravity is a force that pulls objects with mass toward each other. The more mass an object has, the stronger its gravitational pull!</p>
                    <p>Sir Isaac Newton discovered that the force of gravity depends on:</p>
                    <ul>
                        <li>The masses of the two objects</li>
                        <li>The distance between the objects</li>
                    </ul>
                    <div class="formula">F = G √ó (m‚ÇÅ √ó m‚ÇÇ) / r¬≤</div>
                    <p>Where:</p>
                    <ul>
                        <li>F is the force of gravity</li>
                        <li>G is the gravitational constant</li>
                        <li>m‚ÇÅ and m‚ÇÇ are the masses of the two objects</li>
                        <li>r is the distance between the centers of the objects</li>
                    </ul>
                    <p>In our sandbox, you can change these values and see how they affect gravity!</p>
                </div>
            </div>
        </div>
        
        <!-- Learning Modules Screen -->
        <div class="screen hidden" id="learn-screen">
            <h2 class="screen-title">Learning Adventures</h2>
            
            <!-- Module Navigation -->
            <div class="nav-buttons" id="module-nav">
                <button class="nav-button module-btn selected" data-module="intro-gravity">Intro to Gravity</button>
                <button class="nav-button module-btn" data-module="orbits">Orbits & Motion</button>
                <button class="nav-button module-btn" data-module="solar-system">Our Solar System</button>
                <button class="nav-button module-btn" data-module="advanced">Advanced Gravity</button>
            </div>
            
            <!-- Module Content Containers -->
            <div class="module-container" id="intro-gravity-module">
                <h3 class="screen-title">Introduction to Gravity</h3>
                
                <div class="info-panel">
                    <h3 class="info-title">What is Gravity?</h3>
                    <p class="info-content">
                        Gravity is the invisible force that pulls objects toward each other. It's what keeps us on the ground instead of floating away!
                    </p>
                    <div id="gravity-demo-container"></div>
                    <p class="info-content">
                        Everything that has mass (stuff that takes up space) has gravity. The more mass something has, the stronger its gravity pull.
                    </p>
                    <span class="info-detail-toggle" data-target="gravity-info">Tell me more about gravity...</span>
                    <div class="info-detail" id="gravity-info">
                        <p>Gravity works everywhere in the universe. Here are some cool gravity facts:</p>
                        <ul>
                            <li>The gravity on the Moon is about 1/6 of Earth's gravity. That's why astronauts can jump so high on the Moon!</li>
                            <li>The gravity on Jupiter is about 2.5 times stronger than Earth's gravity. If you weigh 50 pounds on Earth, you would weigh 125 pounds on Jupiter!</li>
                            <li>Black holes have gravity so strong that not even light can escape!</li>
                        </ul>
                        <p>The force of gravity between two objects depends on their masses and the distance between them. This relationship was discovered by Sir Isaac Newton and is described by the formula:</p>
                        <div class="formula">F = G √ó (m‚ÇÅ √ó m‚ÇÇ) / r¬≤</div>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h3 class="info-title">Experiment: Drop Different Objects</h3>
                    <p class="info-content">
                        What falls faster: a bowling ball or a feather? Let's find out!
                    </p>
                    <div id="falling-objects-container"></div>
                    <button class="nav-button" id="drop-objects-btn">Drop Objects</button>
                    <button class="nav-button" id="drop-vacuum-btn">Drop in Vacuum</button>
                    <p class="info-content">
                        Surprisingly, without air resistance (like in space or a vacuum), all objects fall at the same speed regardless of their mass!
                    </p>
                    <span class="info-detail-toggle" data-target="falling-info">Learn why...</span>
                    <div class="info-detail" id="falling-info">
                        <p>This happens because of two important facts:</p>
                        <ol>
                            <li>The gravitational force on an object is proportional to its mass</li>
                            <li>The acceleration of an object is inversely proportional to its mass (F = ma)</li>
                        </ol>
                        <p>These two effects exactly cancel each other out! So all objects, regardless of their mass, accelerate at the same rate due to gravity.</p>
                        <p>Galileo Galilei was one of the first scientists to understand this. According to legend, he demonstrated this by dropping two different weights from the Leaning Tower of Pisa.</p>
                        <p>In 1971, astronaut David Scott demonstrated this on the Moon by dropping a hammer and a feather at the same time. With no air resistance, they hit the lunar surface simultaneously!</p>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-question">Mini Quiz: If you were on a planet with twice the gravity of Earth, what would happen?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">You would float away from the planet</div>
                        <div class="quiz-option" data-correct="true">You would feel twice as heavy</div>
                        <div class="quiz-option" data-correct="false">Nothing would change</div>
                        <div class="quiz-option" data-correct="false">You would be crushed flat</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
            
            <div class="module-container hidden" id="orbits-module">
                <h3 class="screen-title">Orbits & Planetary Motion</h3>
                
                <div class="info-panel">
                    <h3 class="info-title">How Planets Orbit</h3>
                    <p class="info-content">
                        An orbit is the path one object takes around another due to gravity. Planets orbit around stars, and moons orbit around planets.
                    </p>
                    <div id="orbit-demo-container"></div>
                    <button class="nav-button" id="orbit-demo-btn">Start Orbit Demo</button>
                    <p class="info-content">
                        Orbits happen when an object has enough sideways motion (velocity) that it keeps "missing" the planet as it falls toward it.
                    </p>
                    <span class="info-detail-toggle" data-target="orbit-info">Learn about Kepler's Laws...</span>
                    <div class="info-detail" id="orbit-info">
                        <p>Johannes Kepler discovered three important laws about how planets move:</p>
                        <ol>
                            <li><strong>Orbits are ellipses:</strong> Planets move in oval-shaped paths with the Sun at one focus of the ellipse.</li>
                            <li><strong>Equal areas in equal times:</strong> A line connecting a planet to the Sun sweeps out equal areas in equal times, meaning planets move faster when they're closer to the Sun.</li>
                            <li><strong>The orbital period squared is proportional to the semi-major axis cubed:</strong> This means that planets farther from the Sun take much longer to complete an orbit.</li>
                        </ol>
                        <div class="formula">P¬≤ ‚àù a¬≥</div>
                        <p>Where P is the orbital period (time to complete one orbit) and a is the semi-major axis (average distance from the Sun).</p>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h3 class="info-title">Why Don't Orbits Crash?</h3>
                    <p class="info-content">
                        Imagine swinging a ball on a string around your head. The string pulls the ball inward (like gravity), but the ball keeps moving sideways so it travels in a circle.
                    </p>
                    <div id="orbit-explanation-container"></div>
                    <button class="nav-button" id="orbit-interactive-btn">Try Different Speeds</button>
                    <p class="info-content">
                        If the ball moves too slowly, it would fall inward. If it moves too fast, it would fly away. At just the right speed, it orbits!
                    </p>
                    <span class="info-detail-toggle" data-target="escape-velocity">Learn about escape velocity...</span>
                    <div class="info-detail" id="escape-velocity">
                        <p>For any planet or star, there's a special speed called the <strong>escape velocity</strong>. If an object moves faster than this speed, it can escape the planet's gravity completely!</p>
                        <p>The escape velocity formula is:</p>
                        <div class="formula">v_escape = ‚àö(2GM/r)</div>
                        <p>Where:</p>
                        <ul>
                            <li>G is the gravitational constant</li>
                            <li>M is the mass of the planet</li>
                            <li>r is the distance from the center of the planet</li>
                        </ul>
                        <p>Earth's escape velocity is about 11.2 kilometers per second (25,000 mph). That's why rockets need to be so powerful to launch spacecraft into space!</p>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-question">Mini Quiz: What happens if a spacecraft orbiting Earth slows down?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">It moves to a higher orbit (farther from Earth)</div>
                        <div class="quiz-option" data-correct="true">It moves to a lower orbit (closer to Earth)</div>
                        <div class="quiz-option" data-correct="false">It stays in the same orbit but takes longer to go around</div>
                        <div class="quiz-option" data-correct="false">It immediately falls to Earth</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
            
            <div class="module-container hidden" id="solar-system-module">
                <h3 class="screen-title">Our Solar System</h3>
                
                <div class="info-panel">
                    <h3 class="info-title">Planets and Their Gravity</h3>
                    <p class="info-content">
                        Our solar system has eight planets, all with different sizes and amounts of gravity.
                    </p>
                    <div id="solar-system-container"></div>
                    <button class="nav-button" id="solar-system-btn">Explore Planets</button>
                    <p class="info-content">
                        If you weigh 60 pounds on Earth, you would weigh different amounts on other planets because of their different gravitational pulls.
                    </p>
                    <div id="weight-calculator">
                        <p>Your Earth weight: <input type="number" id="earth-weight" value="60" min="1" max="1000"> pounds</p>
                        <div id="planet-weights"></div>
                    </div>
                    <span class="info-detail-toggle" data-target="planet-info">Planet details...</span>
                    <div class="info-detail" id="planet-info">
                        <p>Here are some cool facts about the planets in our solar system:</p>
                        <ul>
                            <li><strong>Mercury:</strong> The smallest planet, very hot on the side facing the Sun and very cold on the other side.</li>
                            <li><strong>Venus:</strong> Similar in size to Earth but covered in thick poisonous clouds and extremely hot.</li>
                            <li><strong>Earth:</strong> Our home planet with liquid water and an atmosphere that supports life.</li>
                            <li><strong>Mars:</strong> The "Red Planet" with polar ice caps and the largest volcano in the solar system.</li>
                            <li><strong>Jupiter:</strong> A giant gas planet with a Great Red Spot that is a storm larger than Earth.</li>
                            <li><strong>Saturn:</strong> Famous for its beautiful rings made of ice particles and rocks.</li>
                            <li><strong>Uranus:</strong> A blue-green ice giant that rotates on its side.</li>
                            <li><strong>Neptune:</strong> The windiest planet with storms that can reach 1,200 miles per hour.</li>
                        </ul>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h3 class="info-title">The Sun's Mighty Gravity</h3>
                    <p class="info-content">
                        The Sun contains 99.8% of all the mass in our solar system! That's why its gravitational pull can keep all the planets in orbit, even ones that are very far away.
                    </p>
                    <div id="sun-gravity-container"></div>
                    <p class="info-content">
                        The Sun's gravity is so strong that it actually bends space itself, like a heavy ball on a rubber sheet.
                    </p>
                    <span class="info-detail-toggle" data-target="sun-info">More about the Sun...</span>
                    <div class="info-detail" id="sun-info">
                        <p>The Sun is classified as a G-type main-sequence star, often called a yellow dwarf. Here are some amazing facts about our star:</p>
                        <ul>
                            <li>The Sun is about 109 times wider than Earth</li>
                            <li>It would take about 1.3 million Earths to fill the volume of the Sun</li>
                            <li>The temperature at the Sun's core is about 15 million degrees Celsius (27 million degrees Fahrenheit)</li>
                            <li>The Sun fuses about 600 million tons of hydrogen into helium every second</li>
                            <li>Light from the Sun takes about 8 minutes to reach Earth</li>
                        </ul>
                        <p>The Sun's immense mass creates a gravitational well that holds the entire solar system together. This is a perfect example of how mass affects gravity on a cosmic scale!</p>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-question">Mini Quiz: Why does Jupiter have stronger gravity than Earth?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="true">Because Jupiter has much more mass than Earth</div>
                        <div class="quiz-option" data-correct="false">Because Jupiter is closer to the Sun</div>
                        <div class="quiz-option" data-correct="false">Because Jupiter spins faster than Earth</div>
                        <div class="quiz-option" data-correct="false">Because Jupiter has many moons</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
            
            <div class="module-container hidden" id="advanced-module">
                <h3 class="screen-title">Advanced Gravity Concepts</h3>
                
                <div class="info-panel">
                    <h3 class="info-title">Einstein's Gravity</h3>
                    <p class="info-content">
                        Albert Einstein discovered that gravity isn't just a force pulling objects together. It's actually the result of massive objects bending space and time itself!
                    </p>
                    <div id="spacetime-container"></div>
                    <button class="nav-button" id="spacetime-btn">Show Spacetime Bending</button>
                    <p class="info-content">
                        Think of space as a trampoline. If you put a bowling ball in the middle, it creates a dip. Any marbles you roll near it will curve toward the bowling ball, just like planets curve around the Sun!
                    </p>
                    <span class="info-detail-toggle" data-target="relativity-info">Learn about General Relativity...</span>
                    <div class="info-detail" id="relativity-info">
                        <p>Einstein's Theory of General Relativity explains gravity in a completely different way than Newton did. Here are the key ideas:</p>
                        <ol>
                            <li>Mass tells spacetime how to curve</li>
                            <li>Curved spacetime tells objects how to move</li>
                        </ol>
                        <p>This explains why light, which has no mass, can still be affected by gravity - it's following the curves in spacetime!</p>
                        <p>General Relativity predicts several phenomena that Newton's theory couldn't explain:</p>
                        <ul>
                            <li><strong>Gravitational lensing:</strong> The bending of light around massive objects</li>
                            <li><strong>Black holes:</strong> Regions where spacetime is so curved that nothing can escape</li>
                            <li><strong>Gravitational waves:</strong> Ripples in spacetime that travel at the speed of light</li>
                            <li><strong>Time dilation:</strong> Time passes more slowly in stronger gravitational fields</li>
                        </ul>
                        <p>Scientists proved Einstein was right by measuring how the Sun bends starlight during a solar eclipse, and more recently by detecting gravitational waves from merging black holes!</p>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h3 class="info-title">Gravity and Time</h3>
                    <p class="info-content">
                        One of the strangest predictions of Einstein's theory is that gravity affects how time flows. Time actually passes more slowly in stronger gravity!
                    </p>
                    <div id="time-dilation-container"></div>
                    <button class="nav-button" id="time-dilation-btn">Show Time Dilation</button>
                    <p class="info-content">
                        This means time passes slightly faster for your head than for your feet, since your feet are closer to Earth's center. The difference is too tiny to notice, but it becomes significant near very massive objects like black holes.
                    </p>
                    <span class="info-detail-toggle" data-target="time-info">More about time dilation...</span>
                    <div class="info-detail" id="time-info">
                        <p>Gravitational time dilation is described by the formula:</p>
                        <div class="formula">t‚ÇÄ = t_f √ó ‚àö(1 - 2GM/rc¬≤)</div>
                        <p>Where:</p>
                        <ul>
                            <li>t‚ÇÄ is the time measured by an observer far from the massive object</li>
                            <li>t_f is the time measured by an observer near the massive object</li>
                            <li>G is the gravitational constant</li>
                            <li>M is the mass of the object creating the gravitational field</li>
                            <li>r is the distance from the center of the massive object</li>
                            <li>c is the speed of light</li>
                        </ul>
                        <p>This effect is actually important for GPS satellites! They experience less gravity than we do on Earth, so their clocks run about 38 microseconds faster per day. If we didn't correct for this, GPS navigation would drift by about 10 kilometers each day!</p>
                        <p>The movie "Interstellar" shows this in an extreme way when the astronauts visit a planet near a black hole. Every hour they spend on the planet equals 7 years passing on Earth!</p>
                    </div>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-question">Mini Quiz: According to Einstein, gravity is best described as:</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">A force that pulls objects together</div>
                        <div class="quiz-option" data-correct="false">Tiny particles called gravitons</div>
                        <div class="quiz-option" data-correct="true">The curvature of spacetime caused by mass</div>
                        <div class="quiz-option" data-correct="false">Magnetic attraction between planets</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>
        
        <!-- Quiz Screen -->
        <div class="screen hidden" id="quiz-screen">
            <h2 class="screen-title">Test Your Knowledge!</h2>
            <div id="quiz-progress">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
            
            <div class="quiz-container" id="main-quiz-container">
                <!-- Quiz content will be dynamically loaded here -->
            </div>
            
            <div class="nav-buttons">
                <button class="nav-button hidden" id="prev-question-btn">Previous</button>
                <button class="nav-button" id="next-question-btn">Next Question</button>
                <button class="nav-button hidden" id="finish-quiz-btn">Finish Quiz</button>
            </div>
        </div>
        
        <!-- Achievements Screen -->
        <div class="screen hidden" id="achieve-screen">
            <h2 class="screen-title">Your Space Achievements</h2>
            <p>Collect achievements by exploring and learning about gravity!</p>
            
            <div class="achievements-container" id="achievements-list">
                <!-- Achievements will be dynamically loaded here -->
            </div>
        </div>
        
        <!-- Characters -->
        <div class="character astro-character" id="astro-character">
            <svg viewBox="0 0 100 100" width="100%" height="100%">
                <!-- Astronaut body -->
                <circle cx="50" cy="50" r="30" fill="#f2f2f2" stroke="#aaa" stroke-width="2"/>
                <!-- Helmet visor -->
                <path d="M30 45 Q50 30 70 45" fill="none" stroke="#3a67cc" stroke-width="4"/>
                <!-- Suit details -->
                <rect x="40" y="65" width="20" height="15" rx="5" fill="#3a67cc"/>
                <!-- Backpack -->
                <rect x="35" y="40" width="30" height="25" rx="5" fill="#ddd" stroke="#aaa" stroke-width="1"/>
                <!-- Arms -->
                <path d="M25 50 Q15 55 20 70" fill="none" stroke="#f2f2f2" stroke-width="8" stroke-linecap="round"/>
                <path d="M75 50 Q85 55 80 70" fill="none" stroke="#f2f2f2" stroke-width="8" stroke-linecap="round"/>
            </svg>
        </div>
        <div class="character-speech astro-speech hidden" id="astro-speech">
            Hi there! I'm Astro. I'll help you learn about gravity and space!
        </div>
        
        <div class="character alien-character" id="alien-character">
            <svg viewBox="0 0 100 100" width="100%" height="100%">
                <!-- Alien body -->
                <ellipse cx="50" cy="60" rx="25" ry="30" fill="#7fba00"/>
                <!-- Head -->
                <circle cx="50" cy="35" r="20" fill="#7fba00"/>
                <!-- Eyes -->
                <ellipse cx="40" cy="30" rx="6" ry="8" fill="black"/>
                <ellipse cx="60" cy="30" rx="6" ry="8" fill="black"/>
                <circle cx="42" cy="28" r="2" fill="white"/>
                <circle cx="62" cy="28" r="2" fill="white"/>
                <!-- Antennas -->
                <path d="M40 15 Q38 5 30 3" fill="none" stroke="#7fba00" stroke-width="3"/>
                <path d="M60 15 Q62 5 70 3" fill="none" stroke="#7fba00" stroke-width="3"/>
                <circle cx="30" cy="3" r="3" fill="#f8d347"/>
                <circle cx="70" cy="3" r="3" fill="#f8d347"/>
                <!-- Mouth -->
                <path d="M40 45 Q50 55 60 45" fill="none" stroke="black" stroke-width="2"/>
            </svg>
        </div>
        <div class="character-speech alien-speech hidden" id="alien-speech">
            Greetings, Earthling! I'm Cosmo from Planet Graviton. Our gravity is 5 times stronger than yours!
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel" id="settings-panel">
            <button class="close-settings" id="close-settings">√ó</button>
            <h2 class="settings-title">Game Settings</h2>
            
            <div class="settings-group">
                <h3 class="settings-title">Display</h3>
                <div class="checkbox-container">
                    <input type="checkbox" id="show-formulas" checked>
                    <label for="show-formulas">Show Mathematical Formulas</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="show-advanced" checked>
                    <label for="show-advanced">Show Advanced Concepts</label>
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Text Size</span>
                        <span id="text-size-value">Medium</span>
                    </div>
                    <input type="range" min="0" max="2" value="1" class="slider" id="text-size-slider">
                </div>
            </div>
            
            <div class="settings-group">
                <h3 class="settings-title">Learning Experience</h3>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Learning Depth</span>
                        <span id="learning-depth-value">Balanced</span>
                    </div>
                    <input type="range" min="0" max="2" value="1" class="slider" id="learning-depth-slider">
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="auto-guide" checked>
                    <label for="auto-guide">Enable Character Hints</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="quiz-mode" checked>
                    <label for="quiz-mode">Quiz After Each Section</label>
                </div>
            </div>
            
            <div class="settings-group">
                <h3 class="settings-title">Simulation</h3>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Simulation Quality</span>
                        <span id="sim-quality-value">Medium</span>
                    </div>
                    <input type="range" min="0" max="2" value="1" class="slider" id="sim-quality-slider">
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="show-vectors" checked>
                    <label for="show-vectors">Show Force Vectors</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="realistic-physics" checked>
                    <label for="realistic-physics">Realistic Physics</label>
                </div>
            </div>
            
            <button class="nav-button" id="reset-progress">Reset Game Progress</button>
        </div>
        
        <!-- Badge Notification -->
        <div class="badge-notification" id="badge-notification">
            Achievement Unlocked: Space Explorer!
        </div>
    </div>
    
    <script>
        // Main Game Class
        class SpaceAdventureGame {
            constructor() {
                // Game state
                this.gameState = {
                    currentScreen: "intro",
                    currentModule: "intro-gravity",
                    difficulty: 0, // 0: 5-7 years, 1: 8-10 years, 2: 11+ years
                    progress: 0,
                    score: 0,
                    achievements: [],
                    quizAnswers: [],
                    visitedScreens: [],
                    launchCount: 0,
                    experimentCount: 0,
                    currentQuizIndex: 0
                };
                
                // Settings
                this.settings = {
                    showFormulas: true,
                    showAdvanced: true,
                    textSize: 1, // 0: small, 1: medium, 2: large
                    learningDepth: 1, // 0: basic, 1: balanced, 2: detailed
                    autoGuide: true,
                    quizMode: true,
                    simulationQuality: 1, // 0: low, 1: medium, 2: high
                    showVectors: true,
                    realisticPhysics: true
                };
                
                // p5 instance for main simulation
                this.p5Instance = null;
                
                // Character dialogue timer
                this.dialogueTimer = null;
                
                // Achievements definition
                this.achievementsList = [
                    {
                        id: "first-launch",
                        name: "Space Cadet",
                        icon: "üöÄ",
                        description: "Launch your first object into orbit",
                        unlocked: false
                    },
                    {
                        id: "gravity-master",
                        name: "Gravity Master",
                        icon: "ü™ê",
                        description: "Successfully complete the gravity module quiz",
                        unlocked: false
                    },
                    {
                        id: "orbit-expert",
                        name: "Orbit Expert",
                        icon: "üõ∞Ô∏è",
                        description: "Create a stable orbit in the sandbox",
                        unlocked: false
                    },
                    {
                        id: "solar-explorer",
                        name: "Solar Explorer",
                        icon: "‚òÄÔ∏è",
                        description: "Learn about all planets in our solar system",
                        unlocked: false
                    },
                    {
                        id: "einstein-apprentice",
                        name: "Einstein's Apprentice",
                        icon: "‚è±Ô∏è",
                        description: "Understand gravitational time dilation",
                        unlocked: false
                    },
                    {
                        id: "quiz-ace",
                        name: "Quiz Ace",
                        icon: "üèÜ",
                        description: "Score 100% on the final quiz",
                        unlocked: false
                    },
                    {
                        id: "parameter-tweaker",
                        name: "Parameter Tweaker",
                        icon: "‚öôÔ∏è",
                        description: "Adjust all available simulation parameters",
                        unlocked: false
                    },
                    {
                        id: "planet-hopper",
                        name: "Planet Hopper",
                        icon: "üë®‚ÄçüöÄ",
                        description: "Calculate your weight on all planets",
                        unlocked: false
                    }
                ];
                
                // Quiz questions
                this.quizQuestions = {
                    easy: [
                        {
                            question: "What invisible force pulls objects toward each other?",
                            options: ["Gravity", "Magnetism", "Electricity", "Wind"],
                            correct: 0
                        },
                        {
                            question: "Which planet has the strongest gravity in our solar system?",
                            options: ["Earth", "Mars", "Jupiter", "Venus"],
                            correct: 2
                        },
                        {
                            question: "What keeps the Moon orbiting around the Earth?",
                            options: ["Rocket engines", "Magic", "Gravity", "Magnets"],
                            correct: 2
                        },
                        {
                            question: "If you drop a feather and a rock at the same time in space, what happens?",
                            options: ["The rock falls faster", "The feather falls faster", "They fall at the same speed", "They both float away"],
                            correct: 2
                        },
                        {
                            question: "What is the center of our solar system that all planets orbit around?",
                            options: ["Earth", "The Moon", "Mars", "The Sun"],
                            correct: 3
                        }
                    ],
                    medium: [
                        {
                            question: "What determines how strong an object's gravity is?",
                            options: ["Its color", "Its mass", "Its temperature", "Its age"],
                            correct: 1
                        },
                        {
                            question: "Why do astronauts float in the International Space Station?",
                            options: ["There is no gravity in space", "They are constantly falling around Earth", "They wear special floating shoes", "Space has anti-gravity"],
                            correct: 1
                        },
                        {
                            question: "What shape are the orbits of planets around the Sun?",
                            options: ["Perfect circles", "Ellipses (oval shapes)", "Triangles", "Random zigzag paths"],
                            correct: 1
                        },
                        {
                            question: "What happens to your weight if you travel to a planet with more mass than Earth?",
                            options: ["You would weigh more", "You would weigh less", "Your weight wouldn't change", "You would become weightless"],
                            correct: 0
                        },
                        {
                            question: "What happens to gravity between two objects if you double the distance between them?",
                            options: ["Gravity becomes twice as strong", "Gravity becomes half as strong", "Gravity becomes four times weaker", "Gravity doesn't change"],
                            correct: 2
                        }
                    ],
                    advanced: [
                        {
                            question: "According to Einstein, what is gravity?",
                            options: ["A fundamental force", "The curvature of spacetime", "Tiny particles called gravitons", "Magnetic attraction"],
                            correct: 1
                        },
                        {
                            question: "What is 'escape velocity'?",
                            options: ["The speed needed to leave a planet's gravity", "How fast planets move", "The speed of light", "How quickly astronauts move in space"],
                            correct: 0
                        },
                        {
                            question: "What happens to time in stronger gravitational fields?",
                            options: ["Time passes faster", "Time passes slower", "Time stops completely", "Time moves backward"],
                            correct: 1
                        },
                        {
                            question: "What is a black hole?",
                            options: ["A planet painted black", "An empty region of space", "A star that has collapsed under its own gravity", "A hole in the fabric of space"],
                            correct: 2
                        },
                        {
                            question: "What did scientists detect in 2015 that proved Einstein's prediction about gravity?",
                            options: ["Black holes", "Dark matter", "Gravitational waves", "Wormholes"],
                            correct: 2
                        }
                    ]
                };
                
                // Initialize the game
                this.initialize();
            }
            
            initialize() {
                // Create starfield background
                this.createStarfield();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Initialize character interactions
                this.initializeCharacters();
                
                // Initialize first screen
                this.showScreen("intro");
                
                // Update progress bar
                this.updateProgress(0);
                
                // Initialize achievements
                this.renderAchievements();
                
                // Remove loading screen after initialization
                setTimeout(() => {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                    }, 1000);
                }, 2000);
                
                // Set up the first simulation
                this.setupSandboxSimulation();
            }
            
            createStarfield() {
                const starfield = document.getElementById('starfield');
                const starCount = window.innerWidth < 768 ? 100 : 200;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Random size between 1 and 3 pixels
                    const size = Math.random() * 2 + 1;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    
                    // Random position
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    
                    // Random opacity
                    star.style.opacity = Math.random() * 0.7 + 0.3;
                    
                    // Add animation
                    star.style.animation = `twinkle ${Math.random() * 5 + 3}s infinite`;
                    
                    starfield.appendChild(star);
                }
            }
            
            setupEventListeners() {
                // Navigation buttons
                document.getElementById('intro-btn').addEventListener('click', () => this.showScreen('intro'));
                document.getElementById('explore-btn').addEventListener('click', () => this.showScreen('explore'));
                document.getElementById('learn-btn').addEventListener('click', () => this.showScreen('learn'));
                document.getElementById('quiz-btn').addEventListener('click', () => this.showScreen('quiz'));
                document.getElementById('achieve-btn').addEventListener('click', () => this.showScreen('achieve'));
                
                // Start button
                document.getElementById('start-btn').addEventListener('click', () => this.showScreen('learn'));
                
                // Settings button
                document.getElementById('settings-button').addEventListener('click', () => this.toggleSettings());
                document.getElementById('close-settings').addEventListener('click', () => this.toggleSettings());
                
                // Age selector
                document.querySelectorAll('.age-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.age-option').forEach(opt => opt.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.gameState.difficulty = parseInt(e.target.dataset.age);
                        this.updateDifficulty();
                    });
                });
                
                // Module navigation
                document.querySelectorAll('.module-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.module-btn').forEach(b => b.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.gameState.currentModule = e.target.dataset.module;
                        this.showModule(this.gameState.currentModule);
                    });
                });
                
                // Info detail toggles
                document.querySelectorAll('.info-detail-toggle').forEach(toggle => {
                    toggle.addEventListener('click', (e) => {
                        const targetId = e.target.dataset.target;
                        const detailElement = document.getElementById(targetId);
                        detailElement.classList.toggle('expanded');
                        
                        if (detailElement.classList.contains('expanded')) {
                            e.target.textContent = e.target.textContent.replace('Learn more', 'Show less');
                            this.unlockAchievementIfRelevant(targetId);
                        } else {
                            e.target.textContent = e.target.textContent.replace('Show less', 'Learn more');
                        }
                    });
                });
                
                // Quiz options
                document.querySelectorAll('.quiz-option').forEach(option => {
                    option.addEventListener('click', (e) => this.selectQuizOption(e.target));
                });
                
                // Quiz navigation
                document.getElementById('next-question-btn').addEventListener('click', () => this.nextQuizQuestion());
                document.getElementById('prev-question-btn').addEventListener('click', () => this.prevQuizQuestion());
                document.getElementById('finish-quiz-btn').addEventListener('click', () => this.finishQuiz());
                
                // Settings sliders
                document.getElementById('text-size-slider').addEventListener('input', (e) => {
                    this.settings.textSize = parseInt(e.target.value);
                    const sizes = ['Small', 'Medium', 'Large'];
                    document.getElementById('text-size-value').textContent = sizes[this.settings.textSize];
                    this.applySettings();
                });
                
                document.getElementById('learning-depth-slider').addEventListener('input', (e) => {
                    this.settings.learningDepth = parseInt(e.target.value);
                    const depths = ['Basic', 'Balanced', 'Detailed'];
                    document.getElementById('learning-depth-value').textContent = depths[this.settings.learningDepth];
                    this.applySettings();
                });
                
                document.getElementById('sim-quality-slider').addEventListener('input', (e) => {
                    this.settings.simulationQuality = parseInt(e.target.value);
                    const qualities = ['Low', 'Medium', 'High'];
                    document.getElementById('sim-quality-value').textContent = qualities[this.settings.simulationQuality];
                    this.applySettings();
                });
                
                // Checkbox settings
                document.getElementById('show-formulas').addEventListener('change', (e) => {
                    this.settings.showFormulas = e.target.checked;
                    this.applySettings();
                });
                
                document.getElementById('show-advanced').addEventListener('change', (e) => {
                    this.settings.showAdvanced = e.target.checked;
                    this.applySettings();
                });
                
                document.getElementById('auto-guide').addEventListener('change', (e) => {
                    this.settings.autoGuide = e.target.checked;
                    this.applySettings();
                });
                
                document.getElementById('quiz-mode').addEventListener('change', (e) => {
                    this.settings.quizMode = e.target.checked;
                    this.applySettings();
                });
                
                document.getElementById('show-vectors').addEventListener('change', (e) => {
                    this.settings.showVectors = e.target.checked;
                    this.applySettings();
                });
                
                document.getElementById('realistic-physics').addEventListener('change', (e) => {
                    this.settings.realisticPhysics = e.target.checked;
                    this.applySettings();
                });
                
                // Reset progress button
                document.getElementById('reset-progress').addEventListener('click', () => this.resetProgress());
                
                // Character interactions
                document.getElementById('astro-character').addEventListener('click', () => this.showCharacterSpeech('astro'));
                document.getElementById('alien-character').addEventListener('click', () => this.showCharacterSpeech('alien'));
                
                // Interactive elements in learning modules
                document.getElementById('drop-objects-btn')?.addEventListener('click', () => this.runFallingObjectsDemo(false));
                document.getElementById('drop-vacuum-btn')?.addEventListener('click', () => this.runFallingObjectsDemo(true));
                document.getElementById('orbit-demo-btn')?.addEventListener('click', () => this.runOrbitDemo());
                document.getElementById('orbit-interactive-btn')?.addEventListener('click', () => this.runInteractiveOrbitDemo());
                document.getElementById('solar-system-btn')?.addEventListener('click', () => this.exploreSolarSystem());
                document.getElementById('spacetime-btn')?.addEventListener('click', () => this.showSpacetimeBending());
                document.getElementById('time-dilation-btn')?.addEventListener('click', () => this.showTimeDilation());
                
                // Earth weight calculator
                const earthWeightInput = document.getElementById('earth-weight');
                if (earthWeightInput) {
                    earthWeightInput.addEventListener('input', () => this.updatePlanetWeights());
                }
                
                // Sandbox controls
                document.getElementById('launch-btn')?.addEventListener('click', () => {
                    if (this.p5Instance && typeof this.p5Instance.launchObject === 'function') {
                        this.p5Instance.launchObject();
                        this.gameState.launchCount++;
                        
                        // Check for achievement
                        if (this.gameState.launchCount === 1) {
                            this.unlockAchievement('first-launch');
                        }
                    }
                });
                
                // Slider controls for sandbox
                const sliders = ['planet-mass', 'planet-size', 'gravity-strength', 'time-speed', 'launch-speed', 'object-mass'];
                sliders.forEach(sliderId => {
                    const slider = document.getElementById(sliderId);
                    if (slider) {
                        slider.addEventListener('input', (e) => {
                            const value = e.target.value;
                            document.getElementById(`${sliderId}-value`).textContent = value;
                            
                            if (this.p5Instance && typeof this.p5Instance.updateParameters === 'function') {
                                this.p5Instance.updateParameters(sliderId, value);
                            }
                            
                            // Track parameter adjustments for achievement
                            this.trackParameterAdjustment(sliderId);
                        });
                    }
                });
            }
            
            initializeCharacters() {
                const astroCharacter = document.getElementById('astro-character');
                const alienCharacter = document.getElementById('alien-character');
                
                // Add floating animation
                astroCharacter.style.animation = 'float 4s ease-in-out infinite';
                alienCharacter.style.animation = 'float 5s ease-in-out infinite';
                
                // Initial welcome message
                setTimeout(() => {
                    this.showCharacterSpeech('astro');
                    setTimeout(() => {
                        this.showCharacterSpeech('alien');
                    }, 5000);
                }, 3000);
            }
            
            showCharacterSpeech(character) {
                // Clear any existing timers
                if (this.dialogueTimer) {
                    clearTimeout(this.dialogueTimer);
                }
                
                // Hide all speech bubbles
                document.getElementById('astro-speech').classList.add('hidden');
                document.getElementById('alien-speech').classList.add('hidden');
                
                // Get relevant elements
                const speechBubble = document.getElementById(`${character}-speech`);
                
                // Dynamic messages based on current screen and progress
                let message = '';
                
                if (character === 'astro') {
                    switch (this.gameState.currentScreen) {
                        case 'intro':
                            message = "Welcome to Space Adventure! I'm Astro, and I'll be your guide. Click on the 'Let's Start!' button to begin our journey!";
                            break;
                        case 'explore':
                            message = "This is our Gravity Sandbox! Try changing the planet's mass or gravity strength and see what happens when you launch objects.";
                            break;
                        case 'learn':
                            message = "Learning mode activated! Click through the different modules to learn all about gravity, from basic concepts to Einstein's theories.";
                            break;
                        case 'quiz':
                            message = "Time to test your knowledge! Don't worry if you don't know all the answers - you can always go back and learn more.";
                            break;
                        case 'achieve':
                            message = "These are your space achievements! Unlock them all by exploring every part of the game and completing challenges.";
                            break;
                        default:
                            message = "Hi there! I'm Astro. Click on me anytime if you need some help!";
                    }
                } else if (character === 'alien') {
                    switch (this.gameState.currentScreen) {
                        case 'intro':
                            message = "Greetings, Earthling! I'm Cosmo from Planet Graviton. Our gravity is 5 times stronger than yours!";
                            break;
                        case 'explore':
                            message = "On my planet, we have mastered gravity control! Try to create a stable orbit by adjusting the launch speed and direction.";
                            break;
                        case 'learn':
                            message = "Did you know that time passes differently in strong gravity? Einstein's relativity is my favorite Earth science!";
                            break;
                        case 'quiz':
                            message = "Earth quizzes are fun! On my planet, we have to answer questions while floating upside down!";
                            break;
                        case 'achieve':
                            message = "Achievements are like cosmic badges of honor! On Graviton, we collect them across multiple dimensions!";
                            break;
                        default:
                            message = "Hello from Planet Graviton! I'm here to share some alien gravity wisdom with you!";
                    }
                }
                
                // Update message and show speech bubble
                speechBubble.textContent = message;
                speechBubble.classList.remove('hidden');
                
                // Auto-hide after a delay
                this.dialogueTimer = setTimeout(() => {
                    speechBubble.classList.add('hidden');
                }, 10000);
            }
            
            showScreen(screenName) {
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.add('hidden');
                });
                
                // Show the selected screen
                document.getElementById(`${screenName}-screen`).classList.remove('hidden');
                
                // Update current screen in game state
                this.gameState.currentScreen = screenName;
                
                // Track visited screens
                if (!this.gameState.visitedScreens.includes(screenName)) {
                    this.gameState.visitedScreens.push(screenName);
                    this.updateProgress(this.gameState.visitedScreens.length * 10);
                }
                
                // Special handling for specific screens
                switch (screenName) {
                    case 'learn':
                        this.showModule(this.gameState.currentModule);
                        break;
                    case 'quiz':
                        this.initializeQuiz();
                        break;
                    case 'explore':
                        if (this.p5Instance) {
                            // If p5 instance exists, reset it
                            this.setupSandboxSimulation();
                        }
                        break;
                }
                
                // Show character speech relevant to this screen
                if (this.settings.autoGuide) {
                    setTimeout(() => {
                        this.showCharacterSpeech('astro');
                    }, 1000);
                }
            }
            
            showModule(moduleName) {
                // Hide all modules
                document.querySelectorAll('.module-container').forEach(module => {
                    module.classList.add('hidden');
                });
                
                // Show the selected module
                document.getElementById(`${moduleName}-module`).classList.remove('hidden');
                
                // Set up module-specific simulations
                switch (moduleName) {
                    case 'intro-gravity':
                        this.setupGravityDemoSimulation();
                        break;
                    case 'orbits':
                        this.setupOrbitDemoSimulation();
                        break;
                    case 'solar-system':
                        this.setupSolarSystemSimulation();
                        this.updatePlanetWeights();
                        break;
                    case 'advanced':
                        this.setupSpacetimeSimulation();
                        break;
                }
            }
            
            updateProgress(value) {
                // Update progress bar
                const progressBar = document.getElementById('progress-bar');
                const currentProgress = parseInt(progressBar.style.width) || 0;
                
                // Animate progress change
                let step = 0;
                const target = Math.max(currentProgress, value);
                const duration = 1000; // 1 second
                const interval = 20; // 20ms per step
                const steps = duration / interval;
                const increment = (target - currentProgress) / steps;
                
                const animateProgress = () => {
                    step++;
                    const newProgress = currentProgress + (increment * step);
                    progressBar.style.width = `${newProgress}%`;
                    
                    if (step < steps && newProgress < target) {
                        requestAnimationFrame(animateProgress);
                    } else {
                        progressBar.style.width = `${target}%`;
                        this.gameState.progress = target;
                    }
                };
                
                if (target > currentProgress) {
                    requestAnimationFrame(animateProgress);
                }
            }
            
            updateDifficulty() {
                // Adjust game based on selected difficulty level
                const difficultyLevel = this.gameState.difficulty;
                
                // Update content visibility
                document.querySelectorAll('.formula').forEach(formula => {
                    formula.style.display = difficultyLevel > 0 ? 'block' : 'none';
                });
                
                document.querySelectorAll('.info-detail-toggle').forEach(toggle => {
                    if (difficultyLevel === 0) {
                        toggle.textContent = toggle.textContent.replace('Learn more about', 'Simple facts about');
                    } else if (difficultyLevel === 2) {
                        toggle.textContent = toggle.textContent.replace('Learn more about', 'Advanced details on');
                    }
                });
                
                // Update character dialogue
                if (difficultyLevel === 0) {
                    document.getElementById('astro-speech').textContent = 
                        "I'll keep things simple and fun! Let me know if anything is confusing.";
                } else if (difficultyLevel === 2) {
                    document.getElementById('alien-speech').textContent = 
                        "Excellent choice! We'll explore some of the most fascinating concepts in physics!";
                }
                
                // Show relevant speech bubble
                if (difficultyLevel === 0) {
                    this.showCharacterSpeech('astro');
                } else if (difficultyLevel === 2) {
                    this.showCharacterSpeech('alien');
                }
            }
            
            toggleSettings() {
                const settingsPanel = document.getElementById('settings-panel');
                settingsPanel.classList.toggle('open');
            }
            
            applySettings() {
                // Apply text size
                const rootElement = document.documentElement;
                const textSizes = ['14px', '16px', '18px'];
                rootElement.style.setProperty('--base-font-size', textSizes[this.settings.textSize]);
                
                // Apply formula visibility
                document.querySelectorAll('.formula').forEach(formula => {
                    formula.style.display = this.settings.showFormulas ? 'block' : 'none';
                });
                
                // Apply advanced content visibility
                document.querySelectorAll('.info-detail').forEach(detail => {
                    if (!this.settings.showAdvanced) {
                        detail.classList.remove('expanded');
                    }
                });
                
                // Apply simulation quality if p5 instance exists
                if (this.p5Instance && typeof this.p5Instance.updateQuality === 'function') {
                    this.p5Instance.updateQuality(this.settings.simulationQuality);
                }
                
                // Apply vector visibility
                if (this.p5Instance && typeof this.p5Instance.toggleVectors === 'function') {
                    this.p5Instance.toggleVectors(this.settings.showVectors);
                }
                
                // Apply physics realism
                if (this.p5Instance && typeof this.p5Instance.toggleRealisticPhysics === 'function') {
                    this.p5Instance.toggleRealisticPhysics(this.settings.realisticPhysics);
                }
            }
            
            resetProgress() {
                // Reset game state
                this.gameState = {
                    currentScreen: "intro",
                    currentModule: "intro-gravity",
                    difficulty: 0,
                    progress: 0,
                    score: 0,
                    achievements: [],
                    quizAnswers: [],
                    visitedScreens: [],
                    launchCount: 0,
                    experimentCount: 0,
                    currentQuizIndex: 0
                };
                
                // Reset achievements
                this.achievementsList.forEach(achievement => {
                    achievement.unlocked = false;
                });
                this.renderAchievements();
                
                // Reset progress bar
                this.updateProgress(0);
                
                // Return to intro screen
                this.showScreen('intro');
                
                // Show reset confirmation
                this.showCharacterSpeech('astro');
                document.getElementById('astro-speech').textContent = "Game progress has been reset! Let's start fresh!";
            }
            
            // ------- Achievements System ------- //
            
            renderAchievements() {
                const achievementsContainer = document.getElementById('achievements-list');
                
                // Clear current list
                achievementsContainer.innerHTML = '';
                
                // Add each achievement
                this.achievementsList.forEach(achievement => {
                    const achievementElement = document.createElement('div');
                    achievementElement.className = `achievement${achievement.unlocked ? '' : ' locked'}`;
                    
                    const iconElement = document.createElement('div');
                    iconElement.className = 'achievement-icon';
                    iconElement.textContent = achievement.icon;
                    
                    const nameElement = document.createElement('div');
                    nameElement.className = 'achievement-name';
                    nameElement.textContent = achievement.name;
                    
                    const tooltipElement = document.createElement('div');
                    tooltipElement.className = 'achievement-tooltip';
                    tooltipElement.textContent = achievement.description;
                    
                    achievementElement.appendChild(iconElement);
                    achievementElement.appendChild(nameElement);
                    achievementElement.appendChild(tooltipElement);
                    
                    achievementsContainer.appendChild(achievementElement);
                });
            }
            
            unlockAchievement(achievementId) {
                const achievement = this.achievementsList.find(a => a.id === achievementId);
                
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    this.renderAchievements();
                    
                    // Show notification
                    const notification = document.getElementById('badge-notification');
                    notification.textContent = `Achievement Unlocked: ${achievement.name}!`;
                    notification.classList.add('show');
                    
                    // Hide notification after 3 seconds
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                    
                    // Update progress
                    this.updateProgress(this.gameState.progress + 5);
                }
            }
            
            unlockAchievementIfRelevant(targetId) {
                // Check if expanding a specific info section should unlock an achievement
                switch (targetId) {
                    case 'gravity-info':
                    case 'falling-info':
                        // Progress toward gravity master
                        this.checkGravityMasterProgress();
                        break;
                    case 'orbit-info':
                    case 'escape-velocity':
                        // Progress toward orbit expert
                        this.checkOrbitExpertProgress();
                        break;
                    case 'planet-info':
                    case 'sun-info':
                        // Progress toward solar explorer
                        this.checkSolarExplorerProgress();
                        break;
                    case 'relativity-info':
                    case 'time-info':
                        // Unlock Einstein's apprentice
                        this.unlockAchievement('einstein-apprentice');
                        break;
                }
            }
            
            trackParameterAdjustment(parameterId) {
                // Track which parameters have been adjusted
                if (!this.gameState.adjustedParameters) {
                    this.gameState.adjustedParameters = new Set();
                }
                
                this.gameState.adjustedParameters.add(parameterId);
                
                // Check if all parameters have been adjusted
                const allParameters = ['planet-mass', 'planet-size', 'gravity-strength', 'time-speed', 'launch-speed', 'object-mass'];
                
                if (allParameters.every(param => this.gameState.adjustedParameters.has(param))) {
                    this.unlockAchievement('parameter-tweaker');
                }
            }
            
            updatePlanetWeights() {
                const earthWeight = parseFloat(document.getElementById('earth-weight').value) || 60;
                const planetWeightsContainer = document.getElementById('planet-weights');
                
                if (!planetWeightsContainer) return;
                
                // Clear current content
                planetWeightsContainer.innerHTML = '';
                
                // Planet gravitational factors relative to Earth
                const planets = [
                    { name: "Mercury", factor: 0.38 },
                    { name: "Venus", factor: 0.91 },
                    { name: "Earth", factor: 1.0 },
                    { name: "Mars", factor: 0.38 },
                    { name: "Jupiter", factor: 2.34 },
                    { name: "Saturn", factor: 1.06 },
                    { name: "Uranus", factor: 0.92 },
                    { name: "Neptune", factor: 1.19 }
                ];
                
                // Create weight list
                const weightList = document.createElement('ul');
                weightList.style.listStyleType = 'none';
                weightList.style.padding = '10px';
                
                planets.forEach(planet => {
                    const planetWeight = (earthWeight * planet.factor).toFixed(1);
                    const listItem = document.createElement('li');
                    listItem.textContent = `${planet.name}: ${planetWeight} pounds`;
                    listItem.style.margin = '5px 0';
                    listItem.style.padding = '5px';
                    
                    // Highlight Earth
                    if (planet.name === "Earth") {
                        listItem.style.fontWeight = 'bold';
                    }
                    
                    weightList.appendChild(listItem);
                });
                
                planetWeightsContainer.appendChild(weightList);
                
                // Track for achievement
                if (!this.gameState.checkedPlanetWeights) {
                    this.gameState.checkedPlanetWeights = true;
                    this.unlockAchievement('planet-hopper');
                }
            }
            
            checkGravityMasterProgress() {
                // Logic to check progress toward gravity master achievement
                if (!this.gameState.gravityLearningProgress) {
                    this.gameState.gravityLearningProgress = 0;
                }
                
                this.gameState.gravityLearningProgress++;
                
                if (this.gameState.gravityLearningProgress >= 3) {
                    this.unlockAchievement('gravity-master');
                }
            }
            
            checkOrbitExpertProgress() {
                // Logic to check progress toward orbit expert achievement
                if (!this.gameState.orbitLearningProgress) {
                    this.gameState.orbitLearningProgress = 0;
                }
                
                this.gameState.orbitLearningProgress++;
                
                if (this.gameState.orbitLearningProgress >= 2) {
                    this.unlockAchievement('orbit-expert');
                }
            }
            
            checkSolarExplorerProgress() {
                // Logic to check progress toward solar explorer achievement
                if (!this.gameState.solarLearningProgress) {
                    this.gameState.solarLearningProgress = 0;
                }
                
                this.gameState.solarLearningProgress++;
                
                if (this.gameState.solarLearningProgress >= 2) {
                    this.unlockAchievement('solar-explorer');
                }
            }
            
            // ------- Quiz System ------- //
            
            initializeQuiz() {
                // Set up quiz questions based on difficulty
                const difficultyLevel = this.gameState.difficulty;
                let quizQuestions;
                
                if (difficultyLevel === 0) {
                    quizQuestions = this.quizQuestions.easy;
                } else if (difficultyLevel === 1) {
                    quizQuestions = [...this.quizQuestions.easy, ...this.quizQuestions.medium];
                } else {
                    quizQuestions = [...this.quizQuestions.easy, ...this.quizQuestions.medium, ...this.quizQuestions.advanced];
                }
                
                // Shuffle questions
                this.shuffleArray(quizQuestions);
                
                // Take 10 questions or fewer if not enough
                this.gameState.currentQuizQuestions = quizQuestions.slice(0, 10);
                this.gameState.quizAnswers = new Array(this.gameState.currentQuizQuestions.length).fill(-1);
                this.gameState.currentQuizIndex = 0;
                
                // Update question count
                document.getElementById('total-questions').textContent = this.gameState.currentQuizQuestions.length;
                
                // Display first question
                this.displayQuizQuestion(0);
            }
            
            displayQuizQuestion(index) {
                // Get question data
                const question = this.gameState.currentQuizQuestions[index];
                const quizContainer = document.getElementById('main-quiz-container');
                
// Clear container
quizContainer.innerHTML = '';
                
                // Create question element
                const questionElement = document.createElement('div');
                questionElement.className = 'quiz-question';
                questionElement.textContent = question.question;
                
                // Create options container
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'quiz-options';
                
                // Add options
                question.options.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'quiz-option';
                    optionElement.textContent = option;
                    optionElement.dataset.index = optionIndex;
                    
                    // Check if this option was previously selected
                    if (this.gameState.quizAnswers[index] === optionIndex) {
                        optionElement.classList.add('selected');
                    }
                    
                    // Add click handler
                    optionElement.addEventListener('click', () => this.selectQuizOption(optionElement, index, optionIndex));
                    
                    optionsContainer.appendChild(optionElement);
                });
                
                // Create feedback element
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'quiz-feedback';
                
                // Add elements to container
                quizContainer.appendChild(questionElement);
                quizContainer.appendChild(optionsContainer);
                quizContainer.appendChild(feedbackElement);
                
                // Update current question number
                document.getElementById('current-question').textContent = index + 1;
                
                // Update navigation buttons
                const prevButton = document.getElementById('prev-question-btn');
                const nextButton = document.getElementById('next-question-btn');
                const finishButton = document.getElementById('finish-quiz-btn');
                
                prevButton.classList.toggle('hidden', index === 0);
                nextButton.classList.toggle('hidden', index === this.gameState.currentQuizQuestions.length - 1);
                finishButton.classList.toggle('hidden', index !== this.gameState.currentQuizQuestions.length - 1);
            }
            
            selectQuizOption(optionElement, questionIndex, optionIndex) {
                // Get all options for this question
                const allOptions = optionElement.parentElement.querySelectorAll('.quiz-option');
                
                // Remove selected class from all options
                allOptions.forEach(option => option.classList.remove('selected'));
                
                // Add selected class to clicked option
                optionElement.classList.add('selected');
                
                // Save answer
                this.gameState.quizAnswers[questionIndex] = optionIndex;
                
                // Show feedback
                this.showQuizFeedback(questionIndex, optionIndex);
            }
            
            showQuizFeedback(questionIndex, selectedIndex) {
                const question = this.gameState.currentQuizQuestions[questionIndex];
                const correctIndex = question.correct;
                const feedbackElement = document.querySelector('.quiz-feedback');
                
                if (selectedIndex === correctIndex) {
                    feedbackElement.textContent = 'Correct! üåü';
                    feedbackElement.className = 'quiz-feedback correct';
                } else {
                    feedbackElement.textContent = 'Not quite right. Try again! üöÄ';
                    feedbackElement.className = 'quiz-feedback incorrect';
                }
            }
            
            nextQuizQuestion() {
                if (this.gameState.currentQuizIndex < this.gameState.currentQuizQuestions.length - 1) {
                    this.gameState.currentQuizIndex++;
                    this.displayQuizQuestion(this.gameState.currentQuizIndex);
                }
            }
            
            prevQuizQuestion() {
                if (this.gameState.currentQuizIndex > 0) {
                    this.gameState.currentQuizIndex--;
                    this.displayQuizQuestion(this.gameState.currentQuizIndex);
                }
            }
            
            finishQuiz() {
                // Calculate score
                let correctCount = 0;
                this.gameState.currentQuizQuestions.forEach((question, index) => {
                    if (this.gameState.quizAnswers[index] === question.correct) {
                        correctCount++;
                    }
                });
                
                const totalQuestions = this.gameState.currentQuizQuestions.length;
                const percentageScore = Math.round((correctCount / totalQuestions) * 100);
                
                // Display results
                const quizContainer = document.getElementById('main-quiz-container');
                quizContainer.innerHTML = '';
                
                const resultTitle = document.createElement('h3');
                resultTitle.className = 'screen-title';
                resultTitle.textContent = 'Quiz Results';
                
                const scoreElement = document.createElement('p');
                scoreElement.style.fontSize = '24px';
                scoreElement.style.textAlign = 'center';
                scoreElement.style.margin = '20px 0';
                scoreElement.innerHTML = `You got <strong>${correctCount}</strong> out of <strong>${totalQuestions}</strong> questions correct!`;
                
                const percentElement = document.createElement('p');
                percentElement.style.fontSize = '36px';
                percentElement.style.textAlign = 'center';
                percentElement.style.margin = '30px 0';
                percentElement.innerHTML = `<strong>${percentageScore}%</strong>`;
                
                // Create a visual score representation
                const scoreBar = document.createElement('div');
                scoreBar.style.width = '100%';
                scoreBar.style.height = '30px';
                scoreBar.style.backgroundColor = '#1a2a5a';
                scoreBar.style.borderRadius = '15px';
                scoreBar.style.margin = '20px 0';
                scoreBar.style.position = 'relative';
                scoreBar.style.overflow = 'hidden';
                
                const scoreProgress = document.createElement('div');
                scoreProgress.style.width = `${percentageScore}%`;
                scoreProgress.style.height = '100%';
                scoreProgress.style.backgroundColor = percentageScore >= 70 ? '#4caf50' : percentageScore >= 40 ? '#ff9800' : '#f44336';
                scoreProgress.style.transition = 'width 1s ease-in-out';
                
                scoreBar.appendChild(scoreProgress);
                
                // Feedback based on score
                const feedbackElement = document.createElement('p');
                feedbackElement.style.textAlign = 'center';
                feedbackElement.style.margin = '20px 0';
                
                if (percentageScore >= 90) {
                    feedbackElement.textContent = 'Amazing! You\'re a gravity genius! üåüüöÄ';
                    this.unlockAchievement('quiz-ace');
                } else if (percentageScore >= 70) {
                    feedbackElement.textContent = 'Great job! You\'ve learned a lot about gravity and space! ü™ê';
                } else if (percentageScore >= 50) {
                    feedbackElement.textContent = 'Good effort! Keep exploring to learn more about the cosmos! üåå';
                } else {
                    feedbackElement.textContent = 'Keep learning and try again! Space is full of mysteries to discover! üî≠';
                }
                
                // Add a button to retake the quiz
                const retakeButton = document.createElement('button');
                retakeButton.className = 'nav-button';
                retakeButton.textContent = 'Retake Quiz';
                retakeButton.style.margin = '20px auto';
                retakeButton.style.display = 'block';
                retakeButton.addEventListener('click', () => this.initializeQuiz());
                
                quizContainer.appendChild(resultTitle);
                quizContainer.appendChild(scoreElement);
                quizContainer.appendChild(percentElement);
                quizContainer.appendChild(scoreBar);
                quizContainer.appendChild(feedbackElement);
                quizContainer.appendChild(retakeButton);
                
                // Update game progress
                this.updateProgress(this.gameState.progress + 10);
            }
            
            // ------- Simulation Systems ------- //
            
            setupSandboxSimulation() {
                // Clear existing canvas if it exists
                if (this.p5Instance) {
                    this.p5Instance.remove();
                    this.p5Instance = null;
                }
                
                const canvasContainer = document.getElementById('canvas-container');
                if (!canvasContainer) return;
                
                // Define sketch
                const sketch = (p) => {
                    // Simulation parameters
                    let planetMass = 1000;
                    let planetSize = 30;
                    let gravityStrength = 1.0;
                    let timeSpeed = 1.0;
                    let launchSpeed = 5;
                    let objectMass = 10;
                    let showVectors = true;
                    let realisticPhysics = true;
                    let simulationQuality = 1;
                    
                    // Objects in simulation
                    const planet = {
                        pos: null,
                        mass: planetMass,
                        radius: planetSize
                    };
                    
                    const objects = [];
                    
                    p.setup = function() {
                        // Create canvas to fit container
                        const containerWidth = canvasContainer.clientWidth;
                        const containerHeight = 400;
                        p.createCanvas(containerWidth, containerHeight);
                        
                        // Initialize planet position
                        planet.pos = p.createVector(p.width / 2, p.height / 2);
                    };
                    
                    p.draw = function() {
                        // Clear canvas
                        p.background(10, 10, 42);
                        
                        // Draw stars in background
                        drawStars();
                        
                        // Draw planet
                        drawPlanet();
                        
                        // Update and draw objects
                        updateObjects();
                        
                        // Draw launch trajectory preview
                        drawLaunchPreview();
                    };
                    
                    function drawStars() {
                        p.noStroke();
                        
                        // Number of stars based on quality setting
                        const starCount = simulationQuality === 0 ? 50 : simulationQuality === 1 ? 100 : 200;
                        
                        // Draw a set of fixed stars
                        p.push();
                        for (let i = 0; i < starCount; i++) {
                            const x = (p.sin(i * 3.14159 * 0.1) * 0.5 + 0.5) * p.width;
                            const y = (p.cos(i * 3.14159 * 0.13) * 0.5 + 0.5) * p.height;
                            const brightness = p.map(p.sin(p.frameCount * 0.01 + i), -1, 1, 150, 255);
                            const size = p.map(p.cos(p.frameCount * 0.015 + i), -1, 1, 1, 3);
                            
                            p.fill(brightness);
                            p.ellipse(x, y, size, size);
                        }
                        p.pop();
                    }
                    
                    function drawPlanet() {
                        p.push();
                        
                        // Draw planet glow
                        p.noStroke();
                        for (let i = 5; i > 0; i--) {
                            const alpha = p.map(i, 5, 0, 20, 0);
                            p.fill(58, 134, 255, alpha);
                            p.ellipse(planet.pos.x, planet.pos.y, planet.radius * 2 + i * 10);
                        }
                        
                        // Draw planet
                        p.noStroke();
                        
                        // Create gradient-like effect
                        for (let i = 0; i < planet.radius; i++) {
                            const t = i / planet.radius;
                            const r = p.map(t, 0, 1, 30, 80);
                            const g = p.map(t, 0, 1, 70, 120);
                            const b = p.map(t, 0, 1, 180, 230);
                            p.fill(r, g, b);
                            p.ellipse(planet.pos.x, planet.pos.y, (planet.radius - i) * 2);
                        }
                        
                        // Draw gravitational field visualization if vectors are enabled
                        if (showVectors) {
                            drawGravityField();
                        }
                        
                        p.pop();
                    }
                    
                    function drawGravityField() {
                        p.push();
                        p.stroke(58, 134, 255, 40);
                        p.strokeWeight(1);
                        p.noFill();
                        
                        const fieldResolution = simulationQuality === 0 ? 20 : simulationQuality === 1 ? 30 : 40;
                        const fieldStrength = gravityStrength * 100;
                        
                        for (let i = 0; i < fieldResolution; i++) {
                            p.ellipse(
                                planet.pos.x, 
                                planet.pos.y, 
                                planet.radius * 2 + i * (fieldStrength / fieldResolution)
                            );
                        }
                        p.pop();
                    }
                    
                    function updateObjects() {
                        // Apply time scaling
                        const dt = 0.016 * timeSpeed; // Base on 60fps with time scaling
                        
                        for (let i = objects.length - 1; i >= 0; i--) {
                            const obj = objects[i];
                            
                            // Calculate gravitational force
                            const direction = p5.Vector.sub(planet.pos, obj.pos);
                            const distance = direction.mag();
                            
                            // Check for collision with planet
                            if (distance < planet.radius + obj.radius) {
                                // Collision occurred
                                objects.splice(i, 1);
                                continue;
                            }
                            
                            direction.normalize();
                            
                            // Calculate force using adjusted inverse square law
                            let forceMagnitude;
                            if (realisticPhysics) {
                                // F = G * m1 * m2 / r^2
                                const G = 0.1 * gravityStrength;
                                forceMagnitude = G * planet.mass * obj.mass / (distance * distance);
                            } else {
                                // Simplified force calculation for easier understanding
                                forceMagnitude = (gravityStrength * planet.mass * obj.mass) / (distance * 10);
                            }
                            
                            const force = p5.Vector.mult(direction, forceMagnitude);
                            
                            // F = ma, so a = F/m
                            const acceleration = p5.Vector.div(force, obj.mass);
                            
                            // Update velocity
                            obj.vel.add(p5.Vector.mult(acceleration, dt));
                            
                            // Update position
                            obj.pos.add(p5.Vector.mult(obj.vel, dt));
                            
                            // Draw the object
                            drawObject(obj);
                            
                            // Optional: Remove objects that go far off screen
                            if (obj.pos.x < -100 || obj.pos.x > p.width + 100 || 
                                obj.pos.y < -100 || obj.pos.y > p.height + 100) {
                                objects.splice(i, 1);
                            }
                        }
                    }
                    
                    function drawObject(obj) {
                        p.push();
                        
                        // Draw trail
                        if (obj.trail && obj.trail.length > 1) {
                            p.noFill();
                            p.beginShape();
                            for (let i = 0; i < obj.trail.length; i++) {
                                const point = obj.trail[i];
                                const alpha = p.map(i, 0, obj.trail.length - 1, 0, 200);
                                p.stroke(obj.color[0], obj.color[1], obj.color[2], alpha);
                                p.vertex(point.x, point.y);
                            }
                            p.endShape();
                        }
                        
                        // Update trail
                        if (!obj.trail) obj.trail = [];
                        obj.trail.push(p.createVector(obj.pos.x, obj.pos.y));
                        
                        // Limit trail length based on quality setting
                        const maxTrailLength = simulationQuality === 0 ? 20 : simulationQuality === 1 ? 50 : 100;
                        if (obj.trail.length > maxTrailLength) {
                            obj.trail.shift();
                        }
                        
                        // Draw object
                        p.fill(obj.color[0], obj.color[1], obj.color[2]);
                        p.noStroke();
                        p.ellipse(obj.pos.x, obj.pos.y, obj.radius * 2);
                        
                        // Draw velocity vector if enabled
                        if (showVectors) {
                            p.stroke(obj.color[0], obj.color[1], obj.color[2]);
                            p.strokeWeight(2);
                            const velVector = p5.Vector.mult(obj.vel, 3); // Scale for visibility
                            p.line(obj.pos.x, obj.pos.y, obj.pos.x + velVector.x, obj.pos.y + velVector.y);
                            
                            // Arrow tip
                            const tip = p.createVector(obj.pos.x + velVector.x, obj.pos.y + velVector.y);
                            const angle = velVector.heading();
                            p.push();
                            p.translate(tip.x, tip.y);
                            p.rotate(angle);
                            p.line(0, 0, -10, 5);
                            p.line(0, 0, -10, -5);
                            p.pop();
                        }
                        
                        p.pop();
                    }
                    
                    function drawLaunchPreview() {
                        p.push();
                        
                        // Get mouse position
                        const mousePos = p.createVector(p.mouseX, p.mouseY);
                        
                        // Draw launch direction line
                        p.stroke(255, 255, 255, 100);
                        p.strokeWeight(1);
                        p.line(p.width / 2, p.height - 20, mousePos.x, mousePos.y);
                        
                        // Draw launch point
                        p.noStroke();
                        p.fill(255);
                        p.ellipse(p.width / 2, p.height - 20, 10, 10);
                        
                        p.pop();
                    }
                    
                    // Public functions for external control
                    p.launchObject = function() {
                        // Create launch vector based on mouse position
                        const mousePos = p.createVector(p.mouseX, p.mouseY);
                        const launchPos = p.createVector(p.width / 2, p.height - 20);
                        
                        // Calculate direction and normalize
                        const launchDir = p5.Vector.sub(mousePos, launchPos);
                        launchDir.normalize();
                        
                        // Scale by launch speed
                        const velocity = p5.Vector.mult(launchDir, launchSpeed);
                        
                        // Random color for the object
                        const color = [
                            p.random(150, 255),
                            p.random(150, 255),
                            p.random(150, 255)
                        ];
                        
                        // Create new object
                        const newObject = {
                            pos: p.createVector(launchPos.x, launchPos.y),
                            vel: velocity,
                            mass: objectMass,
                            radius: p.map(objectMass, 1, 100, 3, 15),
                            color: color
                        };
                        
                        objects.push(newObject);
                    };
                    
                    // Update parameters
                    p.updateParameters = function(param, value) {
                        value = parseFloat(value);
                        
                        switch (param) {
                            case 'planet-mass':
                                planetMass = value;
                                planet.mass = value;
                                break;
                            case 'planet-size':
                                planetSize = value;
                                planet.radius = value;
                                break;
                            case 'gravity-strength':
                                gravityStrength = value;
                                break;
                            case 'time-speed':
                                timeSpeed = value;
                                break;
                            case 'launch-speed':
                                launchSpeed = value;
                                break;
                            case 'object-mass':
                                objectMass = value;
                                break;
                        }
                    };
                    
                    // Update quality setting
                    p.updateQuality = function(quality) {
                        simulationQuality = quality;
                    };
                    
                    // Toggle vectors
                    p.toggleVectors = function(show) {
                        showVectors = show;
                    };
                    
                    // Toggle realistic physics
                    p.toggleRealisticPhysics = function(realistic) {
                        realisticPhysics = realistic;
                    };
                    
                    // Resize handler
                    p.windowResized = function() {
                        const containerWidth = canvasContainer.clientWidth;
                        p.resizeCanvas(containerWidth, 400);
                        planet.pos = p.createVector(p.width / 2, p.height / 2);
                    };
                };
                
                // Create the p5 instance
                this.p5Instance = new p5(sketch, canvasContainer);
            }
            
            setupGravityDemoSimulation() {
                const gravityDemoContainer = document.getElementById('gravity-demo-container');
                if (!gravityDemoContainer) return;
                
                // Clear existing content
                gravityDemoContainer.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = gravityDemoContainer.clientWidth;
                demoCanvas.height = 200;
                gravityDemoContainer.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Simple animation showing gravity force
                const animate = () => {
                    // Clear canvas
                    ctx.clearRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Earth
                    const earthRadius = 70;
                    const earthX = demoCanvas.width / 2;
                    const earthY = demoCanvas.height / 2;
                    
                    // Gradient for Earth
                    const earthGradient = ctx.createRadialGradient(
                        earthX, earthY, 0,
                        earthX, earthY, earthRadius
                    );
                    earthGradient.addColorStop(0, '#3a8aff');
                    earthGradient.addColorStop(1, '#1c3d91');
                    
                    // Draw Earth
                    ctx.beginPath();
                    ctx.arc(earthX, earthY, earthRadius, 0, Math.PI * 2);
                    ctx.fillStyle = earthGradient;
                    ctx.fill();
                    
                    // Draw gravity field lines
                    const time = Date.now() * 0.001;
                    
                    ctx.save();
                    for (let i = 0; i < 5; i++) {
                        const radius = earthRadius + 15 + i * 15;
                        const alpha = 0.3 - i * 0.05;
                        
                        ctx.beginPath();
                        ctx.arc(earthX, earthY, radius, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(58, 138, 255, ${alpha})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                    
                    // Draw pulsing gravity waves
                    for (let i = 0; i < 3; i++) {
                        const waveRadius = ((time * 30) % 120) + earthRadius + i * 40;
                        const waveAlpha = Math.max(0, 0.5 - waveRadius / 200);
                        
                        ctx.beginPath();
                        ctx.arc(earthX, earthY, waveRadius, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(58, 138, 255, ${waveAlpha})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                    ctx.restore();
                    
                    // Draw small objects affected by gravity
                    const numObjects = 5;
                    for (let i = 0; i < numObjects; i++) {
                        const angle = (time * 0.5 + i * (Math.PI * 2 / numObjects)) % (Math.PI * 2);
                        
                        // Calculate orbit distance (each object in different orbit)
                        const orbitRadius = earthRadius + 30 + i * 15;
                        
                        // Calculate position
                        const objX = earthX + Math.cos(angle) * orbitRadius;
                        const objY = earthY + Math.sin(angle) * orbitRadius;
                        
                        // Draw object
                        ctx.beginPath();
                        ctx.arc(objX, objY, 5, 0, Math.PI * 2);
                        ctx.fillStyle = `hsl(${i * 60}, 80%, 70%)`;
                        ctx.fill();
                        
                        // Draw orbit path
                        ctx.beginPath();
                        ctx.arc(earthX, earthY, orbitRadius, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(255, 255, 255, 0.1)`;
                        ctx.stroke();
                        
                        // Draw force vector
                        const forceAngle = Math.atan2(earthY - objY, earthX - objX);
                        const forceLength = 15;
                        
                        ctx.beginPath();
                        ctx.moveTo(objX, objY);
                        ctx.lineTo(
                            objX + Math.cos(forceAngle) * forceLength,
                            objY + Math.sin(forceAngle) * forceLength
                        );
                        ctx.strokeStyle = `rgba(255, 255, 255, 0.6)`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                    
                    requestAnimationFrame(animate);
                };
                
                animate();
            }
            
            runFallingObjectsDemo(isVacuum) {
                const containerElement = document.getElementById('falling-objects-container');
                if (!containerElement) return;
                
                // Clear existing content
                containerElement.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = containerElement.clientWidth;
                demoCanvas.height = 300;
                containerElement.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Objects to drop
                const objects = [
                    { name: 'Bowling Ball', mass: 7, radius: 15, color: '#3a3a3a', x: demoCanvas.width * 0.3, y: 50, vy: 0 },
                    { name: 'Feather', mass: 0.01, radius: 8, color: '#f8f8f8', x: demoCanvas.width * 0.7, y: 50, vy: 0 }
                ];
                
                // Ground level
                const groundY = demoCanvas.height - 50;
                
                // Animation variables
                let animationId;
                let startTime = null;
                let dropComplete = false;
                
                const animate = (timestamp) => {
                    if (!startTime) startTime = timestamp;
                    const elapsed = timestamp - startTime;
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Draw sky background
                    const gradient = ctx.createLinearGradient(0, 0, 0, groundY);
                    gradient.addColorStop(0, '#1a1a4a');
                    gradient.addColorStop(1, '#3a3a7a');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, demoCanvas.width, groundY);
                    
                    // Draw ground
                    ctx.fillStyle = '#3a2a1a';
                    ctx.fillRect(0, groundY, demoCanvas.width, demoCanvas.height - groundY);
                    
                    // Title
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '18px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(isVacuum ? 'In Vacuum (No Air Resistance)' : 'On Earth (With Air Resistance)', demoCanvas.width / 2, 30);
                    
                    // Update and draw objects
                    let allLanded = true;
                    
                    objects.forEach(obj => {
                        if (obj.y + obj.radius < groundY) {
                            allLanded = false;
                            
                            // Apply gravity
                            const gravity = 0.2;
                            obj.vy += gravity;
                            
                            // Apply air resistance if not in vacuum
                            if (!isVacuum) {
                                const airResistance = 0.01 * obj.vy * obj.vy * (obj.radius / obj.mass);
                                obj.vy -= airResistance;
                            }
                            
                            // Update position
                            obj.y += obj.vy;
                            
                            // Stop at ground level
                            if (obj.y + obj.radius > groundY) {
                                obj.y = groundY - obj.radius;
                                obj.vy = 0;
                            }
                        }
                        
                        // Draw object
                        ctx.beginPath();
                        ctx.arc(obj.x, obj.y, obj.radius, 0, Math.PI * 2);
                        ctx.fillStyle = obj.color;
                        ctx.fill();
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        
                        // Draw label
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '14px Arial, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(obj.name, obj.x, obj.y - obj.radius - 5);
                    });
                    
                    // Draw timer
                    const seconds = (elapsed / 1000).toFixed(1);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '16px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(`Time: ${seconds}s`, demoCanvas.width / 2, demoCanvas.height - 20);
                    
                    // Check if demonstration is complete
                    if (allLanded && !dropComplete) {
                        dropComplete = true;
                        
                        // Display result message
                        if (isVacuum) {
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                            ctx.fillRect(demoCanvas.width / 2 - 200, demoCanvas.height / 2 - 40, 400, 80);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = 'bold 18px Arial, sans-serif';
                            ctx.fillText('Both objects fell at the same speed!', demoCanvas.width / 2, demoCanvas.height / 2);
                            ctx.font = '14px Arial, sans-serif';
                            ctx.fillText('This proves that gravity accelerates all objects equally', demoCanvas.width / 2, demoCanvas.height / 2 + 25);
                        } else {
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                            ctx.fillRect(demoCanvas.width / 2 - 200, demoCanvas.height / 2 - 40, 400, 80);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = 'bold 18px Arial, sans-serif';
                            ctx.fillText('The bowling ball fell faster due to air resistance!', demoCanvas.width / 2, demoCanvas.height / 2);
                            ctx.font = '14px Arial, sans-serif';
                            ctx.fillText('Air pushes back more on the light feather', demoCanvas.width / 2, demoCanvas.height / 2 + 25);
                        }
                        
                        // Stop animation after showing result for a few seconds
                        setTimeout(() => {
                            cancelAnimationFrame(animationId);
                        }, 5000);
                    } else if (!dropComplete) {
                        animationId = requestAnimationFrame(animate);
                    }
                };
                
                animationId = requestAnimationFrame(animate);
                
                // Count experiment for achievement tracking
                this.gameState.experimentCount = (this.gameState.experimentCount || 0) + 1;
                if (this.gameState.experimentCount >= 3) {
                    this.checkGravityMasterProgress();
                }
            }
            
            setupOrbitDemoSimulation() {
                const orbitContainer = document.getElementById('orbit-demo-container');
                if (!orbitContainer) return;
                
                // Clear existing content
                orbitContainer.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = orbitContainer.clientWidth;
                demoCanvas.height = 300;
                orbitContainer.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Placeholder static orbit diagram
                ctx.fillStyle = '#1a1a4a';
                ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                
                // Draw sun
                const sunX = demoCanvas.width / 2;
                const sunY = demoCanvas.height / 2;
                const sunRadius = 30;
                
                const sunGradient = ctx.createRadialGradient(
                    sunX, sunY, 0,
                    sunX, sunY, sunRadius
                );
                sunGradient.addColorStop(0, '#ffdd00');
                sunGradient.addColorStop(1, '#ff8800');
                
                ctx.beginPath();
                ctx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
                ctx.fillStyle = sunGradient;
                ctx.fill();
                
                // Draw orbit paths
                const orbits = [
                    { radius: 70, color: '#3a3a3a' },
                    { radius: 100, color: '#ff9d5c' },
                    { radius: 130, color: '#80a0ff' }
                ];
                
                orbits.forEach(orbit => {
                    ctx.beginPath();
                    ctx.arc(sunX, sunY, orbit.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = orbit.color;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });
                
                // Text instructions
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Click "Start Orbit Demo" to animate', demoCanvas.width / 2, 30);
            }
            
            runOrbitDemo() {
                const orbitContainer = document.getElementById('orbit-demo-container');
                if (!orbitContainer) return;
                
                // Clear existing content
                orbitContainer.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = orbitContainer.clientWidth;
                demoCanvas.height = 300;
                orbitContainer.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Sun properties
                const sun = {
                    x: demoCanvas.width / 2,
                    y: demoCanvas.height / 2,
                    radius: 30,
                    mass: 1000
                };
                
                // Planets
                const planets = [
                    { name: 'Mercury', radius: 8, color: '#999999', distance: 70, speed: 0.02, angle: 0 },
                    { name: 'Venus', radius: 12, color: '#ff9d5c', distance: 100, speed: 0.015, angle: Math.PI / 2 },
                    { name: 'Earth', radius: 12, color: '#80a0ff', distance: 130, speed: 0.01, angle: Math.PI }
                ];
                
                // Animation function
                const animate = () => {
                    // Clear canvas
                    ctx.fillStyle = '#1a1a4a';
                    ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Draw stars in background
                    for (let i = 0; i < 100; i++) {
                        const x = Math.random() * demoCanvas.width;
                        const y = Math.random() * demoCanvas.height;
                        const size = Math.random() * 2 + 1;
                        
                        ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.5})`;
                        ctx.fillRect(x, y, size, size);
                    }
                    
                    // Draw sun
                    const sunGradient = ctx.createRadialGradient(
                        sun.x, sun.y, 0,
                        sun.x, sun.y, sun.radius
                    );
                    sunGradient.addColorStop(0, '#ffdd00');
                    sunGradient.addColorStop(1, '#ff8800');
                    
                    ctx.beginPath();
                    ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI * 2);
                    ctx.fillStyle = sunGradient;
                    ctx.fill();
                    
                    // Draw sun glow
                    for (let i = 1; i <= 5; i++) {
                        ctx.beginPath();
                        ctx.arc(sun.x, sun.y, sun.radius + i * 3, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 200, 0, ${0.1 - i * 0.015})`;
                        ctx.fill();
                    }
                    
                    // Draw orbit paths
                    planets.forEach(planet => {
                        ctx.beginPath();
                        ctx.arc(sun.x, sun.y, planet.distance, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(255, 255, 255, 0.2)`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    });
                    
                    // Update and draw planets
                    planets.forEach(planet => {
                        // Update angle based on speed
                        planet.angle += planet.speed;
                        
                        // Calculate position
                        const x = sun.x + Math.cos(planet.angle) * planet.distance;
                        const y = sun.y + Math.sin(planet.angle) * planet.distance;
                        
                        // Draw planet
                        ctx.beginPath();
                        ctx.arc(x, y, planet.radius, 0, Math.PI * 2);
                        ctx.fillStyle = planet.color;
                        ctx.fill();
                        
                        // Draw gravity lines
                        ctx.beginPath();
                        ctx.moveTo(sun.x, sun.y);
                        ctx.lineTo(x, y);
                        ctx.strokeStyle = `rgba(255, 255, 255, 0.1)`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        
                        // Draw planet label
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '12px Arial, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(planet.name, x, y - planet.radius - 5);
                    });
                    
                    // Draw explanation text
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(10, demoCanvas.height - 60, 300, 50);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('Planets closer to the Sun:', 20, demoCanvas.height - 40);
                    ctx.fillText('‚Ä¢ Orbit faster', 20, demoCanvas.height - 20);
                    
                    requestAnimationFrame(animate);
                };
                
                // Start animation
                animate();
                
                // Unlock related achievement
                this.checkOrbitExpertProgress();
            }
            
            runInteractiveOrbitDemo() {
                const containerElement = document.getElementById('orbit-explanation-container');
                if (!containerElement) return;
                
                // Clear existing content
                containerElement.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = containerElement.clientWidth;
                demoCanvas.height = 300;
                containerElement.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Speed control
                const speedControl = document.createElement('div');
                speedControl.style.width = '100%';
                speedControl.style.marginTop = '15px';
                speedControl.style.display = 'flex';
                speedControl.style.alignItems = 'center';
                
                const speedLabel = document.createElement('span');
                speedLabel.textContent = 'Launch Speed: ';
                speedLabel.style.marginRight = '10px';
                speedLabel.style.color = '#fff';
                
                const speedSlider = document.createElement('input');
                speedSlider.type = 'range';
                speedSlider.min = '1';
                speedSlider.max = '10';
                speedSlider.value = '5';
                speedSlider.className = 'slider';
                speedSlider.style.flex = '1';
                
                const speedValue = document.createElement('span');
                speedValue.textContent = '5';
                speedValue.style.marginLeft = '10px';
                speedValue.style.color = '#fff';
                
                speedControl.appendChild(speedLabel);
                speedControl.appendChild(speedSlider);
                speedControl.appendChild(speedValue);
                
                containerElement.appendChild(speedControl);
                
                // Launch button
                const launchButton = document.createElement('button');
                launchButton.textContent = 'Launch Satellite';
                launchButton.className = 'nav-button';
                launchButton.style.marginTop = '10px';
                launchButton.style.width = '150px';
                launchButton.style.marginLeft = 'auto';
                launchButton.style.marginRight = 'auto';
                launchButton.style.display = 'block';
                
                containerElement.appendChild(launchButton);
                
                // Planet properties
                const planet = {
                    x: demoCanvas.width / 2,
                    y: demoCanvas.height / 2,
                    radius: 40,
                    mass: 1000
                };
                
                // Satellites
                const satellites = [];
                
                // Animation function
                let animationId;
                
                const animate = () => {
                    // Clear canvas
                    ctx.fillStyle = '#1a1a4a';
                    ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Draw planet
                    const planetGradient = ctx.createRadialGradient(
                        planet.x, planet.y, 0,
                        planet.x, planet.y, planet.radius
                    );
                    planetGradient.addColorStop(0, '#3a8aff');
                    planetGradient.addColorStop(1, '#1c3d91');
                    
                    ctx.beginPath();
                    ctx.arc(planet.x, planet.y, planet.radius, 0, Math.PI * 2);
                    ctx.fillStyle = planetGradient;
                    ctx.fill();
                    
                    // Draw gravity indicator
                    for (let i = 1; i <= 5; i++) {
                        ctx.beginPath();
                        ctx.arc(planet.x, planet.y, planet.radius + i * 15, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(58, 138, 255, ${0.2 - i * 0.03})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                    
                    // Update and draw satellites
                    for (let i = satellites.length - 1; i >= 0; i--) {
                        const sat = satellites[i];
                        
                        // Calculate gravitational force
                        const dx = planet.x - sat.x;
                        const dy = planet.y - sat.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // Check for collision with planet
                        if (distance < planet.radius + sat.radius) {
                            // Collision - show crash message
                            ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                            ctx.fillRect(planet.x - 100, planet.y - 60, 200, 40);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '16px Arial, sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('Satellite Crashed!', planet.x, planet.y - 30);
                            
                            // Remove satellite
                            satellites.splice(i, 1);
                            continue;
                        }
                        
                        // Check if satellite escaped
                        if (distance > demoCanvas.width * 1.5) {
                            // Escape - show message
                            ctx.fillStyle = 'rgba(0, 255, 0, 0.7)';
                            ctx.fillRect(planet.x - 100, planet.y - 60, 200, 40);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '16px Arial, sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('Satellite Escaped!', planet.x, planet.y - 30);
                            
                            // Remove satellite
                            satellites.splice(i, 1);
                            continue;
                        }
                        
                        // Calculate force
                        const G = 0.1; // Gravitational constant
                        const force = G * planet.mass * sat.mass / (distance * distance);
                        
                        // Calculate force components
                        const angle = Math.atan2(dy, dx);
                        const forceX = Math.cos(angle) * force;
                        const forceY = Math.sin(angle) * force;
                        
                        // Calculate acceleration (F = ma, so a = F/m)
                        const accX = forceX / sat.mass;
                        const accY = forceY / sat.mass;
                        
                        // Update velocity
                        sat.vx += accX;
                        sat.vy += accY;
                        
                        // Update position
                        sat.x += sat.vx;
                        sat.y += sat.vy;
                        
                        // Add to trail
                        if (sat.trail.length >= 50) {
                            sat.trail.shift();
                        }
                        sat.trail.push({ x: sat.x, y: sat.y });
                        
                        // Draw trail
                        if (sat.trail.length > 1) {
                            ctx.beginPath();
                            ctx.moveTo(sat.trail[0].x, sat.trail[0].y);
                            
                            for (let j = 1; j < sat.trail.length; j++) {
                                ctx.lineTo(sat.trail[j].x, sat.trail[j].y);
                            }
                            
                            ctx.strokeStyle = `rgba(255, 255, 255, 0.5)`;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                        
                        // Draw satellite
                        ctx.beginPath();
                        ctx.arc(sat.x, sat.y, sat.radius, 0, Math.PI * 2);
                        ctx.fillStyle = sat.color;
                        ctx.fill();
                        
                        // Determine satellite status
                        const speed = Math.sqrt(sat.vx * sat.vx + sat.vy * sat.vy);
                        const escapeVelocity = Math.sqrt(2 * G * planet.mass / distance);
                        
                        let status;
                        if (speed > escapeVelocity * 1.1) {
                            status = 'Escape Trajectory';
                        } else if (speed < escapeVelocity * 0.9) {
                            status = 'Elliptical Orbit';
                        } else {
                            status = 'Circular Orbit';
                        }
                        
                        // Draw status
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '12px Arial, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(status, sat.x, sat.y - sat.radius - 5);
                    }
                    
                    // Show launch instruction if no satellites
                    if (satellites.length === 0) {
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '16px Arial, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('Adjust the speed and click "Launch Satellite"', demoCanvas.width / 2, 30);
                    }
                    
                    animationId = requestAnimationFrame(animate);
                };
                
                // Start animation
                animationId = requestAnimationFrame(animate);
                
                // Speed slider event
                speedSlider.addEventListener('input', () => {
                    speedValue.textContent = speedSlider.value;
                });
                
                // Launch button event
                launchButton.addEventListener('click', () => {
                    const speed = parseFloat(speedSlider.value);
                    
                    // Calculate position and velocity
                    const launchX = 50;
                    const launchY = demoCanvas.height / 2;
                    
                    // Create new satellite
                    const newSat = {
                        x: launchX,
                        y: launchY,
                        vx: 0,
                        vy: -speed / 2, // Initial velocity upward
                        radius: 5,
                        mass: 1,
                        color: `hsl(${Math.random() * 360}, 80%, 70%)`,
                        trail: []
                    };
                    
                    satellites.push(newSat);
                    
                    // Show explanation based on speed
                    const escapeVelocity = Math.sqrt(2 * 0.1 * planet.mass / (planet.radius + 100));
                    let explanation;
                    
                    if (speed < escapeVelocity * 0.7) {
                        explanation = 'Speed too low - will crash into planet';
                    } else if (speed > escapeVelocity * 1.3) {
                        explanation = 'Speed too high - will escape planet\'s gravity';
                    } else {
                        explanation = 'Good speed for orbiting';
                    }
                    
                    // Create explanation element
                    const explanationDiv = document.createElement('div');
                    explanationDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    explanationDiv.style.padding = '10px';
                    explanationDiv.style.borderRadius = '5px';
                    explanationDiv.style.color = '#fff';
                    explanationDiv.style.marginTop = '10px';
                    explanationDiv.textContent = explanation;
                    
                    // Replace any existing explanation
                    const existingExplanation = containerElement.querySelector('.explanation');
                    if (existingExplanation) {
                        containerElement.removeChild(existingExplanation);
                    }
                    
                    explanationDiv.className = 'explanation';
                    containerElement.appendChild(explanationDiv);
                });
                
                // Unlock related achievement
                this.checkOrbitExpertProgress();
            }
            
            setupSolarSystemSimulation() {
                const solarSystemContainer = document.getElementById('solar-system-container');
                if (!solarSystemContainer) return;
                
                // Clear existing content
                solarSystemContainer.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = solarSystemContainer.clientWidth;
                demoCanvas.height = 300;
                solarSystemContainer.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Draw solar system placeholder
                ctx.fillStyle = '#1a1a4a';
                ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                
                // Draw sun
                const sunX = 80;
                const sunY = demoCanvas.height / 2;
                const sunRadius = 40;
                
                const sunGradient = ctx.createRadialGradient(
                    sunX, sunY, 0,
                    sunX, sunY, sunRadius
                );
                sunGradient.addColorStop(0, '#ffff00');
                sunGradient.addColorStop(1, '#ff8800');
                
                ctx.beginPath();
                ctx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
                ctx.fillStyle = sunGradient;
                ctx.fill();
                
                // Draw planets (simplified, not to scale)
                const planets = [
                    { name: 'Mercury', radius: 5, color: '#aaa9ad', distance: 70 },
                    { name: 'Venus', radius: 8, color: '#e7cdcd', distance: 100 },
                    { name: 'Earth', radius: 9, color: '#1d7bbd', distance: 135 },
                    { name: 'Mars', radius: 7, color: '#c1440e', distance: 165 },
                    { name: 'Jupiter', radius: 20, color: '#d8ca9d', distance: 215 },
                    { name: 'Saturn', radius: 17, color: '#ead6b8', distance: 270 },
                    { name: 'Uranus', radius: 12, color: '#baefef', distance: 320 },
                    { name: 'Neptune', radius: 12, color: '#3333ff', distance: 360 }
                ];
                
                planets.forEach(planet => {
                    const planetX = sunX + planet.distance;
                    
                    // Draw orbit line
                    ctx.beginPath();
                    ctx.ellipse(sunX, sunY, planet.distance, planet.distance / 3, 0, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.stroke();
                    
                    // Draw planet
                    ctx.beginPath();
                    ctx.arc(planetX, sunY, planet.radius, 0, Math.PI * 2);
                    ctx.fillStyle = planet.color;
                    ctx.fill();
                    
                    // Add label
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(planet.name, planetX, sunY + planet.radius + 15);
                });
                
                // Draw instruction
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Click "Explore Planets" to learn more', demoCanvas.width / 2, 30);
            }
            
            exploreSolarSystem() {
                const containerElement = document.getElementById('solar-system-container');
                if (!containerElement) return;
                
                // Create tabbed interface for planets
                containerElement.innerHTML = '';
                
                // Create planet selector
                const planetSelector = document.createElement('div');
                planetSelector.style.display = 'flex';
                planetSelector.style.justifyContent = 'center';
                planetSelector.style.margin = '10px 0';
                planetSelector.style.flexWrap = 'wrap';
                planetSelector.style.gap = '5px';
                
                const planets = [
                    { id: 'mercury', name: 'Mercury', color: '#aaa9ad', gravity: 0.38, temp: '430¬∞C to -180¬∞C', facts: ['Smallest planet', 'Closest to the Sun', 'No atmosphere', 'Day is longer than year'] },
                    { id: 'venus', name: 'Venus', color: '#e7cdcd', gravity: 0.91, temp: '471¬∞C', facts: ['Similar size to Earth', 'Hottest planet', 'Spins backwards', 'Thick toxic atmosphere'] },
                    { id: 'earth', name: 'Earth', color: '#1d7bbd', gravity: 1.0, temp: '15¬∞C', facts: ['Our home planet', 'Only known planet with life', '71% covered in water', 'Has one natural satellite (the Moon)'] },
                    { id: 'mars', name: 'Mars', color: '#c1440e', gravity: 0.38, temp: '-65¬∞C', facts: ['Known as the Red Planet', 'Has the largest volcano in the solar system', 'Has polar ice caps', 'Two small moons'] },
                    { id: 'jupiter', name: 'Jupiter', color: '#d8ca9d', gravity: 2.34, temp: '-145¬∞C', facts: ['Largest planet', 'Great Red Spot is a storm larger than Earth', 'Has at least 79 moons', 'A gas giant with no solid surface'] },
                    { id: 'saturn', name: 'Saturn', color: '#ead6b8', gravity: 1.06, temp: '-178¬∞C', facts: ['Famous for its beautiful rings', 'Second largest planet', 'Less dense than water (would float)', 'Has at least 82 moons'] },
                    { id: 'uranus', name: 'Uranus', color: '#baefef', gravity: 0.92, temp: '-224¬∞C', facts: ['Rotates on its side', 'Blue-green color from methane', 'Has 13 known rings', 'Has 27 known moons'] },
                    { id: 'neptune', name: 'Neptune', color: '#3333ff', gravity: 1.19, temp: '-214¬∞C', facts: ['Most distant planet', 'Windiest planet (winds up to 2,100 km/h)', 'Has 14 known moons', 'Discovered through mathematical predictions'] }
                ];
                
                planets.forEach((planet, index) => {
                    const planetButton = document.createElement('div');
                    planetButton.className = 'planet-button';
                    planetButton.style.width = '60px';
                    planetButton.style.height = '60px';
                    planetButton.style.borderRadius = '50%';
                    planetButton.style.backgroundColor = planet.color;
                    planetButton.style.display = 'flex';
                    planetButton.style.flexDirection = 'column';
                    planetButton.style.justifyContent = 'center';
                    planetButton.style.alignItems = 'center';
                    planetButton.style.cursor = 'pointer';
                    planetButton.style.position = 'relative';
                    planetButton.style.transition = 'transform 0.3s ease';
                    
                    // Add hover effect
                    planetButton.onmouseover = () => {
                        planetButton.style.transform = 'scale(1.1)';
                    };
                    planetButton.onmouseout = () => {
                        planetButton.style.transform = 'scale(1)';
                    };
                    
                    // Add planet name
                    const nameLabel = document.createElement('div');
                    nameLabel.style.position = 'absolute';
                    nameLabel.style.bottom = '-20px';
                    nameLabel.style.width = '100%';
                    nameLabel.style.textAlign = 'center';
                    nameLabel.style.color = '#fff';
                    nameLabel.style.fontSize = '12px';
                    nameLabel.textContent = planet.name;
                    
                    planetButton.appendChild(nameLabel);
                    
                    // Add click handler
                    planetButton.addEventListener('click', () => {
                        showPlanetInfo(planet);
                        
                        // Highlight selected planet
                        document.querySelectorAll('.planet-button').forEach(button => {
                            button.style.border = 'none';
                        });
                        planetButton.style.border = '2px solid #fff';
                    });
                    
                    planetSelector.appendChild(planetButton);
                });
                
                // Create planet info panel
                const planetInfo = document.createElement('div');
                planetInfo.className = 'planet-info';
                planetInfo.style.marginTop = '30px';
                planetInfo.style.backgroundColor = 'rgba(20, 30, 70, 0.7)';
                planetInfo.style.borderRadius = '10px';
                planetInfo.style.padding = '20px';
                
                containerElement.appendChild(planetSelector);
                containerElement.appendChild(planetInfo);
                
                // Function to display planet information
                function showPlanetInfo(planet) {
                    planetInfo.innerHTML = '';
                    
                    // Create planet visualization
                    const planetVisual = document.createElement('div');
                    planetVisual.style.display = 'flex';
                    planetVisual.style.alignItems = 'center';
                    planetVisual.style.marginBottom = '20px';
                    
                    // Planet circle
                    const planetCircle = document.createElement('div');
                    planetCircle.style.width = '80px';
                    planetCircle.style.height = '80px';
                    planetCircle.style.borderRadius = '50%';
                    planetCircle.style.backgroundColor = planet.color;
                    planetCircle.style.marginRight = '20px';
                    planetCircle.style.boxShadow = '0 0 20px rgba(255, 255, 255, 0.3)';
                    
                    // Planet name and gravity
                    const planetDetails = document.createElement('div');
                    
                    const nameElement = document.createElement('h3');
                    nameElement.style.margin = '0 0 10px 0';
                    nameElement.style.color = '#fff';
                    nameElement.textContent = planet.name;
                    
                    const gravityElement = document.createElement('div');
                    gravityElement.textContent = `Gravity: ${planet.gravity} √ó Earth's gravity`;
                    gravityElement.style.marginBottom = '5px';
                    
                    const tempElement = document.createElement('div');
                    tempElement.textContent = `Temperature: ${planet.temp}`;
                    
                    planetDetails.appendChild(nameElement);
                    planetDetails.appendChild(gravityElement);
                    planetDetails.appendChild(tempElement);
                    
                    planetVisual.appendChild(planetCircle);
                    planetVisual.appendChild(planetDetails);
                    
                    // Create facts list
                    const factsList = document.createElement('div');
                    factsList.style.marginTop = '20px';
                    
                    const factsTitle = document.createElement('h4');
                    factsTitle.style.margin = '0 0 10px 0';
                    factsTitle.style.color = '#a3e4ff';
                    factsTitle.textContent = 'Interesting Facts';
                    
                    const factsUl = document.createElement('ul');
                    factsUl.style.paddingLeft = '20px';
                    factsUl.style.margin = '0';
                    
                    planet.facts.forEach(fact => {
                        const li = document.createElement('li');
                        li.textContent = fact;
                        li.style.marginBottom = '5px';
                        factsUl.appendChild(li);
                    });
                    
                    factsList.appendChild(factsTitle);
                    factsList.appendChild(factsUl);
                    
                    // Add weight comparison
                    const weightComparison = document.createElement('div');
                    weightComparison.style.marginTop = '20px';
                    weightComparison.style.backgroundColor = 'rgba(30, 40, 80, 0.7)';
                    weightComparison.style.padding = '15px';
                    weightComparison.style.borderRadius = '10px';
                    
                    const weightTitle = document.createElement('h4');
                    weightTitle.style.margin = '0 0 10px 0';
                    weightTitle.style.color = '#a3e4ff';
                    weightTitle.textContent = 'Weight Comparison';
                    
                    const weightText = document.createElement('p');
                    const earthWeight = document.getElementById('earth-weight') ? document.getElementById('earth-weight').value : '60';
                    const planetWeight = (earthWeight * planet.gravity).toFixed(1);
                    weightText.innerHTML = `If you weigh <strong>${earthWeight}</strong> pounds on Earth, you would weigh <strong>${planetWeight}</strong> pounds on ${planet.name}.`;
                    
                    weightComparison.appendChild(weightTitle);
                    weightComparison.appendChild(weightText);
                    
                    // Add all elements to the info panel
                    planetInfo.appendChild(planetVisual);
                    planetInfo.appendChild(factsList);
                    planetInfo.appendChild(weightComparison);
                }
                
                // Show first planet by default
                showPlanetInfo(planets[0]);
                document.querySelector('.planet-button').style.border = '2px solid #fff';
                
                // Mark solar system explored for achievement
                this.checkSolarExplorerProgress();
            }
            
            setupSpacetimeSimulation() {
                const spacetimeContainer = document.getElementById('spacetime-container');
                if (!spacetimeContainer) return;
                
                // Clear existing content
                spacetimeContainer.innerHTML = '';
                
                // Add placeholder for visualization
                const placeholderDiv = document.createElement('div');
                placeholderDiv.style.width = '100%';
                placeholderDiv.style.height = '250px';
                placeholderDiv.style.backgroundColor = '#1a1a4a';
                placeholderDiv.style.borderRadius = '10px';
                placeholderDiv.style.display = 'flex';
                placeholderDiv.style.justifyContent = 'center';
                placeholderDiv.style.alignItems = 'center';
                placeholderDiv.style.color = '#fff';
                placeholderDiv.style.fontSize = '16px';
                placeholderDiv.textContent = 'Click "Show Spacetime Bending" to visualize how mass curves space';
                
                spacetimeContainer.appendChild(placeholderDiv);
            }
            
            showSpacetimeBending() {
                const containerElement = document.getElementById('spacetime-container');
                if (!containerElement) return;
                
                // Clear existing content
                containerElement.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = containerElement.clientWidth;
                demoCanvas.height = 300;
                containerElement.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Objects with different masses
                const objects = [
                    { name: 'Sun', x: demoCanvas.width / 2, y: demoCanvas.height / 2, mass: 100, radius: 30, color: '#ffdd00' },
                    { name: 'Earth', x: demoCanvas.width * 0.2, y: demoCanvas.height / 2, mass: 20, radius: 15, color: '#3a8aff' }
                ];
                
                // Grid properties
                const gridSize = 20;
                const gridRows = Math.ceil(demoCanvas.height / gridSize);
                const gridCols = Math.ceil(demoCanvas.width / gridSize);
                
                // Animation function
                const animate = () => {
                    // Clear canvas
                    ctx.fillStyle = '#1a1a4a';
                    ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Draw grid representing spacetime
                    drawSpacetimeGrid();
                    
                    // Draw objects
                    objects.forEach(obj => {
                        drawObject(obj);
                    });
                    
                    // Draw explanation text
                    drawExplanation();
                    
                    requestAnimationFrame(animate);
                };
                
                function drawSpacetimeGrid() {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    
                    // Draw distorted grid
                    for (let y = 0; y < gridRows; y++) {
                        ctx.beginPath();
                        
                        for (let x = 0; x < gridCols; x++) {
                            const px = x * gridSize;
                            const py = y * gridSize;
                            
                            // Calculate spacetime distortion for this point
                            const distortedPoint = calculateDistortion(px, py);
                            
                            if (x === 0) {
                                ctx.moveTo(distortedPoint.x, distortedPoint.y);
                            } else {
                                ctx.lineTo(distortedPoint.x, distortedPoint.y);
                            }
                        }
                        
                        ctx.stroke();
                    }
                    
                    // Vertical lines
                    for (let x = 0; x < gridCols; x++) {
                        ctx.beginPath();
                        
                        for (let y = 0; y < gridRows; y++) {
                            const px = x * gridSize;
                            const py = y * gridSize;
                            
                            // Calculate spacetime distortion for this point
                            const distortedPoint = calculateDistortion(px, py);
                            
                            if (y === 0) {
                                ctx.moveTo(distortedPoint.x, distortedPoint.y);
                            } else {
                                ctx.lineTo(distortedPoint.x, distortedPoint.y);
                            }
                        }
                        
                        ctx.stroke();
                    }
                }
                
                function calculateDistortion(x, y) {
                    let distX = x;
                    let distY = y;
                    
                    // Apply distortion based on each object's mass
                    objects.forEach(obj => {
                        const dx = x - obj.x;
                        const dy = y - obj.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < obj.radius) {
                            // Inside object, no additional distortion
                            return;
                        }
                        
                        // Calculate distortion factor based on mass and distance
                        const distortionFactor = obj.mass / (distance * 3);
                        
                        // Apply distortion
                        const angle = Math.atan2(dy, dx);
                        distX -= Math.cos(angle) * distortionFactor;
                        distY -= Math.sin(angle) * distortionFactor;
                    });
                    
                    return { x: distX, y: distY };
                }
                
                function drawObject(obj) {
                    // Draw object with gradient
                    const gradient = ctx.createRadialGradient(
                        obj.x, obj.y, 0,
                        obj.x, obj.y, obj.radius
                    );
                    
                    if (obj.color === '#ffdd00') {
                        // Sun
                        gradient.addColorStop(0, '#ffdd00');
                        gradient.addColorStop(1, '#ff8800');
                    } else {
                        // Earth or other planet
                        gradient.addColorStop(0, obj.color);
                        gradient.addColorStop(1, shadeColor(obj.color, -30));
                    }
                    
                    ctx.beginPath();
                    ctx.arc(obj.x, obj.y, obj.radius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Draw glow
                    for (let i = 5; i > 0; i--) {
                        const alpha = i * 0.05;
                        ctx.beginPath();
                        ctx.arc(obj.x, obj.y, obj.radius + i * 4, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                        ctx.fill();
                    }
                    
                    // Draw label
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(obj.name, obj.x, obj.y - obj.radius - 10);
                    
                    // Draw mass label
                    ctx.fillStyle = '#a3e4ff';
                    ctx.font = '12px Arial, sans-serif';
                    ctx.fillText(`Mass: ${obj.mass}`, obj.x, obj.y + obj.radius + 15);
                }
                
                function drawExplanation() {
                    // Draw explanation box
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(10, 10, 280, 80);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('Einstein\'s General Relativity:', 20, 30);
                    ctx.fillText('‚Ä¢ Mass tells spacetime how to curve', 20, 50);
                    ctx.fillText('‚Ä¢ Curved spacetime tells matter how to move', 20, 70);
                }
                
                // Helper function to darken a color
                function shadeColor(color, percent) {
                    let R = parseInt(color.substring(1, 3), 16);
                    let G = parseInt(color.substring(3, 5), 16);
                    let B = parseInt(color.substring(5, 7), 16);
                    
                    R = parseInt(R * (100 + percent) / 100);
                    G = parseInt(G * (100 + percent) / 100);
                    B = parseInt(B * (100 + percent) / 100);
                    
                    R = (R < 255) ? R : 255;
                    G = (G < 255) ? G : 255;
                    B = (B < 255) ? B : 255;
                    
                    R = Math.max(0, R);
                    G = Math.max(0, G);
                    B = Math.max(0, B);
                    
                    const RR = ((R.toString(16).length === 1) ? "0" + R.toString(16) : R.toString(16));
                    const GG = ((G.toString(16).length === 1) ? "0" + G.toString(16) : G.toString(16));
                    const BB = ((B.toString(16).length === 1) ? "0" + B.toString(16) : B.toString(16));
                    
                    return "#" + RR + GG + BB;
                }
                
                // Start animation
                animate();
                
                // Unlock achievement
                this.unlockAchievement('einstein-apprentice');
            }
            
            showTimeDilation() {
                const containerElement = document.getElementById('time-dilation-container');
                if (!containerElement) return;
                
                // Clear existing content
                containerElement.innerHTML = '';
                
                const demoCanvas = document.createElement('canvas');
                demoCanvas.width = containerElement.clientWidth;
                demoCanvas.height = 300;
                containerElement.appendChild(demoCanvas);
                
                const ctx = demoCanvas.getContext('2d');
                
                // Environment
                const background = {
                    stars: []
                };
                
                // Generate stars
                for (let i = 0; i < 100; i++) {
                    background.stars.push({
                        x: Math.random() * demoCanvas.width,
                        y: Math.random() * demoCanvas.height,
                        size: Math.random() * 2 + 1,
                        brightness: Math.random() * 0.5 + 0.5
                    });
                }
                
                // Objects
                const earth = {
                    x: demoCanvas.width * 0.2,
                    y: demoCanvas.height / 2,
                    radius: 30,
                    gravity: 1,
                    label: 'Earth',
                    color: '#3a8aff',
                    clock: { time: 0, rate: 1 }
                };
                
                const blackHole = {
                    x: demoCanvas.width * 0.8,
                    y: demoCanvas.height / 2,
                    radius: 15,
                    event_horizon: 50,
                    gravity: 1000,
                    label: 'Black Hole',
                    color: '#000000',
                    clock: { time: 0, rate: 0.2 }
                };
                
                // Clocks to display time
                const clocks = [
                    { x: earth.x, y: earth.y - earth.radius - 60, reference: earth, label: 'Earth Time' },
                    { x: blackHole.x, y: blackHole.y - blackHole.event_horizon - 90, reference: blackHole, label: 'Near Black Hole' }
                ];
                
                // Animation function
                const animate = () => {
                    // Clear canvas
                    ctx.fillStyle = '#0a0a2a';
                    ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);
                    
                    // Draw stars
                    drawStars();
                    
                    // Draw objects
                    drawEarth();
                    drawBlackHole();
                    
                    // Update and draw clocks
                    updateClocks();
                    drawClocks();
                    
                    // Draw comparison
                    drawTimeComparison();
                    
                    requestAnimationFrame(animate);
                };
                
                function drawStars() {
                    background.stars.forEach(star => {
                        ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                        ctx.fillRect(star.x, star.y, star.size, star.size);
                    });
                }
                
                function drawEarth() {
                    // Draw atmosphere glow
                    const glowGradient = ctx.createRadialGradient(
                        earth.x, earth.y, earth.radius,
                        earth.x, earth.y, earth.radius * 1.5
                    );
                    glowGradient.addColorStop(0, 'rgba(58, 138, 255, 0.5)');
                    glowGradient.addColorStop(1, 'rgba(58, 138, 255, 0)');
                    
                    ctx.beginPath();
                    ctx.arc(earth.x, earth.y, earth.radius * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = glowGradient;
                    ctx.fill();
                    
                    // Draw Earth
                    const earthGradient = ctx.createRadialGradient(
                        earth.x, earth.y, 0,
                        earth.x, earth.y, earth.radius
                    );
                    earthGradient.addColorStop(0, '#3a8aff');
                    earthGradient.addColorStop(1, '#1e4d8f');
                    
                    ctx.beginPath();
                    ctx.arc(earth.x, earth.y, earth.radius, 0, Math.PI * 2);
                    ctx.fillStyle = earthGradient;
                    ctx.fill();
                    
                    // Draw continents (simplified)
                    ctx.fillStyle = '#3a9c3a';
                    
                    // North America
                    ctx.beginPath();
                    ctx.ellipse(earth.x - 10, earth.y - 10, 10, 7, Math.PI / 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // South America
                    ctx.beginPath();
                    ctx.ellipse(earth.x - 5, earth.y + 5, 5, 10, Math.PI / 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Africa
                    ctx.beginPath();
                    ctx.ellipse(earth.x + 10, earth.y, 8, 15, Math.PI / 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Label
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(earth.label, earth.x, earth.y - earth.radius - 10);
                    
                    // Normal gravity field
                    ctx.strokeStyle = 'rgba(58, 138, 255, 0.2)';
                    ctx.lineWidth = 1;
                    
                    for (let i = 1; i <= 3; i++) {
                        ctx.beginPath();
                        ctx.arc(earth.x, earth.y, earth.radius + i * 15, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }
                
                function drawBlackHole() {
                    // Draw event horizon
                    const horizonGradient = ctx.createRadialGradient(
                        blackHole.x, blackHole.y, 0,
                        blackHole.x, blackHole.y, blackHole.event_horizon
                    );
                    horizonGradient.addColorStop(0, 'rgba(0, 0, 0, 1)');
                    horizonGradient.addColorStop(0.7, 'rgba(20, 20, 50, 0.7)');
                    horizonGradient.addColorStop(1, 'rgba(20, 20, 50, 0)');
                    
                    ctx.beginPath();
                    ctx.arc(blackHole.x, blackHole.y, blackHole.event_horizon, 0, Math.PI * 2);
                    ctx.fillStyle = horizonGradient;
                    ctx.fill();
                    
                    // Draw black hole center
                    ctx.beginPath();
                    ctx.arc(blackHole.x, blackHole.y, blackHole.radius, 0, Math.PI * 2);
                    ctx.fillStyle = '#000000';
                    ctx.fill();
                    
                    // Draw accretion disk
                    ctx.save();
                    ctx.translate(blackHole.x, blackHole.y);
                    ctx.rotate(Date.now() * 0.001); // Rotate over time
                    
                    const diskGradient = ctx.createRadialGradient(
                        0, 0, blackHole.radius,
                        0, 0, blackHole.event_horizon * 1.2
                    );
                    diskGradient.addColorStop(0, 'rgba(255, 100, 0, 0)');
                    diskGradient.addColorStop(0.7, 'rgba(255, 100, 0, 0.7)');
                    diskGradient.addColorStop(1, 'rgba(255, 200, 0, 0)');
                    
                    ctx.beginPath();
                    ctx.ellipse(0, 0, blackHole.event_horizon * 1.2, blackHole.event_horizon * 0.3, 0, 0, Math.PI * 2);
                    ctx.fillStyle = diskGradient;
                    ctx.fill();
                    ctx.restore();
                    
                    // Label
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(blackHole.label, blackHole.x, blackHole.y - blackHole.event_horizon - 10);
                    
                    // Strong gravity field
                    ctx.strokeStyle = 'rgba(255, 100, 0, 0.2)';
                    ctx.lineWidth = 1;
                    
                    for (let i = 1; i <= 5; i++) {
                        ctx.beginPath();
                        ctx.arc(blackHole.x, blackHole.y, blackHole.event_horizon + i * 20, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }
                
                function updateClocks() {
                    // Update clock times based on their time rates
                    earth.clock.time += earth.clock.rate;
                    blackHole.clock.time += blackHole.clock.rate;
                }
                
                function drawClocks() {
                    clocks.forEach(clock => {
                        // Draw clock background
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                        ctx.fillRect(clock.x - 50, clock.y, 100, 50);
                        
                        // Draw clock label
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '12px Arial, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(clock.label, clock.x, clock.y + 15);
                        
                        // Format time (minutes:seconds)
                        const totalSeconds = Math.floor(clock.reference.clock.time / 60);
                        const minutes = Math.floor(totalSeconds / 60);
                        const seconds = totalSeconds % 60;
                        const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Draw time
                        ctx.font = '20px monospace';
                        ctx.fillText(timeStr, clock.x, clock.y + 38);
                    });
                }
                
                function drawTimeComparison() {
                    // Draw comparison box
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(demoCanvas.width / 2 - 150, demoCanvas.height - 80, 300, 70);
                    
                    // Calculate time ratio
                    const ratio = (blackHole.clock.rate / earth.clock.rate).toFixed(1);
                    
                    // Draw comparison text
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('Time Dilation Effect:', demoCanvas.width / 2, demoCanvas.height - 60);
                    ctx.fillText(`Time runs ${ratio}x slower near the black hole`, demoCanvas.width / 2, demoCanvas.height - 40);
                    ctx.fillText('(Einstein\'s Theory of General Relativity)', demoCanvas.width / 2, demoCanvas.height - 20);
                }
                
                // Start animation
                animate();
                
                // Unlock achievement
                this.unlockAchievement('einstein-apprentice');
            }
            
            // ------- Utility Functions ------- //
            
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
        }
        
        // Initialize the game
        window.addEventListener('load', () => {
            const game = new SpaceAdventureGame();
        });
    </script>
</body>
</html>