<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiles Hop Adventure</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #7db9e8, #1e5799);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background-color: #f9f9f9;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        /* Screen Styles */
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            background-size: cover;
            background-position: center;
            padding: 20px;
        }
        
        .screen.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Start Screen */
        #start-screen {
            background: linear-gradient(to bottom, #ffda89, #ffaf40);
        }
        
        .title {
            font-size: 48px;
            color: #3c1053;
            text-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .subtitle {
            font-size: 24px;
            color: #3c1053;
            margin-bottom: 40px;
            text-align: center;
        }
        
        /* Button Styles */
        .btn {
            padding: 15px 30px;
            font-size: 20px;
            background-color: #ff5252;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 5px 0 #c41616;
            transition: all 0.2s;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #c41616;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #c41616;
        }
        
        .btn-blue {
            background-color: #4285f4;
            box-shadow: 0 5px 0 #2867c9;
        }
        
        .btn-blue:hover {
            box-shadow: 0 8px 0 #2867c9;
        }
        
        .btn-blue:active {
            box-shadow: 0 3px 0 #2867c9;
        }
        
        .btn-green {
            background-color: #34a853;
            box-shadow: 0 5px 0 #23783a;
        }
        
        .btn-green:hover {
            box-shadow: 0 8px 0 #23783a;
        }
        
        .btn-green:active {
            box-shadow: 0 3px 0 #23783a;
        }
        
        /* Character Styles */
        .character {
            position: absolute;
            width: 120px;
            height: 120px;
            pointer-events: none;
        }
        
        #melody {
            bottom: 10px;
            left: 10px;
        }
        
        #beat {
            bottom: 10px;
            right: 10px;
        }
        
        .speech-bubble {
            position: absolute;
            background-color: white;
            border-radius: 20px;
            padding: 15px;
            min-width: 200px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 18px;
            color: #333;
            z-index: 10;
            pointer-events: none;
        }
        
        #melody-bubble {
            bottom: 140px;
            left: 20px;
        }
        
        #beat-bubble {
            bottom: 140px;
            right: 20px;
        }
        
        /* Game Screen */
        #game-screen {
            background: linear-gradient(to bottom, #b8e1fc, #6ec7f6);
        }
        
        #game-area {
            position: relative;
            width: 600px;
            height: 400px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tile {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 5px 0 rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transform: scale(1);
            transition: transform 0.1s ease;
            user-select: none;
        }
        
        .tile.active {
            transform: scale(1.1);
        }
        
        .tile.correct {
            background-color: #34a853 !important;
        }
        
        .tile.wrong {
            background-color: #ea4335 !important;
        }
        
        /* Game UI */
        #game-ui {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        #score-display, #level-display, #lives-display {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            color: #3c1053;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        }
        
        /* Quiz Screen */
        #quiz-screen {
            background: linear-gradient(to bottom, #a6e6ff, #75c6ef);
        }
        
        #quiz-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            width: 600px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        #quiz-question {
            font-size: 24px;
            margin-bottom: 30px;
            color: #3c1053;
        }
        
        #quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quiz-option {
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }
        
        .quiz-option:hover {
            background-color: #e0e0e0;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-option.selected {
            background-color: #4285f4;
            color: white;
        }
        
        .quiz-option.correct {
            background-color: #34a853;
            color: white;
        }
        
        .quiz-option.incorrect {
            background-color: #ea4335;
            color: white;
        }
        
        /* Settings Screen */
        #settings-screen {
            background: linear-gradient(to bottom, #d0e6ff, #90c8ff);
        }
        
        .settings-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            width: 600px;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .settings-title {
            font-size: 28px;
            color: #3c1053;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .setting-group {
            margin-bottom: 25px;
        }
        
        .setting-label {
            font-size: 20px;
            color: #3c1053;
            margin-bottom: 10px;
            display: block;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 70%;
            height: 10px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            margin: 0 15px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4285f4;
            cursor: pointer;
        }
        
        .slider-value {
            font-size: 18px;
            width: 50px;
            text-align: center;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
        }
        
        .checkbox {
            width: 25px;
            height: 25px;
            margin-right: 15px;
        }
        
        /* Results Screen */
        #results-screen {
            background: linear-gradient(to bottom, #ffd280, #ffaa33);
        }
        
        .results-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            width: 600px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .results-title {
            font-size: 36px;
            color: #3c1053;
            margin-bottom: 20px;
        }
        
        .result-score {
            font-size: 48px;
            color: #4285f4;
            margin-bottom: 20px;
        }
        
        .result-message {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
        }
        
        /* Particle Effects */
        .particle {
            position: absolute;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            pointer-events: none;
        }
        
        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 850px) {
            #game-container {
                width: 95vw;
                height: 95vh;
            }
            
            .title {
                font-size: 36px;
            }
            
            .subtitle {
                font-size: 20px;
            }
            
            #game-area {
                width: 90%;
                height: 60vh;
            }
            
            .settings-container, #quiz-container, .results-container {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen visible">
            <h1 class="title">Tiles Hop Adventure</h1>
            <p class="subtitle">Hop on colorful tiles, make music, and learn patterns!</p>
            
            <button id="start-btn" class="btn">Start Game</button>
            <button id="settings-btn" class="btn btn-blue">Settings</button>
            
            <!-- Characters -->
            <div id="melody" class="character">
                <!-- Melody SVG -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <!-- Body -->
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#FF9FF3" />
                    
                    <!-- Head -->
                    <circle cx="60" cy="40" r="25" fill="#FFAAA7" />
                    
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    
                    <!-- Smile -->
                    <path d="M45,50 Q60,65 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    
                    <!-- Hair -->
                    <path d="M35,25 Q60,5 85,25 Q60,15 35,25" fill="#FF7675" />
                    
                    <!-- Music Notes -->
                    <circle cx="25" cy="60" r="8" fill="#6C5CE7" />
                    <path d="M25,60 L25,40 L35,35" stroke="#6C5CE7" stroke-width="3" />
                    
                    <circle cx="95" cy="55" r="8" fill="#6C5CE7" />
                    <path d="M95,55 L95,35 L85,30" stroke="#6C5CE7" stroke-width="3" />
                    
                    <!-- Arms -->
                    <path d="M35,70 L20,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    
                    <!-- Legs -->
                    <path d="M45,110 L50,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="beat" class="character">
                <!-- Beat SVG -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <!-- Body -->
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#74B9FF" />
                    
                    <!-- Head -->
                    <circle cx="60" cy="40" r="25" fill="#A3CB38" />
                    
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    
                    <!-- Smile -->
                    <path d="M45,50 Q60,60 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    
                    <!-- Headphones -->
                    <path d="M35,30 C25,20 25,60 35,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M85,30 C95,20 95,60 85,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M35,30 L85,30" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <rect x="30" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    <rect x="80" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    
                    <!-- Drum Sticks -->
                    <line x1="30" y1="65" x2="15" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="10" cy="50" r="5" fill="#FFA500" />
                    
                    <line x1="90" y1="65" x2="105" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="110" cy="50" r="5" fill="#FFA500" />
                    
                    <!-- Arms -->
                    <path d="M35,70 L20,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    
                    <!-- Legs -->
                    <path d="M45,110 L50,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="melody-bubble" class="speech-bubble">
                Hi there! I'm Melody! Are you ready to hop on tiles and make music?
            </div>
            
            <div id="beat-bubble" class="speech-bubble">
                I'm Beat! Let's create awesome rhythms together! Click Start to play!
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div id="game-ui">
                <div id="score-display">Score: 0</div>
                <div id="level-display">Level: 1</div>
                <div id="lives-display">Lives: ❤️❤️❤️</div>
            </div>
            
            <div id="game-area"></div>
            
            <div class="button-container" style="margin-top: 20px;">
                <button id="pause-btn" class="btn">Pause</button>
            </div>
            
            <!-- Characters -->
            <div id="melody-game" class="character" style="left: 10px; bottom: 10px; transform: scale(0.7);">
                <!-- Melody SVG (same as above) -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <!-- Body -->
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#FF9FF3" />
                    
                    <!-- Head -->
                    <circle cx="60" cy="40" r="25" fill="#FFAAA7" />
                    
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    
                    <!-- Smile -->
                    <path d="M45,50 Q60,65 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    
                    <!-- Hair -->
                    <path d="M35,25 Q60,5 85,25 Q60,15 35,25" fill="#FF7675" />
                    
                    <!-- Music Notes -->
                    <circle cx="25" cy="60" r="8" fill="#6C5CE7" />
                    <path d="M25,60 L25,40 L35,35" stroke="#6C5CE7" stroke-width="3" />
                    
                    <circle cx="95" cy="55" r="8" fill="#6C5CE7" />
                    <path d="M95,55 L95,35 L85,30" stroke="#6C5CE7" stroke-width="3" />
                    
                    <!-- Arms -->
                    <path d="M35,70 L20,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    
                    <!-- Legs -->
                    <path d="M45,110 L50,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="beat-game" class="character" style="right: 10px; bottom: 10px; transform: scale(0.7);">
                <!-- Beat SVG (same as above) -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <!-- Body -->
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#74B9FF" />
                    
                    <!-- Head -->
                    <circle cx="60" cy="40" r="25" fill="#A3CB38" />
                    
                    <!-- Eyes -->
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    
                    <!-- Smile -->
                    <path d="M45,50 Q60,60 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    
                    <!-- Headphones -->
                    <path d="M35,30 C25,20 25,60 35,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M85,30 C95,20 95,60 85,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M35,30 L85,30" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <rect x="30" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    <rect x="80" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    
                    <!-- Drum Sticks -->
                    <line x1="30" y1="65" x2="15" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="10" cy="50" r="5" fill="#FFA500" />
                    
                    <line x1="90" y1="65" x2="105" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="110" cy="50" r="5" fill="#FFA500" />
                    
                    <!-- Arms -->
                    <path d="M35,70 L20,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    
                    <!-- Legs -->
                    <path d="M45,110 L50,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="melody-game-bubble" class="speech-bubble">
                Tap the tiles in the correct sequence to make music!
            </div>
            
            <div id="beat-game-bubble" class="speech-bubble">
                Follow the pattern and rhythm! You can do it!
            </div>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quiz-screen" class="screen">
            <div id="quiz-container">
                <h2 id="quiz-question">What pattern comes next?</h2>
                <div id="quiz-options">
                    <!-- Quiz options will be added dynamically -->
                </div>
                <button id="submit-quiz" class="btn btn-green">Submit Answer</button>
            </div>
            
            <!-- Characters -->
            <div id="melody-quiz" class="character" style="left: 10px; bottom: 10px; transform: scale(0.7);">
                <!-- Melody SVG (same as above) -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#FF9FF3" />
                    <circle cx="60" cy="40" r="25" fill="#FFAAA7" />
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    <path d="M45,50 Q60,65 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    <path d="M35,25 Q60,5 85,25 Q60,15 35,25" fill="#FF7675" />
                    <circle cx="25" cy="60" r="8" fill="#6C5CE7" />
                    <path d="M25,60 L25,40 L35,35" stroke="#6C5CE7" stroke-width="3" />
                    <circle cx="95" cy="55" r="8" fill="#6C5CE7" />
                    <path d="M95,55 L95,35 L85,30" stroke="#6C5CE7" stroke-width="3" />
                    <path d="M35,70 L20,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#FFAAA7" stroke-width="6" stroke-linecap="round" />
                    <path d="M45,110 L50,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#FF9FF3" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="beat-quiz" class="character" style="right: 10px; bottom: 10px; transform: scale(0.7);">
                <!-- Beat SVG (same as above) -->
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <ellipse cx="60" cy="75" rx="30" ry="35" fill="#74B9FF" />
                    <circle cx="60" cy="40" r="25" fill="#A3CB38" />
                    <circle cx="50" cy="35" r="5" fill="white" />
                    <circle cx="70" cy="35" r="5" fill="white" />
                    <circle cx="50" cy="35" r="2.5" fill="black" />
                    <circle cx="70" cy="35" r="2.5" fill="black" />
                    <path d="M45,50 Q60,60 75,50" stroke="black" stroke-width="2" fill="transparent" />
                    <path d="M35,30 C25,20 25,60 35,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M85,30 C95,20 95,60 85,50" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <path d="M35,30 L85,30" stroke="#2D3436" stroke-width="3" fill="transparent" />
                    <rect x="30" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    <rect x="80" y="35" width="10" height="15" rx="5" fill="#2D3436" />
                    <line x1="30" y1="65" x2="15" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="10" cy="50" r="5" fill="#FFA500" />
                    <line x1="90" y1="65" x2="105" y2="55" stroke="#DAA520" stroke-width="3" />
                    <circle cx="110" cy="50" r="5" fill="#FFA500" />
                    <path d="M35,70 L20,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    <path d="M85,70 L100,60" stroke="#A3CB38" stroke-width="6" stroke-linecap="round" />
                    <path d="M45,110 L50,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                    <path d="M75,110 L70,90" stroke="#74B9FF" stroke-width="8" stroke-linecap="round" />
                </svg>
            </div>
            
            <div id="melody-quiz-bubble" class="speech-bubble">
                Think about the patterns we just played!
            </div>
            
            <div id="beat-quiz-bubble" class="speech-bubble">
                Choose the answer that continues the pattern!
            </div>
        </div>
        
        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <div class="settings-container">
                <h2 class="settings-title">Game Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-label">Game Speed</label>
                    <div class="slider-container">
                        <span>Slow</span>
                        <input type="range" min="1" max="5" value="3" class="slider" id="speed-slider">
                        <span>Fast</span>
                        <span class="slider-value" id="speed-value">3</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Sound Volume</label>
                    <div class="slider-container">
                        <span>Off</span>
                        <input type="range" min="0" max="10" value="7" class="slider" id="volume-slider">
                        <span>Loud</span>
                        <span class="slider-value" id="volume-value">7</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Difficulty</label>
                    <div class="slider-container">
                        <span>Easy</span>
                        <input type="range" min="1" max="3" value="1" class="slider" id="difficulty-slider">
                        <span>Hard</span>
                        <span class="slider-value" id="difficulty-value">1</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Game Mode</label>
                    <div class="checkbox-container">
                        <input type="radio" name="mode" id="pattern-mode" class="checkbox" checked>
                        <label for="pattern-mode">Pattern Mode</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="radio" name="mode" id="rhythm-mode" class="checkbox">
                        <label for="rhythm-mode">Rhythm Mode</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="radio" name="mode" id="mixed-mode" class="checkbox">
                        <label for="mixed-mode">Mixed Mode</label>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Visual Effects</label>
                    <div class="checkbox-container">
                        <input type="checkbox" id="particles-checkbox" class="checkbox" checked>
                        <label for="particles-checkbox">Show Particle Effects</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="animations-checkbox" class="checkbox" checked>
                        <label for="animations-checkbox">Show Animations</label>
                    </div>
                </div>
                
                <button id="settings-back-btn" class="btn">Back to Main Menu</button>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <h2 class="results-title">Level Complete!</h2>
                <div class="result-score">Score: <span id="final-score">0</span></div>
                <p class="result-message" id="result-message">Great job! You're becoming a Tiles Hop master!</p>
                
                <button id="next-level-btn" class="btn btn-green">Next Level</button>
                <button id="replay-btn" class="btn">Replay Level</button>
                <button id="main-menu-btn" class="btn btn-blue">Main Menu</button>
            </div>
        </div>
    </div>
    
    <script>
        // Game State
        const gameState = {
            score: 0,
            level: 1,
            lives: 3,
            currentMode: 'pattern', // 'pattern', 'rhythm', 'mixed'
            currentPattern: [],
            userPattern: [],
            patternIndex: 0,
            isPlaying: false,
            isPaused: false,
            tilesCount: 4,
            currentQuiz: {
                question: '',
                options: [],
                correctAnswer: '',
                userAnswer: ''
            },
            settings: {
                speed: 3,
                volume: 0.7,
                difficulty: 1,
                particles: true,
                animations: true
            },
            animations: {
                timers: [],
                particles: []
            }
        };
        
        // Elements
        const elements = {
            screens: {
                startScreen: document.getElementById('start-screen'),
                gameScreen: document.getElementById('game-screen'),
                quizScreen: document.getElementById('quiz-screen'),
                settingsScreen: document.getElementById('settings-screen'),
                resultsScreen: document.getElementById('results-screen')
            },
            buttons: {
                startBtn: document.getElementById('start-btn'),
                settingsBtn: document.getElementById('settings-btn'),
                pauseBtn: document.getElementById('pause-btn'),
                submitQuizBtn: document.getElementById('submit-quiz'),
                settingsBackBtn: document.getElementById('settings-back-btn'),
                nextLevelBtn: document.getElementById('next-level-btn'),
                replayBtn: document.getElementById('replay-btn'),
                mainMenuBtn: document.getElementById('main-menu-btn')
            },
            displays: {
                scoreDisplay: document.getElementById('score-display'),
                levelDisplay: document.getElementById('level-display'),
                livesDisplay: document.getElementById('lives-display'),
                gameArea: document.getElementById('game-area'),
                quizQuestion: document.getElementById('quiz-question'),
                quizOptions: document.getElementById('quiz-options'),
                finalScore: document.getElementById('final-score'),
                resultMessage: document.getElementById('result-message')
            },
            settings: {
                speedSlider: document.getElementById('speed-slider'),
                speedValue: document.getElementById('speed-value'),
                volumeSlider: document.getElementById('volume-slider'),
                volumeValue: document.getElementById('volume-value'),
                difficultySlider: document.getElementById('difficulty-slider'),
                difficultyValue: document.getElementById('difficulty-value'),
                patternMode: document.getElementById('pattern-mode'),
                rhythmMode: document.getElementById('rhythm-mode'),
                mixedMode: document.getElementById('mixed-mode'),
                particlesCheckbox: document.getElementById('particles-checkbox'),
                animationsCheckbox: document.getElementById('animations-checkbox')
            },
            characters: {
                melodyBubble: document.getElementById('melody-bubble'),
                beatBubble: document.getElementById('beat-bubble'),
                melodyGameBubble: document.getElementById('melody-game-bubble'),
                beatGameBubble: document.getElementById('beat-game-bubble'),
                melodyQuizBubble: document.getElementById('melody-quiz-bubble'),
                beatQuizBubble: document.getElementById('beat-quiz-bubble')
            }
        };
        
        // Audio Context
        let audioContext;
        
        // Initialize the game
        function initGame() {
            // Initialize Web Audio API
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error('Web Audio API is not supported in this browser');
            }
            
            // Character speech bubbles
            showCharacterMessages();
            
            // Event Listeners
            setupEventListeners();
            
            // Settings initialization
            updateSettingsDisplay();
        }
        
        // Show character messages
        function showCharacterMessages() {
            setTimeout(() => {
                elements.characters.melodyBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.melodyBubble.style.opacity = '0';
                    
                    setTimeout(() => {
                        elements.characters.beatBubble.style.opacity = '1';
                        
                        setTimeout(() => {
                            elements.characters.beatBubble.style.opacity = '0';
                        }, 5000);
                    }, 1000);
                }, 5000);
            }, 1000);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Main Menu Buttons
            elements.buttons.startBtn.addEventListener('click', () => {
                playButtonSound();
                startGame();
            });
            
            elements.buttons.settingsBtn.addEventListener('click', () => {
                playButtonSound();
                showScreen('settingsScreen');
            });
            
            // Game Buttons
            elements.buttons.pauseBtn.addEventListener('click', () => {
                playButtonSound();
                togglePause();
            });
            
            // Quiz Buttons
            elements.buttons.submitQuizBtn.addEventListener('click', () => {
                playButtonSound();
                checkQuizAnswer();
            });
            
            // Settings Buttons
            elements.buttons.settingsBackBtn.addEventListener('click', () => {
                playButtonSound();
                showScreen('startScreen');
            });
            
            // Results Buttons
            elements.buttons.nextLevelBtn.addEventListener('click', () => {
                playButtonSound();
                nextLevel();
            });
            
            elements.buttons.replayBtn.addEventListener('click', () => {
                playButtonSound();
                replayLevel();
            });
            
            elements.buttons.mainMenuBtn.addEventListener('click', () => {
                playButtonSound();
                resetGame();
                showScreen('startScreen');
            });
            
            // Settings Sliders
            elements.settings.speedSlider.addEventListener('input', () => {
                gameState.settings.speed = parseInt(elements.settings.speedSlider.value);
                elements.settings.speedValue.textContent = gameState.settings.speed;
            });
            
            elements.settings.volumeSlider.addEventListener('input', () => {
                gameState.settings.volume = parseInt(elements.settings.volumeSlider.value) / 10;
                elements.settings.volumeValue.textContent = elements.settings.volumeSlider.value;
            });
            
            elements.settings.difficultySlider.addEventListener('input', () => {
                gameState.settings.difficulty = parseInt(elements.settings.difficultySlider.value);
                elements.settings.difficultyValue.textContent = gameState.settings.difficulty;
            });
            
            // Game Mode Radio Buttons
            elements.settings.patternMode.addEventListener('change', () => {
                if (elements.settings.patternMode.checked) {
                    gameState.currentMode = 'pattern';
                    playSelectSound();
                }
            });
            
            elements.settings.rhythmMode.addEventListener('change', () => {
                if (elements.settings.rhythmMode.checked) {
                    gameState.currentMode = 'rhythm';
                    playSelectSound();
                }
            });
            
            elements.settings.mixedMode.addEventListener('change', () => {
                if (elements.settings.mixedMode.checked) {
                    gameState.currentMode = 'mixed';
                    playSelectSound();
                }
            });
            
            // Visual Effects Checkboxes
            elements.settings.particlesCheckbox.addEventListener('change', () => {
                gameState.settings.particles = elements.settings.particlesCheckbox.checked;
                playSelectSound();
            });
            
            elements.settings.animationsCheckbox.addEventListener('change', () => {
                gameState.settings.animations = elements.settings.animationsCheckbox.checked;
                playSelectSound();
            });
        }
        
        // Update settings display
        function updateSettingsDisplay() {
            elements.settings.speedValue.textContent = gameState.settings.speed;
            elements.settings.volumeValue.textContent = Math.round(gameState.settings.volume * 10);
            elements.settings.difficultyValue.textContent = gameState.settings.difficulty;
            
            elements.settings.speedSlider.value = gameState.settings.speed;
            elements.settings.volumeSlider.value = Math.round(gameState.settings.volume * 10);
            elements.settings.difficultySlider.value = gameState.settings.difficulty;
            
            elements.settings.patternMode.checked = gameState.currentMode === 'pattern';
            elements.settings.rhythmMode.checked = gameState.currentMode === 'rhythm';
            elements.settings.mixedMode.checked = gameState.currentMode === 'mixed';
            
            elements.settings.particlesCheckbox.checked = gameState.settings.particles;
            elements.settings.animationsCheckbox.checked = gameState.settings.animations;
        }
        
        // Show a specific screen
        function showScreen(screenName) {
            Object.keys(elements.screens).forEach(key => {
                elements.screens[key].classList.remove('visible');
            });
            
            elements.screens[screenName].classList.add('visible');
        }
        
        // Start the game
        function startGame() {
            // Reset game state
            gameState.score = 0;
            gameState.lives = 3;
            gameState.isPlaying = true;
            gameState.isPaused = false;
            
            // Update displays
            updateScoreDisplay();
            updateLivesDisplay();
            
            // Load first level
            loadLevel(gameState.level);
            
            // Show game screen
            showScreen('gameScreen');
            
            // Show character messages
            showGameCharacterMessages();
        }
        
        // Show game character messages
        function showGameCharacterMessages() {
            setTimeout(() => {
                elements.characters.melodyGameBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.melodyGameBubble.style.opacity = '0';
                    
                    setTimeout(() => {
                        elements.characters.beatGameBubble.style.opacity = '1';
                        
                        setTimeout(() => {
                            elements.characters.beatGameBubble.style.opacity = '0';
                        }, 4000);
                    }, 1000);
                }, 4000);
            }, 1000);
        }
        
        // Load a specific level
        function loadLevel(level) {
            // Update level display
            gameState.level = level;
            elements.displays.levelDisplay.textContent = `Level: ${level}`;
            
            // Set tiles count based on level and difficulty
            gameState.tilesCount = 4 + Math.min(level - 1, 4) + (gameState.settings.difficulty - 1) * 2;
            
            // Clear game area
            elements.displays.gameArea.innerHTML = '';
            
            // Create tiles
            createTiles();
            
            // Generate pattern
            generatePattern();
            
            // Start demonstrating pattern
            setTimeout(() => {
                demonstratePattern();
            }, 1000);
        }
        
        // Create tiles in the game area
        function createTiles() {
            const gameWidth = elements.displays.gameArea.clientWidth;
            const gameHeight = elements.displays.gameArea.clientHeight;
            
            // Get tile size based on the number of tiles
            const tileSize = Math.min(80, (gameWidth - 40) / Math.ceil(Math.sqrt(gameState.tilesCount)));
            
            // Calculate grid dimensions
            const gridSize = Math.ceil(Math.sqrt(gameState.tilesCount));
            const gridWidth = tileSize * gridSize + 20 * (gridSize - 1);
            const gridHeight = tileSize * gridSize + 20 * (gridSize - 1);
            
            // Starting position to center the grid
            const startX = (gameWidth - gridWidth) / 2;
            const startY = (gameHeight - gridHeight) / 2;
            
            // Create tiles in a grid layout
            const colors = ['#4285f4', '#ea4335', '#fbbc05', '#34a853', '#ff6d00', '#46bdc6', '#8e24aa', '#0f9d58'];
            
            for (let i = 0; i < gameState.tilesCount; i++) {
                // Calculate position in the grid
                const row = Math.floor(i / gridSize);
                const col = i % gridSize;
                
                const tileX = startX + col * (tileSize + 20);
                const tileY = startY + row * (tileSize + 20);
                
                // Create the tile
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.style.width = `${tileSize}px`;
                tile.style.height = `${tileSize}px`;
                tile.style.left = `${tileX}px`;
                tile.style.top = `${tileY}px`;
                tile.style.backgroundColor = colors[i % colors.length];
                
                // Display tile number
                tile.textContent = (i + 1).toString();
                
                // Add event listener
                tile.addEventListener('click', () => {
                    if (gameState.isPlaying && !gameState.isPaused) {
                        tileClicked(i);
                    }
                });
                
                // Add to game area
                elements.displays.gameArea.appendChild(tile);
            }
        }
        
        // Generate pattern for the level
        function generatePattern() {
            // Clear previous pattern
            gameState.currentPattern = [];
            gameState.userPattern = [];
            gameState.patternIndex = 0;
            
            // Pattern length based on level and difficulty
            const patternLength = 3 + Math.min(gameState.level - 1, 5) + (gameState.settings.difficulty - 1) * 2;
            
            // Generate random pattern
            for (let i = 0; i < patternLength; i++) {
                const tileIndex = Math.floor(Math.random() * gameState.tilesCount);
                gameState.currentPattern.push(tileIndex);
            }
        }
        
        // Demonstrate the pattern to the player
        function demonstratePattern() {
            // Reset user pattern
            gameState.userPattern = [];
            gameState.patternIndex = 0;
            
            // Disable tile clicking during demonstration
            gameState.isPlaying = false;
            
            // Demo message
            const demoMessage = gameState.currentMode === 'rhythm' ? 
                "Watch and listen to the rhythm!" : 
                "Watch the pattern carefully!";
                
            elements.characters.melodyGameBubble.textContent = demoMessage;
            elements.characters.melodyGameBubble.style.opacity = '1';
            
            setTimeout(() => {
                elements.characters.melodyGameBubble.style.opacity = '0';
            }, 3000);
            
            // Demonstrate each tile in the pattern
            let index = 0;
            
            const demonstrateNextTile = () => {
                if (index < gameState.currentPattern.length) {
                    // Highlight tile
                    const tileIndex = gameState.currentPattern[index];
                    const tiles = elements.displays.gameArea.querySelectorAll('.tile');
                    
                    if (tiles[tileIndex]) {
                        // Visual feedback
                        tiles[tileIndex].classList.add('active');
                        
                        // Play sound for the tile
                        playTileSound(tileIndex);
                        
                        // Reset after a short delay
                        setTimeout(() => {
                            tiles[tileIndex].classList.remove('active');
                            
                            // Continue with next tile after a pause
                            index++;
                            
                            // Delay between tiles depends on game mode and speed
                            let delay = 1000 / gameState.settings.speed;
                            
                            if (gameState.currentMode === 'rhythm') {
                                // Rhythm mode has varying delays
                                delay = (500 + Math.random() * 500) / gameState.settings.speed;
                            }
                            
                            setTimeout(demonstrateNextTile, delay);
                        }, 500);
                    } else {
                        // Skip if tile doesn't exist
                        index++;
                        setTimeout(demonstrateNextTile, 500);
                    }
                } else {
                    // Finished demonstrating, player's turn
                    setTimeout(() => {
                        gameState.isPlaying = true;
                        
                        // Your turn message
                        elements.characters.beatGameBubble.textContent = "Your turn! Repeat the pattern!";
                        elements.characters.beatGameBubble.style.opacity = '1';
                        
                        setTimeout(() => {
                            elements.characters.beatGameBubble.style.opacity = '0';
                        }, 3000);
                    }, 1000);
                }
            };
            
            // Start demonstration
            setTimeout(demonstrateNextTile, 1000);
        }
        
        // Handle tile click
        function tileClicked(tileIndex) {
            const tiles = elements.displays.gameArea.querySelectorAll('.tile');
            
            // Visual feedback
            tiles[tileIndex].classList.add('active');
            
            // Play sound
            playTileSound(tileIndex);
            
            // Reset visual after a short delay
            setTimeout(() => {
                tiles[tileIndex].classList.remove('active');
            }, 300);
            
            // Add to user pattern
            gameState.userPattern.push(tileIndex);
            
            // Check if the user's choice matches the pattern
            const currentIndex = gameState.userPattern.length - 1;
            
            if (gameState.userPattern[currentIndex] === gameState.currentPattern[currentIndex]) {
                // Correct choice
                
                // Check if pattern is complete
                if (gameState.userPattern.length === gameState.currentPattern.length) {
                    // Pattern completed successfully
                    setTimeout(() => {
                        patternCompleted();
                    }, 500);
                }
            } else {
                // Incorrect choice
                setTimeout(() => {
                    patternFailed();
                }, 300);
            }
        }
        
        // Pattern completed successfully
        function patternCompleted() {
            // Visual celebration
            if (gameState.settings.particles) {
                createParticleEffect();
            }
            
            // Play success sound
            playSuccessSound();
            
            // Show congratulation message
            elements.characters.melodyGameBubble.textContent = "Great job! You got it right!";
            elements.characters.melodyGameBubble.style.opacity = '1';
            
            setTimeout(() => {
                elements.characters.melodyGameBubble.style.opacity = '0';
            }, 3000);
            
            // Add score
            gameState.score += gameState.currentPattern.length * gameState.level;
            updateScoreDisplay();
            
            // Proceed to quiz or next level
            setTimeout(() => {
                // Every 2nd level has a quiz
                if (gameState.level % 2 === 0) {
                    generateQuiz();
                    showScreen('quizScreen');
                } else {
                    // Show results and proceed
                    showResults();
                }
            }, 2000);
        }
        
        // Pattern failed
        function patternFailed() {
            // Play error sound
            playErrorSound();
            
            // Shake game area
            const gameArea = elements.displays.gameArea;
            gameArea.style.animation = 'none';
            setTimeout(() => {
                gameArea.style.animation = 'shake 0.5s';
            }, 10);
            
            // Show correct pattern
            setTimeout(() => {
                showCorrectPattern();
            }, 1000);
            
            // Lose a life
            gameState.lives--;
            updateLivesDisplay();
            
            // Check if game over
            if (gameState.lives <= 0) {
                setTimeout(() => {
                    gameOver();
                }, 3000);
            } else {
                // Show encouragement message
                elements.characters.beatGameBubble.textContent = "Oops! Let's try again!";
                elements.characters.beatGameBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.beatGameBubble.style.opacity = '0';
                    
                    // Retry the same pattern
                    setTimeout(() => {
                        demonstratePattern();
                    }, 1000);
                }, 3000);
            }
        }
        
        // Show the correct pattern after a fail
        function showCorrectPattern() {
            // Disable tile clicking
            gameState.isPlaying = false;
            
            // Show the correct pattern message
            elements.characters.melodyGameBubble.textContent = "Here's the correct pattern:";
            elements.characters.melodyGameBubble.style.opacity = '1';
            
            setTimeout(() => {
                elements.characters.melodyGameBubble.style.opacity = '0';
            }, 3000);
            
            // Highlight the correct pattern slowly
            const tiles = elements.displays.gameArea.querySelectorAll('.tile');
            let index = 0;
            
            const highlightNextTile = () => {
                if (index < gameState.currentPattern.length) {
                    // Highlight the correct tile
                    const tileIndex = gameState.currentPattern[index];
                    
                    if (tiles[tileIndex]) {
                        // Highlight with a "correct" class
                        tiles[tileIndex].classList.add('correct');
                        
                        // Play sound
                        playTileSound(tileIndex);
                        
                        // Reset after a short delay
                        setTimeout(() => {
                            tiles[tileIndex].classList.remove('correct');
                            
                            // Continue with next tile
                            index++;
                            setTimeout(highlightNextTile, 800);
                        }, 800);
                    } else {
                        // Skip if tile doesn't exist
                        index++;
                        setTimeout(highlightNextTile, 800);
                    }
                }
            };
            
            // Start showing the correct pattern
            setTimeout(highlightNextTile, 1000);
        }
        
        // Game over
        function gameOver() {
            // Show game over message
            elements.characters.beatGameBubble.textContent = "Game Over! Don't worry, you can try again!";
            elements.characters.beatGameBubble.style.opacity = '1';
            
            // Show results screen with sad message
            elements.displays.finalScore.textContent = gameState.score;
            elements.displays.resultMessage.textContent = `You reached level ${gameState.level}. Keep practicing to improve!`;
            
            // Hide next level button
            elements.buttons.nextLevelBtn.style.display = 'none';
            elements.buttons.replayBtn.style.display = 'inline-block';
            elements.buttons.mainMenuBtn.style.display = 'inline-block';
            
            showScreen('resultsScreen');
        }
        
        // Generate quiz questions
        function generateQuiz() {
            // Show quiz character messages
            elements.characters.melodyQuizBubble.textContent = "Time for a quick quiz! Let's see what you've learned!";
            elements.characters.melodyQuizBubble.style.opacity = '1';
            
            setTimeout(() => {
                elements.characters.melodyQuizBubble.style.opacity = '0';
                
                setTimeout(() => {
                    elements.characters.beatQuizBubble.textContent = "Choose the best answer!";
                    elements.characters.beatQuizBubble.style.opacity = '1';
                    
                    setTimeout(() => {
                        elements.characters.beatQuizBubble.style.opacity = '0';
                    }, 3000);
                }, 1000);
            }, 5000);
            
            // Generate quiz based on the current level and mode
            let question = '';
            let options = [];
            let correctAnswer = '';
            
            if (gameState.currentMode === 'pattern') {
                // Pattern-based quiz
                question = "Which pattern was played during this level?";
                
                // Generate correct pattern representation
                correctAnswer = gameState.currentPattern.map(i => (i + 1)).join(', ');
                
                // Generate incorrect options
                const incorrectOptions = [];
                
                for (let i = 0; i < 3; i++) {
                    // Create a slightly modified version of the correct pattern
                    const modifiedPattern = [...gameState.currentPattern];
                    
                    // Modify 1-2 elements
                    const numChanges = Math.min(1 + Math.floor(Math.random() * 2), modifiedPattern.length);
                    
                    for (let j = 0; j < numChanges; j++) {
                        const changeIndex = Math.floor(Math.random() * modifiedPattern.length);
                        let newValue;
                        do {
                            newValue = Math.floor(Math.random() * gameState.tilesCount);
                        } while (newValue === modifiedPattern[changeIndex]);
                        modifiedPattern[changeIndex] = newValue;
                    }
                    
                    // Format and add to incorrect options
                    incorrectOptions.push(modifiedPattern.map(i => (i + 1)).join(', '));
                }
                
                options = [correctAnswer, ...incorrectOptions];
            } else if (gameState.currentMode === 'rhythm') {
                // Rhythm-based quiz
                question = "What is rhythm in music?";
                
                correctAnswer = "The pattern of beats and silences in music";
                
                options = [
                    correctAnswer,
                    "The loudness or softness of music",
                    "The speed of music",
                    "The different sounds made by instruments"
                ];
            } else {
                // Mixed mode quiz - choose pattern or rhythm concepts
                const quizType = Math.random() < 0.5 ? 'pattern' : 'concepts';
                
                if (quizType === 'pattern') {
                    // Pattern sequence quiz
                    question = "If the pattern is Red, Blue, Yellow, Red, what comes next?";
                    
                    correctAnswer = "Blue";
                    
                    options = [
                        correctAnswer,
                        "Red",
                        "Yellow",
                        "Green"
                    ];
                } else {
                    // Music concept quiz
                    question = "What happens when you follow a pattern in music?";
                    
                    correctAnswer = "You create rhythm and structure";
                    
                    options = [
                        correctAnswer,
                        "The music gets louder",
                        "The music gets faster",
                        "Nothing happens"
                    ];
                }
            }
            
            // Shuffle options
            options = shuffleArray(options);
            
            // Update quiz state
            gameState.currentQuiz = {
                question,
                options,
                correctAnswer,
                userAnswer: ''
            };
            
            // Update quiz display
            updateQuizDisplay();
        }
        
        // Update quiz display
        function updateQuizDisplay() {
            // Set question
            elements.displays.quizQuestion.textContent = gameState.currentQuiz.question;
            
            // Clear options
            elements.displays.quizOptions.innerHTML = '';
            
            // Add options
            gameState.currentQuiz.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', function() {
                    selectQuizOption(this);
                });
                elements.displays.quizOptions.appendChild(optionElement);
            });
        }
        
        // Select a quiz option
        function selectQuizOption(optionElement) {
            // Clear previous selections
            const options = elements.displays.quizOptions.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select the clicked option
            optionElement.classList.add('selected');
            
            // Play select sound
            playSelectSound();
            
            // Store user's answer
            gameState.currentQuiz.userAnswer = optionElement.textContent;
        }
        
        // Check quiz answer
        function checkQuizAnswer() {
            if (!gameState.currentQuiz.userAnswer) {
                // No answer selected
                elements.characters.beatQuizBubble.textContent = "Please select an answer first!";
                elements.characters.beatQuizBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.beatQuizBubble.style.opacity = '0';
                }, 3000);
                return;
            }
            
            // Check if answer is correct
            if (gameState.currentQuiz.userAnswer === gameState.currentQuiz.correctAnswer) {
                // Correct answer
                
                // Visual celebration
                if (gameState.settings.particles) {
                    createParticleEffect();
                }
                
                // Play success sound
                playSuccessSound();
                
                // Show celebration message
                elements.characters.melodyQuizBubble.textContent = "Excellent! That's correct!";
                elements.characters.melodyQuizBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.melodyQuizBubble.style.opacity = '0';
                }, 3000);
                
                // Bonus points for correct quiz answer
                gameState.score += 100 * gameState.level;
                
                // Highlight correct answer
                const options = elements.displays.quizOptions.querySelectorAll('.quiz-option');
                options.forEach(option => {
                    if (option.textContent === gameState.currentQuiz.correctAnswer) {
                        option.classList.add('correct');
                    }
                });
            } else {
                // Incorrect answer
                
                // Play error sound
                playErrorSound();
                
                // Show hint message
                elements.characters.melodyQuizBubble.textContent = `Not quite. The correct answer is: ${gameState.currentQuiz.correctAnswer}`;
                elements.characters.melodyQuizBubble.style.opacity = '1';
                
                setTimeout(() => {
                    elements.characters.melodyQuizBubble.style.opacity = '0';
                }, 5000);
                
                // Highlight correct and incorrect answers
                const options = elements.displays.quizOptions.querySelectorAll('.quiz-option');
                options.forEach(option => {
                    if (option.textContent === gameState.currentQuiz.correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });
            }
            
            // Proceed to results after delay
            setTimeout(() => {
                showResults();
            }, 3000);
        }
        
        // Show results screen
        function showResults() {
            // Update final score
            elements.displays.finalScore.textContent = gameState.score;
            
            // Generate result message based on level and score
            let message = '';
            
            if (gameState.level < 3) {
                message = "Great start! Keep practicing to become a Tiles Hop master!";
            } else if (gameState.level < 5) {
                message = "Awesome job! You're getting really good at this!";
            } else {
                message = "Incredible! You have amazing pattern recognition skills!";
            }
            
            elements.displays.resultMessage.textContent = message;
            
            // Show appropriate buttons
            elements.buttons.nextLevelBtn.style.display = 'inline-block';
            elements.buttons.replayBtn.style.display = 'inline-block';
            elements.buttons.mainMenuBtn.style.display = 'inline-block';
            
            // Show results screen
            showScreen('resultsScreen');
        }
        
        // Proceed to next level
        function nextLevel() {
            // Increment level
            gameState.level++;
            
            // Load the next level
            loadLevel(gameState.level);
            
            // Show game screen
            showScreen('gameScreen');
        }
        
        // Replay current level
        function replayLevel() {
            // Reset score for the level
            gameState.score = Math.max(0, gameState.score - (100 * gameState.level));
            
            // Reset lives if depleted
            if (gameState.lives <= 0) {
                gameState.lives = 3;
                updateLivesDisplay();
            }
            
            // Load the current level again
            loadLevel(gameState.level);
            
            // Show game screen
            showScreen('gameScreen');
        }
        
        // Reset the game
        function resetGame() {
            gameState.score = 0;
            gameState.level = 1;
            gameState.lives = 3;
            gameState.isPlaying = false;
            gameState.isPaused = false;
            
            // Clear all animations
            clearAllAnimations();
        }
        
        // Toggle pause state
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                elements.buttons.pauseBtn.textContent = 'Resume';
                
                // Show pause message
                elements.characters.beatGameBubble.textContent = "Game paused! Click Resume when you're ready.";
                elements.characters.beatGameBubble.style.opacity = '1';
            } else {
                elements.buttons.pauseBtn.textContent = 'Pause';
                
                // Hide pause message
                elements.characters.beatGameBubble.style.opacity = '0';
            }
        }
        
        // Update score display
        function updateScoreDisplay() {
            elements.displays.scoreDisplay.textContent = `Score: ${gameState.score}`;
        }
        
        // Update lives display
        function updateLivesDisplay() {
            const heartsText = '❤️'.repeat(gameState.lives);
            elements.displays.livesDisplay.textContent = `Lives: ${heartsText}`;
        }
        
        // Play tile sound
        function playTileSound(tileIndex) {
            if (audioContext && gameState.settings.volume > 0) {
                // Create an oscillator
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // Set oscillator type and frequency based on tile index
                // Use a pentatonic scale for pleasant sounds
                const pentatonicScale = [523.25, 587.33, 659.25, 783.99, 880.00]; // C5, D5, E5, G5, A5
                const baseNote = pentatonicScale[tileIndex % pentatonicScale.length];
                const octave = Math.floor(tileIndex / pentatonicScale.length);
                const frequency = baseNote * Math.pow(2, octave / 2);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                
                // Set volume
                gainNode.gain.setValueAtTime(gameState.settings.volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                
                // Connect nodes
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Play sound
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }
        
        // Play button sound
        function playButtonSound() {
            if (audioContext && gameState.settings.volume > 0) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(gameState.settings.volume * 0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            }
        }
        
        // Play select sound
        function playSelectSound() {
            if (audioContext && gameState.settings.volume > 0) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(gameState.settings.volume * 0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            }
        }
        
        // Play success sound
        function playSuccessSound() {
            if (audioContext && gameState.settings.volume > 0) {
                const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                
                notes.forEach((frequency, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime + index * 0.1);
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime + index * 0.1);
                    gainNode.gain.linearRampToValueAtTime(gameState.settings.volume * 0.4, audioContext.currentTime + index * 0.1 + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + index * 0.1 + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime + index * 0.1);
                    oscillator.stop(audioContext.currentTime + index * 0.1 + 0.3);
                });
            }
        }
        
        // Play error sound
        function playErrorSound() {
            if (audioContext && gameState.settings.volume > 0) {
                const frequencies = [349.23, 329.63, 311.13]; // F4, E4, D#4/Eb4
                
                frequencies.forEach((frequency, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime + index * 0.15);
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime + index * 0.15);
                    gainNode.gain.linearRampToValueAtTime(gameState.settings.volume * 0.4, audioContext.currentTime + index * 0.15 + 0.01);
                    gainNode.gain.linearRampToValueAtTime(0.001, audioContext.currentTime + index * 0.15 + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime + index * 0.15);
                    oscillator.stop(audioContext.currentTime + index * 0.15 + 0.3);
                });
            }
        }
        
        // Create particle effect
        function createParticleEffect() {
            if (!gameState.settings.particles) return;
            
            // Clear any existing particles
            clearParticles();
            
            // Create stars or bubbles
            const particleCount = 30;
            const particleTypes = ['star', 'bubble'];
            
            for (let i = 0; i < particleCount; i++) {
                const particleType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
                createParticle(particleType);
            }
        }
        
        // Create a single particle
        function createParticle(type) {
            const container = document.getElementById('game-container');
            
            if (type === 'star') {
                // Create a star
                const star = document.createElement('div');
                star.className = 'star';
                
                // Random position
                const x = Math.random() * container.clientWidth;
                const y = Math.random() * container.clientHeight;
                
                // Random size
                const size = Math.random() * 30 + 10;
                
                // Star SVG
                star.innerHTML = `
                    <svg width="${size}" height="${size}" viewBox="0 0 51 48">
                        <path fill="#FFD700" d="m25,1 6,17h18l-14,11 5,17-15-10-15,10 5-17-14-11h18z"/>
                    </svg>
                `;
                
                star.style.left = `${x}px`;
                star.style.top = `${y}px`;
                container.appendChild(star);
                
                // Animation
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                const dx = Math.cos(angle) * speed;
                const dy = Math.sin(angle) * speed;
                
                let opacity = 1;
                let posX = x;
                let posY = y;
                
                const animation = setInterval(() => {
                    opacity -= 0.01;
                    posX += dx;
                    posY += dy;
                    
                    star.style.opacity = opacity;
                    star.style.left = `${posX}px`;
                    star.style.top = `${posY}px`;
                    
                    if (opacity <= 0) {
                        clearInterval(animation);
                        star.remove();
                        
                        // Remove from animations array
                        const index = gameState.animations.timers.indexOf(animation);
                        if (index > -1) {
                            gameState.animations.timers.splice(index, 1);
                        }
                    }
                }, 20);
                
                // Add to animations
                gameState.animations.particles.push(star);
                gameState.animations.timers.push(animation);
            } else {
                // Create a bubble
                const bubble = document.createElement('div');
                bubble.className = 'particle';
                
                // Random position
                const x = Math.random() * container.clientWidth;
                const y = container.clientHeight + 20;
                
                // Random size
                const size = Math.random() * 40 + 20;
                
                // Random color
                const colors = ['#FF9A00', '#4b0082', '#4CAF50', '#f44336', '#2196F3'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.borderRadius = '50%';
                bubble.style.backgroundColor = color;
                bubble.style.position = 'absolute';
                bubble.style.left = `${x}px`;
                bubble.style.top = `${y}px`;
                bubble.style.opacity = '0.7';
                container.appendChild(bubble);
                
                // Animation
                const speed = Math.random() * 3 + 1;
                let posY = y;
                
                const animation = setInterval(() => {
                    posY -= speed;
                    bubble.style.top = `${posY}px`;
                    
                    if (posY < -size) {
                        clearInterval(animation);
                        bubble.remove();
                        
                        // Remove from animations array
                        const index = gameState.animations.timers.indexOf(animation);
                        if (index > -1) {
                            gameState.animations.timers.splice(index, 1);
                        }
                    }
                }, 20);
                
                // Add to animations
                gameState.animations.particles.push(bubble);
                gameState.animations.timers.push(animation);
            }
        }
        
        // Clear all particles
        function clearParticles() {
            // Remove all particles
            gameState.animations.particles.forEach(particle => {
                if (particle.parentNode) {
                    particle.remove();
                }
            });
            
            // Clear all animation timers
            gameState.animations.timers.forEach(timer => {
                clearInterval(timer);
            });
            
            // Reset arrays
            gameState.animations.particles = [];
            gameState.animations.timers = [];
        }
        
        // Clear all animations
        function clearAllAnimations() {
            clearParticles();
        }
        
        // Helper function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Add shake animation to CSS
        const style = document.createElement('style');
        style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        `;
        document.head.appendChild(style);
        
        // Initialize the game when the window loads
        window.addEventListener('load', initGame);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // Recreate tiles with new dimensions if the game is active
            if (document.getElementById('game-screen').classList.contains('visible')) {
                createTiles();
            }
        });
        
        // Initialize audio context on first user interaction to comply with browser policies
        document.addEventListener('click', () => {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.error('Web Audio API is not supported in this browser');
                }
            }
        }, { once: true });
    </script>
</body>
</html>