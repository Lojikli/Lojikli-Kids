<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Explorer: Fun Timers for Kids</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        :root {
            --primary: #FF9F00;
            --secondary: #5B92E5;
            --tertiary: #FF5C8D;
            --background: #F0F8FF;
            --text: #333333;
            --light: #FFFFFF;
            --dark: #222222;
            --success: #4CAF50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--light);
            padding: 20px;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 15px 0;
            color: var(--primary);
        }
        
        .card {
            background-color: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .btn {
            background-color: var(--primary);
            color: var(--light);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background-color: var(--secondary);
            transform: scale(1.05);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-tertiary {
            background-color: var(--tertiary);
        }
        
        .timer-display {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .timer-card {
            width: 300px;
            min-height: 400px;
            background-color: var(--light);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }
        
        .timer-title {
            color: var(--secondary);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .timer-canvas {
            width: 100%;
            height: 250px;
            margin: 10px 0;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        #create-timer-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
        }
        
        .tab-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: var(--light);
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            box-shadow: 0 -4px 8px rgba(0,0,0,0.05);
        }
        
        .tab.active {
            background-color: var(--primary);
            color: var(--light);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background-color: var(--light);
            border-radius: 0 15px 15px 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .character {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 999;
            cursor: pointer;
        }
        
        .speech-bubble {
            position: absolute;
            top: -100px;
            right: 0;
            background-color: var(--light);
            border-radius: 20px;
            padding: 15px;
            width: 200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            right: 30px;
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: var(--light) transparent transparent;
        }
        
        .speech-bubble.visible {
            opacity: 1;
        }
        
        .emoji-animation {
            position: absolute;
            font-size: 2rem;
            opacity: 0;
            pointer-events: none;
            transform: translateY(0);
            animation: float 2s forwards;
        }
        
        @keyframes float {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px);
            }
        }
        
        input[type="text"], input[type="number"], select {
            padding: 8px 12px;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            font-size: 1rem;
            margin: 5px 0;
            background-color: var(--light);
        }
        
        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91, 146, 229, 0.3);
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--light);
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 10px;
            padding: 10px;
        }
        
        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--light);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .quiz-option {
            background-color: var(--background);
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .quiz-option:hover {
            background-color: var(--primary);
            color: var(--light);
        }
        
        .quiz-option.correct {
            background-color: var(--success);
            color: var(--light);
        }
        
        .quiz-option.incorrect {
            background-color: var(--tertiary);
            color: var(--light);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: var(--light);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .fun-fact {
            background-color: rgba(91, 146, 229, 0.1);
            border-left: 4px solid var(--secondary);
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        @media (max-width: 768px) {
            .timer-display {
                flex-direction: column;
                align-items: center;
            }
            
            .timer-card {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Time Explorer</h1>
            <p>Learn about time with fun timers!</p>
        </header>
        
        <div class="tab-container">
            <div class="tab active" data-tab="timers">Timers</div>
            <div class="tab" data-tab="learn">Learn About Time</div>
            <div class="tab" data-tab="quiz">Time Quiz</div>
            <div class="tab" data-tab="sandbox">Time Sandbox</div>
        </div>
        
        <div class="tab-content active" id="timers">
            <h2>My Fun Timers</h2>
            <p>Create your own timers for different activities!</p>
            
            <div class="card">
                <h3>Create a New Timer</h3>
                <div class="form-group">
                    <label for="timer-name">Timer Name:</label>
                    <input type="text" id="timer-name" placeholder="Enter a name for your timer">
                </div>
                <div class="form-group">
                    <label for="timer-minutes">Minutes:</label>
                    <input type="number" id="timer-minutes" min="0" max="60" value="5">
                </div>
                <div class="form-group">
                    <label for="timer-seconds">Seconds:</label>
                    <input type="number" id="timer-seconds" min="0" max="59" value="0">
                </div>
                <div class="form-group">
                    <label for="timer-type">Timer Type:</label>
                    <select id="timer-type">
                        <option value="sand">Sand Timer</option>
                        <option value="analog">Analog Clock</option>
                        <option value="digital">Digital Clock</option>
                        <option value="water">Water Timer</option>
                        <option value="candle">Candle Timer</option>
                        <option value="orbit">Planet Orbit Timer</option>
                    </select>
                </div>
                <button id="create-timer-btn" class="btn">Create Timer</button>
            </div>
            
            <div class="timer-display" id="timer-container">
                <!-- Timers will be added here dynamically -->
            </div>
        </div>
        
        <div class="tab-content" id="learn">
            <h2>Learn About Time</h2>
            
            <div class="card">
                <h3>What Is Time?</h3>
                <p>Time is how we measure when things happen. It's like an invisible ruler that helps us organize our day!</p>
                
                <div class="fun-fact">
                    <strong>Fun Fact:</strong> Did you know that time moves slightly slower when you're high up? This is what scientists call "time dilation" and was discovered by Albert Einstein!
                </div>
                
                <div id="time-concept-canvas" class="timer-canvas"></div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>How We Measure Time</h3>
                    <p>People measure time in many ways:</p>
                    <ul>
                        <li>Seconds</li>
                        <li>Minutes (60 seconds)</li>
                        <li>Hours (60 minutes)</li>
                        <li>Days (24 hours)</li>
                        <li>Weeks (7 days)</li>
                        <li>Months (about 30 days)</li>
                        <li>Years (12 months or 365 days)</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>Types of Clocks</h3>
                    <p>There are many ways to tell time:</p>
                    <ul>
                        <li><strong>Sundials</strong> - Use shadows from the sun</li>
                        <li><strong>Sand Timers</strong> - Sand falls from top to bottom</li>
                        <li><strong>Analog Clocks</strong> - Have moving hands</li>
                        <li><strong>Digital Clocks</strong> - Show numbers</li>
                        <li><strong>Atomic Clocks</strong> - The most precise in the world!</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>The Science of Time</h3>
                    <p>Scientists like Albert Einstein discovered that time isn't the same everywhere!</p>
                    <p>Time can actually slow down when:</p>
                    <ul>
                        <li>You move very, very fast</li>
                        <li>You're near something very heavy, like Earth</li>
                    </ul>
                    <p>This is called "relativity" and it's a very special discovery!</p>
                </div>
                
                <div class="card">
                    <h3>Time Around the World</h3>
                    <p>When it's daytime for you, it might be nighttime for someone else!</p>
                    <p>The world is divided into "time zones" so people can keep track of time in different places.</p>
                    <div id="world-time-canvas" class="timer-canvas"></div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="quiz">
            <h2>Test Your Time Knowledge!</h2>
            
            <div class="quiz-container" id="quiz-area">
                <h3 id="quiz-question">Question will appear here</h3>
                <div id="quiz-options"></div>
                <div id="quiz-feedback" style="margin: 15px 0;"></div>
                <button id="next-question-btn" class="btn">Start Quiz</button>
            </div>
        </div>
        
        <div class="tab-content" id="sandbox">
            <h2>Time Experiment Sandbox</h2>
            <p>Change these settings to see how time works in different situations!</p>
            
            <div class="grid">
                <div class="card">
                    <h3>Time Dilation Experiment</h3>
                    <p>Moving clocks run slower! This is called "time dilation".</p>
                    
                    <div class="form-group">
                        <label for="speed-slider">Speed (% of light speed):</label>
                        <input type="range" id="speed-slider" min="0" max="99" value="0" class="slider">
                        <span id="speed-value">0%</span>
                    </div>
                    
                    <div id="dilation-canvas" class="timer-canvas"></div>
                    <p id="dilation-result">At normal speed, 10 seconds for you is 10 seconds for everyone else.</p>
                </div>
                
                <div class="card">
                    <h3>Gravitational Time Effects</h3>
                    <p>Gravity can also affect how time passes!</p>
                    
                    <div class="form-group">
                        <label for="gravity-slider">Gravity Strength:</label>
                        <input type="range" id="gravity-slider" min="1" max="100" value="10" class="slider">
                        <span id="gravity-value">Earth (1g)</span>
                    </div>
                    
                    <div id="gravity-canvas" class="timer-canvas"></div>
                    <p id="gravity-result">At Earth's gravity, time passes normally.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="character" id="time-buddy">
        <svg width="150" height="150" viewBox="0 0 200 200">
            <!-- Character Body -->
            <circle cx="100" cy="100" r="70" fill="#FFD700" stroke="#FF9F00" stroke-width="5"/>
            
            <!-- Face -->
            <circle cx="70" cy="80" r="10" fill="#333"/> <!-- Left eye -->
            <circle cx="130" cy="80" r="10" fill="#333"/> <!-- Right eye -->
            
            <!-- Mouth -->
            <path d="M70 120 Q100 150 130 120" stroke="#333" stroke-width="5" fill="none"/>
            
            <!-- Clock hands -->
            <line id="hour-hand" x1="100" y1="100" x2="100" y2="70" stroke="#333" stroke-width="6" stroke-linecap="round"/>
            <line id="minute-hand" x1="100" y1="100" x2="130" y2="100" stroke="#333" stroke-width="4" stroke-linecap="round"/>
            
            <!-- Hat -->
            <path d="M60 50 L140 50 L150 30 L50 30 Z" fill="#5B92E5" stroke="#333" stroke-width="2"/>
        </svg>
        
        <div class="speech-bubble" id="buddy-speech">
            <p>Hi! I'm Timey! Click on me for time facts and help!</p>
        </div>
    </div>
    
    <script>
        // Global Variables
        const timers = [];
        let activeSketches = [];
        let currentQuizIndex = 0;
        let characterMessages = [
            "Time is like a river that flows in only one direction!",
            "Did you know that light takes 8 minutes to travel from the Sun to Earth?",
            "A day on Venus is longer than a year on Venus!",
            "The word 'clock' comes from the Latin word 'clocca' which means 'bell'!",
            "Your heartbeat is like your own personal clock!",
            "Time flies when you're having fun because your brain pays less attention to it!",
            "The fastest animal is the peregrine falcon which can dive at 240 miles per hour!",
            "Clocks on GPS satellites run slightly faster than clocks on Earth due to less gravity!",
            "Some animals, like bees, can tell time using the position of the Sun!",
            "Ancient people used water clocks called 'clepsydras' to measure time!"
        ];
        
        // Quiz questions
        const quizQuestions = [
            {
                question: "How many seconds are in a minute?",
                options: ["30 seconds", "60 seconds", "100 seconds", "10 seconds"],
                answer: 1
            },
            {
                question: "Which shows time with moving hands?",
                options: ["Digital clock", "Analog clock", "Sand timer", "Stopwatch"],
                answer: 1
            },
            {
                question: "How many hours are in a day?",
                options: ["12 hours", "24 hours", "10 hours", "60 hours"],
                answer: 1
            },
            {
                question: "What do we call it when sand falls from top to bottom to measure time?",
                options: ["Water clock", "Sundial", "Digital timer", "Sand timer"],
                answer: 3
            },
            {
                question: "If it's daytime where you are, what is it on the opposite side of the world?",
                options: ["Also daytime", "Nighttime", "Evening", "Morning"],
                answer: 1
            },
            {
                question: "How many minutes are in an hour?",
                options: ["24 minutes", "100 minutes", "60 minutes", "30 minutes"],
                answer: 2
            },
            {
                question: "Which scientist discovered that time can slow down when you move very fast?",
                options: ["Albert Einstein", "Isaac Newton", "Marie Curie", "Thomas Edison"],
                answer: 0
            },
            {
                question: "What's the most accurate type of clock in the world?",
                options: ["Digital clock", "Sand timer", "Sundial", "Atomic clock"],
                answer: 3
            },
            {
                question: "If it's 3:00, where is the hour hand pointing?",
                options: ["To the 12", "To the 3", "To the 6", "To the 9"],
                answer: 1
            },
            {
                question: "What happens to time when you're near something very heavy like a black hole?",
                options: ["Time speeds up", "Time stops completely", "Time slows down", "Time moves backward"],
                answer: 2
            }
        ];
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and content
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                    
                    // Clear any p5 canvases when switching tabs to avoid performance issues
                    cleanupSketches();
                    
                    // Initialize p5 sketches for the active tab
                    if (tab.dataset.tab === 'learn') {
                        initTimeConceptSketch();
                        initWorldTimeSketch();
                    } else if (tab.dataset.tab === 'sandbox') {
                        initDilationSketch();
                        initGravitySketch();
                    }
                });
            });
            
            // Create timer button
            document.getElementById('create-timer-btn').addEventListener('click', createNewTimer);
            
            // Quiz button
            document.getElementById('next-question-btn').addEventListener('click', function() {
                if (this.textContent === 'Start Quiz') {
                    this.textContent = 'Next Question';
                    showQuizQuestion(0);
                } else {
                    showQuizQuestion(currentQuizIndex + 1);
                }
            });
            
            // Character interaction
            document.getElementById('time-buddy').addEventListener('click', showCharacterMessage);
            
            // Sliders in sandbox
            document.getElementById('speed-slider').addEventListener('input', function() {
                const speedValue = this.value;
                document.getElementById('speed-value').textContent = speedValue + '%';
                updateDilationResult(speedValue);
            });
            
            document.getElementById('gravity-slider').addEventListener('input', function() {
                const gravityValue = this.value;
                let gravityLabel;
                
                if (gravityValue <= 10) {
                    gravityLabel = 'Earth (' + gravityValue + 'g)';
                } else if (gravityValue <= 30) {
                    gravityLabel = 'Jupiter-like (' + gravityValue + 'g)';
                } else if (gravityValue <= 60) {
                    gravityLabel = 'Neutron Star-like (' + gravityValue + 'g)';
                } else {
                    gravityLabel = 'Black Hole-like (' + gravityValue + 'g)';
                }
                
                document.getElementById('gravity-value').textContent = gravityLabel;
                updateGravityResult(gravityValue);
            });
            
            // Create an initial timer for the user
            createDefaultTimer();
        });
        
        // Timer Functions
        function createNewTimer() {
            const name = document.getElementById('timer-name').value || 'My Timer';
            const minutes = parseInt(document.getElementById('timer-minutes').value) || 5;
            const seconds = parseInt(document.getElementById('timer-seconds').value) || 0;
            const type = document.getElementById('timer-type').value;
            
            const totalSeconds = (minutes * 60) + seconds;
            
            if (totalSeconds <= 0) {
                alert('Please set a time greater than 0!');
                return;
            }
            
            const timerId = 'timer-' + Date.now();
            const timer = {
                id: timerId,
                name: name,
                totalSeconds: totalSeconds,
                remainingSeconds: totalSeconds,
                type: type,
                isRunning: false,
                interval: null,
                sketch: null
            };
            
            timers.push(timer);
            createTimerElement(timer);
            
            // Reset form
            document.getElementById('timer-name').value = '';
            document.getElementById('timer-minutes').value = 5;
            document.getElementById('timer-seconds').value = 0;
            
            // Show speech bubble with encouragement
            showSpeechBubble("Great job creating a timer! Now press Start to begin!");
        }
        
        function createDefaultTimer() {
            const timer = {
                id: 'timer-default',
                name: 'My First Timer',
                totalSeconds: 300, // 5 minutes
                remainingSeconds: 300,
                type: 'sand',
                isRunning: false,
                interval: null,
                sketch: null
            };
            
            timers.push(timer);
            createTimerElement(timer);
        }
        
        function createTimerElement(timer) {
            const timerCard = document.createElement('div');
            timerCard.className = 'timer-card';
            timerCard.id = timer.id + '-card';
            
            timerCard.innerHTML = `
                <h3 class="timer-title">${timer.name}</h3>
                <div id="${timer.id}-canvas" class="timer-canvas"></div>
                <p id="${timer.id}-display">${formatTime(timer.remainingSeconds)}</p>
                <div class="timer-controls">
                    <button id="${timer.id}-start" class="btn">Start</button>
                    <button id="${timer.id}-reset" class="btn btn-secondary">Reset</button>
                    <button id="${timer.id}-delete" class="btn btn-tertiary">Delete</button>
                </div>
            `;
            
            document.getElementById('timer-container').appendChild(timerCard);
            
            // Initialize p5 sketch for this timer
            initTimerSketch(timer);
            
            // Add event listeners for timer controls
            document.getElementById(`${timer.id}-start`).addEventListener('click', function() {
                if (timer.isRunning) {
                    pauseTimer(timer);
                    this.textContent = 'Start';
                } else {
                    startTimer(timer);
                    this.textContent = 'Pause';
                }
            });
            
            document.getElementById(`${timer.id}-reset`).addEventListener('click', function() {
                resetTimer(timer);
            });
            
            document.getElementById(`${timer.id}-delete`).addEventListener('click', function() {
                deleteTimer(timer);
            });
        }
        
        function startTimer(timer) {
            if (timer.isRunning) return;
            
            timer.isRunning = true;
            timer.interval = setInterval(function() {
                timer.remainingSeconds--;
                
                updateTimerDisplay(timer);
                
                if (timer.remainingSeconds <= 0) {
                    clearInterval(timer.interval);
                    timer.isRunning = false;
                    document.getElementById(`${timer.id}-start`).textContent = 'Start';
                    
                    // Celebration animation
                    celebrateTimerCompletion(timer);
                    
                    // Speech bubble
                    showSpeechBubble("Time's up! Great job waiting!");
                }
            }, 1000);
        }
        
        function pauseTimer(timer) {
            if (!timer.isRunning) return;
            
            clearInterval(timer.interval);
            timer.isRunning = false;
        }
        
        function resetTimer(timer) {
            pauseTimer(timer);
            timer.remainingSeconds = timer.totalSeconds;
            updateTimerDisplay(timer);
            document.getElementById(`${timer.id}-start`).textContent = 'Start';
        }
        
        function deleteTimer(timer) {
            pauseTimer(timer);
            
            const timerIndex = timers.findIndex(t => t.id === timer.id);
            if (timerIndex !== -1) {
                timers.splice(timerIndex, 1);
            }
            
            const timerCard = document.getElementById(`${timer.id}-card`);
            if (timerCard) {
                timerCard.remove();
            }
            
            // Clean up sketch
            if (timer.sketch && typeof timer.sketch.remove === 'function') {
                timer.sketch.remove();
            }
        }
        
        function updateTimerDisplay(timer) {
            const displayElement = document.getElementById(`${timer.id}-display`);
            if (displayElement) {
                displayElement.textContent = formatTime(timer.remainingSeconds);
            }
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function celebrateTimerCompletion(timer) {
            const timerCard = document.getElementById(`${timer.id}-card`);
            
            // Add some celebratory emojis
            const emojis = ['🎉', '⭐', '🎊', '👏', '🌟'];
            
            for (let i = 0; i < 10; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji-animation';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.left = Math.random() * 100 + '%';
                emoji.style.animationDelay = (Math.random() * 0.5) + 's';
                
                timerCard.appendChild(emoji);
                
                // Remove emoji after animation
                setTimeout(() => {
                    emoji.remove();
                }, 2000);
            }
        }
        
        // P5.js Sketch Functions
        function initTimerSketch(timer) {
            const sketch = function(p) {
                let canvasWidth, canvasHeight;
                
                p.setup = function() {
                    const canvasContainer = document.getElementById(`${timer.id}-canvas`);
                    if (!canvasContainer) return;
                    
                    canvasWidth = canvasContainer.offsetWidth;
                    canvasHeight = canvasContainer.offsetHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.frameRate(30);
                };
                
                p.draw = function() {
                    p.clear();
                    p.background(255, 255, 255, 0);
                    
                    const percentage = timer.remainingSeconds / timer.totalSeconds;
                    
                    switch(timer.type) {
                        case 'sand':
                            drawSandTimer(p, percentage);
                            break;
                        case 'analog':
                            drawAnalogClock(p, timer.remainingSeconds);
                            break;
                        case 'digital':
                            drawDigitalClock(p, timer.remainingSeconds);
                            break;
                        case 'water':
                            drawWaterTimer(p, percentage);
                            break;
                        case 'candle':
                            drawCandleTimer(p, percentage);
                            break;
                        case 'orbit':
                            drawOrbitTimer(p, percentage);
                            break;
                        default:
                            drawSandTimer(p, percentage);
                    }
                };
                
                function drawSandTimer(p, percentage) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const width = canvasWidth * 0.6;
                    const height = canvasHeight * 0.8;
                    
                    // Hourglass outline
                    p.stroke(91, 146, 229);
                    p.strokeWeight(3);
                    p.fill(240, 248, 255, 50);
                    
                    // Top half
                    p.beginShape();
                    p.vertex(centerX - width/2, centerY - height/2);
                    p.vertex(centerX + width/2, centerY - height/2);
                    p.vertex(centerX + width/6, centerY);
                    p.vertex(centerX - width/6, centerY);
                    p.endShape(p.CLOSE);
                    
                    // Bottom half
                    p.beginShape();
                    p.vertex(centerX - width/6, centerY);
                    p.vertex(centerX + width/6, centerY);
                    p.vertex(centerX + width/2, centerY + height/2);
                    p.vertex(centerX - width/2, centerY + height/2);
                    p.endShape(p.CLOSE);
                    
                    // Sand in top half
                    p.noStroke();
                    p.fill(255, 159, 0);
                    
                    // Calculate how much sand is in top half
                    const topSandHeight = (height/2) * percentage;
                    
                    if (percentage > 0) {
                        p.beginShape();
                        p.vertex(centerX - width/2, centerY - height/2);
                        p.vertex(centerX + width/2, centerY - height/2);
                        p.vertex(centerX + width/6, centerY - height/2 + topSandHeight);
                        p.vertex(centerX - width/6, centerY - height/2 + topSandHeight);
                        p.endShape(p.CLOSE);
                    }
                    
                    // Sand in bottom half
                    const bottomSandHeight = (height/2) * (1 - percentage);
                    
                    if (percentage < 1) {
                        p.beginShape();
                        p.vertex(centerX - width/6, centerY);
                        p.vertex(centerX + width/6, centerY);
                        p.vertex(centerX + width/2 - (width/3) * (1 - bottomSandHeight/(height/2)), centerY + bottomSandHeight);
                        p.vertex(centerX - width/2 + (width/3) * (1 - bottomSandHeight/(height/2)), centerY + bottomSandHeight);
                        p.endShape(p.CLOSE);
                    }
                    
                    // Falling sand particles
                    if (timer.isRunning && percentage > 0) {
                        p.fill(255, 159, 0);
                        for (let i = 0; i < 3; i++) {
                            const particleX = centerX + p.random(-2, 2);
                            const particleY = centerY - (height/4) + p.random(0, height/2) * p.sin(p.frameCount/10 + i);
                            p.ellipse(particleX, particleY, 3, 3);
                        }
                    }
                }
                
                function drawAnalogClock(p, seconds) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const radius = Math.min(canvasWidth, canvasHeight) * 0.4;
                    
                    // Clock face
                    p.fill(255);
                    p.stroke(91, 146, 229);
                    p.strokeWeight(4);
                    p.ellipse(centerX, centerY, radius * 2, radius * 2);
                    
                    // Hour markers
                    p.stroke(0);
                    p.strokeWeight(2);
                    for (let i = 0; i < 12; i++) {
                        const angle = i * p.TWO_PI / 12;
                        const x1 = centerX + (radius - 10) * p.cos(angle - p.PI/2);
                        const y1 = centerY + (radius - 10) * p.sin(angle - p.PI/2);
                        const x2 = centerX + radius * p.cos(angle - p.PI/2);
                        const y2 = centerY + radius * p.sin(angle - p.PI/2);
                        p.line(x1, y1, x2, y2);
                        
                        // Add numbers
                        const numX = centerX + (radius - 30) * p.cos(angle - p.PI/2);
                        const numY = centerY + (radius - 30) * p.sin(angle - p.PI/2);
                        p.noStroke();
                        p.fill(0);
                        p.textSize(16);
                        p.textAlign(p.CENTER, p.CENTER);
                        p.text((i === 0 ? 12 : i), numX, numY);
                    }
                    
                    // Calculate angles based on remaining time
                    const totalMinutes = seconds / 60;
                    const hours = totalMinutes / 60;
                    const minutes = totalMinutes % 60;
                    const secondsAngle = (seconds % 60) * p.TWO_PI / 60;
                    const minutesAngle = minutes * p.TWO_PI / 60;
                    const hoursAngle = hours * p.TWO_PI / 12;
                    
                    // Hour hand
                    p.stroke(0);
                    p.strokeWeight(6);
                    p.line(centerX, centerY, 
                           centerX + radius * 0.5 * p.cos(hoursAngle - p.PI/2), 
                           centerY + radius * 0.5 * p.sin(hoursAngle - p.PI/2));
                    
                    // Minute hand
                    p.stroke(0);
                    p.strokeWeight(4);
                    p.line(centerX, centerY, 
                           centerX + radius * 0.7 * p.cos(minutesAngle - p.PI/2), 
                           centerY + radius * 0.7 * p.sin(minutesAngle - p.PI/2));
                    
                    // Second hand
                    p.stroke(255, 0, 0);
                    p.strokeWeight(2);
                    p.line(centerX, centerY, 
                           centerX + radius * 0.8 * p.cos(secondsAngle - p.PI/2), 
                           centerY + radius * 0.8 * p.sin(secondsAngle - p.PI/2));
                    
                    // Center circle
                    p.fill(0);
                    p.noStroke();
                    p.ellipse(centerX, centerY, 10, 10);
                }
                
                function drawDigitalClock(p, seconds) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const width = canvasWidth * 0.8;
                    const height = canvasHeight * 0.4;
                    
                    // Digital clock background
                    p.fill(0);
                    p.stroke(91, 146, 229);
                    p.strokeWeight(4);
                    p.rect(centerX - width/2, centerY - height/2, width, height, 10);
                    
                    // Time display
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    p.fill(0, 255, 0);
                    p.noStroke();
                    p.textSize(height * 0.6);
                    p.textAlign(p.CENTER, p.CENTER);
                    p.text(timeStr, centerX, centerY);
                    
                    // Decorative elements
                    p.fill(255, 0, 0, 128);
                    p.ellipse(centerX - width/2 + 20, centerY + height/2 + 20, 10, 10);
                }
                
                function drawWaterTimer(p, percentage) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const width = canvasWidth * 0.6;
                    const height = canvasHeight * 0.8;
                    
                    // Container
                    p.stroke(91, 146, 229);
                    p.strokeWeight(3);
                    p.fill(240, 248, 255, 50);
                    p.rect(centerX - width/2, centerY - height/2, width, height, 10);
                    
                    // Water
                    const waterHeight = height * (1 - percentage);
                    p.noStroke();
                    p.fill(91, 146, 229, 200);
                    p.rect(centerX - width/2, centerY + height/2 - waterHeight, width, waterHeight, 0, 0, 10, 10);
                    
                    // Bubbles
                    if (timer.isRunning) {
                        p.fill(255, 255, 255, 150);
                        for (let i = 0; i < 5; i++) {
                            const bubbleX = centerX + p.random(-width/3, width/3);
                            const bubbleY = centerY + height/2 - p.random(0, waterHeight);
                            const bubbleSize = p.random(5, 15);
                            p.ellipse(bubbleX, bubbleY + p.sin(p.frameCount/10 + i) * 5, bubbleSize, bubbleSize);
                        }
                    }
                    
                    // Water level marker lines
                    p.stroke(0, 0, 0, 100);
                    p.strokeWeight(1);
                    for (let i = 1; i <= 4; i++) {
                        const y = centerY - height/2 + (height * i / 5);
                        p.line(centerX - width/2, y, centerX + width/2, y);
                        
                        // Add time markers
                        p.noStroke();
                        p.fill(0);
                        p.textSize(12);
                        p.textAlign(p.RIGHT, p.CENTER);
                        const timeMarker = Math.floor(timer.totalSeconds * (1 - i/5) / 60) + ":" + 
                                          (Math.floor(timer.totalSeconds * (1 - i/5) % 60)).toString().padStart(2, '0');
                        p.text(timeMarker, centerX - width/2 - 5, y);
                    }
                }
                
                function drawCandleTimer(p, percentage) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const candleWidth = canvasWidth * 0.2;
                    const candleHeight = canvasHeight * 0.7;
                    
                    // Candle holder
                    p.fill(150);
                    p.noStroke();
                    p.rect(centerX - candleWidth*1.5, centerY + candleHeight/2, candleWidth*3, candleHeight*0.1, 5);
                    
                    // Candle body
                    const remainingHeight = candleHeight * percentage;
                    p.fill(255, 220, 220);
                    p.rect(centerX - candleWidth/2, centerY + candleHeight/2 - remainingHeight, candleWidth, remainingHeight);
                    
                    // Candle wick
                    p.stroke(0);
                    p.strokeWeight(2);
                    p.line(centerX, centerY + candleHeight/2 - remainingHeight, centerX, centerY + candleHeight/2 - remainingHeight - 10);
                    
                    // Flame
                    if (timer.isRunning && percentage > 0) {
                        p.noStroke();
                        
                        // Outer flame
                        p.fill(255, 140, 0, 150);
                        p.beginShape();
                        for (let i = 0; i < p.TWO_PI; i += 0.2) {
                            const flameSize = 15 + p.sin(p.frameCount * 0.1 + i * 2) * 5;
                            const fx = centerX + p.cos(i) * flameSize * 0.7;
                            const fy = centerY + candleHeight/2 - remainingHeight - 15 + p.sin(i) * flameSize;
                            p.vertex(fx, fy);
                        }
                        p.endShape();
                        
                        // Inner flame
                        p.fill(255, 220, 0, 200);
                        p.beginShape();
                        for (let i = 0; i < p.TWO_PI; i += 0.2) {
                            const flameSize = 8 + p.sin(p.frameCount * 0.2 + i * 3) * 3;
                            const fx = centerX + p.cos(i) * flameSize * 0.5;
                            const fy = centerY + candleHeight/2 - remainingHeight - 15 + p.sin(i) * flameSize;
                            p.vertex(fx, fy);
                        }
                        p.endShape();
                    }
                    
                    // Candle markings
                    p.stroke(200, 150, 150);
                    p.strokeWeight(1);
                    for (let i = 1; i <= 5; i++) {
                        const y = centerY + candleHeight/2 - (candleHeight * i / 6);
                        p.line(centerX - candleWidth/2, y, centerX + candleWidth/2, y);
                        
                        // Add time markers
                        p.noStroke();
                        p.fill(0);
                        p.textSize(12);
                        p.textAlign(p.RIGHT, p.CENTER);
                        const timeMarker = Math.floor(timer.totalSeconds * i / 6 / 60) + ":" + 
                                          (Math.floor(timer.totalSeconds * i / 6 % 60)).toString().padStart(2, '0');
                        p.text(timeMarker, centerX - candleWidth/2 - 5, y);
                    }
                }
                
                function drawOrbitTimer(p, percentage) {
                    const centerX = canvasWidth / 2;
                    const centerY = canvasHeight / 2;
                    const orbitRadius = Math.min(canvasWidth, canvasHeight) * 0.35;
                    
                    // Space background
                    p.background(10, 10, 30, 200);
                    
                    // Stars
                    p.fill(255);
                    p.noStroke();
                    for (let i = 0; i < 50; i++) {
                        const starX = p.random(0, canvasWidth);
                        const starY = p.random(0, canvasHeight);
                        const starSize = p.random(1, 3);
                        p.ellipse(starX, starY, starSize, starSize);
                    }
                    
                    // Sun
                    p.fill(255, 200, 0);
                    p.ellipse(centerX, centerY, 40, 40);
                    
                    // Orbit path
                    p.stroke(100, 100, 100, 150);
                    p.strokeWeight(1);
                    p.noFill();
                    p.ellipse(centerX, centerY, orbitRadius * 2, orbitRadius * 2);
                    
                    // Earth
                    const angle = p.TWO_PI * (1 - percentage);
                    const earthX = centerX + orbitRadius * p.cos(angle);
                    const earthY = centerY + orbitRadius * p.sin(angle);
                    
                    p.fill(0, 100, 255);
                    p.noStroke();
                    p.ellipse(earthX, earthY, 20, 20);
                    
                    // Earth details
                    p.fill(0, 150, 0, 150);
                    p.ellipse(earthX - 3, earthY + 3, 10, 8);
                    p.ellipse(earthX + 5, earthY - 2, 8, 6);
                    
                    // Moon
                    const moonAngle = angle + p.frameCount * 0.05;
                    const moonX = earthX + 30 * p.cos(moonAngle);
                    const moonY = earthY + 30 * p.sin(moonAngle);
                    
                    p.fill(200);
                    p.ellipse(moonX, moonY, 8, 8);
                    
                    // Marker lines
                    p.stroke(255, 255, 255, 100);
                    p.strokeWeight(1);
                    for (let i = 0; i < 12; i++) {
                        const markerAngle = i * p.TWO_PI / 12;
                        const x1 = centerX + orbitRadius * p.cos(markerAngle);
                        const y1 = centerY + orbitRadius * p.sin(markerAngle);
                        const x2 = centerX + (orbitRadius + 15) * p.cos(markerAngle);
                        const y2 = centerY + (orbitRadius + 15) * p.sin(markerAngle);
                        
                        p.line(x1, y1, x2, y2);
                        
                        // Add time markers
                        const markerX = centerX + (orbitRadius + 30) * p.cos(markerAngle);
                        const markerY = centerY + (orbitRadius + 30) * p.sin(markerAngle);
                        
                        p.noStroke();
                        p.fill(255);
                        p.textSize(12);
                        p.textAlign(p.CENTER, p.CENTER);
                        
                        const timeMarker = Math.floor(timer.totalSeconds * i / 12 / 60) + ":" + 
                                          (Math.floor(timer.totalSeconds * i / 12 % 60)).toString().padStart(2, '0');
                        p.text(timeMarker, markerX, markerY);
                    }
                }
            };
            
            // Create the sketch
            let p5Instance = new p5(sketch, document.getElementById(`${timer.id}-canvas`));
            timer.sketch = p5Instance;
            
            // Add to active sketches for cleanup
            activeSketches.push(p5Instance);
        }
        
        function initTimeConceptSketch() {
            const sketch = function(p) {
                let canvasWidth, canvasHeight;
                let timeObjects = [];
                
                p.setup = function() {
                    const canvasContainer = document.getElementById('time-concept-canvas');
                    if (!canvasContainer) return;
                    
                    canvasWidth = canvasContainer.offsetWidth;
                    canvasHeight = canvasContainer.offsetHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.frameRate(30);
                    
                    // Create time objects for visualization
                    createTimeObjects();
                };
                
                p.draw = function() {
                    p.clear();
                    p.background(240, 248, 255);
                    
                    // Draw timeline
                    drawTimeline();
                    
                    // Update and draw time objects
                    timeObjects.forEach(obj => {
                        obj.update();
                        obj.display();
                    });
                };
                
                function createTimeObjects() {
                    timeObjects = [];
                    
                    // Add different time measurement objects
                    timeObjects.push(new TimeObject('Second', 60, '#FF5C8D', 2));
                    timeObjects.push(new TimeObject('Minute', 30, '#5B92E5', 1));
                    timeObjects.push(new TimeObject('Hour', 15, '#FF9F00', 0.5));
                    timeObjects.push(new TimeObject('Day', 10, '#4CAF50', 0.2));
                }
                
                function drawTimeline() {
                    p.stroke(100);
                    p.strokeWeight(2);
                    p.line(50, canvasHeight - 50, canvasWidth - 50, canvasHeight - 50);
                    
                    // Draw time markers
                    p.textSize(14);
                    p.textAlign(p.CENTER, p.TOP);
                    p.fill(0);
                    p.noStroke();
                    
                    const numMarkers = 5;
                    const markerStep = (canvasWidth - 100) / numMarkers;
                    
                    for (let i = 0; i <= numMarkers; i++) {
                        const x = 50 + i * markerStep;
                        p.line(x, canvasHeight - 50, x, canvasHeight - 40);
                        p.text(i, x, canvasHeight - 35);
                    }
                    
                    p.textAlign(p.CENTER, p.BOTTOM);
                    p.text('Time Flowing →', canvasWidth / 2, canvasHeight - 10);
                }
                
                class TimeObject {
                    constructor(label, size, color, speed) {
                        this.label = label;
                        this.size = size;
                        this.color = color;
                        this.speed = speed;
                        this.x = 50;
                        this.y = canvasHeight - 50 - size - 10;
                        this.pulseAmount = 0;
                    }
                    
                    update() {
                        this.x += this.speed;
                        if (this.x > canvasWidth - 50) {
                            this.x = 50;
                        }
                        
                        this.pulseAmount = p.sin(p.frameCount * 0.1) * 5;
                    }
                    
                    display() {
                        p.fill(this.color);
                        p.stroke(0);
                        p.strokeWeight(1);
                        p.ellipse(this.x, this.y, this.size + this.pulseAmount, this.size + this.pulseAmount);
                        
                        p.textAlign(p.CENTER, p.CENTER);
                        p.textSize(12);
                        p.fill(0);
                        p.noStroke();
                        p.text(this.label, this.x, this.y - this.size - 10);
                    }
                }
            };
            
            let p5Instance = new p5(sketch);
            activeSketches.push(p5Instance);
        }
        
        function initWorldTimeSketch() {
            const sketch = function(p) {
                let canvasWidth, canvasHeight;
                let earthRotation = 0;
                
                p.setup = function() {
                    const canvasContainer = document.getElementById('world-time-canvas');
                    if (!canvasContainer) return;
                    
                    canvasWidth = canvasContainer.offsetWidth;
                    canvasHeight = canvasContainer.offsetHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.frameRate(30);
                };
                
                p.draw = function() {
                    p.clear();
                    p.background(10, 10, 30);
                    
                    // Draw stars
                    drawStars();
                    
                    // Draw sun
                    drawSun();
                    
                    // Draw Earth
                    drawEarth();
                    
                    // Advance rotation
                    earthRotation += 0.005;
                };
                
                function drawStars() {
                    p.fill(255);
                    p.noStroke();
                    for (let i = 0; i < 50; i++) {
                        const x = p.random(canvasWidth);
                        const y = p.random(canvasHeight);
                        const size = p.random(1, 3);
                        p.ellipse(x, y, size, size);
                    }
                }
                
                function drawSun() {
                    p.fill(255, 200, 0);
                    p.noStroke();
                    p.ellipse(canvasWidth * 0.8, canvasHeight * 0.3, 40, 40);
                    
                    // Sun glow
                    for (let i = 5; i > 0; i--) {
                        p.fill(255, 200, 0, 10 * i);
                        p.ellipse(canvasWidth * 0.8, canvasHeight * 0.3, 40 + i * 6, 40 + i * 6);
                    }
                }
                
                function drawEarth() {
                    p.push();
                    p.translate(canvasWidth * 0.5, canvasHeight * 0.5);
                    p.rotate(earthRotation);
                    
                    // Earth body
                    p.fill(0, 100, 255);
                    p.stroke(255);
                    p.strokeWeight(1);
                    p.ellipse(0, 0, 100, 100);
                    
                    // Day/night terminator
                    p.noStroke();
                    p.fill(10, 10, 30, 150);
                    p.arc(0, 0, 100, 100, -p.PI/2, p.PI/2);
                    
                    // Continents (simplified)
                    p.fill(0, 150, 0);
                    p.noStroke();
                    
                    // North America
                    p.ellipse(-20, -20, 30, 25);
                    
                    // South America
                    p.ellipse(-15, 15, 15, 25);
                    
                    // Europe/Africa
                    p.ellipse(10, -10, 20, 40);
                    
                    // Asia/Australia
                    p.ellipse(25, 0, 30, 30);
                    
                    // Time zones indication
                    for (let i = 0; i < 24; i++) {
                        let angle = i * p.TWO_PI / 24;
                        let x1 = 50 * p.cos(angle);
                        let y1 = 50 * p.sin(angle);
                        let x2 = 60 * p.cos(angle);
                        let y2 = 60 * p.sin(angle);
                        
                        p.stroke(255, 100);
                        p.strokeWeight(1);
                        p.line(x1, y1, x2, y2);
                    }
                    
                    // Time indicators
                    let times = ['12 AM', '6 AM', '12 PM', '6 PM'];
                    let angles = [0, p.PI/2, p.PI, p.PI*1.5];
                    
                    for (let i = 0; i < 4; i++) {
                        let angle = angles[i];
                        let x = 70 * p.cos(angle);
                        let y = 70 * p.sin(angle);
                        
                        p.fill(255);
                        p.noStroke();
                        p.textSize(12);
                        p.textAlign(p.CENTER, p.CENTER);
                        p.text(times[i], x, y);
                    }
                    
                    p.pop();
                    
                    // Labels
                    p.textAlign(p.CENTER, p.TOP);
                    p.fill(255);
                    p.noStroke();
                    p.textSize(14);
                    p.text('When it\'s daytime here...', canvasWidth * 0.3, canvasHeight * 0.8);
                    p.text('...it\'s nighttime here!', canvasWidth * 0.7, canvasHeight * 0.8);
                }
            };
            
            let p5Instance = new p5(sketch);
            activeSketches.push(p5Instance);
        }
        
        function initDilationSketch() {
            const sketch = function(p) {
                let canvasWidth, canvasHeight;
                let normalClock, fastClock;
                
                p.setup = function() {
                    const canvasContainer = document.getElementById('dilation-canvas');
                    if (!canvasContainer) return;
                    
                    canvasWidth = canvasContainer.offsetWidth;
                    canvasHeight = canvasContainer.offsetHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.frameRate(30);
                    
                    normalClock = new Clock(canvasWidth * 0.25, canvasHeight * 0.5, 'Your Clock', false);
                    fastClock = new Clock(canvasWidth * 0.75, canvasHeight * 0.5, 'Moving Clock', true);
                };
                
                p.draw = function() {
                    p.clear();
                    p.background(240, 248, 255);
                    
                    // Get speed percentage
                    const speedPercentage = document.getElementById('speed-slider').value;
                    
                    // Update clocks
                    normalClock.update(1);
                    
                    // Calculate time dilation factor
                    // Using simplified relativistic formula: t' = t / sqrt(1 - (v^2/c^2))
                    const speedRatio = speedPercentage / 100;
                    const dilationFactor = speedRatio === 0 ? 1 : 1 / p.sqrt(1 - (speedRatio * speedRatio));
                    
                    // Invert the factor for visual display (slower time means slower clock)
                    const visualFactor = dilationFactor === 0 ? 1 : 1 / dilationFactor;
                    
                    fastClock.update(visualFactor);
                    
                    // Draw clocks
                    normalClock.display();
                    fastClock.display();
                    
                    // Draw rocket around moving clock
                    drawRocket(canvasWidth * 0.75, canvasHeight * 0.5, speedPercentage);
                    
                    // Update result text
                    updateDilationResult(speedPercentage);
                };
                
                function drawRocket(x, y, speedPercentage) {
                    p.push();
                    p.translate(x, y);
                    
                    // Make rocket vibrate based on speed
                    if (speedPercentage > 0) {
                        const vibration = p.random(-speedPercentage/20, speedPercentage/20);
                        p.translate(vibration, vibration);
                    }
                    
                    // Rocket body
                    p.fill(200);
                    p.stroke(100);
                    p.strokeWeight(2);
                    p.rect(-70, -30, 140, 60, 10);
                    
                    // Rocket nose
                    p.fill(255, 0, 0);
                    p.triangle(70, -20, 70, 20, 90, 0);
                    
                    // Windows
                    p.fill(200, 200, 255);
                    p.ellipse(0, 0, 50, 50);
                    
                    // Rocket flames
                    if (speedPercentage > 0) {
                        p.fill(255, 100, 0, 200);
                        for (let i = 0; i < 10; i++) {
                            const flameLength = p.random(20, 50) * (speedPercentage / 30);
                            p.rect(-70 - flameLength, p.random(-20, 20), flameLength, p.random(5, 10), 5);
                        }
                    }
                    
                    p.pop();
                }
                
                class Clock {
                    constructor(x, y, label, isMoving) {
                        this.x = x;
                        this.y = y;
                        this.label = label;
                        this.isMoving = isMoving;
                        this.radius = 60;
                        this.seconds = 0;
                        this.timeElapsed = 0;
                    }
                    
                    update(timeFactor) {
                        this.seconds += 0.05 * timeFactor;
                        if (this.seconds >= 60) {
                            this.seconds = 0;
                        }
                        
                        this.timeElapsed += 0.05 * timeFactor;
                    }
                    
                    display() {
                        p.push();
                        p.translate(this.x, this.y);
                        
                        // Clock face
                        p.fill(255);
                        p.stroke(0);
                        p.strokeWeight(2);
                        p.ellipse(0, 0, this.radius * 2, this.radius * 2);
                        
                        // Hour markers
                        for (let i = 0; i < 12; i++) {
                            let angle = i * p.TWO_PI / 12;
                            let x1 = (this.radius - 10) * p.cos(angle - p.PI/2);
                            let y1 = (this.radius - 10) * p.sin(angle - p.PI/2);
                            let x2 = this.radius * p.cos(angle - p.PI/2);
                            let y2 = this.radius * p.sin(angle - p.PI/2);
                            
                            p.strokeWeight(2);
                            p.line(x1, y1, x2, y2);
                        }
                        
                        // Clock hands
                        // Second hand
                        let secondAngle = this.seconds * p.TWO_PI / 60;
                        p.stroke(255, 0, 0);
                        p.strokeWeight(2);
                        let sx = this.radius * 0.8 * p.cos(secondAngle - p.PI/2);
                        let sy = this.radius * 0.8 * p.sin(secondAngle - p.PI/2);
                        p.line(0, 0, sx, sy);
                        
                        // Minute hand (simplified, just following seconds)
                        let minuteAngle = (this.timeElapsed / 60) * p.TWO_PI;
                        p.stroke(0);
                        p.strokeWeight(3);
                        let mx = this.radius * 0.7 * p.cos(minuteAngle - p.PI/2);
                        let my = this.radius * 0.7 * p.sin(minuteAngle - p.PI/2);
                        p.line(0, 0, mx, my);
                        
                        // Center dot
                        p.fill(0);
                        p.noStroke();
                        p.ellipse(0, 0, 8, 8);
                        
                        // Label
                        p.textAlign(p.CENTER, p.TOP);
                        p.textSize(16);
                        p.fill(0);
                        p.text(this.label, 0, this.radius + 10);
                        
                        // Time elapsed
                        p.textAlign(p.CENTER, p.BOTTOM);
                        p.textSize(14);
                        p.text(this.timeElapsed.toFixed(1) + ' seconds', 0, -this.radius - 10);
                        
                        p.pop();
                    }
                }
            };
            
            let p5Instance = new p5(sketch);
            activeSketches.push(p5Instance);
        }
        
        function initGravitySketch() {
            const sketch = function(p) {
                let canvasWidth, canvasHeight;
                let earthClock, gravityClock;
                
                p.setup = function() {
                    const canvasContainer = document.getElementById('gravity-canvas');
                    if (!canvasContainer) return;
                    
                    canvasWidth = canvasContainer.offsetWidth;
                    canvasHeight = canvasContainer.offsetHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.frameRate(30);
                    
                    earthClock = new Clock(canvasWidth * 0.25, canvasHeight * 0.5, 'Earth Time', false);
                    gravityClock = new Clock(canvasWidth * 0.75, canvasHeight * 0.5, 'High Gravity Time', true);
                };
                
                p.draw = function() {
                    p.clear();
                    p.background(240, 248, 255);
                    
                    // Get gravity value
                    const gravityValue = parseInt(document.getElementById('gravity-slider').value);
                    
                    // Update clocks
                    earthClock.update(1);
                    
                    // Calculate time dilation due to gravity
                    // Using simplified formula: t' = t * sqrt(1 - (2GM/rc²))
                    // We'll use a simplified version for kids
                    const gravityFactor = 1 - (gravityValue / 200);
                    
                    gravityClock.update(gravityFactor);
                    
                    // Draw clocks
                    earthClock.display();
                    gravityClock.display();
                    
                    // Draw gravity object
                    drawGravityObject(canvasWidth * 0.75, canvasHeight * 0.5, gravityValue);
                    
                    // Update result text
                    updateGravityResult(gravityValue);
                };
                
                function drawGravityObject(x, y, gravityValue) {
                    p.push();
                    p.translate(x, y);
                    
                    // Determine what to draw based on gravity value
                    if (gravityValue <= 10) {
                        // Earth-like
                        p.fill(0, 100, 255);
                        p.ellipse(0, 0, 120, 120);
                        
                        // Continents
                        p.fill(0, 150, 0);
                        p.ellipse(-20, -20, 30, 25);
                        p.ellipse(30, -10, 25, 20);
                        p.ellipse(0, 30, 40, 20);
                        
                    } else if (gravityValue <= 30) {
                        // Jupiter-like
                        p.fill(200, 150, 100);
                        p.ellipse(0, 0, 140, 140);
                        
                        // Bands
                        for (let i = -60; i < 60; i += 20) {
                            p.fill(p.random(150, 220), p.random(100, 150), p.random(50, 100));
                            p.rect(-70, i, 140, 10);
                        }
                        
                        // Great red spot
                        p.fill(255, 100, 50);
                        p.ellipse(30, -20, 30, 20);
                        
                    } else if (gravityValue <= 60) {
                        // Neutron star
                        p.fill(200, 200, 255);
                        p.ellipse(0, 0, 80, 80);
                        
                        // Glow effect
                        for (let i = 5; i > 0; i--) {
                            p.fill(200, 200, 255, 30 * i);
                            p.ellipse(0, 0, 80 + i * 10, 80 + i * 10);
                        }
                        
                        // Magnetic field lines
                        p.stroke(100, 100, 255, 150);
                        p.strokeWeight(2);
                        for (let i = 0; i < 8; i++) {
                            let angle = i * p.PI / 4;
                            p.noFill();
                            p.bezier(
                                0, 0, 
                                100 * p.cos(angle), 100 * p.sin(angle),
                                150 * p.cos(angle + 0.5), 150 * p.sin(angle + 0.5),
                                200 * p.cos(angle + 1), 200 * p.sin(angle + 1)
                            );
                        }
                        
                    } else {
                        // Black hole
                        p.fill(0);
                        p.ellipse(0, 0, 60, 60);
                        
                        // Event horizon glow
                        p.noFill();
                        for (let i = 0; i < 20; i++) {
                            let alpha = 255 - i * 12;
                            if (alpha < 0) alpha = 0;
                            p.stroke(100, 100, 255, alpha);
                            p.strokeWeight(2);
                            p.ellipse(0, 0, 60 + i * 8, 60 + i * 8);
                        }
                        
                        // Accretion disk
                        p.push();
                        p.rotate(p.PI/4);
                        p.fill(255, 150, 0, 150);
                        p.ellipse(0, 0, 200, 40);
                        p.fill(0);
                        p.ellipse(0, 0, 60, 40);
                        p.pop();
                    }
                    
                    p.pop();
                }
                
                class Clock {
                    constructor(x, y, label, isHighGravity) {
                        this.x = x;
                        this.y = y;
                        this.label = label;
                        this.isHighGravity = isHighGravity;
                        this.radius = 40;
                        this.seconds = 0;
                        this.timeElapsed = 0;
                    }
                    
                    update(timeFactor) {
                        this.seconds += 0.05 * timeFactor;
                        if (this.seconds >= 60) {
                            this.seconds = 0;
                        }
                        
                        this.timeElapsed += 0.05 * timeFactor;
                    }
                    
                    display() {
                        p.push();
                        p.translate(this.x, this.y - 90); // Position above the gravity object
                        
                        // Clock face
                        p.fill(255);
                        p.stroke(0);
                        p.strokeWeight(2);
                        p.ellipse(0, 0, this.radius * 2, this.radius * 2);
                        
                        // Hour markers
                        for (let i = 0; i < 12; i++) {
                            let angle = i * p.TWO_PI / 12;
                            let x1 = (this.radius - 5) * p.cos(angle - p.PI/2);
                            let y1 = (this.radius - 5) * p.sin(angle - p.PI/2);
                            let x2 = this.radius * p.cos(angle - p.PI/2);
                            let y2 = this.radius * p.sin(angle - p.PI/2);
                            
                            p.strokeWeight(1);
                            p.line(x1, y1, x2, y2);
                        }
                        
                        // Clock hands
                        // Second hand
                        let secondAngle = this.seconds * p.TWO_PI / 60;
                        p.stroke(255, 0, 0);
                        p.strokeWeight(1);
                        let sx = this.radius * 0.8 * p.cos(secondAngle - p.PI/2);
                        let sy = this.radius * 0.8 * p.sin(secondAngle - p.PI/2);
                        p.line(0, 0, sx, sy);
                        
                        // Minute hand (simplified, just following seconds)
                        let minuteAngle = (this.timeElapsed / 60) * p.TWO_PI;
                        p.stroke(0);
                        p.strokeWeight(2);
                        let mx = this.radius * 0.7 * p.cos(minuteAngle - p.PI/2);
                        let my = this.radius * 0.7 * p.sin(minuteAngle - p.PI/2);
                        p.line(0, 0, mx, my);
                        
                        // Center dot
                        p.fill(0);
                        p.noStroke();
                        p.ellipse(0, 0, 4, 4);
                        
                        // Label
                        p.textAlign(p.CENTER, p.BOTTOM);
                        p.textSize(14);
                        p.fill(0);
                        p.text(this.label, 0, -this.radius - 5);
                        
                        // Time elapsed
                        p.textAlign(p.CENTER, p.TOP);
                        p.textSize(12);
                        p.text(this.timeElapsed.toFixed(1) + ' seconds', 0, this.radius + 5);
                        
                        p.pop();
                    }
                }
            };
            
            let p5Instance = new p5(sketch);
            activeSketches.push(p5Instance);
        }
        
        // Quiz Functions
        function showQuizQuestion(index) {
            if (index >= quizQuestions.length) {
                // Quiz completed
                document.getElementById('quiz-question').textContent = "Congratulations! You've completed the quiz!";
                document.getElementById('quiz-options').innerHTML = "<p>You're a Time Explorer now! Keep learning about time with your fun timers!</p>";
                document.getElementById('quiz-feedback').innerHTML = "";
                document.getElementById('next-question-btn').style.display = 'none';
                
                // Show celebration message
                showSpeechBubble("Wow! You're amazing at learning about time! So proud of you!");
                return;
            }
            
            currentQuizIndex = index;
            const question = quizQuestions[index];
            
            document.getElementById('quiz-question').textContent = question.question;
            
            let optionsHTML = '';
            question.options.forEach((option, i) => {
                optionsHTML += `<div class="quiz-option" data-index="${i}">${option}</div>`;
            });
            
            document.getElementById('quiz-options').innerHTML = optionsHTML;
            document.getElementById('quiz-feedback').innerHTML = "";
            document.getElementById('next-question-btn').style.display = 'none';
            
            // Add click events to options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    checkAnswer(parseInt(this.dataset.index));
                });
            });
        }
        
        function checkAnswer(selectedIndex) {
            const question = quizQuestions[currentQuizIndex];
            const correctIndex = question.answer;
            
            // Remove previous classes
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('correct', 'incorrect');
            });
            
            // Get selected and correct option elements
            const selectedOption = document.querySelector(`.quiz-option[data-index="${selectedIndex}"]`);
            const correctOption = document.querySelector(`.quiz-option[data-index="${correctIndex}"]`);
            
            // Show result
            if (selectedIndex === correctIndex) {
                selectedOption.classList.add('correct');
                document.getElementById('quiz-feedback').innerHTML = "<p>Correct! Great job! 🎉</p>";
                showSpeechBubble("You got it right! You're so smart!");
            } else {
                selectedOption.classList.add('incorrect');
                correctOption.classList.add('correct');
                document.getElementById('quiz-feedback').innerHTML = "<p>Not quite. The correct answer is shown in green.</p>";
                showSpeechBubble("That's okay! Learning is about trying!");
            }
            
            document.getElementById('next-question-btn').style.display = 'block';
        }
        
        // Helper Functions
        function updateDilationResult(speedValue) {
            const speedRatio = speedValue / 100;
            
            if (speedRatio === 0) {
                document.getElementById('dilation-result').textContent = 
                    "At normal speed, 10 seconds for you is 10 seconds for everyone else.";
                return;
            }
            
            // Calculate time dilation: t' = t / sqrt(1 - (v^2/c^2))
            const dilationFactor = 1 / Math.sqrt(1 - (speedRatio * speedRatio));
            const dilatedTime = (10 * dilationFactor).toFixed(1);
            
            document.getElementById('dilation-result').textContent = 
                `At ${speedValue}% of light speed, 10 seconds for you is ${dilatedTime} seconds for someone not moving!`;
        }
        
        function updateGravityResult(gravityValue) {
            if (gravityValue <= 10) {
                document.getElementById('gravity-result').textContent = 
                    `At Earth's gravity (${gravityValue}g), time passes normally.`;
            } else if (gravityValue <= 30) {
                // Simple approximation of gravitational time dilation
                const dilationFactor = 1 - (gravityValue / 200);
                const dilatedTime = (10 * dilationFactor).toFixed(1);
                
                document.getElementById('gravity-result').textContent = 
                    `At ${gravityValue}g gravity, 10 seconds in space would be ${dilatedTime} seconds here!`;
            } else if (gravityValue <= 60) {
                const dilationFactor = 1 - (gravityValue / 150);
                const dilatedTime = (10 * dilationFactor).toFixed(1);
                
                document.getElementById('gravity-result').textContent = 
                    `At ${gravityValue}g gravity (like a neutron star), 10 seconds in space would be ${dilatedTime} seconds here!`;
            } else {
                const dilationFactor = 1 - (gravityValue / 120);
                const dilatedTime = (10 * dilationFactor).toFixed(1);
                
                document.getElementById('gravity-result').textContent = 
                    `At ${gravityValue}g gravity (like near a black hole), 10 seconds in space would be ${dilatedTime} seconds here!`;
            }
        }
        
        function showSpeechBubble(message) {
            const speechBubble = document.getElementById('buddy-speech');
            speechBubble.innerHTML = `<p>${message}</p>`;
            speechBubble.classList.add('visible');
            
            setTimeout(() => {
                speechBubble.classList.remove('visible');
            }, 5000);
        }
        
        function showCharacterMessage() {
            const message = characterMessages[Math.floor(Math.random() * characterMessages.length)];
            showSpeechBubble(message);
        }
        
        function cleanupSketches() {
            // Remove all active p5 sketches to avoid performance issues
            activeSketches.forEach(sketch => {
                if (sketch && typeof sketch.remove === 'function') {
                    sketch.remove();
                }
            });
            
            activeSketches = [];
        }
        
        // Animate character clock hands
        setInterval(() => {
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            
            if (hourHand && minuteHand) {
                const now = new Date();
                const hours = now.getHours() % 12;
                const minutes = now.getMinutes();
                
                const hourAngle = (hours * 30) + (minutes * 0.5); // 30 degrees per hour, plus a bit for minutes
                const minuteAngle = minutes * 6; // 6 degrees per minute
                
                hourHand.setAttribute('transform', `rotate(${hourAngle} 100 100)`);
                minuteHand.setAttribute('transform', `rotate(${minuteAngle} 100 100)`);
            }
        }, 1000);
    </script>
</body>
</html>
