<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangle Explorer Adventure</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
            overflow: hidden;
            color: #333;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        #title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8ec5fc, #e0c3fc);
            z-index: 1000;
            transition: opacity 1s ease-in-out;
        }
        
        #title-screen h1 {
            font-size: 3.5em;
            color: #fff;
            text-shadow: 3px 3px 0px #ff7700;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        #start-button {
            background-color: #ff7700;
            color: white;
            font-size: 1.5em;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px #d65a00;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
        }
        
        #start-button:hover {
            background-color: #ff8800;
            transform: translateY(-2px);
            box-shadow: 0 8px #d65a00;
        }
        
        #start-button:active {
            transform: translateY(4px);
            box-shadow: 0 2px #d65a00;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        #canvas-container {
            width: 100%;
            height: 70%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #controls {
            width: 100%;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
        }
        
        .slider-container {
            width: 80%;
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .slider-label {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ff7700;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ff7700;
            cursor: pointer;
            box-shadow: -415px 0 0 400px #ff9900;
        }
        
        .slider-value {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 5px;
            color: #ff7700;
        }
        
        .button {
            background-color: #4CAF50;
            color: white;
            font-size: 1.2em;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px #388E3C;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
        }
        
        .button:hover {
            background-color: #66BB6A;
            transform: translateY(-2px);
            box-shadow: 0 6px #388E3C;
        }
        
        .button:active {
            transform: translateY(4px);
            box-shadow: 0 0 #388E3C;
        }
        
        #info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 1.1em;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .character {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .character:hover {
            transform: scale(1.1);
        }
        
        .character-speech {
            position: absolute;
            left: 170px;
            bottom: 100px;
            width: 250px;
            padding: 15px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 1.1em;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .character-speech::before {
            content: "";
            position: absolute;
            left: -20px;
            bottom: 30px;
            border-width: 10px;
            border-style: solid;
            border-color: transparent white transparent transparent;
        }
        
        #quiz-screen {
            background-color: #e6f7ff;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .quiz-container {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 800px;
        }
        
        .quiz-question {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #333;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .quiz-option {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.2s;
            border: 3px solid transparent;
        }
        
        .quiz-option:hover {
            background-color: #e0e0e0;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quiz-option.selected {
            border-color: #ff7700;
            background-color: #fff4e6;
        }
        
        .quiz-option.correct {
            border-color: #4CAF50;
            background-color: #e8f5e9;
        }
        
        .quiz-option.incorrect {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        .quiz-feedback {
            margin-top: 20px;
            font-size: 1.4em;
            font-weight: bold;
            height: 30px;
        }
        
        #next-button, #check-answer-button {
            background-color: #4285f4;
            color: white;
            font-size: 1.3em;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px #3367d6;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
        }
        
        #next-button:hover, #check-answer-button:hover {
            background-color: #5c9aff;
            transform: translateY(-2px);
            box-shadow: 0 6px #3367d6;
        }
        
        #next-button:active, #check-answer-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 #3367d6;
        }
        
        .progress-container {
            width: 80%;
            margin: 20px auto;
            background-color: #f1f1f1;
            border-radius: 20px;
            height: 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #ff7700;
            width: 0%;
            transition: width 0.5s;
        }
        
        .celebration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #f00;
            opacity: 0.7;
            animation: fall 5s linear forwards;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .star-burst {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            background-image: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.8) 70%);
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        
        .settings-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: none;
            flex-direction: column;
            z-index: 20;
            max-width: 300px;
        }
        
        .settings-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff7700;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 21;
            font-size: 24px;
        }
        
        .setting-item {
            margin: 10px 0;
        }
        
        .setting-item label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        
        .settings-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .close-settings {
            align-self: flex-end;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        
        #learning-level {
            width: 100%;
        }
        
        #sound-toggle {
            width: 60px;
            height: 30px;
            appearance: none;
            background-color: #eee;
            border-radius: 15px;
            position: relative;
            outline: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #sound-toggle::before {
            content: "";
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        #sound-toggle:checked {
            background-color: #4CAF50;
        }
        
        #sound-toggle:checked::before {
            transform: translateX(30px);
        }
        
        /* Media queries for better responsiveness */
        @media (max-width: 768px) {
            .quiz-options {
                grid-template-columns: 1fr;
            }
            
            #info-panel {
                width: 250px;
                font-size: 1em;
            }
            
            .character {
                width: 120px;
                height: 120px;
            }
            
            .character-speech {
                width: 200px;
                left: 150px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title-screen">
            <h1>Triangle Explorer Adventure</h1>
            <button id="start-button">Start Learning!</button>
        </div>
        
        <div id="explore-screen" class="screen">
            <div id="canvas-container"></div>
            
            <div id="controls">
                <div class="slider-container">
                    <div class="slider-label">Angle A</div>
                    <input type="range" min="1" max="89" value="30" class="slider" id="angle-a-slider">
                    <div class="slider-value" id="angle-a-value">30°</div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">Angle B</div>
                    <input type="range" min="1" max="89" value="60" class="slider" id="angle-b-slider">
                    <div class="slider-value" id="angle-b-value">60°</div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">Side Length</div>
                    <input type="range" min="50" max="200" value="100" class="slider" id="side-length-slider">
                    <div class="slider-value" id="side-length-value">100</div>
                </div>
                
                <div class="buttons-container">
                    <button class="button" id="quiz-button">Take a Quiz!</button>
                </div>
            </div>
            
            <div id="info-panel">
                <h3>Triangle Facts:</h3>
                <div id="info-content">
                    Explore the triangle by moving the sliders!
                </div>
            </div>
            
            <div class="character" id="professor-angle">
                <!-- Character created with SVG -->
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <!-- Body -->
                    <circle cx="100" cy="100" r="70" fill="#FFD700" stroke="#FF7700" stroke-width="5"/>
                    
                    <!-- Eyes -->
                    <circle cx="70" cy="80" r="15" fill="white" stroke="black" stroke-width="2"/>
                    <circle cx="130" cy="80" r="15" fill="white" stroke="black" stroke-width="2"/>
                    <circle cx="70" cy="80" r="7" fill="black"/>
                    <circle cx="130" cy="80" r="7" fill="black"/>
                    
                    <!-- Mouth -->
                    <path d="M70,130 Q100,160 130,130" fill="none" stroke="black" stroke-width="5" stroke-linecap="round"/>
                    
                    <!-- Professor hat -->
                    <rect x="60" y="30" width="80" height="10" fill="#333"/>
                    <rect x="75" y="10" width="50" height="20" fill="#333"/>
                    
                    <!-- Glasses -->
                    <rect x="55" y="75" width="30" height="10" rx="5" fill="none" stroke="#333" stroke-width="3"/>
                    <rect x="115" y="75" width="30" height="10" rx="5" fill="none" stroke="#333" stroke-width="3"/>
                    <line x1="85" y1="80" x2="115" y2="80" stroke="#333" stroke-width="3"/>
                </svg>
            </div>
            
            <div class="character-speech" id="professor-speech">
                Hi there! I'm Professor Angle. Let's explore triangles together!
            </div>
        </div>
        
        <div id="quiz-screen" class="screen">
            <div class="progress-container">
                <div class="progress-bar" id="quiz-progress"></div>
            </div>
            
            <div class="quiz-container">
                <div class="quiz-question" id="quiz-question">
                    What is the sum of all angles in a triangle?
                </div>
                
                <div class="quiz-options" id="quiz-options">
                    <!-- Quiz options will be inserted dynamically -->
                </div>
                
                <div class="quiz-feedback" id="quiz-feedback"></div>
                
                <button id="check-answer-button">Check Answer</button>
                <button id="next-button" style="display:none;">Next Question</button>
            </div>
        </div>
        
        <div class="settings-button" id="settings-button">⚙️</div>
        
        <div class="settings-panel" id="settings-panel">
            <button class="close-settings" id="close-settings">×</button>
            <div class="settings-title">Game Settings</div>
            
            <div class="setting-item">
                <label for="learning-level">Learning Level:</label>
                <input type="range" min="1" max="5" value="1" class="slider" id="learning-level">
                <div class="slider-value" id="learning-level-value">Level 1: Basic</div>
            </div>
            
            <div class="setting-item">
                <label for="sound-toggle">Sound Effects:</label>
                <input type="checkbox" id="sound-toggle" checked>
            </div>
            
            <div class="setting-item">
                <label for="color-theme">Color Theme:</label>
                <select id="color-theme">
                    <option value="default">Default</option>
                    <option value="space">Space</option>
                    <option value="ocean">Ocean</option>
                    <option value="forest">Forest</option>
                </select>
            </div>
            
            <div class="setting-item">
                <label for="animation-speed">Animation Speed:</label>
                <input type="range" min="1" max="5" value="3" class="slider" id="animation-speed">
                <div class="slider-value" id="animation-speed-value">Normal</div>
            </div>
        </div>
        
        <div class="celebration" id="celebration-container"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script>
        // Main game state and variables
        const gameState = {
            currentScreen: 'title',
            angleA: 30,
            angleB: 60,
            angleC: 90,
            sideLength: 100,
            learningLevel: 1,
            soundEnabled: true,
            colorTheme: 'default',
            animationSpeed: 3,
            quizState: {
                currentQuestion: 0,
                score: 0,
                selectedOption: null,
                answered: false,
                questions: []
            }
        };

        // Audio context and sounds
        let audioContext;
        const sounds = {
            click: null,
            correct: null,
            incorrect: null,
            celebration: null,
            sliderMove: null
        };

        // p5.js instance and sketch
        let triangleSketch;

        // DOM Elements
        const elements = {
            titleScreen: document.getElementById('title-screen'),
            startButton: document.getElementById('start-button'),
            exploreScreen: document.getElementById('explore-screen'),
            quizScreen: document.getElementById('quiz-screen'),
            angleASlider: document.getElementById('angle-a-slider'),
            angleAValue: document.getElementById('angle-a-value'),
            angleBSlider: document.getElementById('angle-b-slider'),
            angleBValue: document.getElementById('angle-b-value'),
            sideLengthSlider: document.getElementById('side-length-slider'),
            sideLengthValue: document.getElementById('side-length-value'),
            quizButton: document.getElementById('quiz-button'),
            infoPanel: document.getElementById('info-panel'),
            infoContent: document.getElementById('info-content'),
            professorAngle: document.getElementById('professor-angle'),
            professorSpeech: document.getElementById('professor-speech'),
            quizQuestion: document.getElementById('quiz-question'),
            quizOptions: document.getElementById('quiz-options'),
            quizFeedback: document.getElementById('quiz-feedback'),
            checkAnswerButton: document.getElementById('check-answer-button'),
            nextButton: document.getElementById('next-button'),
            quizProgress: document.getElementById('quiz-progress'),
            settingsButton: document.getElementById('settings-button'),
            settingsPanel: document.getElementById('settings-panel'),
            closeSettings: document.getElementById('close-settings'),
            learningLevel: document.getElementById('learning-level'),
            learningLevelValue: document.getElementById('learning-level-value'),
            soundToggle: document.getElementById('sound-toggle'),
            colorTheme: document.getElementById('color-theme'),
            animationSpeed: document.getElementById('animation-speed'),
            animationSpeedValue: document.getElementById('animation-speed-value'),
            celebrationContainer: document.getElementById('celebration-container')
        };

        // Initialize audio context and create sounds
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create click sound
            sounds.click = createSound(() => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(500, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            });
            
            // Create correct answer sound
            sounds.correct = createSound(() => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            });
            
            // Create incorrect answer sound
            sounds.incorrect = createSound(() => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            });
            
            // Create celebration sound
            sounds.celebration = createSound(() => {
                const oscillator1 = audioContext.createOscillator();
                const oscillator2 = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator1.type = 'sine';
                oscillator2.type = 'triangle';
                
                oscillator1.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator1.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
                oscillator1.frequency.setValueAtTime(1000, audioContext.currentTime + 0.2);
                oscillator1.frequency.setValueAtTime(1200, audioContext.currentTime + 0.3);
                
                oscillator2.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator2.frequency.setValueAtTime(400, audioContext.currentTime + 0.1);
                oscillator2.frequency.setValueAtTime(500, audioContext.currentTime + 0.2);
                oscillator2.frequency.setValueAtTime(600, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator1.start();
                oscillator1.stop(audioContext.currentTime + 0.5);
                oscillator2.start();
                oscillator2.stop(audioContext.currentTime + 0.5);
            });
            
            // Create slider move sound
            sounds.sliderMove = createSound(() => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.05);
            });
        }

        // Helper function to create sound functions
        function createSound(soundFunction) {
            return function() {
                if (gameState.soundEnabled) {
                    // If the audio context is suspended (as browsers often do until user interaction),
                    // resume it before playing the sound
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(soundFunction);
                    } else {
                        soundFunction();
                    }
                }
            };
        }

        // P5.js sketch for triangle visualization
        function createTriangleSketch() {
            return new p5(function(p) {
                let canvasWidth, canvasHeight;
                let centerX, centerY;
                let triangleVertices = [];
                let anglesLabels = [];
                let sidesLabels = [];
                let arcRadius;
                
                p.setup = function() {
                    const canvasContainer = document.getElementById('canvas-container');
                    canvasWidth = canvasContainer.clientWidth;
                    canvasHeight = canvasContainer.clientHeight;
                    
                    p.createCanvas(canvasWidth, canvasHeight);
                    p.textFont('Nunito');
                    p.textAlign(p.CENTER, p.CENTER);
                    
                    centerX = canvasWidth / 2;
                    centerY = canvasHeight / 2;
                    arcRadius = 40;
                    
                    calculateTriangleVertices();
                };
                
                p.draw = function() {
                    p.clear();
                    
                    // Apply color theme
                    let bgColor, triangleColor, arcColor, textColor;
                    switch(gameState.colorTheme) {
                        case 'space':
                            bgColor = p.color(20, 20, 40);
                            triangleColor = p.color(100, 100, 240);
                            arcColor = p.color(200, 100, 240);
                            textColor = p.color(255);
                            break;
                        case 'ocean':
                            bgColor = p.color(200, 230, 240);
                            triangleColor = p.color(0, 120, 180);
                            arcColor = p.color(0, 180, 120);
                            textColor = p.color(0, 60, 100);
                            break;
                        case 'forest':
                            bgColor = p.color(230, 240, 220);
                            triangleColor = p.color(40, 120, 60);
                            arcColor = p.color(180, 120, 40);
                            textColor = p.color(60, 40, 20);
                            break;
                        default:
                            bgColor = p.color(240, 240, 255);
                            triangleColor = p.color(255, 120, 0);
                            arcColor = p.color(0, 120, 255);
                            textColor = p.color(40, 40, 40);
                    }
                    
                    // Draw background
                    p.background(bgColor);
                    
                    // Draw coordinate grid for higher learning levels
                    if (gameState.learningLevel >= 3) {
                        drawCoordinateGrid();
                    }
                    
                    // Draw triangle
                    p.stroke(triangleColor);
                    p.strokeWeight(4);
                    p.noFill();
                    p.beginShape();
                    for (let vertex of triangleVertices) {
                        p.vertex(vertex.x, vertex.y);
                    }
                    p.endShape(p.CLOSE);
                    
                    // Draw angle arcs
                    drawAngleArcs(arcColor);
                    
                    // Draw labels
                    p.noStroke();
                    p.fill(textColor);
                    p.textSize(16);
                    
                    // Draw angle labels
                    for (let label of anglesLabels) {
                        p.text(label.text, label.x, label.y);
                    }
                    
                    // Draw side labels
                    if (gameState.learningLevel >= 2) {
                        for (let label of sidesLabels) {
                            p.push();
                            p.translate(label.x, label.y);
                            p.rotate(label.angle);
                            p.text(label.text, 0, -15);
                            p.pop();
                        }
                    }
                    
                    // Draw additional information for higher learning levels
                    if (gameState.learningLevel >= 4) {
                        drawTrigonometryInfo();
                    }
                    
                    // Draw animated particles or effects based on animation speed
                    if (gameState.animationSpeed > 1) {
                        drawAnimatedEffects();
                    }
                };
                
                function calculateTriangleVertices() {
                    // Convert angles to radians
                    const angleAInRadians = p.radians(gameState.angleA);
                    const angleBInRadians = p.radians(gameState.angleB);
                    const angleCInRadians = p.radians(gameState.angleC);
                    
                    // Calculate side lengths based on angles (simplified for kids)
                    const scale = gameState.sideLength / 100;
                    
                    // Right triangle: C is always 90 degrees (π/2 radians)
                    // A is at origin (bottom left)
                    const pointA = { x: centerX - 100 * scale, y: centerY + 50 * scale };
                    
                    // B is horizontally to the right of A (bottom right)
                    const pointB = { x: centerX + 100 * scale, y: centerY + 50 * scale };
                    
                    // C is up from A and calculated based on angle A
                    // For a right triangle, we can use trigonometry
                    const baseLength = pointB.x - pointA.x;
                    const height = baseLength * Math.tan(angleAInRadians);
                    const pointC = { x: pointA.x, y: pointA.y - height };
                    
                    triangleVertices = [pointA, pointB, pointC];
                    
                    // Calculate side lengths
                    const sideAB = p.dist(pointA.x, pointA.y, pointB.x, pointB.y);
                    const sideBC = p.dist(pointB.x, pointB.y, pointC.x, pointC.y);
                    const sideCA = p.dist(pointC.x, pointC.y, pointA.x, pointA.y);
                    
                    // Angle labels
                    anglesLabels = [
                        { text: `${gameState.angleA}°`, x: pointA.x - 30, y: pointA.y - 10 },
                        { text: `${gameState.angleB}°`, x: pointB.x + 30, y: pointB.y - 10 },
                        { text: `${gameState.angleC}°`, x: pointC.x - 10, y: pointC.y - 20 }
                    ];
                    
                    // Side labels
                    sidesLabels = [
                        { text: `${Math.round(sideAB)}`, x: (pointA.x + pointB.x) / 2, y: (pointA.y + pointB.y) / 2, angle: 0 },
                        { text: `${Math.round(sideBC)}`, x: (pointB.x + pointC.x) / 2, y: (pointB.y + pointC.y) / 2, angle: Math.atan2(pointC.y - pointB.y, pointC.x - pointB.x) },
                        { text: `${Math.round(sideCA)}`, x: (pointC.x + pointA.x) / 2, y: (pointC.y + pointA.y) / 2, angle: Math.atan2(pointA.y - pointC.y, pointA.x - pointC.x) }
                    ];
                    
                    // Update info panel with triangle facts
                    updateInfoPanel(sideAB, sideBC, sideCA);
                }
                
                function drawAngleArcs(arcColor) {
                    p.stroke(arcColor);
                    p.strokeWeight(2);
                    p.noFill();
                    
                    // Angle A arc
                    p.arc(
                        triangleVertices[0].x,
                        triangleVertices[0].y,
                        arcRadius,
                        arcRadius,
                        p.PI - p.radians(gameState.angleA),
                        p.PI
                    );
                    
                    // Angle B arc
                    p.arc(
                        triangleVertices[1].x,
                        triangleVertices[1].y,
                        arcRadius,
                        arcRadius,
                        p.PI,
                        p.PI + p.radians(gameState.angleB)
                    );
                    
                    // Angle C arc (90 degrees)
                    p.arc(
                        triangleVertices[2].x,
                        triangleVertices[2].y,
                        arcRadius,
                        arcRadius,
                        p.PI/2,
                        p.PI
                    );
                    
                    // Draw right angle square for angle C
                    const squareSize = arcRadius / 2;
                    p.line(
                        triangleVertices[2].x,
                        triangleVertices[2].y,
                        triangleVertices[2].x + squareSize,
                        triangleVertices[2].y
                    );
                    p.line(
                        triangleVertices[2].x + squareSize,
                        triangleVertices[2].y,
                        triangleVertices[2].x + squareSize,
                        triangleVertices[2].y + squareSize
                    );
                    p.line(
                        triangleVertices[2].x + squareSize,
                        triangleVertices[2].y + squareSize,
                        triangleVertices[2].x,
                        triangleVertices[2].y + squareSize
                    );
                }
                
                function drawCoordinateGrid() {
                    p.stroke(200);
                    p.strokeWeight(1);
                    
                    // Draw horizontal lines
                    for (let y = 0; y < canvasHeight; y += 50) {
                        p.line(0, y, canvasWidth, y);
                    }
                    
                    // Draw vertical lines
                    for (let x = 0; x < canvasWidth; x += 50) {
                        p.line(x, 0, x, canvasHeight);
                    }
                    
                    // Draw axes
                    p.stroke(100);
                    p.strokeWeight(2);
                    p.line(0, centerY, canvasWidth, centerY); // x-axis
                    p.line(centerX, 0, centerX, canvasHeight); // y-axis
                    
                    // Draw axis labels
                    p.noStroke();
                    p.fill(100);
                    p.textSize(14);
                    p.text("X", canvasWidth - 20, centerY + 20);
                    p.text("Y", centerX + 20, 20);
                }
                
                function drawTrigonometryInfo() {
                    const angleAInRadians = p.radians(gameState.angleA);
                    const sinA = Math.sin(angleAInRadians).toFixed(2);
                    const cosA = Math.cos(angleAInRadians).toFixed(2);
                    const tanA = Math.tan(angleAInRadians).toFixed(2);
                    
                    p.noStroke();
                    p.fill(0, 120, 180);
                    p.textSize(18);
                    
                    let infoY = 50;
                    p.text(`sin(${gameState.angleA}°) = ${sinA}`, 120, infoY);
                    infoY += 30;
                    p.text(`cos(${gameState.angleA}°) = ${cosA}`, 120, infoY);
                    infoY += 30;
                    p.text(`tan(${gameState.angleA}°) = ${tanA}`, 120, infoY);
                    
                    // Draw visual representation of sin, cos, tan
                    if (gameState.learningLevel >= 5) {
                        drawUnitCircle();
                    }
                }
                
                function drawUnitCircle() {
                    const unitCircleX = canvasWidth - 150;
                    const unitCircleY = 150;
                    const radius = 80;
                    
                    // Draw circle
                    p.stroke(100);
                    p.strokeWeight(1);
                    p.noFill();
                    p.ellipse(unitCircleX, unitCircleY, radius * 2);
                    
                    // Draw axes
                    p.line(unitCircleX - radius - 10, unitCircleY, unitCircleX + radius + 10, unitCircleY);
                    p.line(unitCircleX, unitCircleY - radius - 10, unitCircleX, unitCircleY + radius + 10);
                    
                    // Calculate point on circle based on angle A
                    const angleAInRadians = p.radians(gameState.angleA);
                    const pointX = unitCircleX + Math.cos(angleAInRadians) * radius;
                    const pointY = unitCircleY - Math.sin(angleAInRadians) * radius;
                    
                    // Draw radius line
                    p.stroke(255, 120, 0);
                    p.strokeWeight(3);
                    p.line(unitCircleX, unitCircleY, pointX, pointY);
                    
                    // Draw sin line
                    p.stroke(0, 120, 255);
                    p.line(pointX, unitCircleY, pointX, pointY);
                    
                    // Draw cos line
                    p.stroke(0, 200, 100);
                    p.line(unitCircleX, unitCircleY, pointX, unitCircleY);
                    
                    // Draw point
                    p.fill(255, 0, 0);
                    p.noStroke();
                    p.ellipse(pointX, pointY, 8);
                    
                    // Labels
                    p.fill(0);
                    p.textSize(14);
                    p.text("Unit Circle", unitCircleX, unitCircleY - radius - 20);
                    p.fill(0, 120, 255);
                    p.text("sin", pointX + 15, (pointY + unitCircleY) / 2);
                    p.fill(0, 200, 100);
                    p.text("cos", (pointX + unitCircleX) / 2, unitCircleY + 15);
                }
                
                function drawAnimatedEffects() {
                    const time = p.millis() / 1000;
                    const speed = gameState.animationSpeed / 3;
                    
                    // Draw pulsating points at vertices
                    p.noStroke();
                    for (let i = 0; i < triangleVertices.length; i++) {
                        const pulseSize = 5 + Math.sin(time * speed + i) * 3;
                        p.fill(255, 100, 100, 200);
                        p.ellipse(triangleVertices[i].x, triangleVertices[i].y, pulseSize * 2);
                    }
                    
                    // Draw animated particles along the sides of the triangle
                    p.fill(100, 200, 255, 150);
                    for (let i = 0; i < triangleVertices.length; i++) {
                        const nextIndex = (i + 1) % triangleVertices.length;
                        const current = triangleVertices[i];
                        const next = triangleVertices[nextIndex];
                        
                        const particleCount = 3;
                        for (let j = 0; j < particleCount; j++) {
                            const progress = (time * speed + j / particleCount) % 1;
                            const x = p.lerp(current.x, next.x, progress);
                            const y = p.lerp(current.y, next.y, progress);
                            const particleSize = 4 + Math.sin(time * 5 + j) * 2;
                            
                            p.ellipse(x, y, particleSize);
                        }
                    }
                }
                
                p.windowResized = function() {
                    const canvasContainer = document.getElementById('canvas-container');
                    canvasWidth = canvasContainer.clientWidth;
                    canvasHeight = canvasContainer.clientHeight;
                    
                    p.resizeCanvas(canvasWidth, canvasHeight);
                    centerX = canvasWidth / 2;
                    centerY = canvasHeight / 2;
                    
                    calculateTriangleVertices();
                };
                
                // Expose methods to be called from outside
                this.updateTriangle = function() {
                    calculateTriangleVertices();
                };
            }, 'canvas-container');
        }

        // Update info panel with triangle facts
        function updateInfoPanel(sideAB, sideBC, sideCA) {
            let infoContent = "";
            
            // Basic facts for all levels
            infoContent += `<p>Sum of angles in a triangle: <strong>${gameState.angleA + gameState.angleB + gameState.angleC}°</strong></p>`;
            
            // Level 1: Basic facts
            if (gameState.learningLevel >= 1) {
                infoContent += `<p>This is a <strong>right triangle</strong> because it has a 90° angle.</p>`;
            }
            
            // Level 2: Add Pythagorean theorem
            if (gameState.learningLevel >= 2) {
                const hypotenuse = Math.max(sideAB, sideBC, sideCA);
                const legs = [sideAB, sideBC, sideCA].filter(side => side !== hypotenuse);
                
                infoContent += `<p>The longest side (hypotenuse) is <strong>${Math.round(hypotenuse)}</strong>.</p>`;
                infoContent += `<p>Pythagorean Theorem: a² + b² = c²</p>`;
                infoContent += `<p>${Math.round(legs[0])}² + ${Math.round(legs[1])}² ≈ ${Math.round(hypotenuse)}²</p>`;
            }
            
            // Level 3: Add trigonometric ratios
            if (gameState.learningLevel >= 3) {
                const sinA = Math.sin(Math.radians(gameState.angleA)).toFixed(2);
                const cosA = Math.cos(Math.radians(gameState.angleA)).toFixed(2);
                const tanA = Math.tan(Math.radians(gameState.angleA)).toFixed(2);
                
                infoContent += `<p>For angle ${gameState.angleA}°:</p>`;
                infoContent += `<p>sin(θ) = ${sinA}</p>`;
                infoContent += `<p>cos(θ) = ${cosA}</p>`;
                infoContent += `<p>tan(θ) = ${tanA}</p>`;
            }
            
            // Level 4: Add area calculation
            if (gameState.learningLevel >= 4) {
                // Calculate area of the triangle (1/2 * base * height)
                const base = sideAB;
                const height = sideBC * Math.sin(Math.radians(gameState.angleB));
                const area = 0.5 * base * height;
                
                infoContent += `<p>Area of the triangle = ${Math.round(area)} square units</p>`;
            }
            
            // Level 5: Advanced concepts
            if (gameState.learningLevel >= 5) {
                // Add law of sines and cosines
                infoContent += `<p>Law of Sines: a/sin(A) = b/sin(B) = c/sin(C)</p>`;
                
                // Add vectors, complex plane, or other advanced concepts
                infoContent += `<p>The triangle can represent a vector in 2D space!</p>`;
            }
            
            elements.infoContent.innerHTML = infoContent;
        }

        // Create celebration effects
        function createCelebration() {
            elements.celebrationContainer.style.display = 'block';
            elements.celebrationContainer.innerHTML = '';
            
            // Create star burst effect
            const starBurst = document.createElement('div');
            starBurst.className = 'star-burst';
            elements.celebrationContainer.appendChild(starBurst);
            
            // Create confetti
            const colors = ['#ff7700', '#4CAF50', '#3498db', '#9b59b6', '#f1c40f', '#e74c3c'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                elements.celebrationContainer.appendChild(confetti);
            }
            
            // Play celebration sound
            sounds.celebration();
            
            // Hide after animation completes
            setTimeout(() => {
                elements.celebrationContainer.style.display = 'none';
            }, 5000);
        }

        // Helper function to convert from degrees to radians
        Math.radians = function(degrees) {
            return degrees * Math.PI / 180;
        };

        // Helper function to convert from radians to degrees
        Math.degrees = function(radians) {
            return radians * 180 / Math.PI;
        };

        // Quiz questions generator
        function generateQuizQuestions() {
            const questions = [
                {
                    question: "What is the sum of all angles in a triangle?",
                    options: ["90°", "180°", "270°", "360°"],
                    correctAnswer: 1,
                    feedback: "Great job! The sum of all angles in any triangle is always 180°."
                },
                {
                    question: "What makes a triangle a right triangle?",
                    options: ["All sides are equal", "It has one 90° angle", "All angles are equal", "It has one 180° angle"],
                    correctAnswer: 1,
                    feedback: "Correct! A right triangle has one angle that is exactly 90° (a right angle)."
                },
                {
                    question: "If angle A is 30° and angle B is 60° in a right triangle, what is angle C?",
                    options: ["30°", "60°", "90°", "120°"],
                    correctAnswer: 2,
                    feedback: "Exactly right! In a right triangle, angle C is 90°. The three angles add up to 180°."
                },
                {
                    question: "What is the name of the longest side in a right triangle?",
                    options: ["Base", "Height", "Hypotenuse", "Leg"],
                    correctAnswer: 2,
                    feedback: "Perfect! The hypotenuse is the longest side in a right triangle, opposite to the right angle."
                },
                {
                    question: "Which formula represents the Pythagorean theorem?",
                    options: ["a + b = c", "a² + b² = c²", "a × b = c", "a + b + c = 180"],
                    correctAnswer: 1,
                    feedback: "Excellent! a² + b² = c² is the Pythagorean theorem, where c is the hypotenuse."
                }
            ];
            
            // Add more advanced questions for higher learning levels
            if (gameState.learningLevel >= 3) {
                questions.push(
                    {
                        question: "In a right triangle, what is the sine of an angle?",
                        options: [
                            "The ratio of the opposite side to the hypotenuse",
                            "The ratio of the adjacent side to the hypotenuse",
                            "The ratio of the opposite side to the adjacent side",
                            "The sum of all sides"
                        ],
                        correctAnswer: 0,
                        feedback: "Excellent! The sine of an angle is the ratio of the opposite side to the hypotenuse."
                    },
                    {
                        question: "In a right triangle, what is the cosine of an angle?",
                        options: [
                            "The ratio of the opposite side to the hypotenuse",
                            "The ratio of the adjacent side to the hypotenuse",
                            "The ratio of the opposite side to the adjacent side",
                            "The product of all sides"
                        ],
                        correctAnswer: 1,
                        feedback: "Correct! The cosine of an angle is the ratio of the adjacent side to the hypotenuse."
                    }
                );
            }
            
            // Add even more advanced questions for the highest learning levels
            if (gameState.learningLevel >= 4) {
                questions.push(
                    {
                        question: "What is the tangent of an angle in terms of sine and cosine?",
                        options: [
                            "sin × cos",
                            "sin + cos",
                            "sin ÷ cos",
                            "cos ÷ sin"
                        ],
                        correctAnswer: 2,
                        feedback: "Perfect! The tangent of an angle equals sine divided by cosine (sin/cos)."
                    },
                    {
                        question: "How do you find the area of a right triangle?",
                        options: [
                            "base × height",
                            "(base × height) ÷ 2",
                            "base + height",
                            "base² + height²"
                        ],
                        correctAnswer: 1,
                        feedback: "Correct! The area of a right triangle is half the product of its base and height."
                    }
                );
            }
            
            if (gameState.learningLevel >= 5) {
                questions.push(
                    {
                        question: "What does the Law of Sines state?",
                        options: [
                            "a + b + c = 180°",
                            "a² + b² = c²",
                            "a/sin(A) = b/sin(B) = c/sin(C)",
                            "sin²(A) + cos²(A) = 1"
                        ],
                        correctAnswer: 2,
                        feedback: "Excellent! The Law of Sines states that the ratio of the length of a side to the sine of the opposite angle is constant for all sides and angles in a triangle."
                    },
                    {
                        question: "Which trigonometric identity is always true for any angle?",
                        options: [
                            "sin(A) + cos(A) = 1",
                            "sin²(A) + cos²(A) = 1",
                            "tan(A) = sin(A) × cos(A)",
                            "sin(A) = cos(A)"
                        ],
                        correctAnswer: 1,
                        feedback: "Perfect! The Pythagorean identity sin²(A) + cos²(A) = 1 is always true for any angle A."
                    }
                );
            }
            
            return questions;
        }

        // Event listeners
        function setupEventListeners() {
            // Start button
            elements.startButton.addEventListener('click', () => {
                sounds.click();
                startGame();
            });
            
            // Angle A slider
            elements.angleASlider.addEventListener('input', () => {
                sounds.sliderMove();
                gameState.angleA = parseInt(elements.angleASlider.value);
                elements.angleAValue.textContent = `${gameState.angleA}°`;
                
                // Update angle B if the sum would exceed 90 degrees
                const maxB = 90 - gameState.angleA;
                if (gameState.angleB > maxB) {
                    gameState.angleB = maxB;
                    elements.angleBSlider.value = maxB;
                    elements.angleBValue.textContent = `${maxB}°`;
                }
                
                triangleSketch.updateTriangle();
            });
            
            // Angle B slider
            elements.angleBSlider.addEventListener('input', () => {
                sounds.sliderMove();
                gameState.angleB = parseInt(elements.angleBSlider.value);
                elements.angleBValue.textContent = `${gameState.angleB}°`;
                
                // Update angle A if the sum would exceed 90 degrees
                const maxA = 90 - gameState.angleB;
                if (gameState.angleA > maxA) {
                    gameState.angleA = maxA;
                    elements.angleASlider.value = maxA;
                    elements.angleAValue.textContent = `${maxA}°`;
                }
                
                triangleSketch.updateTriangle();
            });
            
            // Side length slider
            elements.sideLengthSlider.addEventListener('input', () => {
                sounds.sliderMove();
                gameState.sideLength = parseInt(elements.sideLengthSlider.value);
                elements.sideLengthValue.textContent = gameState.sideLength;
                triangleSketch.updateTriangle();
            });
            
            // Quiz button
            elements.quizButton.addEventListener('click', () => {
                sounds.click();
                startQuiz();
            });
            
            // Professor character
            elements.professorAngle.addEventListener('click', () => {
                sounds.click();
                elements.professorSpeech.style.opacity = '1';
                
                // Generate a random tip based on learning level
                const tips = [
                    "Did you know? The sum of angles in a triangle is always 180°!",
                    "A right triangle has one angle that's exactly 90 degrees!",
                    "The Pythagorean theorem (a² + b² = c²) only works for right triangles!",
                    "Try changing the angles to see how the triangle changes shape!",
                    "The hypotenuse is the longest side in a right triangle!",
                    "Sine, cosine, and tangent help us understand the relationships between angles and sides!",
                    "The area of a triangle is half the base times the height!",
                    "Triangles are everywhere in the world around us - from bridges to roofs to pizza slices!"
                ];
                
                const advancedTips = [
                    "In trigonometry, sine, cosine, and tangent are ratios of the sides of a right triangle!",
                    "The unit circle helps us visualize trigonometric functions like sine and cosine!",
                    "The Law of Sines works for any triangle, not just right triangles!",
                    "Vectors can be represented using triangles in coordinate geometry!",
                    "Triangulation is used in GPS systems to determine your exact location!"
                ];
                
                let allTips = tips;
                if (gameState.learningLevel >= 3) {
                    allTips = allTips.concat(advancedTips);
                }
                
                const randomTip = allTips[Math.floor(Math.random() * allTips.length)];
                elements.professorSpeech.textContent = randomTip;
                
                // Hide speech bubble after a few seconds
                setTimeout(() => {
                    elements.professorSpeech.style.opacity = '0';
                }, 5000);
            });
            
            // Check answer button
            elements.checkAnswerButton.addEventListener('click', () => {
                checkAnswer();
            });
            
            // Next question button
            elements.nextButton.addEventListener('click', () => {
                sounds.click();
                nextQuestion();
            });
            
            // Settings button
            elements.settingsButton.addEventListener('click', () => {
                sounds.click();
                elements.settingsPanel.style.display = elements.settingsPanel.style.display === 'flex' ? 'none' : 'flex';
            });
            
            // Close settings button
            elements.closeSettings.addEventListener('click', () => {
                sounds.click();
                elements.settingsPanel.style.display = 'none';
            });
            
            // Learning level slider
            elements.learningLevel.addEventListener('input', () => {
                sounds.sliderMove();
                gameState.learningLevel = parseInt(elements.learningLevel.value);
                updateLearningLevelDisplay();
                triangleSketch.updateTriangle();
            });
            
            // Sound toggle
            elements.soundToggle.addEventListener('change', () => {
                gameState.soundEnabled = elements.soundToggle.checked;
                
                // Play a sound to confirm if enabled
                if (gameState.soundEnabled) {
                    sounds.click();
                }
            });
            
            // Color theme selector
            elements.colorTheme.addEventListener('change', () => {
                sounds.click();
                gameState.colorTheme = elements.colorTheme.value;
            });
            
            // Animation speed slider
            elements.animationSpeed.addEventListener('input', () => {
                sounds.sliderMove();
                gameState.animationSpeed = parseInt(elements.animationSpeed.value);
                updateAnimationSpeedDisplay();
            });
        }

        // Update learning level display
        function updateLearningLevelDisplay() {
            const levelTexts = [
                "Level 1: Basic",
                "Level 2: Intermediate",
                "Level 3: Advanced",
                "Level 4: Expert",
                "Level 5: Genius"
            ];
            
            elements.learningLevelValue.textContent = levelTexts[gameState.learningLevel - 1];
        }

        // Update animation speed display
        function updateAnimationSpeedDisplay() {
            const speedTexts = [
                "None",
                "Slow",
                "Normal",
                "Fast",
                "Super Fast"
            ];
            
            elements.animationSpeedValue.textContent = speedTexts[gameState.animationSpeed - 1];
        }

        // Start the game
        function startGame() {
            // Hide title screen and show explore screen
            elements.titleScreen.style.opacity = '0';
            setTimeout(() => {
                elements.titleScreen.style.display = 'none';
                elements.exploreScreen.style.display = 'flex';
                gameState.currentScreen = 'explore';
            }, 1000);
        }

        // Start the quiz
        function startQuiz() {
            // Generate quiz questions
            gameState.quizState.questions = generateQuizQuestions();
            gameState.quizState.currentQuestion = 0;
            gameState.quizState.score = 0;
            
            // Hide explore screen and show quiz screen
            elements.exploreScreen.style.display = 'none';
            elements.quizScreen.style.display = 'flex';
            gameState.currentScreen = 'quiz';
            
            // Load the first question
            loadQuestion();
        }

        // Load a quiz question
        function loadQuestion() {
            const currentQ = gameState.quizState.questions[gameState.quizState.currentQuestion];
            
            // Reset quiz state
            gameState.quizState.selectedOption = null;
            gameState.quizState.answered = false;
            
            // Update progress bar
            const progress = (gameState.quizState.currentQuestion / gameState.quizState.questions.length) * 100;
            elements.quizProgress.style.width = `${progress}%`;
            
            // Set question text
            elements.quizQuestion.textContent = currentQ.question;
            
            // Create options
            elements.quizOptions.innerHTML = '';
            currentQ.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                
                optionElement.addEventListener('click', () => {
                    sounds.click();
                    
                    // Only allow selection if question hasn't been answered yet
                    if (!gameState.quizState.answered) {
                        // Remove selected class from all options
                        const allOptions = elements.quizOptions.querySelectorAll('.quiz-option');
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        optionElement.classList.add('selected');
                        
                        // Update selected option
                        gameState.quizState.selectedOption = index;
                    }
                });
                
                elements.quizOptions.appendChild(optionElement);
            });
            
            // Reset feedback and buttons
            elements.quizFeedback.textContent = '';
            elements.checkAnswerButton.style.display = 'block';
            elements.nextButton.style.display = 'none';
        }

        // Check the current answer
        function checkAnswer() {
            // If no option selected or already answered, do nothing
            if (gameState.quizState.selectedOption === null || gameState.quizState.answered) {
                return;
            }
            
            gameState.quizState.answered = true;
            const currentQ = gameState.quizState.questions[gameState.quizState.currentQuestion];
            const isCorrect = gameState.quizState.selectedOption === currentQ.correctAnswer;
            
            // Get all options and highlight correct/incorrect
            const allOptions = elements.quizOptions.querySelectorAll('.quiz-option');
            allOptions.forEach((opt, index) => {
                if (index === currentQ.correctAnswer) {
                    opt.classList.add('correct');
                } else if (index === gameState.quizState.selectedOption) {
                    if (!isCorrect) {
                        opt.classList.add('incorrect');
                    }
                }
            });
            
            // Show feedback
            elements.quizFeedback.textContent = isCorrect ? currentQ.feedback : "Try again! Let's see the correct answer.";
            
            // Play sound
            if (isCorrect) {
                sounds.correct();
                gameState.quizState.score++;
                
                // Create celebration effect for correct answers
                createCelebration();
            } else {
                sounds.incorrect();
            }
            
            // Show next button, hide check answer button
            elements.checkAnswerButton.style.display = 'none';
            elements.nextButton.style.display = 'block';
        }

        // Move to the next question or end the quiz
        function nextQuestion() {
            // Increment current question
            gameState.quizState.currentQuestion++;
            
            // Check if we've reached the end of the quiz
            if (gameState.quizState.currentQuestion >= gameState.quizState.questions.length) {
                endQuiz();
            } else {
                loadQuestion();
            }
        }

        // End the quiz and show results
        function endQuiz() {
            // Calculate final score percentage
            const scorePercentage = Math.round((gameState.quizState.score / gameState.quizState.questions.length) * 100);
            
            // Create result display
            elements.quizQuestion.textContent = `Quiz Complete!`;
            elements.quizOptions.innerHTML = `
                <div style="text-align: center; font-size: 1.5em; margin: 20px;">
                    <p>You scored ${gameState.quizState.score} out of ${gameState.quizState.questions.length} questions correctly (${scorePercentage}%)!</p>
                    <p>${scorePercentage >= 80 ? 'Amazing job! You\'re a triangle genius!' : 'Good effort! Keep practicing to become a triangle master!'}</p>
                </div>
            `;
            
            // Hide feedback and check answer button
            elements.quizFeedback.textContent = '';
            elements.checkAnswerButton.style.display = 'none';
            
            // Change next button to return to explorer
            elements.nextButton.textContent = 'Back to Explorer';
            elements.nextButton.style.display = 'block';
            
            // Update next button event listener for one-time use
            const originalNextButton = elements.nextButton;
            const newNextButton = originalNextButton.cloneNode(true);
            originalNextButton.parentNode.replaceChild(newNextButton, originalNextButton);
            elements.nextButton = newNextButton;
            
            elements.nextButton.addEventListener('click', () => {
                sounds.click();
                
                // Return to explorer screen
                elements.quizScreen.style.display = 'none';
                elements.exploreScreen.style.display = 'flex';
                gameState.currentScreen = 'explore';
                
                // Reset next button text
                elements.nextButton.textContent = 'Next Question';
            });
            
            // Create celebration effect for completing the quiz
            createCelebration();
        }

        // Initialize the game
        function init() {
            // Create p5.js sketch
            triangleSketch = createTriangleSketch();
            
            // Initialize audio
            initAudio();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize learning level display
            updateLearningLevelDisplay();
            
            // Initialize animation speed display
            updateAnimationSpeedDisplay();
        }

        // Start the game when the page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
