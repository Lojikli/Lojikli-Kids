<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Mathematics Learning Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@500;600;700&display=swap');
        
        :root {
            --primary: #2b6cb0;
            --primary-light: #3182ce;
            --secondary: #38b2ac;
            --accent: #ed8936;
            --background: #f7fafc;
            --card-bg: #ffffff;
            --text: #2d3748;
            --text-light: #4a5568;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --module-numbers: linear-gradient(135deg, #3182ce 0%, #63b3ed 100%);
            --module-shapes: linear-gradient(135deg, #38b2ac 0%, #4fd1c5 100%);
            --module-advanced: linear-gradient(135deg, #805ad5 0%, #b794f4 100%);
            --module-puzzles: linear-gradient(135deg, #dd6b20 0%, #f6ad55 100%);
            --module-games: linear-gradient(135deg, #2f855a 0%, #68d391 100%);
            --module-discovery: linear-gradient(135deg, #c53030 0%, #fc8181 100%);
        }
        
        .dark-mode {
            --background: #1a202c;
            --card-bg: #2d3748;
            --text: #f7fafc;
            --text-light: #e2e8f0;
            --border: #4a5568;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 4rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 2rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            position: relative;
            z-index: 2;
        }
        
        h1, h2, h3 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #ffffff, #f0f4ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 600px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .header-shapes {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }
        
        .header-shape {
            position: absolute;
            opacity: 0.1;
            background-color: white;
        }
        
        .shape-1 {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            top: -40px;
            right: 10%;
        }
        
        .shape-2 {
            width: 80px;
            height: 80px;
            transform: rotate(45deg);
            bottom: 20px;
            right: 20%;
        }
        
        .shape-3 {
            width: 100px;
            height: 100px;
            border-radius: 30%;
            top: 30%;
            right: 5%;
        }
        
        /* Controls section */
        .controls-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px var(--shadow);
        }
        
        .controls-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        @media (min-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .age-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .search-filter {
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .search-input {
            flex: 1;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 0.8rem;
            color: var(--text-light);
        }
        
        .age-btn {
            background-color: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 50px;
            padding: 0.5rem 1.5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .age-btn:hover, .age-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 6px rgba(43, 108, 176, 0.2);
        }
        
        .age-btn.toddler {
            border-color: #f6ad55;
        }
        
        .age-btn.toddler:hover, .age-btn.toddler.active {
            background-color: #f6ad55;
            border-color: #f6ad55;
            box-shadow: 0 4px 6px rgba(246, 173, 85, 0.2);
        }
        
        .age-btn.kindergarten {
            border-color: #4fd1c5;
        }
        
        .age-btn.kindergarten:hover, .age-btn.kindergarten.active {
            background-color: #4fd1c5;
            border-color: #4fd1c5;
            box-shadow: 0 4px 6px rgba(79, 209, 197, 0.2);
        }
        
        /* Loading spinner */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem 0;
            flex-direction: column;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        .loading-text {
            color: var(--text-light);
            font-weight: 600;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Module grid */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .module {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
        }
        
        .module:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
        }
        
        .module-header {
            background: var(--module-numbers);
            padding: 1.5rem;
            position: relative;
        }
        
        .module-icon {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .module-title {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            padding-right: 2rem;
        }
        
        .module-age {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.25rem 0.75rem;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.8rem;
            color: white;
        }
        
        .game-list {
            list-style: none;
            padding: 1.5rem;
            min-height: 200px;
        }
        
        .game-item {
            margin-bottom: 0.75rem;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        
        .game-item:nth-child(1) { animation-delay: 0.1s; }
        .game-item:nth-child(2) { animation-delay: 0.2s; }
        .game-item:nth-child(3) { animation-delay: 0.3s; }
        .game-item:nth-child(4) { animation-delay: 0.4s; }
        .game-item:nth-child(5) { animation-delay: 0.5s; }
        
        .game-item:last-child {
            margin-bottom: 0;
        }
        
        .game-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            background-color: rgba(0, 0, 0, 0.02);
            border-left: 3px solid transparent;
        }
        
        .game-link:hover {
            background-color: rgba(0, 0, 0, 0.05);
            border-left-color: var(--primary);
            transform: translateX(5px);
        }
        
        .game-icon {
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background-color: var(--primary-light);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .game-name {
            font-weight: 600;
        }
        
        .game-type {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-left: auto;
            padding-left: 1rem;
        }
        
        /* Module color variations */
        .module.numbers .module-header {
            background: var(--module-numbers);
        }
        
        .module.shapes .module-header {
            background: var(--module-shapes);
        }
        
        .module.advanced .module-header {
            background: var(--module-advanced);
        }
        
        .module.puzzles .module-header {
            background: var(--module-puzzles);
        }
        
        .module.games .module-header {
            background: var(--module-games);
        }
        
        .module.discovery .module-header {
            background: var(--module-discovery);
        }
        
        /* Match game icons to modules */
        .module.numbers .game-icon {
            background-color: #63b3ed;
        }
        
        .module.shapes .game-icon {
            background-color: #4fd1c5;
        }
        
        .module.advanced .game-icon {
            background-color: #b794f4;
        }
        
        .module.puzzles .game-icon {
            background-color: #f6ad55;
        }
        
        .module.games .game-icon {
            background-color: #68d391;
        }
        
        .module.discovery .game-icon {
            background-color: #fc8181;
        }
        
        /* No results message */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px var(--shadow);
        }
        
        .no-results-icon {
            font-size: 4rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .no-results-title {
            font-size: 1.5rem;
            color: var(--text);
            margin-bottom: 0.5rem;
        }
        
        .no-results-msg {
            color: var(--text-light);
        }
        
        footer {
            background-color: var(--card-bg);
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .footer-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            font-family: 'Poppins', sans-serif;
        }
        
        /* Interactive welcome banner */
        .welcome-banner {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0 2rem;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 15px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .banner-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(49, 130, 206, 0.05) 0%, rgba(49, 130, 206, 0) 70%);
            z-index: 0;
        }
        
        .banner-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .banner-title {
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 1.7rem;
        }
        
        .banner-text {
            color: var(--text-light);
            margin-bottom: 1.5rem;
            max-width: 600px;
        }
        
        .banner-btn {
            display: inline-block;
            background-color: var(--accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .banner-btn:hover {
            background-color: #dd6b20;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(237, 137, 54, 0.3);
        }
        
        .banner-image {
            margin-left: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .banner-img {
            width: 180px;
            height: 180px;
            object-fit: contain;
        }
        
        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        
        /* Animation classes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Pulse animation */
        .pulse {
            animation: pulse 2.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .float {
            animation: float 5s infinite ease-in-out;
        }
        
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        
        /* Stats counter */
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            min-width: 180px;
            flex: 1;
            text-align: center;
            box-shadow: 0 4px 6px var(--shadow);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-family: 'Poppins', sans-serif;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 1rem;
        }
        
        /* Status message */
        .status-message {
            background-color: #ebf8ff;
            border-left: 4px solid var(--primary);
            color: var(--primary);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            display: none;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            .banner-image {
                display: none;
            }
            
            .welcome-banner {
                text-align: center;
            }
            
            .stats-container {
                flex-direction: column;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 45px;
                height: 45px;
            }
            
            .module-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-shapes">
            <div class="header-shape shape-1"></div>
            <div class="header-shape shape-2"></div>
            <div class="header-shape shape-3"></div>
        </div>
        <div class="header-content">
            <h1>Interactive Mathematics Learning Center</h1>
            <p>Engaging educational games designed by experts to make learning mathematics fun and effective for young minds.</p>
        </div>
    </header>
    
    <div class="container">
        <div class="welcome-banner">
            <div class="banner-bg"></div>
            <div class="banner-content">
                <h3 class="banner-title">Welcome to our Learning Adventure!</h3>
                <p class="banner-text">Our educational games combine fun and learning to help young minds develop strong mathematical foundations while enjoying themselves.</p>
                <a href="#modules" class="banner-btn pulse">Explore Activities</a>
            </div>
            <div class="banner-image">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cstyle%3E.st0%7Bfill:%233182ce%7D.st1%7Bfill:%2363b3ed%7D.st2%7Bfill:%23f6ad55%7D.st3%7Bfill:%234fd1c5%7D.st4%7Bfill:%23fff%7D%3C/style%3E%3Ccircle cx='100' cy='100' r='90' fill='%23f7fafc'/%3E%3Cpath class='st0' d='M70 60h60v80H70z'/%3E%3Cpath class='st1' d='M80 70h40v60H80z'/%3E%3Ccircle class='st2' cx='150' cy='60' r='20'/%3E%3Ccircle class='st3' cx='40' cy='50' r='15'/%3E%3Cpath class='st2' d='M25 120l30-15 30 15v30H25z'/%3E%3Ccircle class='st4' cx='100' cy='100' r='15'/%3E%3Cpath class='st4' d='M94 90h12v20H94zm-4-30h20v10H90z'/%3E%3C/svg%3E" alt="Learning Adventure" class="banner-img float">
            </div>
        </div>
        
        <div class="status-message" id="statusMessage">
            <i class="fas fa-info-circle"></i> <span id="statusText">Loading resources...</span>
        </div>
        
        <div class="controls-section">
            <h3 class="controls-title">Find the Perfect Learning Activity</h3>
            <div class="controls-grid">
                <div class="age-filter" id="ageFilter">
                    <button class="age-btn all active" data-age="all">All Ages</button>
                    <button class="age-btn toddler" data-age="toddler">Toddlers (2-3 years)</button>
                    <button class="age-btn kindergarten" data-age="kindergarten">Early Learners (4-5 years)</button>
                </div>
                <div class="search-filter">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search activities...">
                </div>
            </div>
        </div>
        
        <div class="loading-container" id="loadingContainer">
            <div class="spinner"></div>
            <p class="loading-text">Loading learning activities...</p>
        </div>
        
        <div class="stats-container" id="statsContainer" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalActivities">0</div>
                <div class="stat-label">Total Activities</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="toddlerActivities">0</div>
                <div class="stat-label">Toddler Friendly</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="kindergartenActivities">0</div>
                <div class="stat-label">Early Learner</div>
            </div>
        </div>
        
        <div class="module-grid" id="moduleGrid">
            <!-- Modules will be dynamically generated here -->
        </div>
    </div>
    
    <footer>
        <div class="footer-content">
            <div class="footer-logo">Interactive Mathematics Learning Center</div>
            <p>Designed to foster mathematical thinking and problem-solving skills in young minds through engaging educational content.</p>
        </div>
    </footer>
    
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const moduleGrid = document.getElementById('moduleGrid');
            const loadingContainer = document.getElementById('loadingContainer');
            const ageButtons = document.querySelectorAll('.age-btn');
            const searchInput = document.getElementById('searchInput');
            const themeToggle = document.getElementById('themeToggle');
            const statsContainer = document.getElementById('statsContainer');
            const totalActivitiesEl = document.getElementById('totalActivities');
            const toddlerActivitiesEl = document.getElementById('toddlerActivities');
            const kindergartenActivitiesEl = document.getElementById('kindergartenActivities');
            const statusMessage = document.getElementById('statusMessage');
            const statusText = document.getElementById('statusText');
            
            // State variables
            let allActivities = [];
            let filteredActivities = [];
            let currentAgeFilter = 'all';
            let currentSearchTerm = '';
            let isDarkMode = false;
            
            // Module categories
            const moduleCategories = [
                {
                    id: 'numbers',
                    name: 'Number Exploration',
                    icon: 'üî¢',
                    keywords: ['number', 'count', 'math', 'add', 'subtract', 'multiply', 'divide', 'arithmetic']
                },
                {
                    id: 'shapes',
                    name: 'Pattern & Logic',
                    icon: 'üìä',
                    keywords: ['pattern', 'logic', 'shape', 'geometry', 'statistic', 'data']
                },
                {
                    id: 'advanced',
                    name: 'Advanced Concepts',
                    icon: 'üéì',
                    keywords: ['advanced', 'calculus', 'algebra', 'trig', 'quantum', 'vector']
                },
                {
                    id: 'puzzles',
                    name: 'Puzzle Collection',
                    icon: 'üß©',
                    keywords: ['puzzle', 'mahjong', 'match', 'tile', 'problem', 'challenge']
                },
                {
                    id: 'games',
                    name: 'Strategy Games',
                    icon: 'üéÆ',
                    keywords: ['game', 'strategy', 'lemming', 'solitaire', 'sort', 'problem', 'solve']
                },
                {
                    id: 'discovery',
                    name: 'Discovery Center',
                    icon: 'üîç',
                    keywords: ['discover', 'explore', 'world', 'geography', 'tech', 'brain', 'convert', 'unit']
                }
            ];
            
            // File extension to icon mapping
            const fileIcons = {
                'html': 'üåê',
                'pdf': 'üìÑ',
                'js': 'üìú',
                'css': 'üé®',
                'jpg': 'üñºÔ∏è',
                'jpeg': 'üñºÔ∏è',
                'png': 'üñºÔ∏è',
                'gif': 'üéûÔ∏è',
                'md': 'üìù',
                'json': 'üîß',
                'txt': 'üìù',
                'svg': 'üéØ',
                'zip': 'üì¶',
                'default': 'üìÇ'
            };
            
            // Helper function to show status message
            function showStatus(message, isError = false) {
                statusText.textContent = message;
                statusMessage.style.display = 'block';
                
                if (isError) {
                    statusMessage.style.backgroundColor = '#FFF5F5';
                    statusMessage.style.borderLeftColor = '#F56565';
                    statusMessage.style.color = '#C53030';
                } else {
                    statusMessage.style.backgroundColor = '#EBF8FF';
                    statusMessage.style.borderLeftColor = '#3182CE';
                    statusMessage.style.color = '#2B6CB0';
                }
                
                // Hide after 5 seconds
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
            
            // Function to parse filenames and determine categories
            function categorizeActivity(filename) {
                const activity = {
                    filename: filename,
                    displayName: prettifyName(filename),
                    ageGroups: [],
                    category: null,
                    extension: getFileExtension(filename),
                    url: filename // URL is just the filename since they're in the same directory
                };
                
                // Determine age group based on filename
                if (filename.toLowerCase().includes('2 yr') || 
                    filename.toLowerCase().includes('toddler') || 
                    filename.toLowerCase().includes('2-3') ||
                    filename.toLowerCase().includes('2yr')) {
                    activity.ageGroups.push('toddler');
                }
                
                if (filename.toLowerCase().includes('5') || 
                    filename.toLowerCase().includes('kindergarten') || 
                    filename.toLowerCase().includes('early') ||
                    !activity.ageGroups.includes('toddler')) { // Default to kindergarten if not specified
                    activity.ageGroups.push('kindergarten');
                }
                
                // Determine category based on keywords
                for (const category of moduleCategories) {
                    for (const keyword of category.keywords) {
                        if (filename.toLowerCase().includes(keyword)) {
                            activity.category = category.id;
                            break;
                        }
                    }
                    if (activity.category) break;
                }
                
                // Default category if not found
                if (!activity.category) {
                    // Try to determine category from file extension
                    if (activity.extension === 'pdf') {
                        activity.category = 'discovery';
                    } else if (['jpg', 'jpeg', 'png', 'gif', 'svg'].includes(activity.extension)) {
                        activity.category = 'discovery';
                    } else {
                        activity.category = 'games'; // Default fallback
                    }
                }
                
                return activity;
            }
            
            // Helper function to get file extension
            function getFileExtension(filename) {
                return filename.split('.').pop().toLowerCase();
            }
            
            // Helper function to prettify display names
            function prettifyName(filename) {
                // Remove file extension
                let name = filename.split('.').slice(0, -1).join('.');
                
                // Replace hyphens and underscores with spaces
                name = name.replace(/[-_]/g, ' ');
                
                // Remove version indicators like "v2", "v3"
                name = name.replace(/\s+v\d+/gi, '');
                
                // Capitalize first letter of each word
                name = name.replace(/\w\S*/g, function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
                
                // Remove any trailing numbers or special chars
                name = name.replace(/\s+\d+$/, '');
                
                return name;
            }
            
            // Function to get appropriate icon for a file
            function getFileIcon(activity) {
                if (fileIcons[activity.extension]) {
                    return fileIcons[activity.extension];
                }
                return fileIcons.default;
            }
            
            // Function to organize activities into modules
            function organizeIntoModules(activities) {
                const modules = {};
                
                // Initialize modules
                moduleCategories.forEach(category => {
                    modules[category.id] = {
                        id: category.id,
                        name: category.name,
                        icon: category.icon,
                        activities: []
                    };
                });
                
                // Sort activities into modules
                activities.forEach(activity => {
                    if (modules[activity.category]) {
                        modules[activity.category].activities.push(activity);
                    } else {
                        // Fallback for uncategorized activities
                        modules.games.activities.push(activity);
                    }
                });
                
                return Object.values(modules).filter(module => module.activities.length > 0);
            }
            
            // Function to render modules and activities
            function renderModules(modules) {
                moduleGrid.innerHTML = '';
                
                if (modules.length === 0) {
                    moduleGrid.innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <h3 class="no-results-title">No Activities Found</h3>
                            <p class="no-results-msg">Try changing your search terms or filters.</p>
                        </div>
                    `;
                    return;
                }
                
                modules.forEach((module, index) => {
                    const moduleElement = document.createElement('div');
                    moduleElement.className = `module ${module.id}`;
                    moduleElement.style.animationDelay = `${index * 0.1}s`;
                    
                    let activitiesHTML = '';
                    
                    // Sort activities alphabetically
                    module.activities.sort((a, b) => a.displayName.localeCompare(b.displayName));
                    
                    module.activities.forEach(activity => {
                        const icon = getFileIcon(activity);
                        const ageClasses = activity.ageGroups.map(age => `age-${age}`).join(' ');
                        
                        activitiesHTML += `
                            <li class="game-item ${ageClasses}">
                                <a href="${activity.url}" target="_blank" class="game-link">
                                    <span class="game-icon">${icon}</span>
                                    <span class="game-name">${activity.displayName}</span>
                                    <span class="game-type">.${activity.extension}</span>
                                </a>
                            </li>
                        `;
                    });
                    
                    const ageRange = determineModuleAgeRange(module.activities);
                    
                    moduleElement.innerHTML = `
                        <div class="module-header">
                            <h2 class="module-title">${module.name}</h2>
                            <span class="module-age">${ageRange}</span>
                            <div class="module-icon">${module.icon}</div>
                        </div>
                        <ul class="game-list">
                            ${activitiesHTML}
                        </ul>
                    `;
                    
                    moduleGrid.appendChild(moduleElement);
                });
            }
            
            // Helper to determine age range for a module
            function determineModuleAgeRange(activities) {
                const hasToddler = activities.some(activity => activity.ageGroups.includes('toddler'));
                const hasKindergarten = activities.some(activity => activity.ageGroups.includes('kindergarten'));
                
                if (hasToddler && hasKindergarten) {
                    return "Ages 2-5";
                } else if (hasToddler) {
                    return "Ages 2-3";
                } else {
                    return "Ages 4-5+";
                }
            }
            
            // Function to update statistics
            function updateStats(activities) {
                const total = activities.length;
                const toddler = activities.filter(a => a.ageGroups.includes('toddler')).length;
                const kindergarten = activities.filter(a => a.ageGroups.includes('kindergarten')).length;
                
                // Animate count up
                animateCountUp(totalActivitiesEl, total);
                animateCountUp(toddlerActivitiesEl, toddler);
                animateCountUp(kindergartenActivitiesEl, kindergarten);
                
                statsContainer.style.display = 'flex';
            }
            
            // Helper for count animation
            function animateCountUp(element, target) {
                const duration = 1000; // ms
                const start = parseInt(element.textContent);
                const increment = (target - start) / (duration / 16);
                let current = start;
                
                const timer = setInterval(() => {
                    current += increment;
                    if ((increment > 0 && current >= target) || 
                        (increment < 0 && current <= target)) {
                        clearInterval(timer);
                        current = target;
                    }
                    element.textContent = Math.round(current);
                }, 16);
            }
            
            // Function to filter activities
            function filterActivities() {
                const searchTerm = currentSearchTerm.toLowerCase();
                
                filteredActivities = allActivities.filter(activity => {
                    // Filter by age
                    const ageMatches = currentAgeFilter === 'all' || 
                                      activity.ageGroups.includes(currentAgeFilter);
                    
                    // Filter by search term
                    const searchMatches = searchTerm === '' || 
                                          activity.displayName.toLowerCase().includes(searchTerm) ||
                                          activity.filename.toLowerCase().includes(searchTerm);
                    
                    return ageMatches && searchMatches;
                });
                
                const modules = organizeIntoModules(filteredActivities);
                renderModules(modules);
            }
            
            // Event listeners for age filter buttons
            ageButtons.forEach(button => {
                button.addEventListener('click', function() {
                    ageButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentAgeFilter = this.getAttribute('data-age');
                    filterActivities();
                });
            });
            
            // Event listener for search input
            searchInput.addEventListener('input', function() {
                currentSearchTerm = this.value.trim();
                filterActivities();
            });
            
            // Theme toggle functionality
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                isDarkMode = !isDarkMode;
                
                if (isDarkMode) {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            });
            
            // Main function to fetch directory contents
            async function fetchDirectoryContents() {
                try {
                    let owner = ''; // GitHub username
                    let repo = ''; // Repository name
                    
                    // Try to extract repository info from URL
                    const pathParts = window.location.pathname.split('/');
                    
                    if (window.location.hostname === 'github.com' || 
                        window.location.hostname.endsWith('github.io')) {
                        // Handle GitHub Pages domain
                        if (window.location.hostname.endsWith('github.io')) {
                            owner = window.location.hostname.replace('.github.io', '');
                            if (pathParts.length > 1) {
                                repo = pathParts[1];
                            }
                        } 
                        // Handle github.com domain
                        else if (window.location.hostname === 'github.com' && pathParts.length > 2) {
                            owner = pathParts[1];
                            repo = pathParts[2];
                        }
                    }
                    
                    // If we couldn't determine the repository info, use an alternative method
                    if (!owner || !repo) {
                        // Fall back to directory scanning with the Fetch API
                        await fetchWithFallback();
                        return;
                    }
                    
                    // Determine the path within the repository
                    let path = '';
                    const repoIndex = pathParts.indexOf(repo);
                    if (repoIndex !== -1 && pathParts.length > repoIndex + 1) {
                        path = pathParts.slice(repoIndex + 1).join('/');
                    }
                    
                    // Use the GitHub API to fetch repository contents
                    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`GitHub API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Filter for files only (exclude directories)
                    const files = Array.isArray(data) ? 
                        data.filter(item => item.type === 'file') : 
                        (data.type === 'file' ? [data] : []);
                    
                    // Process the files
                    allActivities = files.map(file => categorizeActivity(file.name));
                    
                    // Update UI
                    loadingContainer.style.display = 'none';
                    updateStats(allActivities);
                    
                    // Initial render
                    filteredActivities = [...allActivities];
                    const modules = organizeIntoModules(filteredActivities);
                    renderModules(modules);
                    
                } catch (error) {
                    console.error('Error fetching directory contents:', error);
                    
                    // Try fallback method
                    await fetchWithFallback();
                }
            }
            
            // Fallback method to scan local directory
            async function fetchWithFallback() {
                try {
                    // Try to fetch a list of files from a potential "files.json" resource
                    const response = await fetch('files.json');
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (Array.isArray(data)) {
                            allActivities = data.map(filename => categorizeActivity(filename));
                        } else if (data.files && Array.isArray(data.files)) {
                            allActivities = data.files.map(filename => categorizeActivity(filename));
                        }
                    } else {
                        // If no files.json, create one with demo data
                        createDemoData();
                    }
                    
                    // Update UI
                    loadingContainer.style.display = 'none';
                    updateStats(allActivities);
                    
                    // Initial render
                    filteredActivities = [...allActivities];
                    const modules = organizeIntoModules(filteredActivities);
                    renderModules(modules);
                    
                    // Show instructions for setup
                    if (allActivities.length === 0 || allActivities[0].isDemoData) {
                        showSetupInstructions();
                    }
                    
                } catch (error) {
                    console.error('Fallback method error:', error);
                    createDemoData();
                    
                    // Update UI with demo data
                    loadingContainer.style.display = 'none';
                    updateStats(allActivities);
                    
                    filteredActivities = [...allActivities];
                    const modules = organizeIntoModules(filteredActivities);
                    renderModules(modules);
                    
                    showSetupInstructions();
                }
            }
            
            // Function to create demo data for initial setup
            function createDemoData() {
                const demoFiles = [
                    'area-volume-game.html',
                    'triangle-explorer-game.html',
                    'unit-conversion-game.html',
                    'toddler-math-zone.html',
                    'binomial-blocks-game.html',
                    'statistics-game.html',
                    'calculus-game.html',
                    'trig-adventure.html',
                    'matching-tiles-game.html',
                    'problem-solvers-game.html',
                    'world-explorer-game.html',
                    'measurement-story.pdf'
                ];
                
                allActivities = demoFiles.map(filename => {
                    const activity = categorizeActivity(filename);
                    activity.isDemoData = true;
                    return activity;
                });
            }
            
            // Function to show setup instructions
            function showSetupInstructions() {
                showStatus("Setup required: Create a files.json to index your content.", true);
                
                // Create a files.json template for the user
                const setupBox = document.createElement('div');
                setupBox.className = 'welcome-banner';
                setupBox.style.marginTop = '2rem';
                
                setupBox.innerHTML = `
                    <div class="banner-content">
                        <h3 class="banner-title">Setup Your Dynamic Index</h3>
                        <p class="banner-text">
                            To make this index page automatically detect your files, create a <strong>files.json</strong> 
                            file in the same directory with the following format:
                        </p>
                        <pre style="background-color: rgba(0,0,0,0.05); padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; font-family: monospace;">
{
    "files": [
        "game1.html",
        "game2.html",
        "story.pdf",
        "activity-sheet.html",
        "toddler-game.html"
        // Add all your filenames here
    ]
}
                        </pre>
                        <p class="banner-text">
                            The system will automatically categorize files based on their names and extensions.
                        </p>
                    </div>
                `;
                
                document.querySelector('.container').appendChild(setupBox);
            }
            
            // Start the app
            fetchDirectoryContents();
        });
    </script>
</body>
</html>
